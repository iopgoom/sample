(function(Core){
	'use strict';

	if(typeof define === "function" && define.amd) {
		define("Core", [], function(){
			return Core();
		});
	}else{
		window['Core'] = Core();
	}
})(function(){
	'use strict';

	var UI = {}; // Core;
	var moduleData = {}; //module
	var moduleSelector = {};
	var Sandbox = function(){
		var args = Array.prototype.slice.call(arguments);
		var callback = args.pop();
		var modules = (args[0] && typeof args[0] === 'string') ? args:args[0];

		return {
			rtnJson:function(data, notevil){
				return UI.Utils.strToJson(data, notevil || true);
			},
			uiInit:function(data){
				return UI.moduleBehavior(data);
			},
			sliderBar:function(data){
				return UI.SliderBar.call(data.context, data.callback);
			},
			rtnPrice:function(price){
				return UI.Utils.price(price);
			},
			rtnObjLength:function(obj){
				return UI.Utils.objLengtn(obj);
			},
			getModule:function(moduleID){
				return UI.getModule(moduleID);
			},
			getComponents:function(componentID, setting, callback){
				return UI.getComponents(componentID, setting, callback);
			},
			moduleEventInjection:function(strHtml, defer){
				UI.moduleEventInjection(strHtml, defer);
			},
			scrollController:function(wrapper, container, callback, id){
				return UI.Scrollarea.setScrollArea(wrapper, container, callback, id);
			},
			utils:UI.Utils,
			setLoadingBarState:function(isLoad){
				if(isLoad) UI.Loading.show();
				else UI.Loading.hide();
			},
			validation:UI.validation,
			ga:UI.ga,
			aaNew:UI.aaNew,
			reSize:UI.reSizeWidth,
			cookie:UI.cookie,
			sessionHistory:UI.sessionHistory
		}
	}

	UI.register = function(moduleID, creator){
		//console.log(new Object({'moduleid':moduleID, 'creator':creator}));
		moduleData[moduleID] = {
			creator:creator,
			instance:null
		}
	}

	UI.init = function(moduleID){
		moduleData[moduleID].instance = moduleData[moduleID].creator(new Sandbox(this));
		moduleData[moduleID].instance.init();
		/*deplicated*/
		/*
			body의 Dom요소의 moduleName에 따라 모듈실행
		*/
		/*if(moduleData[moduleID].instance !== undefined && moduleData[moduleID].instance.init !== undefined && typeof moduleData[moduleID].instance.init == 'function'){
			moduleData[moduleID].instance.init();
		}*/
	}

	UI.destroy = function(moduleID){
		var data = moduleData[moduleID];
		if(data.instance && moduleData[moduleID].instance.destroy !== undefined && typeof moduleData[moduleID].instance.destroy == 'function'){
			data.instance.destroy();
			delete data.instance;
		}
	}

	UI.initAll = function(){
		for(var moduleID in moduleData){
			if(moduleData.hasOwnProperty(moduleID)){
				this.init(moduleID);
			}
		}
	}

	UI.destroyAll = function(){
		for(var moduleID in moduleData){
			if(moduleData.hasOwnProperty(moduleID)){
				this.destroy(moduleID);
			}
		}
	}

	UI.getModule = function(moduleID){
		try{
			return moduleData[moduleID].instance;
		}catch(e){
			console.log(moduleID + ' - This module is not defined');
		}
	}

	UI.moduleBehavior = function(data){
		/************************************************************************************************************
			모듈이 실행되는 context 내에 같은 이름( selector )을 가진 template 이 있을경우 모듈의 인스턴스 함수 init이 n번 실행되는 경우 발견
			해당 모듈은 각각의 스코프를 가지고 있기때문에 템플릿 내의 컴포넌트의 기능의 오류는 없으나 메모리를 차지하기 때문에 추후 변경 요망

			모듈 : 페이지내에 하나만 존재
			컴포넌트 : 페이지내에 여러개 존재

			따라서 모듈은 페이지 내에 하나만 존재하는 것이기 때문에 template의 레이아웃을 변경해야한다.
		************************************************************************************************************/

		/*if(data.hasOwnProperty('moduleName')){
			moduleSelector[data.attrName] = data.moduleName;
		}*/

		if($(data.selector).length <= 0) return;
		$(data.selector).each(function(i){
			if(data.hasOwnProperty('attrName')){
				if(data.attrName instanceof Array){
					data.handler.method.call(this, (function(){
						var obj = {};
						for(var i in data.attrName){
							obj[data.attrName[i]] = UI.Utils.strToJson($(this).attr(data.attrName[i]), true);
						}
						return obj;
					}.bind(this))());
				}else{
					data.handler.method.call(this, UI.Utils.strToJson($(this).attr(data.attrName), true));
				}
			}
		});
	}


	UI.getComponents = function(componentID, setting, callback){
		try{
			var _self = this;
			var component = this.Components[componentID];
			var $context = (setting && setting.context) ? setting.context : $('body');
			var attrName = (component.attrName instanceof Array) ? component.attrName[0] : component.attrName;
			var selector = (setting && setting.selector) ? setting.selector : '['+ attrName +']';
			var setting = (setting) ? setting : {};
			var arrComponent = [];
			var reInitIS = component.hasOwnProperty('reInit');

			if(component.hasOwnProperty('constructor') && component.hasOwnProperty('attrName')){
				//기존에 실행되었던 component 를 지운다.

				/*if(this.CurrentComponents.hasOwnProperty(componentID) && component.hasOwnProperty('reInit')){
					for(var i=0; i<this.CurrentComponents[componentID].components.length; i++){
						if(typeof this.CurrentComponents[componentID].components[i].destroy === 'function'){
							this.CurrentComponents[componentID].components[i].destroy();
						}
					}
				}*/

				$context.find(selector).each(function(i){
					var instance;
					var context = $(this).context;
					var indexOf = _self.CurrentComponentsContext.indexOf(context); //(reInitIS) ? _self.CurrentComponentsContext.indexOf(context) : -1;
					setting['selector'] = this;

					if(indexOf > -1){
						instance = _self.CurrentComponents[indexOf].setting(setting);
						//console.log('instance1', instance);
					}else{
						instance = component.constructor().setting(setting).init((function(){
						    if(component.attrName instanceof Array){
						        var obj = {};
        						for(var i in component.attrName){
        							obj[component.attrName[i]] = _self.Utils.strToJson($(this).attr(component.attrName[i]), true);
        						}
        						return obj;
						    }else{
						        return _self.Utils.strToJson($(this).attr(component.attrName), true);
						    }
						}.bind(this))());
						_self.CurrentComponentsContext.push(context);
						_self.CurrentComponents.push(instance);
					}

					if(callback && typeof callback === 'function'){
						callback.call(instance, i, this);
					}

					arrComponent.push(instance);
				});
				//console.log( 'com', (arrComponent.length > 1) ? arrComponent : arrComponent[0] );
				return (arrComponent.length > 1) ? arrComponent : arrComponent[0];
			}else{
				component = null;
				setting = null;
				console.log(componentID + ' - constructor is not defined.');
			}

		}catch(e){
			console.log(e);
		}
	}

	UI.moduleEventInjection = function(strHtml, defer){
		/************************************************************************************************************
			First starting is auto from component, definition is retry that component from module

			component 부터 자동으로 실행되어야한다. module에서 component를 다시 정의하기 때문에 기존의 이벤트들이 삭제되어 아무런 동작을 안한다.
			그리고 기본적인 동작을 하는 component만 실행한다. ( hasOwnProperty( object ) )
		************************************************************************************************************/

		if(!strHtml) return;

		var _self = this;
		var ID = this.Utils.arrSameRemove(strHtml.match(/data-(?:module|component)-+(?:\w|-)*/g)).sort();
		for(var i=0; i<ID.length; i++){
			var name = ID[i].replace(/data-/g, '').replace(/-/g, '_');
			var type = name.replace(/\_\w*/g, '');
			if(type === 'module'){
				try{
					/*if(moduleSelector.hasOwnProperty(ID[i])){
						if(this.getModule(moduleSelector[ID[i]]).hasOwnProperty('destroy')){
							this.getModule(moduleSelector[ID[i]]).destroy();
							delete moduleSelector[ID[i]];
						}
					}

					this.getModule(name).init();*/

					//UI.init
					if(this.getModule(name)){
						if(this.getModule(name).hasOwnProperty('destroy')){
							this.getModule(name).destroy();
							moduleData[name].instance = null;
							//delete moduleSelector[ID[i]];
						}
						//this.getModule(name).init();
					}

					this.init(name);
					if(defer && this.getModule(name).hasOwnProperty('setDeferred')){
						this.getModule(name).setDeferred(defer);
					}

				}catch(e){
					console.log(e);
				}
			}else if(type === 'component'){
				try{
					var component = this.Components[name];
					if(component.hasOwnProperty('constructor') && component.hasOwnProperty('reInit') && component.reInit){
						_self.getComponents(name);
					}else{
						component = null;
					}
				}catch(e){
					console.log(e);
				}

			}
		}
	}

	UI.Components = {};
	UI.CurrentComponentsContext = [];
	UI.CurrentComponents = [];
	UI.Observer = {
		eventID:0,
		addEvent:function(type, handler){
			if(!this.listeners) this.listeners = {};
			if(!this.listeners[type]) this.listeners[type] = {};

			var eventID = this.eventID++;
			this.listeners[type][eventID] = handler;
			return eventID;
		},
		fireEvent:function(type){
			if(!this.listeners || !this.listeners[type]) return false;
			var handlers = this.listeners[type];
			var eventID;
			var args =  Array.prototype.slice.call(arguments);

			if(handlers.stop) return false;

			args.shift();
			for(eventID in handlers) {
				if(handlers.hasOwnProperty(eventID)){
					if(eventID !== "stop"){
						if(!handlers[eventID].stop){
							handlers[eventID].apply(args[0], args[1]);
						}
					}
				}
			}
		},
		removeEvent:function(type, hnd){
			if(!this.listeners || !this.listeners[type]) return -1;
			var handlers = this.listeners[type];
			if(typeof hnd === "function"){
				for(eventID in handlers) if(handlers.hasOwnProperty(f)){
					if(handlers[eventID] === hnd){
						delete handlers[eventID];
						break;
					}
				}
				return !handlers[eventID];
			}else{
				if(handlers[hnd]) delete handlers[hnd]
					return !handlers[hnd];
			}
		},
		applyObserver:function(tclass){
			for(var p in this){
				tclass.prototype[p] = this[p];
			};

			return true;
		}
	}

	UI.Utils = {
		contextPath:(function(){
			try{
			    return _GLOBAL.SITE.CONTEXT_PATH ? _GLOBAL.SITE.CONTEXT_PATH : '';
			}catch(e){
			    return '';
			}
		})(),
		getValidateChk:function(components, msg){
			var isValidateChk = false;
			if(Array.isArray(components)){
				$.each(components, function(i){
					isValidateChk = this.getValidateChk(msg);
				});
			}else{
				isValidateChk = components.getValidateChk(msg);
			}

			return isValidateChk;
		},
		getQueryParams:function(str, type){
			if(!str) return [];

			var data = (type === 'array') ? [] : {};
			str.replace(/([^?=&]+)(?:=([^&]*))/g, function(pattern, key, value){
				if(type === 'array'){
					data.push(pattern);
				}else{
					//data[key] = decodeURI(value);
					if(data.hasOwnProperty(key)){
						if(typeof data[key] === 'object'){
							data[key].push(value);
						}else{
							data[key] = [data[key], value];
						}
					}else{
						data[key] = value;
					}
				}
			});

			return data;
		},
		arrSameRemove:function(arr){
			if(arr === null) return [];
			return arr.reduce(function(a,b){
				if (a.indexOf(b) < 0 ) a.push(b);
				return a;
			},[]);
		},
		objLengtn:function(obj){
			var size = 0, key;
			for (key in obj) {
				if (obj.hasOwnProperty(key)) size++;
			}
			return size;
		},
		trim:function(str){
			return str.replace(/(^\s*)|(\s*$)/gi, '');
		},
		price:function(price){
			//if(!price) return false;
			var temp = price.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,');
			if(_GLOBAL.SITE.USE_KOREA_WON_PRICE_FORMAT == true ){
				temp += '원';
			}
			return temp;
		},
		strToJson:function(str, notevil){
			try{
				// json 데이터에 "가 있을경우 변환할필요가 없으므로 notevil을 false로 변경
				if(str.match(/"/,'g') !== null) notevil = false;
				if(notevil) {
					return JSON.parse(str
						// wrap keys without quote with valid double quote
						.replace(/([\$\w]+)\s*:+([`'~!@#$%^&*?():|_+=\/\w-#().\s가-힣/\[/\]]*)/g, function(_, $1, $2){
							if($2 !== ''){
								return '"'+$1+'":"'+$2+'"';
							}else{
								return '"'+$1+'":""';
							}
						})
						//.replace(/([\$\w]+)\s*:+([`~!@#$%^&*()_=+|{};:,.<>?\s\w가-힣]*)/g, function(_, $1, $2){return '"'+$1+'":"'+$2+'"';})
						//replacing single quote wrapped ones to double quote
						.replace(/'([^']+)'/g, function(_, $1){return '"'+$1+'"';}));
				} else {
					return (new Function("", "var json = " + str + "; return JSON.parse(JSON.stringify(json));"))();
				}
			}catch(e){
				return false;
			}
		},
		mobileChk:(function(){
			return navigator.userAgent.match(/Android|Mobile|iP(hone|od|ad)|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/);
		})(),
		mobileDetect:(function(){
			/*
				console.log( md.mobile() );          // 'Sony'
				console.log( md.phone() );           // 'Sony'
				console.log( md.tablet() );          // null
				console.log( md.userAgent() );       // 'Safari'
				console.log( md.os() );              // 'AndroidOS'
				console.log( md.is('iPhone') );      // false
				console.log( md.is('bot') );         // false
				console.log( md.version('Webkit') );         // 534.3
				console.log( md.versionStr('Build') );       // '4.1.A.0.562'
				console.log( md.match('playstation|xbox') ); // false
			*/
			return new MobileDetect(window.navigator.userAgent);
		})(),
		touch:(window.Modernizr && Modernizr.touch === true) || (function () {
			'use strict';
			return !!(('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch);
		})(),
		transforms3d:(window.Modernizr && Modernizr.csstransforms3d === true) || (function () {
			'use strict';
			var div = document.createElement('div').style;
			return ('webkitPerspective' in div || 'MozPerspective' in div || 'OPerspective' in div || 'MsPerspective' in div || 'perspective' in div);
		})(),
		transforms:(window.Modernizr && Modernizr.csstransforms === true) || (function () {
			'use strict';
			var div = document.createElement('div').style;
			return ('transform' in div || 'WebkitTransform' in div || 'MozTransform' in div || 'msTransform' in div || 'MsTransform' in div || 'OTransform' in div);
		})(),
		transitions:(window.Modernizr && Modernizr.csstransitions === true) || (function () {
			'use strict';
			var div = document.createElement('div').style;
			return ('transition' in div || 'WebkitTransition' in div || 'MozTransition' in div || 'msTransition' in div || 'MsTransition' in div || 'OTransition' in div);
		})(),
		addEvent:function($target, evt, func){
			if(window.addEventListener || document.addEventListener){
				$target.addEventListener(evt, func);
			}else{
				$target.attachEvent('on'+ evt, func);
			}
		},
		removeEvent:function($target, evt, func){
			if(window.addEventListener){
				$target.removeEventListener(evt, func);
			}else{
				$target.detachEvent('on'+ evt, func);
			}
		},
		ajax:function(url, method, data, callback, isCustom, isLoadingBar, delay, dataType, cache){
			//$('.dim').addClass('active');
			if(!isLoadingBar) UI.Loading.show();

			// POST 일때 token 추가, 현재 admin에서만 동작함
			var $tokenForm = $('#tokenForm');
			if( $tokenForm != null && data != null && String(method).toLowerCase() == 'post'){
				if( typeof( data ) == 'object' ){
					if( data.csrfToken == null ){
						data.csrfToken = $tokenForm.find('input[name="csrfToken"]').val();
					}
				}
				if( typeof( data ) == 'string' ){
					data = data + '&' + $tokenForm.serialize()
				}
			}

			$.ajax({
				url:url,
				type:method||'POST',
        		dataType:dataType||'json',
				data:data,
				cache:false||cache,
				complete:function(data){
					//$('.dim').removeClass('active');

					_.delay(function(data){

						if(!isLoadingBar) UI.Loading.hide();
						if(data.status == 200 && data.readyState === 4 || isCustom ){
							callback(data);
						}else{
							UIkit.notify('error : ' + data.status, {timeout:3000,pos:'top-center',status:'danger'});
						}
					},( delay || 100 ), data);
				}
			});
		},
		jsonp:function(url, data, callbackName, callback, isLoadingBar, dataType){
			if(!isLoadingBar) UI.Loading.show();
			$.ajax({
				url:url,
				data:data,
				dataType:'jsonp',
				jsonp:callbackName,
				success:function(data){
					if(!isLoadingBar) UI.Loading.hide();
					callback(data);
				}
			});
		},
		promise:function(opts){
			var isLoadingBar = (opts.isLoadingBar === false) ? opts.isLoadingBar : true;
			if(!opts.url) return false;
			if(isLoadingBar) UI.Loading.show();

			var defer = $.Deferred();
			var promise = $.ajax({
				url:opts.url,
				type:opts.method || 'GET',
				data:opts.data || {},
				success:function(data){
					if(isLoadingBar) UI.Loading.hide();
					if(data.hasOwnProperty('result')){
						if(data.result){
							defer.resolve(data);
						}else{
							defer.reject(data.errorMessage || data.errorMsg || data);
						}
					}else{
						defer.resolve(data);
					}
				},
				error:function(data){
					if(isLoadingBar) UI.Loading.hide();
					defer.reject(data.statusText);
				}
			});

			return defer.promise();
		},
		replaceTemplate:function(template, rtnFunc){
			return template.replace(/{+[\w-]*}+/g, function(pattern){
				return rtnFunc(pattern.replace(/{{|}}/g, ''));
			});
		},
		replaceTemplateTest:function(template, data){
			function rtnTemp(template){
				data.forEach(function(data, i){
					var txt = '';
					var temp = template.replace(/({{each?[\s\w.]+}}{1})([\s\w<>="{}#\/.-]*){{\/each}}/g, function(){
						var argexp = new RegExp(/each/, 'g');
						var args = arguments;
						var arrKeys = args[1].match(/[^{}]/g).join('').replace(/(?:each|\s)/g, '').split(/\./g);
						var tempData = data;

						for(var i=0; i<arrKeys.length; i++){
							if(i > 0){
								tempData = rtnValue(tempData, arrKeys[i]);
							}
						}

						if(argexp.test(args[2])){
							rtnTemp(args[2]);
						}

						txt += args[2].replace(/{+[\w.]*}+/g, function(pattern){
							var arrKeys = pattern.match(/[^{}]/g).join('').split(/\./g);
							var val = data;

							for(var i=0; i<arrKeys.length; i++){
								if(i > 0){
									val = rtnValue(val, arrKeys[i]);
								}
							}

							return val;
						});
					});

					return txt;
				});
			}

			function rtnValue(data, key){
				return data[key];
			}

			return rtnTemp(template);
		},
		url : {
			appendParamToURL:function( url, key, value ){
				var g = "?";
				if ( url.indexOf( g ) !== -1 ){
					g = "&";
				}
				return url + g + key + "=" + ( _.isEmpty($.trim( value )) ? "" : encodeURIComponent( value ))

			},
			appendParamsToUrl: function ( e, i, d ) {
				var g = UI.Utils.url.getUri( e ),
					h = arguments.length < 3 ? false : d;
				var f = $.extend( g.queryParams, i );
				var c = g.path + "?" + $.param( f );
				if ( h ) {
					c += g.hash
				}
				if ( c.indexOf( "http" ) < 0 && c.charAt( 0 ) !== "/" ) {
					c = "/" + c
				}
				return c
			},
			removeParamFromURL: function ( d, k ) {
				var g = d.split( "?" );
				if ( g.length >= 2 ) {
					var c = g.shift();
					var j = g.join( "?" );
					var h = encodeURIComponent( k ) + "=";
					var f = j.split( /[&;]/g );
					var e = f.length;
					while ( 0 < e-- ) {
						if ( f[ e ].lastIndexOf( h, 0 ) !== -1 ) {
							f.splice( e, 1 )
						}
					}
					d = c + "?" + f.join( "&" )
				}
				return d
			},
			updateParamFromURL: function ( e, c, f ) {
				var d = new RegExp( "([?&])" + c + "=.*?(&|$)", "i" );
				var g = e.indexOf( "?" ) !== -1 ? "&" : "?";
				if ( e.match( d ) ) {
					return e.replace( d, "$1" + c + "=" + f + "$2" )
				} else {
					return e + g + c + "=" + f
				}
			},
			staticUrl: function ( c ) {
				if ( !c || a.trim( c ).length === 0 ) {
					return b.urls.staticPath
				}
				return b.urls.staticPath + ( c.charAt( 0 ) === "/" ? c.substr( 1 ) : c )
			},
			ajaxUrl: function ( c ) {
				return UI.Utils.url.appendParamToURL( c, "format", "ajax" )
			},
			toAbsoluteUrl: function ( c ) {
				if ( c.indexOf( "http" ) !== 0 && c.charAt( 0 ) !== "/" ) {
					c = "/" + c
				}
				return c;
			},
			toProtocolNeutralUrl: function ( d ) {
				var c = d ? d.indexOf( "://" ) : -1;
				return c >= 0 ? d.substr( c + 1 ) : d;
			},
			// hot-fix (chohh) -20160513
			getCurrentUrl: function () {
				//return window.location.href
				return window.location.origin + window.location.pathname + window.location.search;
			},
			getQueryStringParams: function ( c ) {
				if ( !c || c.length === 0 ) {
					return {};
				}
				var e = {},
					d = unescape( c );
				d.replace( new RegExp( "([^?=&]+)(=([^&]*))?", "g" ), function ( g, f, i, h ) {
					e[ f ] = h;
				} );
				return e;
			},
			getUri: function ( e ) {
				var c;
				if ( e.tagName && a( e ).attr( "href" ) ) {
					c = e;
				} else {
					if ( typeof e === "string" ) {
						c = document.createElement( "a" );
						c.href = e;
					} else {
						return null;
					}
				}
				var d = ( c.pathname.charAt( 0 ) === "/" ? "" : "/" ) + c.pathname;
				return {
					protocol: c.protocol,
					host: c.host,
					hostname: c.hostname,
					port: c.port,
					path: d,
					query: c.search,
					queryParams: c.search.length > 1 ? UI.Utils.url.getQueryStringParams( c.search.substr( 1 ) ) : {},
					hash: c.hash,
					url: c.protocol + "//" + c.hostname + d,
					urlWithQuery: c.protocol + "//" + c.hostname + c.port + d + c.search
				}
			},
			hashExists: function () {
				return ( window.location.hash ) ? true : false;
			},
			getHashFromUrl: function () {
				return window.location.hash.substring( 1 );
			}
		},
		rtnMatchComma:function(keyword){
			return keyword.match(/[0-9a-zA-Z가-힣\s]+[^,\s]/g) || [];
		}
	}

	UI.Loading = (function(){
		var template = '<div class="loading"><div class="dim"></div><div class="contents"><img src="/cmsstatic/theme/b-commerce/assets/images/preloader.gif" /><span class="comment">처리중 입니다.</span></div></div>';
		var $loading = $('body').append((function(){
			return $('#loading-icon-template').html();
		})() || template).find('.loading');

		return {
			show:function(){
				$loading.focus();
				$loading.addClass('open');
			},
			hide:function(){
				$loading.removeClass('open');
			}
		}
	})();

	UI.Scrollarea = (function(){
		var ScrollArea = function(wrapper, container, callback, id){
			var ID = id || '';
			var $wrapper = $(wrapper);
			var $container = $(container);
			var currentPer = 0;
			var arrCallBackFunc = [];
			var maximumHeight;
			var percent;
			var scrollTop;

			return {
				init:function(){
					var _self = this;
					$wrapper.on('scroll.' + ID, function(e){
						scrollTop = $(this).scrollTop();
						maximumHeight = $container.height() - $(this).height();
						percent = Math.round((scrollTop / maximumHeight) * 100);

						if(callback && typeof callback === 'function'){
							callback.call(_self, percent, scrollTop);
							currentPer = percent;
						}else{
							console.log('Not defined that callbackfunc of scrollEvent');
							$wrapper.off('scroll');
						}
					});

					return _self;
				},
				setScrollTop:function(top){
					$wrapper.scrollTop(top);
					return this;
				},
				setScrollPer:function(per){
					return Math.round((maximumHeight / 100) * per);
				},
				getScrollTop:function(offsetTop){
					return Math.round(((offsetTop - $wrapper.height()) / maximumHeight) * 100);
				},
				getScrollPer:function(){
					return currentPer;
				},
				setAddCallBack:function(callbackfunc){
					arrCallBackFunc.push(callbackfunc);
				},
				destroy:function(){
					$wrapper.off('scroll.' + ID);
					return this;
				}
			}
		}

		return {
			setScrollArea:function(wrapper, container, callback, id){
				return new ScrollArea(wrapper, container, callback, id).init();
			}
		};
	})();


	UI.SliderBar = function(){
		var _self = this;
		var callback = Array.prototype.slice.call(arguments).pop();
		var $container = $(this).parent();
		var currentPer = 0;
		var startX = 0;

		if(UI.Utils.touch){
			UI.Utils.addEvent(this, 'touchstart', onStart);
			UI.Utils.addEvent(this, 'touchmove', onMove);
			UI.Utils.addEvent(this, 'touchend', onEnd);
		}else{
			UI.Utils.addEvent(this, 'mousedown', onStart);
		}

		function onStart(e){
			var touchobj = (UI.Utils.touch) ? e.touches[0] : e;

			startX = touchobj.clientX - $container.offset().left;
			currentPer = ((startX / $container.width()) * 100);

			if(typeof callback.start == 'function') callback.start(currentPer);
			if(!UI.Utils.touch){
				UI.Utils.addEvent(document, 'mousemove', onMove);
				UI.Utils.addEvent(document, 'mouseup', onEnd);
			}
		}

		function onMove(e){
			var touchobj = (UI.Utils.touch) ? e.touches[0] : e;
			var percent = ((((touchobj.clientX - $container.offset().left) - startX) / $container.width()) * 100) + currentPer;

			if(percent < 0) percent = 0;
			else if(percent > 100) percent = 100;

			//console.log(percent);

			if(typeof callback.move == 'function') callback.move(percent);
		}

		function onEnd(e){
			if(typeof callback.end == 'function') callback.end();
			if(!UI.Utils.touch){
				UI.Utils.removeEvent(document, 'mousemove', onMove);
				UI.Utils.removeEvent(document, 'mouseup', onEnd);
			}
		}

		return {
			getPercent:function(){
				return currentPer;
			},
			setPercent:function(per){
				currentPer = per;
				if(typeof callback.move == 'function') callback.move(currentPer);
			}
		}
	}


	UI.polyfill = (function(){

		//  ~ IE8 function bind method add
		Function.prototype.bind = Function.prototype.bind || function(b) {
			if (typeof this !== "function") {
				throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
			}

			var a = Array.prototype.slice;
			var f = a.call(arguments, 1);
			var e = this;
			var c = function() {};
			var d = function() {
				return e.apply(this instanceof c ? this : b || window, f.concat(a.call(arguments)));
			};
			c.prototype = this.prototype;
			d.prototype = new c();
			return d;
		};




		//  ~ IE8 Object keys method add
		// From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys
		if (!Object.keys) {
			Object.keys = (function() {
				'use strict';
				var hasOwnProperty = Object.prototype.hasOwnProperty,
					hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),
					dontEnums = [
						'toString',
						'toLocaleString',
						'valueOf',
						'hasOwnProperty',
						'isPrototypeOf',
						'propertyIsEnumerable',
						'constructor'
					],
					dontEnumsLength = dontEnums.length;

				return function(obj) {
					if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {
						throw new TypeError('Object.keys called on non-object');
					}

					var result = [], prop, i;

					for (prop in obj) {
						if (hasOwnProperty.call(obj, prop)) {
							result.push(prop);
						}
					}

					if (hasDontEnumBug) {
						for (i = 0; i < dontEnumsLength; i++) {
							if (hasOwnProperty.call(obj, dontEnums[i])) {
							result.push(dontEnums[i]);
							}
						}
					}

					return result;
				};
			}());
		}



		// ECMA-262 5판, 15.4.4.21항의 작성 과정
		// 참고: http://es5.github.io/#x15.4.4.21
		if (!Array.prototype.reduce) {
			Array.prototype.reduce = function(callback /*, initialValue*/) {
				'use strict';
				if (this == null) {
					throw new TypeError('Array.prototype.reduce called on null or undefined');
				}
				if (typeof callback !== 'function') {
					throw new TypeError(callback + ' is not a function');
				}
				var t = Object(this), len = t.length >>> 0, k = 0, value;
				if (arguments.length == 2) {
					value = arguments[1];
				} else {
					while (k < len && !(k in t)) {
						k++;
					}
					if (k >= len) {
						throw new TypeError('Reduce of empty array with no initial value');
					}
					value = t[k++];
				}
				for (; k < len; k++) {
					if (k in t) {
						value = callback(value, t[k], k, t);
					}
				}
				return value;
			};
		}

	})();

	UI.validation = (function(){
		var DEFAULT_OPTION = {
			animate: false,
			errorClass: "error",
			errorsContainer : function(elem, isRadioOrCheckbox ) {
				var $target = null;
				if( $(elem.$element).is('input[type="radio"]') || $(elem.$element).is('input[type="checkbox"]') ){
					$target = $( elem.$element ).parent().parent();
				}else{
					$target = $( elem.$element ).parent();
				}
				$target.removeClass("server-error");
				return $target;
			},
			classHandler : function(elem, isRadioOrCheckbox ) {
				var $target = null;
				if( $(elem.$element).is('input[type="radio"]') || $(elem.$element).is('input[type="checkbox"]') ){
					$target = $( elem.$element ).parent().parent();
				}else{
					$target = $( elem.$element ).parent();
				}
				$target.removeClass("server-error");
				return $target;
			},
			errorsWrapper: '<span class="error-message"></span>',
			errorTemplate: '<span></span>',
			validationThreshold : 1,
			excluded: ':hidden'
		}

		function init( dom, opts ){
			dom.parsley( $.extend( DEFAULT_OPTION, opts ));
		}

		function reset( dom, opts ){
			dom.parsley( $.extend( DEFAULT_OPTION, opts ) ).reset();
		}

		function validate( dom ){
			dom.parsley().validate();
		}

		function isValid( dom ){
			return dom.parsley().isValid();
		}

		function destroy( dom ){
			dom.parsley().destroy();
		}

		return {
			init : init,
			reset : reset,
			validate : validate,
			isValid : isValid,
			destroy : destroy
		}
	})();

	UI.ga = ( function(){
		var target = 'master.send';
		var useGa = _GLOBAL.MARKETING_DATA().useGa;
		function isValid() {
			if( !useGa ){
				return false;
			}
			var ga = ga || {};
			return _.isFunction(ga);
		}
		// non-interaction event 처리
		function sendEvent( type, action, label, value ) {
			if ( isValid() ) {
				if ( _.isEmpty(action) ) {action = 'action is empty';}
				if ( _.isEmpty(label) ) {label = 'label is empty';}
				if ( typeof value === 'undefined' || isNaN(value) || !_.isNumber(value) ) {
					value = 0;
				}
				ga( target, 'event', type, action, label, value, {'nonInteraction': 1});
			}
		}
		// 서버에서 처리 되는 ga 호출시 사용
		function processor( data ){
			var marketingData = _GLOBAL.MARKETING_DATA();
			switch( data.orderType ){
				// 주문시
				case 'ORDER' :
					break;
				// 반품시
				case 'RETURN' :
					//TODO
					// 반품되는 전체 order 정보가 필요함 복수 일수도 있음
					//commerce( "order-return",  marketingData.returnOrderNumber, "" );
					break;
				// 부분 반품시
				case 'PARTIAL_RETURN' :
					break;
				// 취소시
				case 'VOID' :
					commerce( "order-cancel",  marketingData.cancelOrderNumber, marketingData.cancelPrice );
					break;
				// 부분 취소시
				case 'PARTIAL_VOID' :
					commerce( "order-partial-cancel",  marketingData.cancelOrderNumber, marketingData.cancelPrice );
					break;
			}

			// 반품 취소 처리 필요
			Core.Utils.ajax(Core.Utils.contextPath +'/processor/execute/google_enhanced_ec', 'GET', data, function(data){
				//console.log( data.responseText );
				if( data.status == 200){
					if( String(data.responseText).indexOf('html') == -1 ){
						//$("body").append( data.responseText );
					}
				}
			}, true, true );
		}
		function pv( type, url ){
			if( isValid() ) {
				ga( target, type, url ); // ex) ga("master.send", "pageview", "/pagename");
			}
		}
		function social( name, action, url ){
			if( isValid() ) {
				ga( target, 'social', name, action, url );
			}
		}
		function action( action, label, value ){
			sendEvent( 'user-action', action, label, value);
		}
		function commerce( action, label, value ){
			sendEvent( 'commerce', action, label, value );
		}
		function error( action, label, value ){
			sendEvent( 'error', action, label, value );
		}
		return {
			processor : processor,
			pv : pv,
			social : social,
			action : action,
			commerce : commerce,
			error : error
		}
	}());

	// UI.aa = ( function(){
	// 	var marketingData = _GLOBAL.MARKETING_DATA();
	// 	var useAa = marketingData.useAa;
	// 	var traceType = "";
	// 	var pageName = "";
	// 	var pageType = "";
	// 	var breadcrumb = "";

	// 	function isValid() {
	// 		return useAa;
	// 	}
	// 	function updateMarketingData(){
	// 		marketingData = _GLOBAL.MARKETING_DATA();
	// 	}
	// 	function pv(){
	// 		if( isValid()){
	// 			pageName = marketingData.pathName.split('/');
	// 			pageType = marketingData.pageType;
	// 			breadcrumb = marketingData.pathName;
	// 			var newAcount = false;
	// 			var newLogin = false;

	// 			if( marketingData.pathName.length == 1 ){
	// 				pageName = pageName[0];
	// 			}else{
	// 				pageName = pageName[ pageName.length - 1 ];
	// 			}

	// 			if( marketingData.pageType == 'home' ){
	// 				pageName = 'Home';
	// 				breadcrumb = 'Home';
	// 			}

	// 			if( marketingData.pageType == 'registerSuccess'){
	// 				newAcount = true;
	// 			}

	// 			var param = getPageData( "default", pageName, pageType, breadcrumb, newAcount, newLogin );
	// 			processor( param );
	// 		}
	// 	}
	// 	function commerce( type ){
	// 		updateMarketingData();
	// 		var param = {};

	// 		switch( type ){
	// 			case 'category' :
	// 				if( marketingData.categoryInfo == null ){
	// 					return;
	// 				}
	// 				var categoryInfo = marketingData.categoryInfo;
	// 				if( categoryInfo.paging == null ){
	// 					return;
	// 				}

	// 				traceType = 'plp';
	// 				pageName = categoryInfo.name;
	// 				pageType = 'plp';
	// 				breadcrumb = getBreadcrumbData(categoryInfo.breadcrumbs);

	// 				var page = categoryInfo.paging.page - 1;
	// 				var pageSize = categoryInfo.paging.pageSize;
	// 				param.categoryId = categoryInfo.id;
	// 				param.limit = pageSize;
	// 				param.offset = page * pageSize;
	// 				param.url = marketingData.pathName;
	// 			break;

	// 			case 'product' :
	// 				if( marketingData.productInfo == null ){
	// 					return;
	// 				}
	// 				var categoryInfo = marketingData.categoryInfo;
	// 				var productInfo = marketingData.productInfo;

	// 				traceType = 'pdp';
	// 				pageName = productInfo.name;
	// 				pageType = 'pdp';
	// 				breadcrumb = getBreadcrumbData(categoryInfo.breadcrumbs);

	// 				param.categoryId = categoryInfo.id;
	// 				param.productIds = productInfo.id;
	// 				param.url = marketingData.pathName;
	// 			break;
	// 			case 'search' :
	// 				if( marketingData.searchInfo == null ){
	// 					return;
	// 				}

	// 				var searchInfo = marketingData.searchInfo;
	// 				var itemList = marketingData.itemList;


	// 				traceType = 'searchResult';
	// 				pageName = 'search result'; // productName을 노출해야 하는데
	// 				pageType = 'search result';
	// 				breadcrumb = 'Search';

	// 				param.totalResultCount = searchInfo.totalCount;
	// 				param.searchTerm = searchInfo.keyword;

	// 				if( itemList != null ){
	// 					var productIds = $.map(itemList, function(item){ return item.id });
	// 					param.productIds = String(productIds);
	// 				}


	// 				// todo 검색 결과가 없을때 에러가 난다;
	// 				if( productIds == "" ){
	// 					return;
	// 				}

	// 			break;
	// 			case 'cart' :
	// 				traceType = 'cartView';
	// 				pageName = 'Cart'
	// 				pageType = 'cart';
	// 				breadcrumb = 'Cart';
	// 			break;

	// 			case 'checkout' :
	// 				if( marketingData.checkoutInfo == null ){
	// 					return;
	// 				}

	// 				var checkoutInfo = marketingData.checkoutInfo;

	// 				var step = checkoutInfo.step;
	// 				if( step == "order" ){
	// 					step = "billing";
	// 				}
	// 				step = step.charAt(0).toUpperCase() + step.slice(1);

	// 				traceType = 'checkout';
	// 				pageName = 'Checkout: ' + step;
	// 				pageType = 'checkout';
	// 				breadcrumb = 'Checkout';

	// 				param.checkoutStepName = step;
	// 			break;

	// 			case 'confirmation' :
	// 				traceType = 'orderConfirm';
	// 				pageName = 'Checkout : Order Confirmation'
	// 				pageType = 'order confirmation';
	// 				breadcrumb = 'Checkout/Order confirmation';

	// 				param.orderNumber = marketingData.orderNumber;
	// 			break;
	// 		}

	// 		param = $.extend( param, getPageData( traceType, pageName, pageType, breadcrumb ));
	// 		processor( param );
	// 	}

	// 	function getPageData(traceType, name, type, breadcrumb, newAcount, newLogin, errorCode ){
	// 		var page = {};
	// 		page.traceType = traceType;
	// 		page.pageName = name;
	// 		page.pageType = type;

	// 		if( breadcrumb != null ){
	// 			page.breadcrumb = breadcrumb;
	// 		}

	// 		if( type == 'error' && errorCode != null){
	// 			page.errorCode = errorCode;
	// 		}

	// 		if( newAcount == true ){
	// 			page.newAccountCreated = true;
	// 		}

	// 		if( newLogin == true ){
	// 			page.newLogin = true;
	// 		}

	// 		return page;
	// 	}
	// 	function getBreadcrumbData( breadcrumb ){
	// 		if( breadcrumb != '' ){
	// 			var breadcrumbList = String(breadcrumb).split('||');
	// 			breadcrumbList = _.without( breadcrumbList, 'home', 'Home', 'HOME').join('/');
	// 			return String(breadcrumbList);
	// 		}
	// 		return '';
	// 	}
	// 	function processor( param ){
	// 		Core.Utils.ajax('/processor/execute/adobe_enhanced_ec', 'GET', param, function(data){
	// 			//console.log( data.responseText );
	// 			if( data.status == 200){
	// 				$("body").append( data.responseText );
	// 			}
	// 		}, true, true );

	// 	}

	// 	function addEvent(){
	// 		var endPoint = UI.getComponents('component_endpoint');

	// 		endPoint.addEvent('loadMoreProducts', function( data ){
	// 			//console.log( data );

	// 			if( marketingData.categoryInfo == null ){
	// 				return;
	// 			}

	// 			var param = {
	// 				traceType : "plpMore",
	// 			}

	// 			var categoryInfo = marketingData.categoryInfo;
	// 			var page = data.page - 1;
	// 			var pageSize = data.pageSize;

	// 			param.categoryId = categoryInfo.id;
	// 			param.limit = pageSize;
	// 			param.offset = page * pageSize;
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('applyFilter', function( data ){
	// 			//console.log( data );
	// 			/*
	// 			digitalData.eventData = {
	// 				filterCategory : data.key,
	// 				filterOption : data.value
	// 			}
	// 			digitalData.event = 'applyFilter';

	// 			var param = {
	// 				traceType : "search",
	// 				filter : 'Y',
	// 				filterCategory : data.key,
	// 				filterOption : data.value
	// 			}
	// 			processor( param );
	// 			*/
	// 		});
	// 		endPoint.addEvent('quickView', function( data ){
	// 			//console.log( data );

	// 			var param = {
	// 				traceType : "search",
	// 				quickview : "Y",
	// 				productIds : data.product.id
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('addToCart', function( data ){

	// 			var param = {
	// 				traceType : 'addToCart',
	// 				cartType : 'add to cart',
	// 				skuIds : data.skuId,
	// 				quantities : data.quantity
	// 			}
	// 			processor( param );

	// 		});
	// 		endPoint.addEvent('buyNow', function( data ){
	// 			//console.log( data );

	// 			var param = {
	// 				traceType : "addToCart",
	// 				cartType : 'buy now',
	// 				skuIds : data.skuId,
	// 				quantities : data.quantity
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('addToWishlist', function( data ){
	// 			//console.log( data );
	// 		});
	// 		endPoint.addEvent('pdpColorClick', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : "colorClick",
	// 				colorName : data.color
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('pdpImageClick', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : "imgClick"
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('pdpSizeGuideClick', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : "sizeGuide"
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('searchSuggestionClick', function( data ){
	// 			// 한글을 사용하면 안되는데 검색어가 한글이 많다.
	// 			// 바로 리다이텍트 걸려서 타이밍이 나올지 확인
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : 'searchSuggest',
	// 				searchTerm : data.key,
	// 				searchSuggestionName : data.text
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('removeFormCart', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : "removeCart",
	// 				itemIds : data.orderItemId
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('cartAddQuantity', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : 'addCartQuantity',
	// 				skuIds : data.skuId,
	// 				quantities : data.quantity
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('applyPromoCode', function( data ){
	// 			//console.log( data );
	// 			//valid, invalid, expired
	// 			//만료된 코드를 알수는 있지만 메시지 처리 된 상태로 전달되고 있어 공통으로 처리가 불가능해 우선은 두가지로만 처리
	// 			var result = ( data.promoAdded == false ? 'invalid' : 'valid' );
	// 			var param = {
	// 				traceType : "applyPromoCode",
	// 				result : result,
	// 				code : data.promoCode
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('newsletterSubscribed', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : "newsletter",
	// 				location : marketingData.pathName
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('newAccountCreated', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : "createAccount"
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('login', function( data ){
	// 			//console.log( data );
	// 			digitalData.event = 'newLogin';
	// 		});
	// 		endPoint.addEvent('socialShareClick', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : "socialShareService",
	// 				socialShareServiceName : data.service
	// 			}
	// 			processor( param );
	// 		});
	// 		endPoint.addEvent('addNewAddress', function( data ){
	// 			//console.log( data );
	// 			var param = {
	// 				traceType : "addNewAddress"
	// 			}
	// 			processor( param );
	// 		});
	// 	}
	// 	function init(){
	// 		addEvent();
	// 	}
	// 	return {
	// 		// 함수를 구분짓는것이 큰 의미는 없지만 추후 형태의 변화가 있을것을 대비해서 구분
	// 		init : init,
	// 		pv : pv,
	// 		commerce : commerce
	// 		//addEvent : addEvent,
	// 		//error : error
	// 	}
	// })();

	UI.reSizeWidth = (function(){
		var frag = '';
		var currentDeviceInfo = {};
		var currentBreakPoint = 0;
		var arrDevice = ['mobile', 'tablet', 'pc'];

		$(window).resize(function(e){
			var wH = $(window).width();
			if(wH <= 480 && frag !== 'mobile'){
				frag = 'mobile';
				currentDeviceInfo = arrDevice[0];
				$('body').attr('data-device', 'mobile');
			}else if(wH > 480 && wH <= 960 && frag !== 'tablet'){
				frag = 'tablet';
				currentDeviceInfo = arrDevice[1];
				$('body').attr('data-device', 'tablet');
			}else if(wH > 960 && frag !== 'pc'){
				frag = 'pc';
				currentDeviceInfo = arrDevice[2];
				$('body').attr('data-device', 'pc');
			}
		});

		$(window).trigger('resize');

		return {
			getState:function(){
				return currentDeviceInfo;
			}
		}
	})();

	UI.sessionHistory = (function(){
		var currentQueryParam = UI.Utils.getQueryParams(location.href);
		for(var key in currentQueryParam){
			sessionStorage.setItem(key, currentQueryParam[key]);
		}

		var currentHistory = (function(){
			var obj = {};
			for(var key in sessionStorage){
				obj[key] = sessionStorage[key];
			}
			return obj;
		})();

		return {
			getHistory:function(key){
				if(key){
					return currentHistory[key];
				}else{
					return currentHistory;
				}
			},
			updateHistory:function(){
				currentHistory = {};
				for(var key in sessionStorage){
					currentHistory[key] = sessionStorage[key];
				}
				return currentHistory;
			},
			setHistory:function(obj){
				if(!obj || typeof obj !== 'object'){
					throw new Error('param obj is not Object');
					return;
				}

				for(var key in obj){
					sessionStorage.setItem(key, obj[key]);
				}

				this.updateHistory();
			},
			removeHistory:function(key){
				if(!key) return;
				if(key === 'all'){
					sessionStorage.clear();
				}else{
					sessionStorage.removeItem(key);
				}

				this.updateHistory();
			}
		}
	})();

	UI.cookie = (function(){
		var objCookies = {};
		unescape(window.cookie).split(/;/).forEach(function(v, i){
			var arrValue = v.split(/=/);
			objCookies[arrValue[0].replace(/[\s\n\t]/, '')] = arrValue[1];
		});

		var setExpiresDate = function (expires , time){
			var date = new Date();
			date.setTime(date.getTime()+(expires*time*1000));
			var expires = "expires=" + date.toUTCString();
			return expires;
		}

		return {
			getCookie:function(key){
				return (key) ? objCookies[key] : objCookies;
			},
			setCookie:function(key, value, options){
				/*
					expires           쿠키 만료일       new Date(year, month, day, hours, minutes, seconds, milliseconds)
					expires_day       쿠키 생존 일      숫자
					expires_hour      쿠키 생존 시간    숫자
					domain            도메인          www.example.com 또는 sub.example.com 또는 example.com
					path              경로            / 또는 /dir
					secure            ssl             true 또는 false

				*/

				var options = options || {};
				var arrCookie = [];

				if(options.encodeType == "encodeURI" ){
					arrCookie.push(escape(key) + '=' + encodeURI(value));
				}else if( options.encodeType == "encodeURIComponent" ) {
					arrCookie.push(escape(key) + '=' + encodeURIComponent(value));
				}else{
					arrCookie.push(escape(key) + '=' + escape(value));
				}


				if(options.expires){
					if( typeof options.expires === 'object' && options.expires instanceof Date ){
						var date = options.expires;
						var expires = "expires=" + date.toUTCString();
						arrCookie.push(expires);
					}
				}else if(options.expires_day){
					arrCookie.push(setExpiresDate(options.expires_day , 24*60*60));
				}else if(options.expires_hour){
					arrCookie.push(setExpiresDate(options.expires_hour , 60*60));
				}

				if(options.domain) arrCookie.push("domain=" + options.domain);
				if(options.path) arrCookie.push('path=' + options.path);
				if(options.secure === true) arrCookie.push('secure=' + options.secure);

				document.cookie = arrCookie.join('; ');
			},
			delCookie:function(key){
				if(!key){
					return 'You will try remove cookie ';
				}else{
					document.cookie=key + "=" + "; expires=" + new Date().toUTCString();
				}
				return objCookies[key];
			}
		}
	})();

	return UI;
});

function showMenu(){
	$("#mobileMenuOpenBtn").trigger('click');
}

$(document).ready(function(){
	//channel sessionHistory
	var currentQueryParam = Core.Utils.getQueryParams(location.href);
	if(currentQueryParam.channel){
		if(!currentQueryParam.pid){
			Core.sessionHistory.removeHistory('pid');
		}
	}

	//modules init
	if(document.readyState == 'complete' || document.readyState == 'interactive'){
		//category history back
		var categoryPagingType = sessionStorage.getItem('categoryPagingType');
		if(categoryPagingType === 'scroll' || categoryPagingType === 'more'){
			if(sessionStorage.getItem('categoryPathname') === location.pathname){
				if(sessionStorage.getItem('categoryTarget')){
					$('body').find(sessionStorage.getItem('categoryTarget')).html(sessionStorage.getItem('categoryList'));
					$(document).scrollTop(sessionStorage.getItem('categoryScrollTop'));
					removeHistory(false);

					//UIkit.notify('history back', {timeout:3000,pos:'top-center',status:'warning'});
				}
			}else{

				if(!sessionStorage.getItem('isHistoryBack')){
					sessionStorage.removeItem('categoryCurrentPage');
					sessionStorage.removeItem('categoryLineSize');
				}
				removeHistory(sessionStorage.getItem('isHistoryBack'));
				sessionStorage.removeItem('isHistoryBack');
				//UIkit.notify('history back no', {timeout:3000,pos:'top-center',status:'warning'});
			}
		}else{
			removeHistory(false);
			//UIkit.notify('history back out', {timeout:3000,pos:'top-center',status:'warning'});
		}

		function removeHistory(flag){
			if(!flag){
				sessionStorage.removeItem('categoryTarget');
				sessionStorage.removeItem('categoryList');
				sessionStorage.removeItem('categoryPathname');
				sessionStorage.removeItem('categoryScrollTop');
			}
		}


		//document ready dim none;
		$('.dim').removeClass('module-start-before');

		//modules registered in Core
		//Core.initAll();

		// modules defined
		var initDocument = $('body').html();
		Core.moduleEventInjection(initDocument);

		// scroll top go
		var offset = 350;   // 수직으로 어느정도 움직여야 버튼이 나올까?
		var duration = 60;   // top으로 이동할때까지의 animate 시간 (밀리세컨드, default는 400. 예제의 기본은 500)

		Core.Scrollarea.setScrollArea(window, document, function(per){
			if(per !== 0 && this.getScrollPer() > per){
				$('.scrollup').fadeIn(duration);
			}else if(per === 0 || this.getScrollPer() < per){
				$('.scrollup').fadeOut(duration);
			}

			if(per > 30){
				$('.historyBack').fadeIn(duration);
			}else{
				$('.historyBack').fadeOut(duration);
			}

			//console.log( per );
		}, 'top');

		// 현재 왓슨스에만 적용되어있는 상단 뒤로가기 버튼 이벤트 처리
		$('.historyBack').click(function(e){
			e.preventDefault();
			history.back();
			return false;
		});

		$('.scrollup').click(function(e){
			e.preventDefault();
			$('html, body').animate({scrollTop: 0}, duration);
			return false;
		});


		// 모든 submit 시 loding 처리
		$('form').on( 'submit', function(){
			if($(this).attr('data-isLoadingBar') === 'false') return;
			Core.Loading.show();
		});

		// 이미지맵 사용시 반응형 처리
	    $('img[usemap]').rwdImageMaps();

		//Core.cookie.setCookie( "MOBILEYN", (!Core.Utils.mobileChk ? 'N' : 'Y' ));

		// 앱 푸시 값 추가 해야함
	    if( _GLOBAL.CUSTOMER.ISSIGNIN  ){
		    //Core.cookie.setCookie( "USERID", _GLOBAL.CUSTOMER.ID);
			//Core.cookie.setCookie( "USERNAME", _GLOBAL.CUSTOMER.FIRSTNAME + _GLOBAL.CUSTOMER.LASTNAME );
			//Core.cookie.setCookie( "USERNAME_ENCODEURI", _GLOBAL.CUSTOMER.FIRSTNAME + _GLOBAL.CUSTOMER.LASTNAME, { encodeType : "encodeURI" }  );
			//Core.cookie.setCookie( "USERNAME_ENCODEURICOMPONENT", _GLOBAL.CUSTOMER.FIRSTNAME + _GLOBAL.CUSTOMER.LASTNAME, { encodeType : "encodeURIComponent" }  );
			//Core.cookie.setCookie( "USER_EXTERNALID", _GLOBAL.CUSTOMER.EXTERNALID);
			//Core.cookie.setCookie( "USER_PUSHYN", "Y");
	    }else{
			//Core.cookie.delCookie( "USERID" );
			//Core.cookie.delCookie( "USERNAME" );
			//Core.cookie.delCookie( "USERNAME_ENCODEURI" );
			//Core.cookie.delCookie( "USERNAME_ENCODEURICOMPONENT" );
			//Core.cookie.delCookie( "USER_EXTERNALID" );
			//Core.cookie.delCookie( "USER_PUSHYN" );
	    }

		/* UIKit modal override */
		/*UIkit.modal.alert = function(content, options) {
		    var modal = UIkit.modal.dialog(([
		        '<div class="uk-margin uk-modal-content">'+String(content)+'</div>',
		        '<div class="uk-modal-footer uk-text-right"><button class="button small uk-modal-close">확인</button></div>'
		    ]).join(""), UIkit.$.extend({bgclose:false, keyboard:false}, options)).show();
		    return modal;
		};

		UIkit.modal.confirm = function(content, options) {
		    var modal = UIkit.modal.dialog(([
		        '<div class="uk-margin uk-modal-content">'+String(content)+'</div>',
		        '<div class="uk-modal-footer uk-text-right"><button class="button small uk-modal-close">확인</button></div>'
		    ]).join(""), UIkit.$.extend({bgclose:false, keyboard:false}, options)).show();
		    return modal;
		};*/



		/* 부하 테스트시 필요한 스크립트 특정 파라미터가 있으면 이벤트를 트리거 */

		var e = {},
			d = Core.Utils.url.getCurrentUrl();
		d.replace( new RegExp( "([^?=&]+)(=([^&]*))?", "g" ), function ( g, f, i, h ) {
			e[ f ] = decodeURIComponent(h);
		} );

		var url = e;

		if( url.tftest ){

			// 상품 바로주문
			// localhost:8080/checkout?tftest=true
			$(this).find("div[data-attribute-name='SHOES_SIZE']").find(".input-radio").eq(0).trigger('click');
			/*
			$(".option-wrap:eq(0)").find('[class^="product-option_"]' ).each( function(){

			});
			*/

				//$("[data-brz-components-type]").find("select").find("option:eq(1)").attr("selected", "selected");
				/*
			$(".option-wrap:eq(0)").find('.select-box' ).each( function(){
				console.log( $(this));
				console.log( $(this).data("brz-components-type"));
				if( $(this).data("brz-components-type") == "SIZE"){
					console.log( 'update')
					$(this).find("select").find("option:eq(1)").attr("selected", "selected").trigger('change');
				}
			});
			*/

			// btn-buy
			// btn-next
			// btn-next
			// btn-gift-submit
			// btn-checkout-complete-submit

			//A4NE-CP35-HE97

			var isFirst = true;
			$('[data-add-item]').each(function(i){
				$(this).find('.btn-link').each( function(){
					var $btn = $(this);
					var type = $btn.attr("action-type");
					if( type == "redirect" && isFirst ){
						isFirst = false;
						_.delay(function(){
							$btn.trigger("click");
						},
						1000);
						return false;
					}
				});
			});

			// 주문고객 정보 입력
			// localhost:8080/checkout?tftest=true&email=dire2@nave.com&phone=01023247648

			if( url.email ){
				$('input[name="emailAddress"]').val( url.email );
				$('input[name="phoneNumber"]').val( url.phone );
				//$('[data-order-info-submit-btn]').trigger( 'click' );
			}

			if( url.name ){
				// 배송지 정보 입력
				$('input[name="address.fullName"]').val( url.name );
				$('input[name="address.phonePrimary.phoneNumber"]').val( url.phone );
				$('input[name="address.addressLine1"]').val( url.addr1 );
				$('input[name="address.addressLine2"]').val( url.addr2 );
				$('input[name="address.postalCode"]').val( url.pcode );
				$('input[name="fulfillmentOptionId"]').eq(0).attr("checked", true);
				//$('[data-order-shipping-submit-btn]').trigger( 'click' );
			}

			// gift 카드 적용
			//3GRG-WSSK-G6JW
			// http://localhost:8080/checkout?tftest=true&gift=XD7Z-9EKG-ZP3F
			// http://localhost:8080/checkout?tftest=true&gift=3GRG-WSSK-G6JW

			if( url.gift ){
				$('input[name="giftCardNumber"]').val( url.gift );
				$('#applyGiftcard_form').submit();
			}

			// 최종 결제
			// http://localhost:8080/checkout?tftest=true&complete=true
			if( url.complete ){
				$('input[name="isCheckoutAgree"]').prop('checked', true);
				$('[data-checkout-btn]').trigger('click');
			}
		}

		/*

		$("[data-issoldout]").each( function( index, data ){
			var isSoldout = $(this).text();
			var type = $( this ).data('issoldout');
			var target = "";
			switch( type ){
				case "productItem" :
					target = $( this ).closest(".product-item");
				break;
				case "product" :
					target = $(".product-option-container");
				break;
			}
			if( String(isSoldout) == "true"){
				target.find('[data-soldout-target="true"]').removeClass('uk-hidden');
				target.find('[data-soldout-target="false"]').remove();
			}else{
				target.find('[data-soldout-target="true"]').remove();
				target.find('[data-soldout-target="false"]').removeClass('uk-hidden');
			}

		})

		*/

	}
});

(function(Core){
	var Like = function(){
		'use strict';

		var $this, $btn;
		var setting = {
			selector:'[data-component-like]',
			btn:'.like'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				$this = $(setting.selector);
				$btn = $this.find(setting.btn);

				$btn.each(function(i){
					var $this = $(this);
					var url = $this.attr('href');

					$this.off('click').on('click',function(e){
						e.preventDefault();

						var target = this;
						Core.Utils.ajax(url, 'GET', {}, function(data){
							var args = Core.Utils.strToJson(data.responseText, true);

							if(args.result){
								_self.fireEvent('likeFeedBack', target, [args]);
							}else{
								UIkit.notify(args.errorMessage, {timeout:3000,pos:'top-center',status:'warning'});
							}
						});
					});
				});

				return this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_like'] = {
		constructor:Like,
		attrName:'data-component-like'
	}
})(Core);

(function(Core){
	var Map = function(){
		'use strict';

		var $this, $btn, storeList = null, map = null, markers = [], infoWindows = [], currentStoreIndex = 0;
		var setting = {
			selector:'[data-component-map]',
			target:'map',
			storeList:null
		}

		var makeMarkerIcon = function(storeData){
			var icon =  {
				size: new naver.maps.Size(20, 31),
				origin: new naver.maps.Point(0, 0),
				anchor: new naver.maps.Point(10, 16)
			}

			if(storeData.additionalAttributes && storeData.additionalAttributes.icon && storeData.additionalAttributes.icon !== ''){
				icon.content = '<i class="icon_map_marker '+storeData.additionalAttributes.icon+'"></i>';
			} else if(undefined !== storeData.additionalAttributes.storeType && storeData.additionalAttributes.storeType.includes('membership')){
				icon.url ='/cmsstatic/theme/c-commerce/assets/images/g_ico_mapFlag01.png';
			} else{
				icon.url ='/cmsstatic/theme/c-commerce/assets/images/g_ico_mapFlag02.png';
			}
			return icon;
		}

		var getStoreList = function(id){
			for(var key in storeList){
				if(storeList[key].id == id){
					return {'info':storeList[key], 'index':key}
				}
			}
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				var args = arguments[0];

				storeList = setting.storeList || args['data-store-list'];
				var firstLatitude = (storeList[0]) ? storeList[0].latitude:37.3595953;
				var firstLongitude = (storeList[0]) ? storeList[0].longitude:127.1053971;

				map = new naver.maps.Map(setting.target, {
					center:new naver.maps.LatLng(firstLatitude, firstLongitude),
					zoom:9
				});

				//store 위도, 경도 값으로 지도 마커 찍어내기
				//store type에 따라 2개의 마커icon 필요함
				for (var i=0; i<storeList.length; i++) {
					var position = new naver.maps.LatLng(storeList[i].latitude, storeList[i].longitude);
					var marker = new naver.maps.Marker({
						map:map,
						position:position,
						title:storeList[i].name,
						icon:makeMarkerIcon(storeList[i]),
						zIndex:100
					});

					var infoWindow;
					if($('body').attr('data-device') === 'mobile'){
						//mobile
						infoWindow = new naver.maps.InfoWindow({
							content: '<div id="map_store_info_layer" style="width:120px;text-align:center;padding:10px 6px 10px 10px;"><span class="tit">'+ storeList[i].name +'</span></div>'
						});
					} else {
						//pc
						infoWindow = new naver.maps.InfoWindow({
							content: '<div id="map_store_info_layer" style="width:260px;text-align:center;padding:20px 14px 20px 20px;">'+Handlebars.compile($('#map-window-store-info').html())(storeList[i])+'</div>'
						});
					}

					markers.push(marker);
					infoWindows.push(infoWindow);
				}


				// 지도 마커 클릭 이벤트
				for (var i=0, ii=markers.length; i<ii; i++) {
					naver.maps.Event.addListener(markers[i], 'click', (function(seq){
						return function(){
							_self.mapEvent(seq);
						}
					})(i));
				}

				return this;
			},
			mapEvent:function(seq){
				var _self = this;
				var marker = markers[seq], infoWindow = infoWindows[seq];
				if (infoWindow.getMap()) {
					infoWindow.close();
					_self.fireEvent('closeMarker', this, [seq]);
				} else {
					infoWindow.open(map, marker);
					_self.fireEvent('openMarker', this, [storeList[seq], seq]);
					map.setCenter(new naver.maps.LatLng(storeList[seq].latitude, storeList[seq].longitude));
					map.setZoom(10);
				}
			},reInit:function(storeList){
				//변수 초기화
				if(storeList){
					map = null;
					markers = [];
					infoWindows = [];
					currentStoreIndex = 0;
					setting.storeList = storeList;
				}
				this.init();
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_map'] = {
		constructor:Map,
		attrName:['data-component-map', 'data-store-list']
	}
})(Core);

(function(Core){
	var Phone = function(){
		'use strict';

		var setting = {
			selector:'[data-component-phone]'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();

				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var args = arguments[0] || {};
				var $this = $(setting.selector);
				$this.text(args.phonenum.replace(/(^[0-9]{2,3})-?([0-9]{3,4})-?([0-9]{4})$/g, '$1-$2-$3'));
				return this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_phone'] = {
		constructor:Phone,
		reInit:true,
		attrName:'data-component-phone'
	}
})(Core);

(function(Core){
	var ISwiper = function(){
		'use strict';

		var $this, args, $slider, opt, $list, defaultWidth, widthMatch;
		var setting = {
			selector:'[data-component-slider]',
			list:'.slider-wrapper, ul',
			prev:'<i class="icon-arrow_left"></i>',
			next:'<i class="icon-arrow_right"></i>'
		}

		var slideWidth = function(sWidth){
			return sWidth / (args.maxSlides || 1) - (args.slideMargin || 0);
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				$this = $(setting.selector);
				$list = $this.find(setting.list);

				args = arguments[0];

				//var maxSlides = (Core.Utils.mobileChk === null) ? args.maxSlides||1 : args.minSlides||1;
				//console.log(_GLOBAL.LAYOUT.MAX_WIDTH / (args.maxSlides || 1) - (args.slideMargin||0));

				defaultWidth = (args.slideWidth === 'full' ? slideWidth($('body').width()) : args.slideWidth) || slideWidth(_GLOBAL.LAYOUT.MAX_WIDTH);
				opt = {
					//slideWidth:args.slideWidth || $this.width() / maxSlides,
					slideWidth:defaultWidth,
					minSlides:args.minSlides || 1,
					maxSlides:args.maxSlides || 1,
					moveSlides:args.moveSlide||args.maxSlide,
					slideMargin:parseInt(args.slideMargin)||0,
					auto:(args.auto != undefined) ? args.auto : false,
					autoHover: true,
					pager:(args.pager != undefined) ? args.pager : true,
					pagerCustom: (args.pagerCustom != undefined) ? args.pagerCustom : false,
					controls:(args.controls != undefined) ? args.controls : false,
					responsive:(args.responsive != undefined) ? args.responsive : true,
					infiniteLoop:(args.infiniteLoop != undefined) ? args.infiniteLoop  :  false,
					mobileViewType:(args.mobileViewType != undefined) ? args.mobileViewType : 'slider',
					mode:args.mode || 'horizontal',
					preloadImages:'all',
					hideControlOnEnd: args.hideControlOnEnd || false,
					prevText: setting.prev,
					nextText: setting.next,
					startSlide:(args.startSlide != undefined) ? args.startSlide : 0,

					onSliderLoad:function($slideElement, currnetIndex){
						setTimeout(function(){
							_self.fireEvent('onInit', $slider, [$slideElement, currnetIndex]);
						});
					},
					onSlideAfter: function($slideElement, oldIndex, newIndex){
						_self.fireEvent('slideAfter', $slider, [$slideElement, oldIndex, newIndex]);

                        /*setTimeout(function(e) {
                            $(window).trigger("scroll");
                        }, 10);*/
                    },
					onSlideBefore: function($slideElement, oldIndex, newIndex){
						_self.fireEvent('slideBefore', $slider, [$slideElement, oldIndex, newIndex]);

                        /*setTimeout(function(e) {
                            $(window).trigger("scroll");
                        }, 10);*/
                    }

				}

				$this.show();

				if( opt.minSlides == 1 || opt.mobileViewType == 'list' ){
					widthMatch = matchMedia("all and (max-width: 767px)");
					var widthHandler = function(matchList) {
					    if (matchList.matches) {
					    	opt.slideWidth = "767px";
					    	if( opt.mobileViewType == 'list' ){
								if( $slider ){
								    $($slider.closest(".swipe-container").context).addClass("destroy");
						    	    $slider.destroySlider();
						    	}else{
						    	    $($list.closest(".swipe-container").context).addClass("destroy");
						    	}
					    	}else{
					    		if( $slider ){
						    	    $slider.reloadSlider( opt );
						    	}else{
						    	    $slider = $list.bxSlider(opt);
						    	}
					    	}
					    } else {
							opt.slideWidth = defaultWidth;
					    	if( $slider ){
					    	   $($slider.closest(".swipe-container").context).removeClass("destroy");
					    	    $slider.reloadSlider( opt );
					    	}else{
					    	    $($list.closest(".swipe-container").context).removeClass("destroy");
					    	    $slider = $list.bxSlider(opt);
					    	}
					    }
					};
					widthMatch.addListener(widthHandler);
					widthHandler(widthMatch);
				}else{
					$slider = $list.bxSlider(opt);
				}

				$this.find('.bxslider-controls .btn-next').on('click', function(e) {
					e.preventDefault();
					$slider.goToNextSlide();
				});
				$this.find('.bxslider-controls .btn-prev').on('click', function(e) {
					e.preventDefault();
					$slider.goToPrevSlide();
				});

				return this;
			},
			reloadSlider:function(index){
				opt.startSlide = (index) ? index : 0;
				$slider.reloadSlider( opt );
				return this;
			},
			redrawSlider:function(){
				$slider.redrawSlider();
				return this;
			},
			goToSlide:function(index){
				$slider.goToSlide(index);
				return this;
			},
			goToNextSlide:function(){
				$slider.goToNextSlide();
				return this;
			},
			goToPrevSlide:function(){
				$slider.goToPrevSlide();
				return this;
			},
			destroySlider:function(){
				$slider.destroySlider();
				return this;
			},
			getCurrentSlide:function(){
				return $slider.retCurrentSlide();
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_slider'] = {
		constructor:ISwiper,
		attrName:'data-component-slider',
		reInit:true
	}
})(Core);

(function(Core){
	var Quantity = function(){
		'use strict';

		var $this, $input, $plusBtn, $minusBtn, $msg, currentQty = 1, maxLen = 1, args;
		var pattern = /[^0-9]/g;
		var setting = {
			selector:'[data-component-quantity]',
			input:'.label',
			plusBtn:'.plus',
			minusBtn:'.minus',
			attrName:'data-component-quantity',
			msg:'.msg'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			getQuantityByCheckLimit:function( quantity ){
				var maxQuantity = (args.maxQuantity != 'null') ? args.maxQuantity : 100; // 최대수량 100
				var minQuantity  = (args.maxQuantity != 'null') ? args.maxQuantity : 100; // 최대수량 100 parseInt(args.minNum || 1);
				if( quantity < minQuantity){
					quantity = minQuantity;
				}else if( quantity > maxQuantity ){
					quantity = maxQuantity
				}

				return quantity;
			},
			init:function(){
				var _self = this;
				args = arguments[0];

				$this = $(setting.selector);
				$input = $this.find(setting.input);
				$plusBtn = $this.find(setting.plusBtn);
				$minusBtn =  $this.find(setting.minusBtn);
				$msg = $this.find(setting.msg);
				maxLen = (args.maxQuantity != 'null') ? args.maxQuantity : 100; // 최대수량 100
				currentQty = $input.val();


				$plusBtn.on('click', function(e){
					e.preventDefault();

					currentQty++;

					$input.val(currentQty);
					$input.trigger('focusout');
				});

				$minusBtn.on('click', function(e){
					e.preventDefault();

					currentQty--;

					if(currentQty <= 1) currentQty = 1;
					$input.val(currentQty);
					$input.trigger('focusout');
				});

				$input.on({
					'keyup':function(e){
						var val = $input.val();
						if(pattern.test(val)){
							$input.val(val.replace(pattern, ''));
						}
					},
					'focusout':function(){
						currentQty = $(this).val();
						if(currentQty <= 1) currentQty = 1;

						if(parseInt(currentQty) > parseInt(maxLen)){
							$msg.text(maxLen + args.msg).show();
							currentQty = maxLen;
						}else{
							$msg.text('').hide();
						}

						$(this).val(currentQty);
						_self.fireEvent('change', this, [currentQty]);
					},
					'keydown':function(e){
						$this.addClass('value');
						if(e.keyCode === 13){
							return false;
						}
					}
				});

				return this;
			},
			getQuantity:function(){
				return currentQty;
			},
			setQuantity:function(quantity){
				$input.val(currentQty);
				// // //alert('setQuantity'+currentQty);
				// // //currentQty = quantity;
				// var qty = this.getQuantityByCheckLimit(quantity);
				// $input.val(qty);
				// currentQty = qty;
			},
			setMaxQuantity:function(quantity){
				//console.log(quantity);
				if(args.maxQuantity == 'null' && quantity != null){
					maxLen = quantity;
				}else if(args.maxQuantity != 'null'){
					if(quantity != null){
						if(quantity < args.maxQuantity){
							maxLen = quantity;
						}else{
							maxLen = args.maxQuantity;
						}
					}else{
						maxLen = args.maxQuantity;
					}
				}else if(quantity == null){
					maxLen = 100;
				}

				if(quantity == 0){
					$msg.text(args.quantityStateMsg).show();
				}else{
					$msg.text('').hide();
				}
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_quantity'] = {
		constructor:Quantity,
		attrName:'data-component-quantity'
	}
})(Core);

(function(Core){
	var Range = function(){
		var setting = {
			selector:'[data-component-range]',
			rangeBars:'.range-handler',
			rangeTrack:'.range-track',
			attrName:'data-component-range',
			componentName:'component_range'
		}

		var $this, $rangeBars, $track, args={}, minper=0, maxper=100, objSlider={}, eventID;


		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				$this = $(setting.selector);
				$rangeBars = $this.find(setting.rangeBars);
				$track = $this.find(setting.rangeTrack);
				args = arguments[0];

				$rangeBars.each(function(i){
					var $this = $(this);
					var slider = Core.SliderBar.call(this, (function(){
						if($this.is('.min')){
							return {
								move:function(percent){
									if(percent > maxper) percent = maxper;

									$this.css('left', percent + '%');
									$track.css({
										'left':percent + '%',
										'width':(maxper - percent) + '%'
									});

									minper = percent;
									_self.fireEvent('change', $this[0], [minper]);
								},
								end:function(){
									$this.addClass('focus').siblings().filter('.max').removeClass('focus');
									_self.fireEvent('touchEnd', $this[0], [minper]);
								}
							}
						}else if($this.is('.max')){
							return {
								move:function(percent){
									if(percent < minper) percent = minper;

									$this.css('left', percent + '%');
									$track.css({
										'width':(percent - minper) + '%'
									});

									maxper = percent;
									_self.fireEvent('change', $this[0], [maxper]);
								},
								end:function(){
									$this.addClass('focus').siblings().filter('.min').removeClass('focus');
									_self.fireEvent('touchEnd', $this[0], [maxper]);
								}
							}
						}
					})());

					objSlider[i] = slider;
				});

				return this;
			},
			getSlide:function(name){
				return objSlider[name];
			},
			getArgs:function(){
				return args;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	};

	Core.Components['component_range'] = {
		constructor:Range,
		attrName:'data-component-range',
	}
})(Core);

(function(Core){
	var SearchField = function(){
		'use strict';

		var $this, $btn, $input, $resultWrap, opt, searchTxt = '', _self, validateIS = false, isAction = true;
		var setting = {
			selector:'[data-component-searchfield]',
			resultWrap:'.result-wrap',
			btn:'.btn_search',
			input:'.input-textfield',
			removeBtn:'.remove-btn',
			attrName:'data-component-searchfield',
			resultTemplate:''
		}


		//dummy data
		var dummyJson = '{"result":"success","query":"척테일러","results":[{"keywordCnt":0,"keyword":"척테일러"},{"keywordCnt":0,"keyword":"척테일러올스타`70"},{"keywordCnt":0,"keyword":"척테일러올스타"},{"keywordCnt":0,"keyword":"척테일러70"},{"keywordCnt":0,"keyword":"척테일러올스타투"},{"keywordCnt":0,"keyword":"척테일러레더"},{"keywordCnt":0,"keyword":"척테일러올스타클래식"},{"keywordCnt":0,"keyword":"척테일러2"},{"keywordCnt":0,"keyword":"척테일러올스타투부츠레더"},{"keywordCnt":0,"keyword":"척테일러올스타레더"}]}';


		var resultFunc = function(data){
			var json = (typeof data === Object) ? data : Core.Utils.strToJson(data.responseText || data, true);
			if(json.results.length > 0){
				addTemplate(json.results);
			}else{
				if(opt.complete !== 'auto'){
					console.log(1);
					UIkit.modal.alert('검색결과가 없습니다.',{
						labels : {
							Ok : '확인'
						}
					});
				}
			}

			isAction = true;
		}

		var resultFuncSearchForm = function(data){
			data = dummyJson;
			var json = (typeof data === Object) ? data : Core.Utils.strToJson(data.responseText || data, true);
			if(json.results.length > 0){
				//alert($input.getValue());
				if($input.getValue().length > 0) {
					//$resultWrap.removeClass('active');
				} else {
					//$resultWrap.addClass('active');
				}
				//removeClass("favorite-search").addClass("auto-search");
				//alert(json.results);
				addTemplate(json.results);
			}else{
				if(opt.complete !== 'auto'){
					UIkit.modal.alert('검색결과가 없습니다.');
				}
			}

			isAction = true;
		}

		var addTemplate = function(data){
			if(setting.resultTemplate === ''){
				UIkit.notify('template is not defined', {timeout:3000,pos:'top-center',status:'warning'});
				return;
			}

			var template = Handlebars.compile($(setting.resultTemplate).html())(data);
			$resultWrap.empty().append(template);
		}

		var action = function(){
			if(searchTxt !== ''){
				_self.fireEvent('beforeSubmit', this, [searchTxt]);

				if(opt.hasOwnProperty('api')){
					Core.Utils.ajax(opt.api, 'GET', {'q':searchTxt}, resultFunc);
				}else if(opt.hasOwnProperty('submit')){
					_self.fireEvent('submit', this, [$(opt.submit), searchTxt]);
					$(opt.submit).submit();
				}else if(opt.hasOwnProperty('onEvent')){
					_self.fireEvent('searchKeyword', this, [$(opt.onEvent), searchTxt]);
				}
			}else{
				//UIkit.modal.alert(opt.errMsg);
				_self.fireEvent('searchEmpty', this, [$(opt.onEvent)]);
				$input.setErrorLabel(opt.errMsg);
			}
		}

		//return prototype
		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				_self = this;
				opt = arguments[0];
				$this = $(setting.selector);
				$resultWrap = $this.find(setting.resultWrap);
				$btn = $this.find(setting.btn);

				$input = Core.getComponents('component_textfield', {context:$this, selector:'.input-textfield'}, function(){
					this.addEvent('focusin', function(e){
						$resultWrap.addClass('active');
					});

					this.addEvent('focusout', function(e){
						searchTxt = $(this).val();
					});

					this.addEvent('enter', function(e){
						searchTxt = $(this).val();

						if(isAction && searchTxt !== ''){
							isAction = false;
							action();
						}
					});

					if(opt.hasOwnProperty('autoComplete')){
						this.addEvent('keyup', function(e){
							if(opt.submit == "#search-form") {
								//resultFuncSearchForm(dummyJson);
								Core.Utils.ajax(opt.autoComplete, 'POST', {'q':$(this).val()}, resultFuncSearchForm);
							} else {
								// 비동기 호출 resultFunc callback 함수 넘김
								Core.Utils.ajax(opt.autoComplete, 'POST', {'q':$(this).val()}, resultFunc);
							}
						});
					}
				});

				$this.off('mouseleave').on('mouseleave', function(){
					$resultWrap.removeClass('active');
				});

				$this.off('mouseenter').on('mouseenter', function(){
					$resultWrap.addClass('active');
				});

				$btn.on('click', function(e){
					e.preventDefault();

					//주소선택시 address1 추가 수정불가 하도록 설정
					var input_address = $this.find('input[type="text"].addressSerch');
					var input_address2 = $this.siblings('.input-textfield').find('input[type="text"].addressLine2');
					if(input_address.prop('readonly')){
						$(this).text('검색');
						input_address.css('background','#fff').prop('readonly', false);
						input_address.focus();
						input_address.val('');
						$this.closest('[data-module-shipping-address-write]').find('#postcode').val('');
						input_address2.val('');

						validateIS = false;
					}else{
						action();
					}
				});

				// result list click event
				$resultWrap.on('click', '.list a', function(e){
					e.preventDefault();

					validateIS = true;
					//$input.setValue($(this).text());

					$this.find('.addressSerch').css('background','#ddd').prop('readonly', true);
					$btn.text('재검색');
					$('.result-wrap div').remove();

					_self.fireEvent('resultSelect', _self, [this]);

					/*if(!opt.hasOwnProperty('api')){
						$btn.trigger('click');
					}*/

					$resultWrap.removeClass('active');
				});

				//result list remove-btn
				$resultWrap.on('click', setting.removeBtn, function(e){
					e.preventDefault();
					var val = $(this).attr('data-remove-value');
					if(val === 'all'){
						$(this).closest('ul').empty();
					}else{
						$(this).parent().remove();
					}

					_self.fireEvent('removeList', this, [val]);
				});

				searchTxt = $input.getValue();

				return this;
			},
			getValidateChk:function(){
				if(opt.required === 'false' || setting.isModify === 'true'){
					return true;
				}else if(opt.required === 'true'){
					return validateIS;
				}
			},
			setErrorLabel:function(message){
				$input.setErrorLabel(message||opt.errMsg);
			},
			getInputComponent:function(){
				return $input;
			},
			setResultAppend:function(appendContainer, template, data){
				if(appendContainer === 'this'){
					$resultWrap.append(Handlebars.compile($(template).html())(data));
				}else{
					$(appendContainer).append(Handlebars.compile($(template).html())(data));
				}

			},
			externalAction:function(){
				action();
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_searchfield'] = {
		constructor:SearchField,
		attrName:'data-component-searchfield'
	};
})(Core);

(function(Core){
	var InputSelectBox = function(){
		'use strict';

		var $this, $select, $selectHead, $selectBody, $selectHeadTxt, $selectOption, opt, eventID, isValidate = false, currentSelectedIndex, isSelectedReset, endPoint, name;
		var selectDisabled = false;
		var setting = {
			selector:'[data-component-select]',
			select:'select',
			attrName:'data-component-select',
			template:"<a class='select-head'><span class='currentOpt'>{{currentLabel}}</span></a><ul class='select-body'>{{#each option}}<li class='list {{this.checked}} {{this.disabled}}'><a href='{{this.value}}' data-value='{{this.value}}'><span class='label'>{{this.label}}</span></a></li>{{/each}}</ul>"
		}


		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				$this = $(setting.selector);
				$select = $this.find(setting.select);
				endPoint = Core.getComponents('component_endpoint');
				opt = (opt) ? opt : arguments[0]||{};
				name = $select.attr('name');


				//select init
				currentSelectedIndex = $select.find('option:selected').index();
				if(currentSelectedIndex > 0 && opt.changeType === 'step'){
					setTimeout(function(){
						$select.trigger('change');
					});
				}

				$select.off('update').on('update', function(e){
					e.preventDefault();
					if(!Core.Utils.mobileChk){
						var index = $select.find(":selected").index();
						updateSelect( $(this).closest(".select-box").find(".select-body li").eq(index).find("a") );
					}
				});

				$select.off('change').on('change', function(e){
					var that = this;
					var $selected = $(this).find('option:selected');
					var val = $selected.val();
					var index = $selected.index();

					if( val === '' || val === '선택해주세요' ){
						isValidate = false;
						return;
					}else{
						isValidate = true;
					}

					endPoint.call('changeSelect', { name : name, value : val });

					switch(opt.changeType){
						case 'normal' :
							_self.fireEvent('change', this, [val, $selected, index]);
							$(this).parsley().validate();
							break;
						case 'submit' :
							var url = "";
							if( $(this).val() === "" || $(this).val() === "default"){
								url = Core.Utils.url.removeParamFromURL( Core.Utils.url.getCurrentUrl(), $(this).attr('name') );
							}else{
								url = Core.Utils.url.updateParamFromURL( Core.Utils.url.getCurrentUrl(), $(this).attr('name'), $(this).val() );
							}

							window.location.assign( url );
							break;
						case 'step' :
							_self.fireEvent('change', that, [$(that).find('option:selected').attr('data-value'), $(that).find('option:selected').val(), $(that).attr('data-id'), $(that).find('option:selected').attr('data-friendly-name')]);
							break;

						case 'link' :
							var url = val;
							if( url != null && $.trim(url) != ''){
								window.location.assign( url );
							}
							break;
					}
				});

				return this;
			},
			receiveToData:function(option, skuData){
				isValidate = false;
				if (option){
					rtnOption(option.type, skuData);
				}
			},
			reInit:function(){
				$select.val('');
				if(!Core.Utils.mobileChk){
					//$selectHeadTxt.text($select.find('option').eq(0).val());
					//$selectBody.eq(0).addClass('checked');
				}
			},
			disabled:function(){
				//초기화
				$select.find('option').attr('disabled', 'disabled');
				if(currentSelectedIndex === 0 || isSelectedReset){
					$select.find('option').eq(0).prop('selected', true);
					if(!Core.Utils.mobileChk){
						$selectHeadTxt.text($select.find('option:selected').val());
						$selectBody.scrollTop(0).find('.list').addClass('disabled').removeClass('checked').eq(0).removeClass('disabled').addClass('checked');
					}
				}else{
					isSelectedReset = true;
				}
			},
			trigger:function(value, valueId){
				//console.log($this);
				//console.log(value, valueId);
				$select.val(valueId).attr('selected', 'selected');
				if($selectHead) $selectHead.find('.currentOpt').text(value);
				if($selectBody) $selectBody.children().eq($select.find('option:selected').index()).addClass('checked').siblings().removeClass('checked');
				$select.trigger('change');
			},
			destroy:function(){
				$selectHead.remove();
				$selectBody.remove();
			},
			getValidateChk:function(){
				if(opt.required === 'true'){
					if(!isValidate && opt.errMsg) UIkit.notify(opt.errMsg, {timeout:3000,pos:'top-center',status:'danger'});
					return isValidate;
				}else{
					return true;
				}
			},
			getThis:function(){
				return $this;
			},
			replaceSelectBox:function(selectbox){
				$this.find(setting.select).remove();
				$this.append(selectbox);
				this.init.call(this, opt);
			},
			rePaintingSelect:function(){
				this.init();
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_select'] = {
		constructor:InputSelectBox,
		reInit:true,
		attrName:'data-component-select'
	};
})(Core);

(function(Core){
	var Tab = function(){
		'use strict';

		var $this, $tabs, args;
		var setting = {
			selector:'[data-component-tabs]',
			tab:'a',
			attrName:'data-component-tabs',
			activeClass:'active'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();

				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				args = arguments[0] || {};

				$this = $(setting.selector);
				$tabs = $this.find(setting.tab);

				$tabs.click(function(e){
					e.preventDefault();

					if(!$(this).hasClass(setting.activeClass)){
						$(this).addClass(setting.activeClass).siblings().removeClass(setting.activeClass);
						_self.fireEvent('tabClick', this, [$(this).index()]);
					}else if($(this).hasClass(setting.activeClass) && args.unlock === 'true'){
						$(this).removeClass(setting.activeClass);
						_self.fireEvent('tabClick', this, [$(this).index()]);
					}
				});

				return this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_tabs'] = {
		constructor:Tab,
		reInit:true,
		attrName:'data-component-tabs'
	}
})(Core);

(function(Core){

	var InputTxtField = function(){
		'use strict';

		var $this, $input, $label, $errorField, $deleteBtn, isValidate = false, args, pattern;
		var objPattern = {
			name:'[^a-zA-Z|ㄱ-ㅎ|ㅏ-ㅣ|가-힣]',
			pw:'[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]',
			email:'^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$',
			phone:'^[0-9]{2,3}[0-9]{3,4}[0-9]{4}$',
			number:'^[0-9]*$' /* ^[0-9] */
		}

		var setting = {
			selector:'[data-component-textfield]',
			input:'input',
			label:'label',
			errorField:'.error-message',
			attrName:'data-component-textfield',
			deleteBtn:'.delete'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				$this = $(setting.selector);
				$input = $this.find(setting.input);
				$label = $this.find(setting.label);
				$errorField = $this.find(setting.errorField);
				$deleteBtn = $this.find(setting.deleteBtn);
				args = arguments[0]||{};
				pattern = (args.type) ? new RegExp(objPattern[args.type], 'g') : false;

				if(args.disabled){
					$input.attr('disabled', 'disabled');
				}

				$input.on({
					'focusin':function(e){
						$this.addClass('focus');
						_self.fireEvent('focusin', this);
					},
					'focusout':function(e){
						var val = $input.val();
						$this.removeClass('focus');
						//$errorField.text('');

						if(val !== ''){
							isValidate = true;
							$this.addClass('value');
						}else{
							isValidate = false;
							$this.removeClass('value');
						}

						if(pattern){
							if(pattern.test(val)){
								$errorField.text('');
							}else if(!pattern.test(val)){
								$errorField.text(args.errMsg||'잘못된 형식 입니다.');
								isValidate = false;
							}
						}

						_self.fireEvent('focusout', this);
					},
					'keyup':function(e){
						if(e.keyCode === 13){
							_self.fireEvent('enter', this);
						}else{
							_self.fireEvent('keyup', this);
						}
					},
					'keydown':function(e){
						$this.addClass('value');
						if(e.keyCode === 13){
							return false;
						}
					}
				});

				$input.bind("paste", function(e){
					var _self = this;
					setTimeout(function(){
						var val = $(_self).val();

						if(val !== ''){
							isValidate = true;
							$this.addClass('value');
						}else{
							isValidate = false;
							$this.removeClass('value');
						}
					});
				});


				$label.on('click', function(e){
					e.preventDefault();
					$input.focus();
				});

				$deleteBtn.on('click', function(e){
					e.preventDefault();
					$input.val('');
					$this.removeClass('value');
					isValidate = false;
				});

				this.setValueLabel();

				return this;
			},
			getValue:function(){
				return $input.val();
			},
			focus:function(){
				$input.focus();
			},
			getThis:function(){
				return $input;
			},
			setValue:function(val){
				if(val !== ''){
					isValidate = true;
					$input.val(val);
					$this.addClass('value');
				}else{
					isValidate = false;
					$input.val(val);
					$this.removeClass('value');
				}
			},
			getValidateChk:function(errorMsgType){
				if(args.required){
					if(!isValidate){
						if(errorMsgType === 'errorLabel') this.setError(args.validateMsg);
						else UIkit.notify(args.validateMsg, {timeout:3000,pos:'top-center',status:'danger'});
					}else{
						if(errorMsgType === 'errorLabel') this.setError('');
					}
					return isValidate;
				}else{
					return true;
				}
			},
			setError:function(message){
				$errorField.text((message || message == '') ? message : args.errMsg);
			},
			setErrorLabel:function(message){
				$label.text(message||args.errMsg).addClass('err');
			},
			setValueLabel:function(){
				// 초기 값이 있으면 label 숨김
				if($input.val() !== ''){
					$this.addClass('value');
					isValidate = true;
				}
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_textfield'] = {
		constructor:InputTxtField,
		reInit:true,
		attrName:'data-component-textfield',
	}
})(Core);

(function(Core){
	var ThumbNail = function(){
		var setting = {
			selector:'[data-component-thumbnail]',
			container:'.thumb-wrap',
			scrollWrap:'.scroll-Wrap',
			list:'.thumb-list',
			thumbTemplate:'{{#each this}}<li class="thumb-list"><a href="{{thumbUrl}}?browse"><img src="{{thumbUrl}}?thumbnail"></a></li>{{/each}}'
		}

		var $this, $container, $list, currentIndex=0, arrThumbList=[], iScroll, args;
		var Closure = function(){}
		Closure.prototype.setting = function(){
			var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
		}
		Closure.prototype.init = function(){
			var _self = this;

			$this = $(setting.selector);
			$container = $this.find(setting.container);
			$list = $this.find(setting.list);
			args = arguments[0];

			var arrList = [];

			$container.find(setting.list).each(function(i){
				var data = Core.Utils.strToJson($(this).attr('data-thumb'), true);
				var imgUrl = $(this).find('img').attr('src').replace(/\?[a-z]+/g, '');
				var pushIS = true;

				data.thumbUrl = imgUrl;

				/* 중복 이미지 처리 */
				for(var i=0; i < arrList.length; i++){
					if(arrList[i].thumbSort === data.thumbSort && arrList[i].thumbUrl === data.thumbUrl){
						pushIS = false;
						console.log('same image');
						return;
					}
				}

				if(pushIS){
					arrList.push(data);
					arrThumbList.push(data);
				}
			});

			$container.on('click', 'li', function(e){
				e.preventDefault();

				$(this).addClass('active').siblings().removeClass('active');
				_self.fireEvent('changeIndex', this, [$(this).index()]);
			});

			this.setThumb(args.sort);

			return this;
		}
		Closure.prototype.getContainer = function(){
			return $this;
		}
		Closure.prototype.setTriggerThumb = function(index){
			var curIndex = index, totalNum = $container.find('li').length;

			if(curIndex < 0){
				curIndex = totalNum - 1;
			}else if(curIndex > totalNum - 1){
				curIndex = 0;
			}

			$container.find('li').eq(curIndex).trigger('click');
		}
		Closure.prototype.setThumb = function(sort){
			var _self = this;
			var appendTxt = '';
			var thumbWidth = (args.thumbType === 'bottom') ? $this.find('.thumb-list').eq(0).outerWidth() : $this.find('.thumb-list').eq(0).outerHeight();
			var count = 0;
			var sortType = sort || args.sort;
			var arrThumbData = arrThumbList.filter(function(item, index, array){
				if(item.thumbSort === sortType || item.thumbSort === 'null'){
					console.log(item);
					return item;
				}
			});

			var thumbTemplate = Handlebars.compile(setting.thumbTemplate)(arrThumbData);
			//var mobileTemplate = Handlebars.compile($("#product-gallery-template-mobile").html())(arrThumbData)
			var totalWidth = count * (thumbWidth + parseInt(args.between));
			if(args.thumbType === 'bottom') $container.empty().append(appendTxt).css({'width':totalWidth}).addClass('show');
			else if(args.thumbType === 'left'){
				if(!Core.Utils.mobileChk){
					$container.css({'height':totalWidth}).addClass('show');
				}
				$container.empty().append(thumbTemplate);
			}

			$container.find('.thumb-list').eq(0).addClass('active');
			$this.parent().append(mobileTemplate);

			_self.fireEvent('setThumbComplete', this);
			$container.find('a').eq(0).trigger('click');

			if(!Core.Utils.mobileChk){
				iScroll = new IScroll($this[0], {
					scrollX:(args.thumbType === 'bottom') ? true : false,
					scrollY:(args.thumbType === 'bottom') ? false : true
				});
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_thumbnail'] = {
		constructor:ThumbNail,
		attrName:'data-component-thumbnail'
	};
})(Core);

(function(Core){

	var InputTxtArea = function(){
		'use strict';

		var $this, $input, $label, validateIS = false, opt;
		var setting = {
			selector:'[data-component-textarea]',
			input:'textarea',
			label:'label',
			attrName:'data-component-textarea'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				$this = $(setting.selector);
				$input = $this.find(setting.input);
				$label = $this.find(setting.label);

				opt = arguments[0]||{};

				if(opt.disabled){
					$input.attr('disabled', 'disabled');
				}

				// 초기 값이 있으면 label 숨김
				if($input.val() !== ''){
					$this.addClass('value');
					validateIS = true;
				}

				$input.on({
					'focusin':function(e){
						$this.addClass('focus');
						_self.fireEvent('focusin', this);
					},
					'focusout':function(e){
						var val = $input.val();
						$this.removeClass('focus');

						if(val !== ''){
							validateIS = true;
							$this.addClass('value');
						}else{
							validateIS = false;
							$this.removeClass('value');
						}

						_self.fireEvent('focusout', this);
					},
					'keydown':function(e){
						$this.addClass('value');
					}
				});

				return this;
			},
			getValue:function(){
				return $input.val();
			},
			setValue:function(val){
				if(val !== ''){
					validateIS = true;
					$input.val(val);
				}else{
					validateIS = false;
					$input.val(val);
				}
			},
			getThis:function(){
				return $input;
			},
			getValidateChk:function(){
				if(opt.required){
					!validateIS && this.setErrorLabel();
					return validateIS;
				}else{
					return true;
				}
			},
			setErrorLabel:function(message){
				if ($label.length) {
					$label.text(message||opt.errMsg).addClass('err');
				} else {
					UIkit.notify(message||opt.errMsg, {timeout:3000,pos:'top-center',status:'danger'});
				}
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_textarea'] = {
		constructor:InputTxtArea,
		reInit:true,
		attrName:'data-component-textarea'
	}
})(Core);

(function(Core){
	var WishListBtn = function(){
		'use strict';

		var $this, args, endPoint;
		var setting = {
			selectorWrap:'[data-component-wishlistbtn]'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				args = arguments[0];
				$this = $(setting.selector).find('.wish-action');

				/* wishlist */
				$this.click(function(e){
					e.preventDefault();

					var el = $(this),
						product = el.closest('.product-tile'),
						parent = product.find('.product-wish'),
						tileMain = product.find('.product-tile-main');

					var query = {
						productId:args.productId
					}
					Core.getModule('module_header').reDirect().setModalHide(true).setLogin(function(data){
						Core.Utils.ajax(args.api, 'GET', query, function(data){
							var jsonData = Core.Utils.strToJson(data.responseText, true) || {};
							if(jsonData.hasOwnProperty('error')){
								//console.log(jsonData);
								UIkit.notify(jsonData.error, {timeout:3000,pos:'top-center',status:'warning'});
							}else{
								if (parent.hasClass('set-changed')) return false;

								parent.addClass('set-changed');
								el.removeClass('set-active').siblings().addClass('set-active');
								//console.log(jsonData.isWishListChk);
								if(jsonData.isWishListChk){
									//console.log(args.addMsg);
									tileMain.addClass('set-wish-success');

									setTimeout(function(){
									  parent.removeClass('set-changed');
									  tileMain.removeClass('set-wish-success');
									  _self.addWish();
									},426);

				          			//UIkit.notify(args.addMsg, {timeout:3000,pos:'top-center',status:'success'});
								}else{
									setTimeout(function(){
										parent.removeClass('set-changed');
									},426);
									//console.log(args.removeMsg);
									//UIkit.notify(args.removeMsg, {timeout:3000,pos:'top-center',status:'warning'});
								}

								// if( _.isFunction( marketingAddWishList )){
								// 	marketingAddWishList();
								// }
							}
						}, null, true)
					})




					// if(args.hasOwnProperty('orderItemId')){
					// 	query['orderItemId'] = args.orderItemId;
					// }

					// Core.getModule('module_header').reDirect().setModalHide(true).setLogin(function(data){
					// 	Core.Utils.ajax(args.api, 'GET', query, function(data){
					// 		var jsonData = Core.Utils.strToJson(data.responseText, true) || {};
					// 		if(jsonData.hasOwnProperty('error')){
					// 			UIkit.notify(jsonData.error, {timeout:3000,pos:'top-center',status:'warning'});
					// 		}else{
					// 			if(jsonData.isWishListChk){
					// 				_self.find('i').addClass('icon-wishlist_full');
					// 				UIkit.notify(args.addMsg, {timeout:3000,pos:'top-center',status:'success'});
					// 				//endPoint.call('addToWishlist', query);
					// 			}else{
					// 				_self.find('i').removeClass('icon-wishlist_full');
					// 				//endPoint.call('removeToWishlist', query);
					// 				UIkit.notify(args.removeMsg, {timeout:3000,pos:'top-center',status:'warning'});
					// 			}
					//
					// 			if( _.isFunction( marketingAddWishList )){
					// 				marketingAddWishList();
					// 			}
					// 		}
					// 	});
					// });
				});

				return this;
			},
			addWish:function(){
				var wish = $('.header-favorites');
				wish.addClass('set-changed');
				setTimeout(function(){
					wish.removeClass('set-changed');
				},426);
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_wishlistbtn'] = {
		constructor:WishListBtn,
		reInit:true,
		attrName:'data-component-wishlistbtn'
	}
})(Core);

(function(Core){
	var InputRadio = function(){
		'use strict';
		var setting = {
			selector:'[data-component-radio]',
			container:'.input-radio',
			label:'label',
			radio:'input[type=radio]',
			unlock:false
		}

		var rtnOption = function(container, key, data){
			data.forEach(function(data, i){
				if(data.inventoryType != 'UNAVAILABLE'){
					if(data.inventoryType === 'ALWAYS_AVAILABLE' || null){
						container.find('input[type=radio]').each(function(i){
							if($(this).val() == data[key]){
								$(this).removeAttr('disabled').parent().removeClass('disabled');
							}
						});
					}else if(data.inventoryType === 'CHECK_QUANTITY'){
						if(data.quantity > 0 || data.quantity == null){
							container.find('input[type=radio]').each(function(i){
								if($(this).val() == data[key]){
									$(this).removeAttr('disabled').parent().removeClass('disabled');
								}
							});
						}
					}
				}
			});
		}

		var $this, $label, $radio, $container, eventID, firstInit = false, opt, isValidate = false;

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				//console.log(arguments);
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				$this = $(setting.selector);
				$container = $this.find(setting.container);
				$label = $container.find(setting.label);
				$radio = $container.find(setting.radio);
				if(!opt) opt = arguments[0]||{};

				$label.off('click').on('click', function(e){
					e.preventDefault();

					_self.fireEvent('click', this, [$(this).siblings()]);
					if(!$(this).parent().hasClass('disabled')){
						if($(this).siblings().prop('checked') && setting.unlock){
							$(this).siblings().prop('checked', false);
							$(this).parent().removeClass('checked');
							return;
						}

						$(this).siblings().trigger('click');
					}
				});

				$radio.off('change').on('change', function(){
					if($(this).prop('checked')){

						isValidate = true;
						$(this).parent().addClass('checked').siblings().removeClass('checked');
						$(this).siblings().attr('checked');

						switch(opt.eventType || 'step'){
							case 'step':
								_self.fireEvent('change', this, [$(this).attr('data-value'), $(this).val(), $(this).attr('data-id'), $(this).attr('data-friendly-name')]);
								break;
							case 'normal':
								_self.fireEvent('change', this, [$(this).val()]);
								break;
						}
					}
				});

				// 기본 선택값 처리
				setTimeout(function(){
					$radio.each(function(i){
						var $this = $(this);
						if ($this.prop('checked')){
							$this.trigger('change');
							_self.fireEvent('init', $this);
						}
					});
				});
				
				return this;
			},
			receiveToData:function(option, skuData){
				isValidate = false;
				if (option){
					rtnOption($container, option.type, skuData);
				}
			},
			reInit:function(){
				this.init();
				/*$container;
				$container.each(function(i){
					$(this).removeClass('checked').find('input[type=radio]').removeAttr('checked');
				});*/
			},
			disabled:function(){
				$container.each(function(i){
					$(this).removeClass('checked').addClass('disabled').find('input[type=radio]').removeAttr('checked').attr('disabled', 'disabled');
				});
			},
			trigger:function(value, valueId){
				$radio.each(function(){
					if($(this).val() == valueId){
						$(this).trigger('click');
						return false;
					}
				});
			},
			getValidateChk:function(){
				if(opt.required){
					return isValidate;
				}else{
					return true;
				}
			},
			getThis:function(){
				return $this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_radio'] = {
		constructor:InputRadio,
		attrName:'data-component-radio',
		reInit:true
	}
})(Core);

(function(Core){
	var Toggle = function(){
		'use strict';

		var $this, $btn;
		var setting = {
			selector:'[data-component-toggle]',
			btn:'.toggle-label'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				$this = $(setting.selector).find('.toggle-label');
        		$this.on('click', function(){
					var el = $(this),
						box = el.closest('.toggle-box'),
						active = 'active',
						isSolo = box.data('component-toggle') == 'solo';
					if (box.hasClass(active)){
						box.removeClass(active);
						box.children('.toggle-label').removeClass(active);
						box.children('.toggle-content').slideUp(213, function(){
							$(this).removeClass(active).removeAttr('style');
						});
					} else {
						box.addClass(active);
						box.children('.toggle-label').addClass(active);
						box.children('.toggle-content').hide().slideDown(213, function(){
							$(this).addClass(active).removeAttr('style');
						});
						isSolo && box.siblings('.active').find('.toggle-label').trigger('click');
					}
        		});
				return this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_toggle'] = {
		constructor:Toggle,
    reInit:true,
		attrName:'data-component-toggle'
	}
})(Core);

(function(Core){
	var InputCheckBox = function(){
		'use strict';

		var $this, $checkbox, $label, args, isValidate = false;
		var setting = {
			selector:'[data-component-checkbox]',
			checkbox:'input[type=checkbox]',
			label:'label',
			attrName:'data-component-checkbox'
		}

		var updateCheckbox = function($target){
			if($target.prop('checked')){
				isValidate = true;
				$target.parent().addClass('checked');
			}else{
				isValidate = false;
				$target.parent().removeClass('checked');
			}
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				$this = $(setting.selector);
				$label = $this.find(setting.label);
				$checkbox = $this.find(setting.checkbox);
				args = arguments[0]||{}

				$label.on('click', function(e){
					e.preventDefault();
					$(this).siblings().trigger('click');
				});

				$checkbox.on('change', function(){
					updateCheckbox( $(this) );
					_self.fireEvent('change', this, [$(this).is(":checked")]);
				});

				// 체크만 하고 이벤트를 실행 시키지 않아야 할 경우도 있어서 제거
				/*
				$.propHooks.checked = {
					set: function(elem, value, name) {
					var ret = (elem[ name ] = value);
						$(elem).trigger("change");
						return ret;
					}
				};
				*/

				// 스크립트로 체크 처리시 change 이벤트는 실행 하지 않고 모양만 변경 처리
				$.propHooks.checked = {
					set: function(elem, value, name) {
					var ret = (elem[ name ] = value);
						updateCheckbox( $(elem));
						return ret;
					}
				}

				$checkbox.trigger('change');
				return this;
			},

			getValidateChk:function(){
				if(args.required){
					if(!isValidate){
						//UIkit.modal.alert(args.errMsg);
						UIkit.notify(args.errMsg, {timeout:3000,pos:'top-center',status:'danger'});
					}
					return isValidate;
				}else{
					return true;
				}
			},
			getThis:function(){
				return $checkbox;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_checkbox'] = {
		constructor:InputCheckBox,
		attrName:'data-component-checkbox',
		reInit:true
	};
})(Core);

(function(Core){

	var ProductOptionSelectedRestock = function(){
		'use strict';

		var receiveToEvent = function(checkedOpt){
			var key = Object.keys(checkedOpt)[0];
			var index = 0;
			var resetIS = false;
			var objOpt = {};
			var currentIndex = 0;

			//currentSku 초기화하여 사용해야 하지만 returnToSkuData에 currentSku값을 사용하는 문제점 해결시 사용해야함
			//if(key === firstOptName) currentSku = allSkuData;
			//선택된 옵션 인덱스

			for(var i=0; i<optionData.length; i++){
				if(optionData[i].type === key){
					currentIndex = i;
					break;
				}
			}

			optionData.map(function(data, i, o){
				if(data.type === key) data.selectedValue = (checkedOpt[key] !== '' && checkedOpt[key] !== null) ? checkedOpt[key] : null;

				//선택된 다음 옵션들 리셋
				if(i > currentIndex) disabled(data.type, i);
				if(data.selectedValue === null){

					if(checkedOpt[key] !== '' && checkedOpt[key] !== null && index === i){
						//data.type : 다음 옵션 아이디
						//data : 다음 옵션 리스트
						//returnToSkuData(key, checkedOpt[key]) : sku 리스트
						// if(checkedOpt[key] === 'SIZE'){
						// 	if(productOptionType === 'single') singleAddOption(objOpt);
						// }
						nextOpt(data.type, data, returnToSkuData(objOpt));
					}
				}else{
					index++;
					objOpt[data.type] = data.selectedValue;

					//if(index === o.length){
						if(productOptionType === 'multi') multiAddOption(objOpt);
						if(productOptionType === 'single') singleAddOption(objOpt);
					//}
				}
			});
		}

		var returnToSkuData = function(objSkuValue){
			var arrData = [];
			var len = Object.keys(objSkuValue).length;
			var counter = 0;

			//currentSku값에서만 옵션을 체크하여 값을 전달 해야 하지만
			//currentSku값의 초기화 문제때문에 allSkuData의 배열을 이용해야한다.
			allSkuData.forEach(function(data){
				counter = 0;
				for(var key in objSkuValue){
					if(data[key] == objSkuValue[key]){
						counter++;
						if(counter === len){
							arrData.push(data);
						}
					}else{
						return false;
					}
				}
			});

			return arrData;
		}

		var nextOpt = function(componentID, opt, sku){
			currentSku = sku;
			optionDom[componentID].receiveToData(opt, sku);
		}

		var disabled = function(componentID, index){
			optionData[index].selectedValue = null;
			optionDom[componentID].disabled();
		}

		var noAddOption = function(){
			var obj = {};
			obj['qty'] = $('input[name=quantity]').eq(0).val();
			currentOptList = {};
			currentOptList['noOption'] = obj;
		}

		var singleAddOption = function(objOpt){
			var obj = {};
			var listKey = '';
			var sku = null;
			var counter = 0;

			sku = returnToSkuData(objOpt)[0];

			//옵션타입이 selectbox일때 value가 없는 즉, 선택하세요.. 이 선택될 경우 sku가 없으므로 리턴시킨다.
			if(!sku) return;

			obj['price'] = sku.price;
			obj['qty'] = $this.find('.qty').val();
			obj['maxQty'] = sku.quantity;
			obj['retailPrice'] = sku.retailPrice;
			obj['salePrice'] = sku.salePrice;
			obj['inventoryType'] = sku.inventoryType;
			obj['options'] = {};
			obj['upc'] = sku.upc;
			obj['id'] = sku.skuId;

			for(var optionKey in option){
				listKey += option[optionKey].values[option[optionKey].selectedValue];
				obj['options'][optionKey] = option[optionKey].values[option[optionKey].selectedValue];

				counter++;
			}

			currentOptList = {};
			currentOptList[listKey] = obj;

			if($submitBtn.hasClass('disabled') && submit){
				$submitBtn.removeClass('disabled');
			}

			if(obj.salePrice){
				var salePrice = parseInt(obj.salePrice.replace(/[￦,가-힣]/g, ''));
				var retailPrice = parseInt(obj.retailPrice.replace(/[￦,가-힣]/g, ''));

				if(salePrice < retailPrice){
					$salePrice.find('strong').text(obj.salePrice).data("price", salePrice);
					$retailPrice.text(obj.retailPrice);
					$('.marketing-msg').show();
				}else{
					$salePrice.find('strong').text(obj.retailPrice).data("price", obj.retailPrice);
					$retailPrice.text('');
					$('.marketing-msg').hide();
				}
			}else{
				$salePrice.find('strong').text(obj.retailPrice).data("price", obj.retailPrice);
				$retailPrice.text('');
			}
			$upcCode.data('upc', obj.upc);
			$("[data-module-restock]").find("#restockSkuId").val(obj.id);
			$upcCode.text(obj.upc);

			/*
				fireEvent 가 등록되기전에 호출하여 처음 이벤트는 발생하지 않는다 그래서 setTimeout으로 자체 딜레이를 주어 해결하였다.
				조금 위험한 방법아지만 해결방법을 찾기 전까지 사용해야 할꺼 같다.
			*/
			setTimeout(function(){
				__self.fireEvent('skuComplete', __self, [obj]);
			});
		}

		var multiAddOption = function(objOpt){
			console.log('multiAddOption');
		}

		var __self,
			$this,
			$submitBtn,
			$titleWrap,
			$salePrice,
			$retailPrice,
			$upcCode,
			optionData = [],
			allSkuData = {},
			bundleDefaultSkuData = {},
			skuData = {},
			option = {},
			optionDom = {},
			qtyComponent = null,
			currentOptList = {},
			currentSku = [],
			currentSkuArray = [],
			productId = 0,
			submit = false,
			firstOptName = 'COLOR',
			productOptionType = 'step',
			selectOptAppendType = false,
			secondIS = false,
			objOptType,
			isFireEvent = true,
			componentType,
			endPoint;

		var setting = {
			selector:'[data-component-product-option-restock]',
			submitBtn:'[data-cartbtn]',
			radio:'[data-component-radio]',
			select:'[data-component-select]',
			quantity:'[data-component-quantity]',
			titlewrap:'.title-wrap',
			salePrice:'.price',
			retailPrice:'.price-sale',
			upcCode:'.upc-code'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this; //closure, Dom Object 아님
				__self = _self;
				$this = $(setting.selector);
				$submitBtn = $this.find(setting.submitBtn);
				$titleWrap = $this.find(setting.titlewrap);
				$salePrice = $this.find(setting.salePrice);
				$retailPrice = $this.find(setting.retailPrice);
				$upcCode = $this.find(setting.upcCode);

				objOptType = arguments[0];
				firstOptName = objOptType.first;
				productOptionType = objOptType.productType;
				selectOptAppendType = objOptType.selectOptAppendType;
				componentType = objOptType.componentType || 'component_radio_restock';

				productId = $this.attr('data-product-id') || false;
				optionData = Core.Utils.strToJson($this.attr('data-product-options'));
				allSkuData = Core.Utils.strToJson($this.attr('data-sku-data'));
				bundleDefaultSkuData = Core.Utils.strToJson($this.attr('data-bundleDefaultSkuData-data'));
				endPoint = Core.getComponents('component_endpoint');

				//옵션 데이터 나누기 예) COLOR:{}, SIZE:{} ...
				for(var k in optionData){
					option[optionData[k].type] = optionData[k];

					for(var i=0; i<allSkuData.length; i++){
						allSkuData[i][optionData[k].type] = allSkuData[i].selectedOptions[k];
					}
				}

				$this.find('[data-brz-components-type]').each(function(i){
					// 컬러 선택이 input이 아닌 링크로 변경
					var componentTypeName = $(this).attr('data-brz-components-type');
					if(componentTypeName == 'COLOR'){
						var friendlyName = $(this).find('input[name=COLOR]').data('value');

						$(this).find('.over-txt').text(friendlyName);

						$this.find('input[type=hidden]').each(function(i){
							if($(this).attr('name') === 'itemAttributes[Color]'){
								$(this).val(escape(friendlyName));
							}
						});
					}
						optionDom[componentTypeName] = Core.getComponents(componentType, {context:$this, selector:this}, function(){
							this.addEvent('change', function(attributeValue, valueId, id, friendlyName){
								var obj = {};
								var _that = this;
								var $that = $(_that);
								var attributeName = $that.attr('data-attributename');
								var friendlyName = $that.attr('data-friendly-name');

								obj[$(_that).attr('name')] = valueId;
								receiveToEvent(obj);

								$this.find('input[type=hidden]').each(function(i){
									if($(this).attr('name') === 'itemAttributes['+attributeName+']'){
										$(this).val(attributeValue);
									}
								});

								/*
									fireEvent 가 등록되기전에 호출하여 처음 이벤트는 발생하지 않는다 그래서 setTimeout으로 자체 딜레이를 주어 해결하였다.
									조금 위험한 방법아지만 해결방법을 찾기 전까지 사용해야 할꺼 같다.
								*/

								setTimeout(function(){

									if(isFireEvent){
										_self.fireEvent('changeFirstOpt', _that, [firstOptName, $(_that).attr('name'), productId, attributeValue, valueId, id, friendlyName]);
										if( attributeName.toLowerCase() == 'color' ){
											endPoint.call( 'pdpColorClick', { color : attributeValue })
										}
									}
									isFireEvent = true;
									$that.find('.over-txt').text(friendlyName);
								});

							});
						});

					optionData[i]['name'] = $(this).attr('data-attribute-name');
				});

				/*
					optionDom : radio, selectbox 컴포넌트
					optionData : 상품의 총 옵션 ( COLOR, SIZE .... )
					allSkuData : 상품 옵션으로 생성된 총 SkuData
					처음 옵션 init 로드 후 allSkuData를 가지고 해당 quantity를 체크하여 옵션의 상태를 처리한다.
					firstOptName은 현 컴포넌트 arguments의 objOptType.first의 값을 가지고 와서 처리 한다. 해당 값은 템플릿에서 newProductOption에서 첫번째, 즉
					iterator.first 옵션의 type이며, COLOR, SIZE 만 테스트가 되어 있는 상태라 다른 옵션타입을 사용 할 경우 테스트를 해야 한다.
					단, 단품이 아닐때 실행한다.
				*/
				if(optionData && $this.find('[data-brz-components-type]').length > 0) {
					optionDom['SIZE'].receiveToData(optionData[1], allSkuData);
				}


				//first option select trigger
				$this.find('.input-radio.checked > input').each(function(i){
					$(this).trigger('click');
				});

				return this;
			},
			setTrigger:function(optionName, value, valueId){
				isFireEvent = false;
				optionDom[optionName].trigger(value, valueId);
			},
			getValidateChk:function(msg){
				var arrIsValidateChk = [];
				var isValidate = false;
				for(var key in optionDom){
					isValidate = optionDom[key].getValidateChk();
					arrIsValidateChk.push(isValidate);
					if(isValidate){
						optionDom[key].getThis().prev().find('.msg').removeClass('msg-on').text('');
					}else{
						optionDom[key].getThis().prev().find('.msg').addClass('msg-on').text(msg);
					}
				}

				return (arrIsValidateChk.indexOf(false) === -1) ? true : false;
			},
			getProductId:function(){
				return productId;
			},
			getDefaultSkuData:function(){
				// 단품일경우 (옵션이 없는경우) defaultSku 가 담겨서 넘어온다.
				// bundleDefaultSkuData 의 length 가 > 1 일때 번들 상품으로 bundleDefaultSkuData 넘김
				return (bundleDefaultSkuData.length > 0) ? bundleDefaultSkuData : allSkuData;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_product_option_restock'] = {
		constructor:ProductOptionSelectedRestock,
		reInit:true,
		attrName:'data-component-product-option-restock'
	}
})(Core);

(function(Core){
   var Gallery = function(){

      var $this, $thumbWrap, $galleryWrap, $zoomWrap, $zoomthumbWrap, args, currentIndex=0, arrThumbList=[], arrThumbListDetail=[], iScroll, sliderComponent, zoomSliderComponent, endPoint;
      var setting = {
         selector:'[data-component-gallery]',
         galleryModal:'#gallery-photo-swipe',
         galleryBtn:'[data-gallery-zoom]',
         thumbWrapper:'.product-thumb',
         zoomthumbWrap: '.zoom-product-gallery-thumb .zoom-product-thumb',
         galleryWrapper:'.product-gallery',
         zoomWrapper:'.pdp-gallery-fullview',
         zoomAppender:'.gallery-images',
         thumbContainer:'.thumb-wrap',
         thumbList:'.thumb-list',
         zoombtn:'.zoom-btn'
      }

      var galleryOptions = {
         history:false,
         focus:false,
         showAnimationDuration:0,
         hideAnimationDuration:0,
         index:0
      };


      var Closure = function(){}
      Closure.prototype.setting = function(){
         var opt = Array.prototype.slice.call(arguments).pop();
         $.extend(setting, opt);
         return this;
      }

      Closure.prototype.init = function(){
         var _self = this;

         args = arguments[0];
         $this = $(setting.selector);
         $thumbWrap = $this.find(setting.thumbWrapper);
         $galleryWrap = $this.find(setting.galleryWrapper);
         $zoomWrap = $this.find(setting.zoomWrapper);
         $zoomthumbWrap = $this.find(setting.zoomthumbWrap);
         endPoint = Core.getComponents('component_endpoint');

         var arrList = [];
         $thumbWrap.find('.thumb-list').each(function(i){
            var data = Core.Utils.strToJson($(this).attr('data-thumb'), true);
            var imgUrl = $(this).find('img').attr('src').replace(/\?[a-z]+/g, '');
            var pushIS = true;

            data.thumbUrl = imgUrl;

            /* 중복 이미지 처리 */
            for(var i=0; i < arrList.length; i++){
               if(arrList[i].thumbSort === data.thumbSort && arrList[i].thumbUrl === data.thumbUrl){
                  pushIS = false;
                  return;
               }
            }

            if(pushIS){
               arrList.push(data);
               arrThumbList.push(data);
               //상품상세 6개 갤러리
               arrThumbListDetail.push(data);
            }
         });

         $thumbWrap.on('click', 'li', function(e){
            e.preventDefault();

            var index = $(this).index();
            $(this).addClass('active').siblings().removeClass('active');
            sliderComponent.goToSlide(index);
            zoomSliderComponent.goToSlide(index);
            galleryOptions.index = index;
                endPoint.call('pdpImageClick', {index : index});
         });

         $galleryWrap.on('click', setting.zoombtn, function(){
            $('html').addClass('uk-modal-page');
            $('body').css('paddingRight', 15);
            $zoomWrap.addClass('show');
			zoomSliderComponent.reloadSlider(currentIndex);

         });

         $zoomWrap.find('.pdp-gallery-fullview-close').click(function(){
            if($('#quickview-wrap').length <= 0){
               $('html').removeClass('uk-modal-page');
               $('body').removeAttr('style');
            }
            $zoomWrap.removeClass('show');
         });

         this.setThumb(args.sort);
         return this;
      }

      Closure.prototype.setThumb = function(sort){
         var _self = this;
         var appendTxt = '';
         var count = 0;
         var count2 = 0;
         var sortType = sort || args.sort;
         var arrThumbData = arrThumbList.filter(function(item, index, array){
            if(item.thumbSort === sortType || item.thumbSort === 'null'){
               count++;
               return item;
            }
         });
         var detailArrThumbData = arrThumbListDetail.filter(function(item, index, array){
             if(item.thumbSort === sortType || item.thumbSort === 'null'){
                count2++;
                if(count2 < 7) {
                    return item;
                 }
             }
          });

         var thumbTemplate = Handlebars.compile($("#product-gallery-thumb").html())(arrThumbData);
         var zoomthumbTemplate = Handlebars.compile($("#product-gallery-thumb-fullzoom").html())(arrThumbData);

         var detailThumbTemplate = Handlebars.compile($("#product-gallery-thumb-detail").html())(detailArrThumbData);
         var galleryTemplate = Handlebars.compile($("#product-gallery-swipe").html())(arrThumbData);
         var zoomTemplate = Handlebars.compile($('#product-gallery-zoom').html())(arrThumbData);

         $thumbWrap.find('.thumb-list').eq(0).addClass('active');
         $("#detail_Thumb").empty().append(detailThumbTemplate);
         $galleryWrap.empty().append(galleryTemplate);
         $zoomWrap.find(setting.zoomAppender).empty().append(zoomTemplate);


         /*if(args.thumbType === 'left'){
            $thumbWrap.empty().append(thumbTemplate).css({
               'minHeight':'100%'
               //'height':($thumbWrap.find(setting.thumbList).eq(0).height() + parseInt(args.between)) * count
               //'height':(($thumbWrap.find(setting.thumbList).eq(0).height()>0 ? $thumbWrap.find(setting.thumbList).eq(0).height() : 83) + parseInt(args.between)) * count
            });
         }*/

         $thumbWrap.empty().append(thumbTemplate);
         $zoomthumbWrap.empty().append(zoomthumbTemplate);

         /*if(args.thumbType === 'bottom'){
            $thumbWrap.find(setting.thumbContainer).css({
               'width':($thumbWrap.find(setting.thumbList).eq(0).outerWidth(true) + parseInt(args.between)) * count
            });
         }*/

         if(sliderComponent) sliderComponent.destroySlider();
         sliderComponent = Core.getComponents('component_slider', {context:$this, selector:'.gallery-swipe'}, function(){
            this.addEvent('slideAfter', function($slideElement, oldIndex, newIndex){
         zoomSliderComponent.reloadSlider(newIndex);
         $thumbWrap.find('li').eq(newIndex).addClass('active').siblings().removeClass('active');
			   currentIndex = newIndex;
            });

            /*this.addEvent('onInit', function(){
               if(!Core.Utils.mobileChk){
                  iScroll = new IScroll($thumbWrap[0], {
                     scrollX:(args.thumbType === 'bottom') ? true : false,
                     scrollY:(args.thumbType === 'bottom') ? false : true
                  });
               }
            });*/
        });

		if(zoomSliderComponent) zoomSliderComponent.destroySlider();
		zoomSliderComponent = Core.getComponents('component_slider', {context:$this, selector:'.zoom-swipe'}, function(){
			this.addEvent('slideAfter', function($slideElement, oldIndex, newIndex){
			  sliderComponent.reloadSlider(newIndex);
        $thumbWrap.find('li').eq(newIndex).addClass('active').siblings().removeClass('active');
			   currentIndex = newIndex;
            });
		});
      }

      Core.Observer.applyObserver(Closure);
      return new Closure();
   }

   Core.Components['component_gallery'] = {
      constructor:Gallery,
      attrName:'data-component-gallery'
   }
})(Core);

(function(Core){
	var InputRadioRestock = function(){
		'use strict';
		var setting = {
			selector:'[data-component-radio-restock]',
			container:'.input-radio',
			label:'label',
			radio:'input[type=radio]',
			unlock:false
		}

		var rtnOption = function(container, key, data){
			container.find('input[type=radio]').parent().show();
			data.forEach(function(data, i){
				if(data.inventoryType != 'UNAVAILABLE'){
					if(data.inventoryType === 'ALWAYS_AVAILABLE' || null){
						container.find('input[type=radio]').each(function(i){
							if($(this).attr('name') == 'SIZE') {
								if($(this).val() == data[key]){
									$(this).parent().addClass('nonActive');
									$(this).parent().hide();
								} else {
									$(this).removeAttr('disabled').parent().removeClass('disabled');
								}
							} else {
								if($(this).val() == data[key]){
									$(this).removeAttr('disabled').parent().removeClass('disabled');
								}
							}
						});
					}else if(data.inventoryType === 'CHECK_QUANTITY'){
						if(data.quantity > 0 || data.quantity == null){
							container.find('input[type=radio]').each(function(i){
								if($(this).attr('name') == 'SIZE') {
									if($(this).val() == data[key]){
										$(this).parent().addClass('nonActive');
										$(this).parent().hide();
									} else {
										$(this).removeAttr('disabled').parent().removeClass('disabled');
									}
								}
								// else {
								// 	if($(this).val() == data[key]){
								// 		$(this).removeAttr('disabled').parent().removeClass('disabled');
								// 	}
								// }
							});
						}else if(data.quantity == 0){
							container.find('input[type=radio]').each(function(i){
								if($(this).attr('name') == 'SIZE') {
									if($(this).val() == data[key]){
										$(this).removeAttr('disabled').parent().removeClass('disabled');
									} else {
										$(this).removeAttr('disabled').parent().removeClass('disabled');
									}
								} else {
									if($(this).val() == data[key]){
										$(this).removeAttr('disabled').parent().removeClass('disabled');
									}
								}
							});
						}
					}
				}
			});
		}

		var $this, $label, $radio, $container, eventID, firstInit = false, opt, isValidate = false;

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				//console.log(arguments);
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				$this = $(setting.selector);
				$container = $this.find(setting.container);
				$label = $container.find(setting.label);
				$radio = $container.find(setting.radio);
				if(!opt) opt = arguments[0]||{};

				$label.off('click').on('click', function(e){
					e.preventDefault();

					_self.fireEvent('click', this, [$(this).siblings()]);
					if(!$(this).parent().hasClass('disabled')){
						if($(this).siblings().prop('checked') && setting.unlock){
							$(this).siblings().prop('checked', false);
							$(this).parent().removeClass('checked');
							return;
						}

						$(this).siblings().trigger('click');
					}
				});

				$radio.off('change').on('change', function(){
					if($(this).prop('checked')){
						isValidate = true;
						$(this).parent().addClass('checked').siblings().removeClass('checked');
						$(this).siblings().attr('checked');

						switch(opt.eventType || 'step'){
							case 'step':
								_self.fireEvent('change', this, [$(this).attr('data-value'), $(this).val(), $(this).attr('data-id'), $(this).attr('data-friendly-name')]);
								break;
							case 'normal':
								_self.fireEvent('change', this, [$(this).val()]);
								break;
						}
					}
				});

				// 기본 선택값 처리
				$radio.each(function(i){
					var $this = $(this);
					if($this.prop('checked')){
						setTimeout(function(){
							$this.trigger('change');
							_self.fireEvent('init', $this);
						});
					}
				});

				return this;
			},
			receiveToData:function(option, skuData){
				isValidate = false;
				if (option){
					rtnOption($container, option.type, skuData);
				}
			},
			reInit:function(){
				this.init();
				/*$container;
				$container.each(function(i){
					$(this).removeClass('checked').find('input[type=radio]').removeAttr('checked');
				});*/
			},
			disabled:function(){
				$container.each(function(i){
					$(this).removeClass('checked').addClass('disabled').find('input[type=radio]').removeAttr('checked').attr('disabled', 'disabled');
				});
			},
			trigger:function(value, valueId){
				$radio.each(function(){
					if($(this).val() == valueId){
						$(this).trigger('click');
						return false;
					}
				});
			},
			getValidateChk:function(){
				if(opt.required){
					return isValidate;
				}else{
					return true;
				}
			},
			getThis:function(){
				return $this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_radio_restock'] = {
		constructor:InputRadioRestock,
		attrName:'data-component-radio-restock',
		reInit:true
	}
})(Core);

(function(Core){
	var FileUpLoad = function(){
		'use strict';

		var $this, $form, $inputFiles, $progress, $uploadBtn, currentIndex=0;
		var setting = {
			selector:'[data-component-file]',
			form:'#fileupload-form',
			inputFiles:'#input-file',
			uploadBtn:'[data-upload-btn]',
			maxLength:5
		}

		var setImgPreview = function(target){
			var _self = target;
			var _this = this;

			if($(this).val() === '') return false;

			$form.ajaxSubmit({
				success:function(data){
					upImageResult.call(_self, data);
				},
				error:function(data){
					_self.fireEvent('error', [data]);
				}
			});
		}

		var upImageResult = function(data){
			if(data.result === true){
				this.fireEvent('upload', this, [data.fileName, data.fullUrl]);
			}else if(data.result === 'error'){
				this.fireEvent('error', this, [data.errorMessage]);
			}else{
				this.fireEvent('error', this, ['이미지 전송을 실패하였습니다.']);
			}
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				var cUrl = Core.Utils.url.getCurrentUrl();
				var cQueryParams = Core.Utils.getQueryParams(cUrl);

				$this = $(setting.selector);
				$uploadBtn = $this.find(setting.uploadBtn);
				$inputFiles = $(setting.inputFiles);
				$form = $(setting.form);

				$uploadBtn.click(function(e){
					e.preventDefault();

					if(currentIndex >= setting.maxLength){
						_self.fireEvent('error', this, ['최대'+setting.maxLength+'장 까지만 업로드 가능합니다.']);
						return false;
					}

					//appView일때 toapp 호출
					var appVer = cQueryParams.appver || '';
					if(cQueryParams.deviceOs){
						if(cQueryParams.deviceOs.toLowerCase() === 'ios' || cQueryParams.deviceOs.toLowerCase() === 'and'){
							if(appVer.replace(/\./g, '') >= 120){
								location.href='toapp://attach?uploadUrl='+ location.origin + $form.attr('action') +'&mediatype=image&callback=Core.getModule("module_review_write").moduleConnect&imagecount=1';
							}else{
								console.log('app version - ' + appVer);
							}
						}
					}else{
						$inputFiles.trigger('click');
					}
				});

				$inputFiles.change(function(e){
					setImgPreview.call(this, _self);
				});

				return this;
			},
			setCurrentIndex:function(index){
				currentIndex = index;
			},
			setToappUploadImage:function(data){
				upImageResult.call(this, data);
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_file'] = {
		constructor:FileUpLoad,
		attrName:'data-component-file'
	}
})(Core);

(function(Core){
	var CategoryItemListView = function(){
		'use strict';

		var $this, $overlayTxt, $quickViewBtn, $hover, modal, args, endPoint;
		var setting = {
			selector:'[data-component-categoryitem-list-view]',
			overlayTxt:'.category-overlaytext',
			quickViewBtn:'.quick-btn',
			hover:'.action-hover'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				args = arguments[0];
				$this = $(setting.selector);
				endPoint = Core.getComponents('component_endpoint');
				$overlayTxt = $this.find(setting.overlayTxt);
				$quickViewBtn = $this.find(setting.quickViewBtn);
				$hover = $this.find(setting.hover);
				modal = UIkit.modal('#common-modal', {modal:false, center:true});
				modal.off('.uk.modal.categoryItem').on({
					'hide.uk.modal.categoryItem':function(){
						console.log('categoryItem modal hide');
						$('html').removeClass('uk-modal-page');
						$('body').removeAttr('style');
					}
				});

				//category item image lazy load
				//$this.find('.lazy').lazyload();

				$quickViewBtn.click(function(e){
					e.preventDefault();

					//var id = $(this).siblings().filter('input[name=productId]').attr('value');
					var target = $(this).attr('data-href');
					var url = $this.find('input[name=producturl]').attr('value'); 
					//categoryitem.js에 아래와 같이 상품 url 받음.
					//$(this).siblings().filter('input[name=producturl]').attr('value');

					Core.Utils.ajax(url, 'GET', {quickview:true}, function(data){
						var domObject = $(data.responseText).find('#quickview-wrap');
						$(target).find('.contents').empty().append(domObject[0].outerHTML);
						$(target).addClass('quickview');
						Core.moduleEventInjection(domObject[0].outerHTML);
						modal.show();

						var $product = $(domObject[0].outerHTML);
						var productData = Core.Utils.strToJson( $product.find('[data-module-product]').data('module-product'), true );
						var data = {
							id : productData.productId,
							name : $product.find('[data-name]').data('name'),
							price : $product.find('[data-price]').data('price'),
							isDefaultSku : productData.isDefaultSku
						}
						endPoint.call('quickView', {product : data})
					});
				});

				$this.find('a').click(function(e){
					//회원전용상품 이고 로그인 안한 상태일때 로그인 모달 띄움
					if(args.isUserOnly === 'true'){
						if(!Core.getModule('module_header').getIsSignIn()){
							e.preventDefault();
							Core.getModule('module_header').reDirect().setLogin();
						}
					}
					if( $(this).closest(".related-items").length > 0){
						var productId = $(this).closest("[data-component-categoryitem]").find("input[name='productId']").val();
						var name = $(this).closest("[data-component-categoryitem]").find("[data-name]").text();
						endPoint.call('productRecommendationClick', { productId : productId, name : name });
					}
					sessionStorage.setItem('isHistoryBack', true);
					sessionStorage.setItem('categoryScrollTop', $(document).scrollTop());
					sessionStorage.setItem('categoryTarget', args.parentWrapper);
					sessionStorage.setItem('categoryPathname', location.pathname);
					sessionStorage.setItem('categoryList', $(args.parentWrapper)[0].innerHTML);
				});

				if(!Core.Utils.mobileChk){
					$hover.on('mouseenter', function(e){
						$(this).addClass('over');
					});

					$hover.on('mouseleave', function(e){
						$(this).removeClass('over');
					});
				}

				return this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_categoryitem_list_view'] = {
		constructor:CategoryItemListView,
		reInit:true,
		attrName:'data-component-categoryitem-list-view'
	}
})(Core);

(function(Core){
	var EndPoint = function(){
		'use strict';

		var _self;
		var setting = {}


		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();

				$.extend(setting, opt);
				return this;
			},
			init:function(){
				_self = this;
				return this;
			}, 
			call:function( status, data ){
				//console.log('endpoint : ', status );
				_self.fireEvent(status, this, [data]);
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_endpoint'] = {
		constructor:EndPoint,
		reInit : true,
		attrName:'data-component-endpoint'
	}
})(Core);

(function(Core){
	var CartQuantity = function(){
		'use strict';

		var $this, $input, $plusBtn, $minusBtn, $msg, currentQty = 1, maxLen = 1, args;
		var pattern = /[^0-9]/g;
		var setting = {
			selector:'[data-component-cart-quantity]',
			input:'.label',
			plusBtn:'.plus',
			minusBtn:'.minus',
			attrName:'data-component-cart-quantity',
			msg:'.msg'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			getQuantityByCheckLimit:function( quantity ){
				var maxQuantity = (args.maxQuantity != 'null') ? args.maxQuantity : 100; // 최대수량 100
				var minQuantity  = (args.maxQuantity != 'null') ? args.maxQuantity : 100; // 최대수량 100 parseInt(args.minNum || 1);
				if( quantity < minQuantity){
					quantity = minQuantity;
				}else if( quantity > maxQuantity ){
					quantity = maxQuantity
				}

				return quantity;
			},
			init:function(){
				var _self = this;
				args = arguments[0];

				$this = $(setting.selector);
				$input = $this.find(setting.input);
				$plusBtn = $this.find(setting.plusBtn);
				$minusBtn =  $this.find(setting.minusBtn);
				$msg = $this.find(setting.msg);
				maxLen = (args.maxQuantity != 'null') ? args.maxQuantity : 100; // 최대수량 100
				currentQty = $input.val();


				$plusBtn.on('click', function(e){
					e.preventDefault();

					currentQty++;

					$input.val(currentQty);
					$input.trigger('focusout');
				});

				$minusBtn.on('click', function(e){
					e.preventDefault();

					currentQty--;

					if(currentQty <= 1) currentQty = 1;
					$input.val(currentQty);
					$input.trigger('focusout');
				});

				$input.on({
					'keyup':function(e){
						var val = $input.val();
						if(pattern.test(val)){
							$input.val(val.replace(pattern, ''));
						}
					},
					'focusout':function(){
						currentQty = $(this).val();
						if(currentQty <= 1) currentQty = 1;

						if(parseInt(currentQty) > parseInt(maxLen)){
							$msg.text(maxLen + args.msg).show();
							currentQty = maxLen;
						}else{
							$msg.text('').hide();
						}

						$(this).val(currentQty);
						_self.fireEvent('change', this, [currentQty]);
					},
					'keydown':function(e){
						$this.addClass('value');
						if(e.keyCode === 13){
							return false;
						}
					}
				});

				return this;
			},
			getQuantity:function(){
				return currentQty;
			},
			setQuantity:function(quantity){
				$input.val(currentQty);
				// // //alert('setQuantity'+currentQty);
				// // //currentQty = quantity;
				// var qty = this.getQuantityByCheckLimit(quantity);
				// $input.val(qty);
				// currentQty = qty;
			},
			setMaxQuantity:function(quantity){
				//console.log(quantity);
				if(args.maxQuantity == 'null' && quantity != null){
					maxLen = quantity;
				}else if(args.maxQuantity != 'null'){
					if(quantity != null){
						if(quantity < args.maxQuantity){
							maxLen = quantity;
						}else{
							maxLen = args.maxQuantity;
						}
					}else{
						maxLen = args.maxQuantity;
					}
				}else if(quantity == null){
					maxLen = 100;
				}

				if(quantity == 0){
					$msg.text(args.quantityStateMsg).show();
				}else{
					$msg.text('').hide();
				}
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_cart_quantity'] = {
		constructor:CartQuantity,
		attrName:'data-component-cart-quantity'
	}
})(Core);

(function(Core){
	var CustomerAddress = function(){
		'use strict';

		var $this, args;
		var setting = {
			selector:'[data-component-customer-address]',
			selectBtn:'[data-customer-address-select-btn]',
			baseDom : '[data-customer-address]'
		}

		var getAddressInfoBySelect = function( $el ){
			var data = {};
			$el.closest(setting.baseDom).find('input[type=hidden]').each(function() {
				data[$(this).attr('name')] = $(this).val() || '';
			});
			return data;
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				args = arguments[0];
				$this = $(setting.selector);

				if( $this.find(setting.selectBtn).length == 0 ){
					return;
				}

				$this.find(setting.selectBtn).on('click', function(e){
					e.preventDefault();
					_self.fireEvent( 'select', this, [getAddressInfoBySelect( $(this) )]);
				});

				return this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_customer_address'] = {
		constructor:CustomerAddress,
		attrName:'data-component-customer-address'
	}
})(Core);

(function(Core){
	var cartAddOnProduct = function(sandbox){
		'use strict';

		var $this, $addonListWrap, $msg, args, selectComponent = null, isRequired=false, forceDependent=false, isValidate=false, isFireEvent = true;
		var objChildItem={}; //single 만 됨
		var setting = {
			selector:'[data-component-addon-option]',
			selectbox:'select',
			optionTemplate:'#addon-sku-option',
			listTemplate:'#cart-addon-sku-list',
			resultWrap:'.addon-list-wrap'
		}

		var addChildItem = function(key, skuData, requestChildItem){
			/*
				원상품 : 애드온 상품
					x_FORCED
					NONE
					1 : 1	EQUIVALENT			quantityComponent 추가 (수량체크는 원상품의 주문 수량만큼 추가가능) 인데 일단 수량 컴포넌트 삭제
					1 : x	PROPORTION			quantityComponent 추가 (relativeQuantity 값 만큼 추가가능)
					x : 1	PROPORTION_REV
			*/

			var appendTxt = '';
			if($(setting.listTemplate).length <= 0){
				throw new Error(setting.listTemplate + ' template is not defined');
				return;
			}

			if(args['data-component-addon-option'].addOnListType === 'single'){
				objChildItem = {};
				$addonListWrap.empty();
			}

			if(!objChildItem.hasOwnProperty(key)){
				skuData.isSubmit = args['data-component-addon-option'].isSubmit;
				skuData.privateId = key;
				appendTxt = Handlebars.compile($(setting.listTemplate).html())(skuData);
				objChildItem[key] = requestChildItem;
				$addonListWrap.append(appendTxt);

				if(skuData.isQuantity){
					Core.getComponents('component_quantity', {context:$addonListWrap}, function(){
						this.addEvent('change', function(qty){
							objChildItem[key].quantity = qty;
						});
					});
				}
			}

			isValidate = true;
			if($msg.length > 0){
				$msg.hide();
			}
		}

		var addMessage = function(){
			if($msg.length > 0){
				$msg.show();
			}else{
				UIkit.notify('상품을 선택해 주세요', {timeout:3000,pos:'top-center',status:''});
			}
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				args = arguments[0];

				//에드온의 템플릿이 없으면 에러 throw
				if($(setting.optionTemplate).lenght <= 0){
					throw new Error('#addon-sku-option template is not defined');
					return;
				}

				//sku 옵션생성
				$this = $(setting.selector);
				$addonListWrap = $this.find(setting.resultWrap);
				$msg = $this.find('.msg');

				var $select = $this.find(setting.selector);
				var optionData = args['data-product-options'];
				var skuData = args['data-sku-data'];
				var skuOpt = [];
				var addOnProductType = args['data-component-addon-option'].addOnProductType;
				var relativeType = args['data-component-addon-option'].addOnRelativeType;
				var relativeQuantity = args['data-component-addon-option'].addOnRelativeQuantity;
				forceDependent = (args['data-component-addon-option'].forceDependent === 'true') ? true : false;
				isRequired = (args['data-component-addon-option'].isRequired === 'true') ? true : false;

				for(var i=0; i<skuData.length; i++){
					if(skuData[i].inventoryType !== 'UNAVAILABLE'){
						if(skuData[i].quantity === 'null' || skuData[i].quantity > 0 || skuData[i].inventoryType === 'ALWAYS_AVAILABLE'){
						    (function(){
						        var obj = {};
								obj['privateId'] = skuData[i].skuId;
								obj['name'] = args['data-component-addon-option'].name;
								obj['retailPrice'] = Core.Utils.price(args['data-component-addon-option'].retailPrice);
						        obj['salePrice'] = Core.Utils.price(args['data-component-addon-option'].salePrice);
								obj['isQuantity'] = (relativeType === 'PROPORTION' || relativeType === 'NONE' || relativeType === 'null') ? true : false;
	    						obj['quantity'] = (relativeQuantity > skuData[i].quantity || relativeQuantity === 'null' || relativeQuantity === '') ? skuData[i].quantity : relativeQuantity;
	    						obj['selectedOptions'] = (function(index){
	    						    var arr = [];
	    						    skuData[index].selectedOptions.forEach(function(a, i){
										var obj = {};
	    						        obj[optionData[i].attributeName] = optionData[i]['values'][a];
										arr.push(obj);
	    						    });
									obj['options'] = JSON.stringify(arr);
	    							return arr;
	    						})(i);
								obj['label'] = (function(index){
	    						    var arr = [];
	    						    skuData[index].selectedOptions.forEach(function(a, i){
										arr.push(optionData[i]['values'][a]);
	    						    });
	    							return arr;
	    						})(i).join(' / ');
	    						skuOpt.push(obj);
						    })();
						}
					}
				}

				selectComponent = Core.getComponents('component_select', {context:$this}, function(){
					this.getThis().find('select').append(Handlebars.compile($(setting.optionTemplate).html())(skuOpt));
					this.rePaintingSelect();
					this.addEvent('change', function(val, $selected, index){
						var requestChildItem = {};
						var privateId = $selected.attr('data-privateid');
						requestChildItem.productId = args['data-component-addon-option'].addonId;
						requestChildItem.quantity = 1;

						for(var i=0; i<skuOpt[index-1].selectedOptions.length; i++){
							for(var key in skuOpt[index-1].selectedOptions[i]){
								requestChildItem['itemAttributes['+ key +']'] = skuOpt[index-1].selectedOptions[i][key];
							}
						}

						addChildItem(privateId, skuOpt[index-1], requestChildItem);
						if(isFireEvent){
							_self.fireEvent('addToAddOnItem', this, [privateId, $selected]);
						}else{
							isFireEvent = true;
						}
					});
				});

				var skuQuantity = 0;
				skuData.forEach(function(rowData,eq){
			    	skuQuantity += rowData.quantity;
				});

				if (skuQuantity <= 0){
		        $(selectComponent.getThis().parents('.addon_select_wrap')).wrap('<p class="addon-out-stock"></p>').parent().html('모든 사은품이 품절되었습니다.');
				}

				/* delete btn addEvent */
				$addonListWrap.on('click', '.btn-addon-remove', function(e){
					e.preventDefault();

					var $parent = $(this).closest('.addon-state');
					var key = $parent.attr('data-privateId');
					$parent.remove();

					if(objChildItem.hasOwnProperty(key)){
						delete objChildItem[key];
						selectComponent.reInit();
					}

					if(Core.Utils.objLengtn() <= 0){
						isValidate = false;
					}

					_self.fireEvent('itemDelete', this, [key]);
				});

				/* isSubmit === true */
				$addonListWrap.on('click', '.btn-submit', function(e){
					e.preventDefault();
					_self.fireEvent('submit', this, [_self.getChildAddToCartItems()]);
				});

				return this;
			},
			setTrigger:function(privateId){
				isFireEvent = false;
				if(selectComponent) selectComponent.trigger(privateId, privateId);
			},
			getChildAddToCartItems:function(){
				var arrChildItem = [];
				for(var key in objChildItem){
					arrChildItem.push(objChildItem[key]);
				}

				return arrChildItem;
			},
			getValidateChk:function(){
				if((!isRequired || isRequired === 'null' ) && (!forceDependent || forceDependent === 'null')){
					isValidate = true;
				}else{
					if(!isValidate){
						addMessage();
					}
				}
				return isValidate;
			},
			getAddonId:function(){
				return args['data-component-addon-option'].addonId;
			},
			removeItems:function(){
				$addonListWrap.find('.btn-delete').trigger('click');
			},
			getAddOnOrderId:function(){
				return args['data-component-addon-option'].addOnOrderId;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_addon_option'] = {
		constructor:cartAddOnProduct,
		reInit:true,
		attrName:['data-component-addon-option', 'data-product-options', 'data-sku-data']
	}
})(Core);

(function(Core){
	var CategoryItem = function(){
		'use strict';

		var $this, $overlayTxt, $quickViewBtn, $hover, modal, args, endPoint;
		var setting = {
			selector:'[data-component-categoryitem]',
			overlayTxt:'.category-overlaytext',
			quickViewBtn:'.quick-btn',
			hover:'.action-hover'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;

				args = arguments[0];
				$this = $(setting.selector);
				endPoint = Core.getComponents('component_endpoint');
				$overlayTxt = $this.find(setting.overlayTxt);
				$quickViewBtn = $this.find(setting.quickViewBtn);
				$hover = $this.find(setting.hover);
				modal = UIkit.modal('#common-modal', {modal:false, center:true});
				modal.off('.uk.modal.categoryItem').on({
					'hide.uk.modal.categoryItem':function(){
						console.log('categoryItem modal hide');
						$('html').removeClass('uk-modal-page');
						$('body').removeAttr('style');
					}
				});

				//category item image lazy load
				//$this.find('.lazy').lazyload();

				$quickViewBtn.click(function(e){
					e.preventDefault();

					//var id = $(this).siblings().filter('input[name=productId]').attr('value');
					var target = $(this).attr('data-href');
					var url = $(this).siblings().filter('input[name=producturl]').attr('value');

					Core.Utils.ajax(url, 'GET', {quickview:true}, function(data){
						var domObject = $(data.responseText).find('#quickview-wrap');
						$(target).find('.contents').empty().append(domObject[0].outerHTML);
						$(target).addClass('quickview');
						Core.moduleEventInjection(domObject[0].outerHTML);
						modal.show();

						var $product = $(domObject[0].outerHTML);
						var productData = Core.Utils.strToJson( $product.find('[data-module-product]').data('module-product'), true );
						var data = {
							id : productData.productId,
							name : $product.find('[data-name]').data('name'),
							price : $product.find('[data-price]').data('price'),
							isDefaultSku : productData.isDefaultSku
						}
						endPoint.call('quickView', {product : data})
					});
				});

				$this.find('a').click(function(e){
					//회원전용상품 이고 로그인 안한 상태일때 로그인 모달 띄움
					if(args.isUserOnly === 'true'){
						if(!Core.getModule('module_header').getIsSignIn()){
							e.preventDefault();
							Core.getModule('module_header').reDirect().setLogin();
						}
					}
					if( $(this).closest(".related-items").length > 0){
						var productId = $(this).closest("[data-component-categoryitem]").find("input[name='productId']").val();
						var name = $(this).closest("[data-component-categoryitem]").find("[data-name]").text();
						endPoint.call('productRecommendationClick', { productId : productId, name : name });
					}
					sessionStorage.setItem('isHistoryBack', true);
					sessionStorage.setItem('categoryScrollTop', $(document).scrollTop());
					sessionStorage.setItem('categoryTarget', args.parentWrapper);
					sessionStorage.setItem('categoryPathname', location.pathname);
					sessionStorage.setItem('categoryList', $(args.parentWrapper)[0].innerHTML);
				});

				if(!Core.Utils.mobileChk){
					$hover.on('mouseenter', function(e){
						$(this).addClass('over');
					});

					$hover.on('mouseleave', function(e){
						$(this).removeClass('over');
					});
				}

				return this;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_categoryitem'] = {
		constructor:CategoryItem,
		reInit:true,
		attrName:'data-component-categoryitem'
	}
})(Core);

(function(Core){
	var addOnProduct = function(sandbox){
		'use strict';

		var $this, $addonListWrap, $msg, args, selectComponent = null, isRequired=false, forceDependent=false, isValidate=false, isFireEvent = true;
		var objChildItem={}; //single 만 됨
		var setting = {
			selector:'[data-component-addon-product-option]',
			selectbox:'select',
			optionTemplate:'#addon-sku-option',
			listTemplate:'#addon-sku-list',
			resultWrap:'.addon-list-wrap'
		}

		var addChildItem = function(key, skuData, requestChildItem){
			/*
				원상품 : 애드온 상품
					x_FORCED
					NONE
					1 : 1	EQUIVALENT			quantityComponent 추가 (수량체크는 원상품의 주문 수량만큼 추가가능) 인데 일단 수량 컴포넌트 삭제
					1 : x	PROPORTION			quantityComponent 추가 (relativeQuantity 값 만큼 추가가능)
					x : 1	PROPORTION_REV
			*/

			var appendTxt = '';
			if($(setting.listTemplate).length <= 0){
				throw new Error(setting.listTemplate + ' template is not defined');
				return;
			}

			if(args['data-component-addon-product-option'].addOnListType === 'single'){
				objChildItem = {};
				$addonListWrap.empty();
			}

			if(!objChildItem.hasOwnProperty(key)){
				skuData.isSubmit = args['data-component-addon-product-option'].isSubmit;
				skuData.privateId = key;
				appendTxt = Handlebars.compile($(setting.listTemplate).html())(skuData);
				objChildItem[key] = requestChildItem;
				$addonListWrap.append(appendTxt);

				if(skuData.isQuantity){
					Core.getComponents('component_quantity', {context:$addonListWrap}, function(){
						this.addEvent('change', function(qty){
							objChildItem[key].quantity = qty;
						});
					});
				}
			}

			isValidate = true;
			if($msg.length > 0){
				$msg.hide();
			}
		}

		var addMessage = function(){
			if($msg.length > 0){
				$msg.show();
			}else{
				UIkit.notify('상품을 선택해 주세요', {timeout:3000,pos:'top-center',status:''});
			}
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this;
				args = arguments[0];

				//에드온의 템플릿이 없으면 에러 throw
				if($(setting.optionTemplate).lenght <= 0){
					throw new Error('#addon-sku-option template is not defined');
					return;
				}

				//sku 옵션생성
				$this = $(setting.selector);
				$addonListWrap = $this.find(setting.resultWrap);
				$msg = $this.find('.msg');

				var $select = $this.find(setting.selector);
				var optionData = args['data-product-options'];
				var skuData = args['data-sku-data'];
				var skuOpt = [];
				var addOnProductType = args['data-component-addon-product-option'].addOnProductType;
				var relativeType = args['data-component-addon-product-option'].addOnRelativeType;
				var relativeQuantity = args['data-component-addon-product-option'].addOnRelativeQuantity;
				forceDependent = (args['data-component-addon-product-option'].forceDependent === 'true') ? true : false;
				isRequired = (args['data-component-addon-product-option'].isRequired === 'true') ? true : false;

				for(var i=0; i<skuData.length; i++){
					if(skuData[i].inventoryType !== 'UNAVAILABLE'){
						if(skuData[i].quantity === 'null' || skuData[i].quantity > 0 || skuData[i].inventoryType === 'ALWAYS_AVAILABLE'){
						    (function(){
						        var obj = {};
								obj['privateId'] = skuData[i].skuId;
								obj['name'] = args['data-component-addon-product-option'].name;
								obj['retailPrice'] = Core.Utils.price(args['data-component-addon-product-option'].retailPrice);
						        obj['salePrice'] = Core.Utils.price(args['data-component-addon-product-option'].salePrice);
								obj['isQuantity'] = (relativeType === 'PROPORTION' || relativeType === 'NONE' || relativeType === 'null') ? true : false;
	    						obj['quantity'] = (relativeQuantity > skuData[i].quantity || relativeQuantity === 'null' || relativeQuantity === '') ? skuData[i].quantity : relativeQuantity;
	    						obj['selectedOptions'] = (function(index){
	    						    var arr = [];
	    						    skuData[index].selectedOptions.forEach(function(a, i){
										var obj = {};
	    						        obj[optionData[i].attributeName] = optionData[i]['values'][a];
										arr.push(obj);
	    						    });
									obj['options'] = JSON.stringify(arr);
	    							return arr;
	    						})(i);
								obj['label'] = (function(index){
	    						    var arr = [];
	    						    skuData[index].selectedOptions.forEach(function(a, i){
										arr.push(optionData[i]['values'][a]);
	    						    });
	    							return arr;
	    						})(i).join(' / ');
	    						skuOpt.push(obj);
						    })();
						}
					}
				}

				selectComponent = Core.getComponents('component_select', {context:$this}, function(){
					this.getThis().find('select').append(Handlebars.compile($(setting.optionTemplate).html())(skuOpt));
					this.rePaintingSelect();
					this.addEvent('change', function(val, $selected, index){
						var requestChildItem = {};
						var privateId = $selected.attr('data-privateid');
						requestChildItem.productId = args['data-component-addon-product-option'].addonId;
						requestChildItem.quantity = 1;

						for(var i=0; i<skuOpt[index-1].selectedOptions.length; i++){
							for(var key in skuOpt[index-1].selectedOptions[i]){
								requestChildItem['itemAttributes['+ key +']'] = skuOpt[index-1].selectedOptions[i][key];
							}
						}

						addChildItem(privateId, skuOpt[index-1], requestChildItem);
						if(isFireEvent){
							_self.fireEvent('addToAddOnItem', this, [privateId, $selected]);
						}else{
							isFireEvent = true;
						}
					});
				});

				var skuQuantity = 0;
				skuData.forEach(function(rowData,eq){
			    	skuQuantity += rowData.quantity;
				});

				if (skuQuantity <= 0){
		        $(selectComponent.getThis().parents('.addon_select_wrap')).wrap('<p class="addon-out-stock"></p>').parent().html('모든 사은품이 품절되었습니다.');
				}

				/* delete btn addEvent */
				$addonListWrap.on('click', '.btn-addon-remove', function(e){
					e.preventDefault();

					var $parent = $(this).closest('.addon-state');
					var key = $parent.attr('data-privateId');
					$parent.remove();

					if(objChildItem.hasOwnProperty(key)){
						delete objChildItem[key];
						selectComponent.reInit();
					}

					if(Core.Utils.objLengtn() <= 0){
						isValidate = false;
					}

					_self.fireEvent('itemDelete', this, [key]);
				});

				/* isSubmit === true */
				$addonListWrap.on('click', '.btn-submit', function(e){
					e.preventDefault();
					_self.fireEvent('submit', this, [_self.getChildAddToCartItems()]);
				});

				return this;
			},
			setTrigger:function(privateId){
				isFireEvent = false;
				if(selectComponent) selectComponent.trigger(privateId, privateId);
			},
			getChildAddToCartItems:function(){
				var arrChildItem = [];
				for(var key in objChildItem){
					arrChildItem.push(objChildItem[key]);
				}

				return arrChildItem;
			},
			getValidateChk:function(){
				if((!isRequired || isRequired === 'null' ) && (!forceDependent || forceDependent === 'null')){
					isValidate = true;
				}else{
					if(!isValidate){
						addMessage();
					}
				}
				return isValidate;
			},
			getAddonId:function(){
				return args['data-component-addon-product-option'].addonId;
			},
			removeItems:function(){
				$addonListWrap.find('.btn-delete').trigger('click');
			},
			getAddOnOrderId:function(){
				return args['data-component-addon-product-option'].addOnOrderId;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_addon_product_option'] = {
		constructor:addOnProduct,
		reInit:true,
		attrName:['data-component-addon-product-option', 'data-product-options', 'data-sku-data']
	}
})(Core);

(function(Core){

	var ProductOptionSelected = function(){
		'use strict';

		var receiveToEvent = function(checkedOpt){

			var key = Object.keys(checkedOpt)[0];
			var index = 0;
			var resetIS = false;
			var objOpt = {};
			var currentIndex = 0;

			//currentSku 초기화하여 사용해야 하지만 returnToSkuData에 currentSku값을 사용하는 문제점 해결시 사용해야함
			//if(key === firstOptName) currentSku = allSkuData;
			//선택된 옵션 인덱스

			for(var i=0; i<optionData.length; i++){
				if(optionData[i].type === key){
					currentIndex = i;
					break;
				}
			}

			optionData.map(function(data, i, o){
				if(data.type === key) data.selectedValue = (checkedOpt[key] !== '' && checkedOpt[key] !== null) ? checkedOpt[key] : null;

				//선택된 다음 옵션들 리셋
				if(i > currentIndex) disabled(data.type, i);
				if(data.selectedValue === null){
					if(checkedOpt[key] !== '' && checkedOpt[key] !== null && index === i){
						//data.type : 다음 옵션 아이디
						//data : 다음 옵션 리스트
						//returnToSkuData(key, checkedOpt[key]) : sku 리스트
						nextOpt(data.type, data, returnToSkuData(objOpt));
					}
				}else{
					index++;
					objOpt[data.type] = data.selectedValue;

					//if(index === o.length){
						if(productOptionType === 'multi') multiAddOption(objOpt);
						if(productOptionType === 'single') singleAddOption(objOpt);
					//}
				}
			});
		}

		var returnToSkuData = function(objSkuValue){
			var arrData = [];
			var len = Object.keys(objSkuValue).length;
			var counter = 0;

			//currentSku값에서만 옵션을 체크하여 값을 전달 해야 하지만
			//currentSku값의 초기화 문제때문에 allSkuData의 배열을 이용해야한다.
			allSkuData.forEach(function(data){
				counter = 0;
				for(var key in objSkuValue){
					if(data[key] == objSkuValue[key]){
						counter++;
						if(counter === len){
							arrData.push(data);
						}
					}else{
						return false;
					}
				}
			});

			return arrData;
		}

		var nextOpt = function(componentID, opt, sku){
			currentSku = sku;
			optionDom[componentID].receiveToData(opt, sku);
		}

		var disabled = function(componentID, index){
			optionData[index].selectedValue = null;
			optionDom[componentID].disabled();
		}

		var noAddOption = function(){
			var obj = {};
			obj['qty'] = $('input[name=quantity]').eq(0).val();
			currentOptList = {};
			currentOptList['noOption'] = obj;
		}

		var singleAddOption = function(objOpt){
			var obj = {};
			var listKey = '';
			var sku = null;
			var counter = 0;

			sku = returnToSkuData(objOpt)[0];

			//옵션타입이 selectbox일때 value가 없는 즉, 선택하세요.. 이 선택될 경우 sku가 없으므로 리턴시킨다.
			if(!sku) return;

			obj['price'] = sku.price;
			obj['qty'] = $this.find('.qty').val();
			obj['maxQty'] = sku.quantity;
			obj['retailPrice'] = sku.retailPrice;
			obj['salePrice'] = sku.salePrice;
			obj['inventoryType'] = sku.inventoryType;
			obj['options'] = {};
			obj['upc'] = sku.upc;
			obj['id'] = sku.skuId;

			for(var optionKey in option){
				listKey += option[optionKey].values[option[optionKey].selectedValue];
				obj['options'][optionKey] = option[optionKey].values[option[optionKey].selectedValue];

				counter++;
			}

			currentOptList = {};
			currentOptList[listKey] = obj;

			if($submitBtn.hasClass('disabled') && submit){
				$submitBtn.removeClass('disabled');
			}

			if(obj.salePrice){
				var salePrice = parseInt(obj.salePrice.replace(/[￦,가-힣]/g, ''));
				var retailPrice = parseInt(obj.retailPrice.replace(/[￦,가-힣]/g, ''));
				var rate = Math.round(parseInt(salePrice)/parseInt(retailPrice) * 100);
				
				if(salePrice < retailPrice){
					$salePrice.text(obj.salePrice).data("price", salePrice);
					$retailPrice.text(obj.retailPrice);
					$rate.text(100 - rate + '%');
					$('.marketing-msg').show();
				}else{
					$salePrice.text(obj.retailPrice).data("price", obj.retailPrice);
					$retailPrice.hide();
					$rate.hide();
					$('.marketing-msg').hide();
				}
			}else{
				$salePrice.text(obj.retailPrice).data("price", obj.retailPrice);
				$retailPrice.hide();
				$rate.hide();
			}
			$upcCode.data('upc', obj.upc);
			$upcCode.text(obj.upc);

			/*
				fireEvent 가 등록되기전에 호출하여 처음 이벤트는 발생하지 않는다 그래서 setTimeout으로 자체 딜레이를 주어 해결하였다.
				조금 위험한 방법아지만 해결방법을 찾기 전까지 사용해야 할꺼 같다.
			*/
			setTimeout(function(){
				__self.fireEvent('skuComplete', __self, [obj]);
			});
		}

		var multiAddOption = function(objOpt){
			console.log('multiAddOption');
		}

		var __self,
			$this,
			$optionWrap,
			$submitBtn,
			$titleWrap,
			$salePrice,
			$retailPrice,
			$upcCode,
			$rate,
			optionData = [],
			allSkuData = {},
			bundleDefaultSkuData = {},
			skuData = {},
			option = {},
			optionDom = {},
			qtyComponent = null,
			currentOptList = {},
			currentSku = [],
			currentSkuArray = [],
			productId = 0,
			submit = false,
			firstOptName = 'COLOR',
			productOptionType = 'step',
			selectOptAppendType = false,
			secondIS = false,
			objOptType,
			isFireEvent = true,
			componentType,
			endPoint;

		var setting = {
			selector:'[data-component-product-option]',
			optionWrap:'.option-wrap',
			submitBtn:'[data-cartbtn]',
			radio:'[data-component-radio]',
			select:'[data-component-select]',
			quantity:'[data-component-quantity]',
			titlewrap:'.title-wrap',
			salePrice:'.sale',
			rate:'.rate',
			retailPrice:'.retail',
			upcCode:'.upc-code'
		}

		var Closure = function(){}
		Closure.prototype = {
			setting:function(){
				var opt = Array.prototype.slice.call(arguments).pop();
				$.extend(setting, opt);
				return this;
			},
			init:function(){
				var _self = this; //closure, Dom Object 아님
				__self = _self;
				$this = $(setting.selector);
				$optionWrap = $this.find(setting.optionWrap);
				$submitBtn = $this.find(setting.submitBtn);
				$titleWrap = $this.find(setting.titlewrap);
				$salePrice = $this.find(setting.salePrice);
				$retailPrice = $this.find(setting.retailPrice);
				$rate = $this.find(setting.rate);
				$upcCode = $this.find(setting.upcCode);

				objOptType = arguments[0];
				firstOptName = objOptType['data-component-product-option'].first;
				productOptionType = objOptType['data-component-product-option'].productType;
				selectOptAppendType = objOptType['data-component-product-option'].selectOptAppendType;
				componentType = objOptType['data-component-product-option'].componentType || 'component_radio';

				//['data-component-product-option', 'data-product-options', 'data-sku-data']

				productId = $this.attr('data-product-id') || false;
				optionData = objOptType['data-product-options'] //Core.Utils.strToJson($this.attr('data-product-options'));
				allSkuData = objOptType['data-sku-data'] //Core.Utils.strToJson($this.attr('data-sku-data'));
				bundleDefaultSkuData = Core.Utils.strToJson($this.attr('data-bundleDefaultSkuData-data'));
				endPoint = Core.getComponents('component_endpoint');

				//옵션 데이터 나누기 예) COLOR:{}, SIZE:{} ...
				for(var k in optionData){
					option[optionData[k].type] = optionData[k];

					for(var i=0; i<allSkuData.length; i++){
						allSkuData[i][optionData[k].type] = allSkuData[i].selectedOptions[k];
					}
				}

				$optionWrap.find('[data-brz-components-type]').each(function(i){
					// 컬러 선택이 input이 아닌 링크로 변경
					var componentTypeName = $(this).attr('data-brz-components-type');
					if(componentTypeName == 'COLOR'){
						var attributename = $(this).find('input[name=COLOR]').data('value');
						var friendlyName = $(this).find('input[name=COLOR]').data('friendly-name');

						$(this).parents('.option-wrap').find('.over-txt').text(friendlyName);

						$optionWrap.find('input[type=hidden]').each(function(i){
							if($(this).attr('name') === 'itemAttributes[COLOR]'){
								$(this).val(attributename);
							}
						});
					}
					optionDom[componentTypeName] = Core.getComponents(componentType, {context:$this, selector:this}, function(){
						this.addEvent('change', function(attributeValue, valueId, id, friendlyName){
							var obj = {};
							var _that = this;
							var $that = $(_that);
							var attributeName = $that.attr('data-attributename');
							var friendlyName = $that.attr('data-friendly-name');

							obj[$(_that).attr('name')] = valueId;
							receiveToEvent(obj);

							$optionWrap.find('input[type=hidden]').each(function(i){
								if($(this).attr('name') === 'itemAttributes['+attributeName+']'){
									$(this).val(escape(attributeValue));
								}
							});

							/*
								fireEvent 가 등록되기전에 호출하여 처음 이벤트는 발생하지 않는다 그래서 setTimeout으로 자체 딜레이를 주어 해결하였다.
								조금 위험한 방법아지만 해결방법을 찾기 전까지 사용해야 할꺼 같다.
							*/

							setTimeout(function(){
								if(isFireEvent){
									_self.fireEvent('changeFirstOpt', _that, [firstOptName, $(_that).attr('name'), productId, attributeValue, valueId, id, friendlyName]);
									if( attributeName.toLowerCase() == 'color' ){
										endPoint.call( 'pdpColorClick', { color : attributeValue })
									}
								}
								isFireEvent = true;
								$that.parents('.option-wrap').find('.over-txt').text(friendlyName);
								$(setting.quantity).find('input').trigger('focusout');
							});

						});
					});

					optionData[i]['name'] = $(this).attr('data-attribute-name');
				});

				/*
					optionDom : radio, selectbox 컴포넌트
					optionData : 상품의 총 옵션 ( COLOR, SIZE .... )
					allSkuData : 상품 옵션으로 생성된 총 SkuData
					처음 옵션 init 로드 후 allSkuData를 가지고 해당 quantity를 체크하여 옵션의 상태를 처리한다.
					firstOptName은 현 컴포넌트 arguments의 objOptType['data-component-product-option'].first의 값을 가지고 와서 처리 한다. 해당 값은 템플릿에서 newProductOption에서 첫번째, 즉
					iterator.first 옵션의 type이며, COLOR, SIZE 만 테스트가 되어 있는 상태라 다른 옵션타입을 사용 할 경우 테스트를 해야 한다.
					단, 단품이 아닐때 실행한다.
				*/
				if(optionData && $optionWrap.find('[data-brz-components-type]').length > 0){
					if($optionWrap.find('[data-brz-components-type]').length == 1){
						var optionName = $optionWrap.find('[data-brz-components-type]').attr('data-attribute-name');
						if(optionName !== 'COLOR'){
							optionDom['SIZE'].receiveToData(optionData[0], allSkuData);
						}
					}else{
						optionDom['SIZE'].receiveToData(optionData[1], allSkuData);
					}
				}


				//first option select trigger
				$optionWrap.find('.selectable.selected').each(function(i){
					$(this).trigger('click');
				});

				return this;
			},
			setTrigger:function(optionName, value, valueId){
				isFireEvent = false;
				optionDom[optionName].trigger(value, valueId);
			},
			getValidateChk:function(msg){
				var arrIsValidateChk = [];
				var isValidate = false;
				for(var key in optionDom){
					isValidate = optionDom[key].getValidateChk();
					arrIsValidateChk.push(isValidate);
					if(isValidate){
						optionDom[key].getThis().find('.msg').text('').hide();
						//optionDom[key].getThis().prev().find('.msg').removeClass('msg-on').text('');
					}else{
						//console.log();
						optionDom[key].getThis().find('.msg').text(msg).show();
						//optionDom[key].getThis().prev().find('.msg').addClass('msg-on').text(msg);
					}
				}

				return (arrIsValidateChk.indexOf(false) === -1) ? true : false;
			},
			getProductId:function(){
				return productId;
			},
			getDefaultSkuData:function(){
				// 단품일경우 (옵션이 없는경우) defaultSku 가 담겨서 넘어온다.
				// bundleDefaultSkuData 의 length 가 > 1 일때 번들 상품으로 bundleDefaultSkuData 넘김
				return (bundleDefaultSkuData.length > 0) ? bundleDefaultSkuData : allSkuData;
			}
		}

		Core.Observer.applyObserver(Closure);
		return new Closure();
	}

	Core.Components['component_product_option'] = {
		constructor:ProductOptionSelected,
		attrName:['data-component-product-option', 'data-product-options', 'data-sku-data']
	}
})(Core);

(function(Core){
	Core.register('module_latest', function(sandbox){
		var $this, args, productId, arrLatestItems;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];
				productId = args.productId || null;

				//최근본상품 cookie
				var latestItemsMaxLength = args.latestItemsMaxLength;
				var latestItems = $.cookie('latestItems');

				if( productId != null){
					var pattern = new RegExp(productId, 'g');
					if(latestItems){
						arrLatestItems = latestItems.replace(pattern, '').match(/[0-9]+/g) || [];
						arrLatestItems.unshift(productId);

						if(arrLatestItems.length >= latestItemsMaxLength){
							arrLatestItems = arrLatestItems.slice(0, -1);
						}
						$.cookie('latestItems', arrLatestItems.join(','), {path:'/'});
					}else if(!latestItems){
						$.cookie('latestItems', productId, {path:'/'});
						$this.remove();
					}
				}

				addLatestItem(latestItems);
			}
		}

		var addLatestItem = function(items){
			var obj = {
				'id':items || 0, // 무조건 dom을 가져오기 위해서 가지고 있는 productid가 없어도 0을 넘겨 비어있음 나오게 한다.
				'mode':'template',
				'templatePath':'/modules/latest',
				'resultVar':'productList',
				'minSlides':args.minSlides || 2,
				'maxSlides':args.maxSlides || 4,
				'slideMargin':args.slideMargin || 0
			}

			sandbox.utils.ajax(sandbox.utils.contextPath + '/processor/execute/product', 'GET', obj, function(data){
				$this.append(data.responseText);
				sandbox.moduleEventInjection(data.responseText);
			}, false, true);
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-latest]',
					attrName:'data-module-latest',
					moduleName:'module_latest',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				console.log('latest destory');
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_returnorder', function(sandbox){
		var Method = {
			$that:null,
			$allCheck:null, // 팝업 전체 선택 체크박스
			$itemList:null, // 선택 해서 popup에 노출되는 아이템 리스트
			$popModal:null,
			$returnBtn:null,
			$returnItemList:null,
			$popSubmitBtn:null,
			$beforeAddress:null,
			$refundAccountInfo:null, //환불정보 입력 폼
			$newAddress:null,
			isAblePartialVoid:null,
			deliverySearch:null,
			isNewAddress:false,
			isDoubleClickFlag:true,
			isCheckeds:false,
			isRefundAccount:false,
			istotalRefundableAmount:null,

			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);
				Method.$that = $this;
				Method.$popModal = UIkit.modal("#popup-return");
				Method.$returnBtn = $this.find('[data-return-btn]');
				Method.$popCuntBtn = Method.$popModal.find('[data-cunt-submit]');
				Method.$popSubmitBtn = Method.$popModal.find('[data-return-submit]');
				Method.addressArea = $this.find(".shipping_address");
				Method.$popAddressModal = UIkit.modal("#popup-customer-address", {modal: false});
				Method.$beforeAddress = Method.$popModal.dialog.find('[data-before-return-address]');
				Method.$newAddress = Method.$popModal.dialog.find('[data-new-return-address]');
				Method.$refundAccountInfo = $this.find('[data-refund-account-info]');
				Method.$popAddressInputModal = UIkit.modal("#addressSelectPopup",{modal: false, center: true});

				// 반품 사유 변경시
				$this.find('[data-return-reason-type]').on("change", Method.updateStatus);

				// 전체 선택 체크박스 처리
				Method.$allCheck = Method.$popModal.find('input[name="check-all"]');
				Method.$allCheck.on("change", Method.changeAllCheck );

				// 주소 입력 처리
				var $zipCodeInput = $(this).find('[name="addressPostalCode"]');
				var $cityInput = $(this).find('[name="addressCity"]');

				Method.deliverySearch = sandbox.getComponents('component_searchfield', {context:$this, selector:'.search-field.return', resultTemplate:"#address-find-list"}, function(){
					// 검색된 내용 선택시 zipcode 처리
					this.addEvent('resultSelect', function(data){
						var zipcode = $(data).data('zip-code5');
						var city = $(data).data('city');
						var doro = $(data).data('doro');

						var $input = this.getInputComponent().setValue( '(' + zipcode + ')' + city + ' ' + doro );

						$zipCodeInput.val( zipcode );
						$cityInput.val( city.split(' ')[0] );
					});
				});


				// 주문별 전체 반품
				$this.find('[data-return-order-btn]').on('click', function(e){
					e.preventDefault();

					var orderdata = $(this).data();
					var defaultAddress = Method.$popModal.find('.default-address');

					Method.fulfillmentType = orderdata.fulfillmenttype;
					// Method.openReturnOrderPopup( $(this).closest('[data-return-order]').find('[data-return-order-item]') );

					defaultAddress.find('input[name="addressFirstName"]').val(orderdata.addressName);
					defaultAddress.find('input[name="addressPhone"]').val(orderdata.addressPhone);
					defaultAddress.find('input[name="addressLine1"]').val(orderdata.addressLine1);
					defaultAddress.find('input[name="addressLine2"]').val(orderdata.addressLine2);
					defaultAddress.find('input[name="addressPostalCode"]').val(orderdata.addressPostalcode);
					defaultAddress.find('input[name="addressCity"]').val(orderdata.addressCity);

					defaultAddress.find('[data-user-name]').html(orderdata.addressName);
					defaultAddress.find('[data-phone]').html(orderdata.addressPhone);
					defaultAddress.find('[data-postalCode]').html(orderdata.addressPostalcode);
					defaultAddress.find('[data-address1]').html(orderdata.addressLine1);
					defaultAddress.find('[data-address2]').html(orderdata.addressLine2);

					if(Method.fulfillmentType === 'PHYSICAL_SHIP'){
						// 배송지 입력 타입 버튼 선택시
						Method.$popModal.find('[data-return-address-type]').on('show.uk.switcher', function(){
							Method.updateAddressInput();
						});

						// 수거메모 선택시
						$this.find('[data-personal-message-select]').on('change', Method.updatePersonalMessage );




						// $this.find('[data-returnAddressSelectPopup-btn]').on('click', function(e){
						// 	e.preventDefault();
						// 	Method.$popAddressInputModal.show();
						// 	var $btn = $(this);
						//
						// 	// 주소 입력 처리
						// 	var $zipCodeInput = Method.$newAddress.find('[name="addressPostalCode"]');
						// 	var $cityInput = Method.$newAddress.find('[name="addressCity"]');
						// 	//var $addressLine1 = Method.$newAddress.find('[name="addressLine1"]');
						//
						// 	Method.deliverySearch = sandbox.getComponents('component_searchfield', {context:$this, selector:'.search-field.return', resultTemplate:"#address-find-list"}, function(e){
						// 		// 검색된 내용 선택시 zipcode 처리
						// 		this.addEvent('resultSelect', function(data){
						// 			var zipcode = $(data).data('zip-code5');
						// 			var city = $(data).data('city');
						// 			var doro = $(data).data('doro');
						//
						// 			var $input = this.getInputComponent().setValue( '(' + zipcode + ')' + city + doro );
						// 			var $value ='(' + zipcode + ')' + city + doro;
						//
						// 			$zipCodeInput.val( zipcode );
						// 			$cityInput.val( city.split(' ')[0]);
						// 			$addressLine1.val($value);
						//
						// 			$btn.siblings('.input-textfield').find('input#addressLine1').val($value).siblings('label').text('');
						//
						// 			Method.$popAddressInputModal.hide();
						// 			sandbox.validation.validate(Method.$popModal.dialog.find('form'));
						//
						// 		});
						// 	});
						// });

						// 배송지 선택 버튼
						Method.$popModal.find('[data-customer-address-btn]').on('click', function(e){
							e.preventDefault();
							Method.$popAddressModal.show();
						});

						// 배송지 선택 모듈 select 이벤트 호출( 배송지 선택했을때 호출됨 )
						Core.getComponents('component_customer_address', {context:$this}, function(){
							this.addEvent('select', function(data){
								Method.updateCustomerAddress( data );
								if( Method.$popAddressModal.isActive()){
									Method.$popAddressModal.hide();
								}
							})
						});
						var addressList = Method.$popAddressModal.find('[data-customer-address]');
						// 등록되어있는 배송지가 없다면
						//TODO customer_address compnent에 size 추가 하자
						if( addressList.length == 0 ){
							$this.find('[data-return-address-type] a').removeClass('uk-active').eq(1).addClass('uk-active');

							// $this.find('[data-return-address-type]').hide();
							$this.find('#return-address').find('>div').removeClass('uk-active').eq(1).addClass('uk-active');
						}else{
							// 첫번째 주소 선택
							$this.find('[data-return-address-type]').show();
							//$this.find('#return-address').addClass('uk-margin-top');
							addressList.each(function(){
								var default_address = $(this).find('input[name=default]').val();
								if(default_address == 'true'){
									$(this).find('[data-customer-address-select-btn]').trigger('click');
								}
							})
						}
						Method.updateAddressInput();
					}


					Method.openReturnOrderPopup($(this).data("orderid"));

				});


				Method.$popSubmitBtn.on('click', Method.returnOrderSubmit );

			},

			updatePersonalMessage:function(e){
				e.preventDefault();
				var $msgContainer = Method.$popModal.dialog.find('[data-personal-message]');
				var $personalMsg = $msgContainer.find('[name="personalMessageText"]');

				var value = $(this).val();
				if(value == ''){
					$personalMsg.val('');
					$msgContainer.addClass('uk-hidden');
				}else if(value == 'dt_1'){
					// 직접입력일 경우
					$personalMsg.val('');
					$msgContainer.removeClass('uk-hidden');
				}else{
					//$personalMsg.val( $(this).find("option:selected").val() + "||" + $(this).find("option:selected").text() );
					$personalMsg.val( $(this).find("option:selected").text());
					$msgContainer.addClass('uk-hidden');
				}
			},

			// 반품 신청 팝업
			openReturnOrderPopup:function( orderId ){

				var $modal = Method.$popModal;

				var $modalForm = $modal.dialog.find('form');
				Method.$itemList = $modal.dialog.find('[data-return-reason-list]');

				var $reasonItem = $modal.dialog.find('[data-return-reason-item]');
				var $returnAddress = $modal.dialog.find('input[name="return-address"]');

				Method.$itemList.empty();

				//sandbox.getModule('module_header').reDirect().setLogin(function(){
					sandbox.utils.promise({
						url:sandbox.utils.contextPath + '/account/orders/returnable/request/' + orderId,
						method:'GET'
					}).then(function(data){
						var defer = $.Deferred();
						$modal.find('[data-return-reason-list]').append(data);

						/*
						isAble 				: 주문 취소, 반품 가능 여부
						isRefundAccount 	: 환불 계좌 필요 여부
						isAblePartial   	: 부분 취소, 반품 가능 여부
						*/

						//모달창에 나오는 상품개수(li)와 각상품의 반품가능 수량이 같지 않으면 부분반품
						var returnableQuantitySum = [];
						var li_partial = $modal.find('[data-return-reason-list]').find('#returnReasonItem').find('.return-reason-item');
						//var li_partial = $modal.find('[data-return-reason-list] > #returnReasonItem .return-reason-item');
						if(li_partial.length > 1 ){
						    Method.isAblePartialVoid = true;
						}else{
						    li_partial.each(function(){
      						var $this_returnableQuantity = $(this).find('input[name="returnableQuantity"]').val();
      						returnableQuantitySum.push(Number($this_returnableQuantity));
      					})
      					var sumTotal = returnableQuantitySum.reduceRight(function(a,b){return a+b;});
      					if(sumTotal == li_partial.length){
      						Method.isAblePartialVoid = false;
      					} else {
      						Method.isAblePartialVoid = true;
      					}
						}

						//주문애드온 유무 판별
						var hasAddonOrder = $modal.find('#returnReasonItem').find('[data-isaddon=true]').length == 1;
						if(hasAddonOrder) {
							Method.isAblePartialVoid = false;
						}

						//적립금 사용 유무 판별
						var isPaymentType = $modal.find('input[name="paymentType"]').val() == 'CUSTOMER_CREDIT';
						if(isPaymentType) {
							Method.isAblePartialVoid = false;
						}

						Method.hasReturnedItem = $modal.find('#hasReturnedItem').val();
						Method.isRefundAccount = $modal.find('#returnReasonItem').data('isrefundaccount');

						if(Method.fulfillmentType === 'PHYSICAL_PICKUP'){
							Method.addressArea.hide();
							$modal.find(".pickup_address").show();
							$modal.find(".exchangeColorNotice").hide();
							//Method.updateAddressPickupInput() //반품매장정보 등록
						}else{
							Method.addressArea.show();
							$modal.find(".pickup_address").hide();
							$modal.find(".exchangeColorNotice").show();
						}

						// 환불 계좌 필요 여부
						if (Method.isRefundAccount) {
							Method.$refundAccountInfo.find('input').prop('disabled', false);
							Method.$refundAccountInfo.find('select').prop('disabled', false);
							Method.$refundAccountInfo.show();
						} else {
							Method.$refundAccountInfo.hide();
							Method.$refundAccountInfo.find('input').prop('disabled', true);
							Method.$refundAccountInfo.find('select').prop('disabled', true);
						}



						var $newItem = $reasonItem.removeClass("uk-hidden");
						var $info = $newItem.find('[return-reason-info]');
						var $thumb = $newItem.find('[return-reason-thumb]');
						var $item = $modal.find('[data-return-reason-list] .order-product-item');

						$item.each(function () {
							// 반품 가능 수량
							var returnableQuantity = $(this).find('input[name="returnableQuantity"]').val();
							// 반품 된 수량
							//var returnedQuantity = $(this).find('input[name="returnedQuantity"]').val();

							// 복사된 정보중 수량은 삭제
							$info.find('.opt.quantity').remove();


							if( Method.isAblePartialVoid ){
								var $quantity = $(this).find('[return-reason-partials-quantity]');
								for( var i=1; i<=returnableQuantity; i++){
									$quantity.find("select").append( '<option value="' + i + '">' + i +'</option>');
								}
							}else{
								if(returnableQuantity > 1){
									var $quantity = $(this).find('[return-reason-partials-quantity]');
									$quantity.find("select").append( '<option value="' + returnableQuantity + '">' + returnableQuantity +'</option>')
									// for( var i=1; i<=returnableQuantity; i++){
									// 	$quantity.find("select").append( '<option value="' + i + '">' + i +'</option>');
									// }
								}
								var $quantity = $(this).find('[return-reason-order-quantity]');
								$quantity.find('input[name="quantity"]').val(returnableQuantity);

								$(this).find('input[name=orderId]').prop('disabled', false);
								$(this).find('input[name=orderItemId]').prop('disabled', false);
								$(this).find('input[name=skuId]').prop('disabled', false);
								$(this).find('select').prop('disabled', false);
								$(this).find('input[name=quantity]').prop('disabled', false);
							}
						});

						// 팝업에서 수량 셀렉트 변경시
						//$item.find('.quantity_select').off('change').on("change", Method.updateStatus );

						Method.updatePaymentInfo( false );
						Method.updateSubmitBtn( false );
						//Method.updateStatus();

						if( Method.isAblePartialVoid ){
							console.log( '부분 반품' );
							$modal.find('[data-return-reason-list] .order-product-item').find('input[type="checkbox"]').on("change", Method.changeItemCheck );
							//$item.find('select').off('change').on("change", Method.updateStatus );

							Method.updateInfoByIsPartial( true );
							Method.updateSubmitBtn( true );

							// 전체 취소로 초기화
							Method.$allCheck.prop('checked', false ).trigger('change');
						}else{
							console.log( '전체 반품' );
							$modal.find('[data-return-reason-list] .order-product-item').find('input[type="checkbox"]').on("change", Method.changeItemCheck );
							Method.updateInfoByIsPartial( false );
							Method.updateSubmitBtn( true );
							//Method.updateStatus();
						}

						$modal.show();

						sandbox.validation.reset( $modal.dialog.find('form'));

						sandbox.getComponents('component_select', {context:$modal.dialog}, function(i){
							this.addEvent('change', function(val, $selected, index){
								//Method.updateStatus()
								if($(this).attr('name') == 'accountCode'){
									$(this).siblings().filter('input[name=accountName]').val($selected.text());
								}
							});
						});

						sandbox.moduleEventInjection(data, defer);

						Method.$itemList = $modal.dialog.find('[data-return-reason-list] #returnReasonItem');

						return defer.promise();
					}).then(function(data){
						// UIkit.modal.alert("취소 되었습니다.").on('hide.uk.modal', function() {
						// 	window.location.reload();
						// });
					}).fail(function(error){
						// if(error){
						// 	UIkit.modal.alert(error).on('hide.uk.modal', function() {
						// 		window.location.reload();
						// 	});
						// }else{
						// 	window.location.reload();
						// }
					});
				//});
			},

			// 아이템 단위로 수량 선택할 수 있는 select 노출 처리
			showHideAvailabeQuantity:function( $checkbox ){
				var $cancelQuantity = $checkbox.parents('[data-return-reason-item]').find('[return-reason-partials-quantity]');
				if( $checkbox.prop('checked') && $checkbox.parents('[data-return-reason-item]').attr('data-isProductAddon') == 'false'){
					$cancelQuantity.show();
				}else{
					$cancelQuantity.hide();
				}
			},

			// 부분 반품 가능 여부에 따른 정보 노출 처리
			updateInfoByIsPartial:function( $bool ){
				var $checkAllContainer = Method.$popModal.dialog.find('.container.check-all');
				var $checkboxs = Method.$itemList.find('.checkbox');
				var $info = Method.$popModal.dialog.find('[data-info-text]');

				if( $bool ){
					$checkAllContainer.show();
					$checkboxs.show();
					$info.text('반품 수량을 확인하여 주시기 바랍니다.');
					$info.show();
					//Method.$popSubmitBtn.text('선택상품 주문 반품');
				}else{
					var isPaymentType = Method.$popModal.dialog.find('input[name="paymentType"]').val() == 'CUSTOMER_CREDIT';
					if(isPaymentType) {
						$info.text('마일리지를 사용한 주문으로 전체반품만 가능합니다.');
						$info.css('border-bottom','0px').show();
					}
					$checkAllContainer.hide();
					$checkboxs.hide();
					$info.hide();
					//Method.$popSubmitBtn.text('주문 반품');
				}
			},

			// 체크 여부에 따른 리턴 버튼 활성화 처리
			updateRetunBtnStatus:function(){
				var isChecked =  Method.$that.find('[data-return-order]').find('[data-return-order-list]').find('input[type="checkbox"]').is(':checked');
				if( isChecked ){
					Method.$returnBtn.removeAttr('disabled').removeClass('disabled');
					Method.$returnBtn.text('부분 반품하기');
				}else{
					Method.$returnBtn.attr('disabled','true').addClass('disabled');
					Method.$returnBtn.text('부분 반품할 상품을 선택해주세요');
				}
			},

			// modal에서 전체 선텍
			changeAllCheck:function(e){
				var isCheck = $(this).prop('checked');
				Method.$itemList.find('.order-product-item.product-mini').each( function(){
					$(this).find('input[type="checkbox"]').prop( 'checked', isCheck );

					if( isCheck ){
						//전체 수량을 선택 시켜 노출
						//$(this).find('select[name="quantity"]').val( $(this).find('[data-quantity]').text()).trigger('update');

						//체크시 사은품이 있는지 확인 후 있으면 같이 체크
						var orderItemId = $(this).find('input[name=orderItemId]').val();

						$(this).find('input[name=orderId]').prop('disabled', !isCheck);
						$(this).find('input[name=orderItemId]').prop('disabled', !isCheck);
						$(this).find('input[name=skuId]').prop('disabled', !isCheck);
						$(this).find('select').prop('disabled', !isCheck);
						$(this).find('input[name=quantity]').prop('disabled', !isCheck);

						Method.addOnCancel($(this).find('input[type="checkbox"]'), isCheck, orderItemId);

					}
					Method.showHideAvailabeQuantity( $(this).find('input[type="checkbox"]') );
				});
				Method.updateStatusChecked();

				if (Method.isCheckeds) {
					Method.updatePaymentInfo( false );
					Method.isCheckeds = false;
				}
			},

			// modal에서 체크박스 선택시
			changeItemCheck:function(e){
			  var isCheck = $(this).prop('checked');
				Method.showHideAvailabeQuantity( $(this ));

				//$(this).closest("li").find('select[name="quantity"]').val( $(this).closest("li").find('[data-quantity]').text() ).trigger('update');

				var $thisItem = $(this).parents(".order-product-item");

				//수량 select시 사은품이 있는지 확인 후 있으면 같이 체크
				var orderItemId = $thisItem.find('input[name=orderItemId]').val();

				//수량 select 수정 시 금액 업데이트
				$thisItem.find('select').off('change').on("change", function(e){
					var $modalForm = Method.$popModal.dialog.find('form');
					sandbox.validation.validate($modalForm);
					if( sandbox.validation.isValid($modalForm)){
						Method.updatePaymentInfo(true);
						Method.updateStatus(e,this);
					}
				});

				var ordertotalQuantity = $thisItem.find('input[name=returnableQuantity]').val();
				var selectQuantity = $thisItem.find('.currentOpt').text();

        if(Method.isAblePartialVoid){
					$thisItem.find('input[name=orderId]').prop('disabled', !isCheck);
					$thisItem.find('input[name=orderItemId]').prop('disabled', !isCheck);
					$thisItem.find('input[name=skuId]').prop('disabled', !isCheck);
					$thisItem.find('select').prop('disabled', !isCheck);
					$thisItem.find('input[name=quantity]').prop('disabled', !isCheck);
        }

        Method.addOnCancel($(this), isCheck, orderItemId);

				Method.updateStatusChecked();
				Method.updateCheckAll(isCheck);

				if (Method.isCheckeds) {
					Method.updatePaymentInfo( false );
					Method.isCheckeds = false;
				}
			},

			// 아이템 체크박스 변경시 전체 선택 체크박스 상태처리
			updateCheckAll:function(isCheck){
		    if(isCheck){
	        if( Method.$itemList.find('.order-product-item').find('input[type="checkbox"]').length == Method.$itemList.find('.order-product-item').find('input[type="checkbox"]:checked').length ){
				    Method.$allCheck.prop( 'checked', true );
					}else{
						Method.$allCheck.prop( 'checked', false );
					}
		    }else{
		        Method.$allCheck.prop( 'checked', false );
		    }
			},

			// 리턴 상황에 따른 가격정보와
			updatePaymentInfo:function( $bool ){
				var $paymentContainer = Method.$popModal.find('[data-payment-conatiner]');
				$paymentContainer.hide();

				if( $bool ){
					$paymentContainer.show();
					Method.$popCuntBtn.parent('.entry-field-action').hide();
				}else{
					$paymentContainer.hide();
					Method.$popCuntBtn.parent('.entry-field-action').show();
				}
			},
			addOnCancel:function(_this, isCheck, itemId){

				var $this = _this;
				var parentorderitemid;
				var orderItemId = itemId;
				var ordertotalQuantity = $this.parents('[data-return-reason-item]').find('input[name=returnableQuantity]').val();

				//부분반품에 따라 비교하는 quantity 설정
				if(ordertotalQuantity > 1){
					var selectQuantity = $this.parents('[data-return-reason-item]').find('.quantity_select').val();
				}else{
					var selectQuantity = $this.parents('[data-return-reason-item]').find('input[name=quantity]').val();
				}

				if(isCheck){
					var isValid = ordertotalQuantity == selectQuantity;
				}else{
					var isValid = false;
					if(!Method.isAblePartialVoid){
					    var isValid = true;
					}
				}
				//if(ordertotalQuantity == selectQuantity){
					Method.$itemList.find('[data-return-reason-item]').each(function(){
						parentorderitemid = $(this).attr('data-parentorderitemid');
						if(parentorderitemid == orderItemId){
							$(this).find('input[name=orderId]').prop('disabled', !isValid);
							$(this).find('input[name=orderItemId]').prop('disabled', !isValid);
							$(this).find('input[name=skuId]').prop('disabled', !isValid);
							$(this).find('input[name=quantity]').prop('disabled', !isValid);
						}
					});
				//}
			},
			updateStatusChecked:function(){
				var $modal = Method.$popModal;
				// 부분반품이 가능한 경우
				if( Method.isAblePartialVoid ){
					var $items = Method.$itemList.find('.order-product-item.productItem').find('input[type="checkbox"]:checked').parents('.order-product-item');
				}else{
					var $items = Method.$itemList.find('.order-product-item.productItem');
				}


				if( $items.length > 0 ){
					if (Method.isDoubleClickFlag) {
						Method.updateSubmitBtn( true ); // 체크박스 선택 가능
						Method.isDoubleClickFlag = false;
					}
				} else {
					// 아이템 없을때
					// 부분 취소, 반품 가능 여부
					var isablepartial = true;

					if (!isablepartial) {
						Method.updateSubmitBtn( true );
					} else {
						if (!Method.isDoubleClickFlag) {
							Method.updateSubmitBtn( false ); // 체크박스 선택 불가능
							Method.isDoubleClickFlag = true;
						}
					}
				}
			},

			// 버튼 활성화/비활성화 처리
			updateSubmitBtn:function( $bool ){
				var $paymentContainer = Method.$popModal.find('[data-payment-conatiner]');

				// var _disabledCheck;
				// Method.$popModal.find('[data-return-reason-list]>ul>li').each( function(){
				// 	var _disabled = $(this).find('input[type="checkbox"]').attr('disabled');
				// 	var _bool = _disabled == 'disabled';
				// 	_disabledCheck = _.some([_bool], Boolean); // true
				// });
				// if (_disabledCheck) {
				// 	Method.$allCheck.attr('disabled', true).closest('.input-checkbox').addClass('disabled');
				// } else {
				// 	Method.$allCheck.attr('disabled', false).closest('.input-checkbox').removeClass('disabled');
				// }

				if ($bool) {
					$paymentContainer.hide();
					Method.$popCuntBtn.show();

					// 총 결제금액 버튼
					Method.$popCuntBtn.on('click', function (e) {
						e.preventDefault();

						if( Method.isAblePartialVoid ){
							//아이템 미선택 시 선택요구
							if(Method.$itemList.find('.order-product-item').find('input[type="checkbox"]:checked').length == 0){
								alert('상품을 선택해주세요');
								return false;
							}
						}

						var $modalForm = Method.$popModal.dialog.find('form');
						sandbox.validation.validate($modalForm);
						if( sandbox.validation.isValid($modalForm)){
							Method.updatePaymentInfo(true);
							Method.updateStatus();
						}
					});

					Method.$popSubmitBtn.removeAttr('disabled').removeClass('disabled');
					Method.$popCuntBtn.removeAttr('disabled').removeClass('disabled');
				} else {
					Method.$popSubmitBtn.attr('disabled','true').addClass('disabled');
					Method.$popCuntBtn.attr('disabled', 'true').addClass('disabled');
					Method.$popCuntBtn.off();
				}
			},

			// 취소 가격 및 추가 정보 입력 여부 처리
			updateStatus:function(e, t){
				var $modal = Method.$popModal,
					_this = t;
				if (!_this) {
					_this = this;
				}

				if($(_this).hasClass('quantity_select')){
					var isCheck = $(_this).parents('[data-return-reason-item]').find('input[type="checkbox"]').prop('checked');
					var orderItemId = $(_this).parents('[data-return-reason-item]').find('input[name=orderItemId]').val();
					Method.addOnCancel($(_this).parents('[data-return-reason-item]').find('input[type="checkbox"]'), isCheck, orderItemId);
				}

				// if(Method.isPartialVoid){
				// 	if(Method.$itemList.find('li').find('input[type="checkbox"]:checked').length == 0){
				// 		alert('상품을 선택해주세요');
				// 		return false;
				// 	}else{
				// 		var $items = Method.$itemList.find('li');
				// 	}
				// }else{
				//
				// }
				var $items = Method.$itemList.find('[data-return-reason-item]');

				var $form = $modal.dialog.find('form');
				var action = $form.attr('action') + '/calculator';
				var $itemForm = Method.getFormByPartialItem( $items );
				var param = $itemForm.serialize() + '&' + $form.serialize();

				if (!$itemForm.serialize().length) {
					return false;
				}

				if( Method.isAblePartialVoid ){
					if( !Method.getIsAvailablePartialReturn()){
						param += '&entireReturn=true';
					}
				}else{
					param += '&entireReturn=true';
				}

				Core.Utils.ajax( action, 'POST', param, function(data){

					var data = sandbox.rtnJson(data.responseText, true);
					var $paymentList = $modal.find('[data-payment-list]');
					var $paymentItem = $modal.find('.uk-hidden[data-payment-item]');
					$paymentList.empty();

					if( !data ){
						var $newItem = Method.getReplacePaymentItem( $paymentItem, '서버 통신 오류' );
						$newItem.appendTo( $paymentList );
					}

					var result = data.result;

					if( result == true ){
						// 반품 배송비
						var returnFgChargeFeeTotal = data.ro.returnFulfillmentFee;

						// 추가 배송비
						var parentFgChargeFeeTotal = data.ro.originFulfillmentChargeFee;

						// 총 환불 예정 금액
						var refundAmountTotal = data.ro.totalRefundableAmount;
						Method.istotalRefundableAmount = data.ro.totalRefundableAmount;

						// 결제 정보
						if( returnFgChargeFeeTotal != null ){
							// 반품 배송비
							if( returnFgChargeFeeTotal != null && returnFgChargeFeeTotal.amount > 0 ){
								var $newItem = Method.getReplacePaymentItem( $paymentItem, "반품 배송비 : ", returnFgChargeFeeTotal.amount );
								$newItem.appendTo( $paymentList );
							}

							// 추가 배송비
							if( parentFgChargeFeeTotal != null && parentFgChargeFeeTotal.amount > 0 ){
								var $newItem = Method.getReplacePaymentItem( $paymentItem, "추가 배송비 : ", parentFgChargeFeeTotal.amount );
								$newItem.appendTo( $paymentList );
							}

							// 총 환불 예정 금액
							if( refundAmountTotal != null ){
								var $newItem = Method.getReplacePaymentItem( $paymentItem, "총 환불 예정 금액 : ", refundAmountTotal.amount );
								$newItem.appendTo( $paymentList );
							}

						} else {
							var $newItem = Method.getReplacePaymentItem( $paymentItem, 'PAYMENTS 정보 오류' );
							$newItem.appendTo( $paymentList );
						}

						Method.isCheckeds = true;
					}else{
						// var $newItem = Method.getReplacePaymentItem( $paymentItem, data.errorMsg );
						// $newItem.appendTo( $paymentList );
						Method.updatePaymentInfo( false );
						Method.isCheckeds = false;
						UIkit.modal.alert(data.errorMsg);
					}
				}, true);
			},

			// 계산 결과 dom 생성
			getReplacePaymentItem:function( $base, type, amount ){
				var $newItem = $base.clone().removeClass("uk-hidden");
				$newItem.find('[data-type]').text( type );
				if( amount ){
					$newItem.find('[data-amount]').text( sandbox.utils.price(amount) );
				}else{
					$newItem.find('[data-amount]').text( sandbox.utils.price(0) );
				}
				return $newItem;
			},

			// 선택된 아이템의 order dom
			getOrderElementByChecked:function($checkbox){
				var $order = $checkbox.closest('[data-return-order]');
				return {
					order : $order,
					allCheckbox : $order.find('input[name="check-all"]'),
					itemList : $order.find('[data-return-order-list]')
				}
			},

			// 배송지 선택으로 주소 입력시
			updateCustomerAddress:function( data ){
				var $target = Method.$popModal.dialog.find('[data-before-return-address]');
				if( $target.find('[data-user-name]').length > 0 ){
					$target.find('[data-user-name]').html($.trim(data.fullName));
				}

				if( $target.find('[data-phone]').length > 0 ){
					$target.find('[data-phone]').html($.trim(data.phoneNumber));
				}

				if( $target.find('[data-postalCode]').length > 0 ){
					$target.find('[data-postalCode]').html($.trim(data.postalCode));
				}

				if( $target.find('[data-address1]').length > 0 ){
					$target.find('[data-address1]').html($.trim(data.addressLine1));
				}

				if( $target.find('[data-address2]').length > 0 ){
					$target.find('[data-address2]').html($.trim(data.addressLine2));
				}

				// 변경된 값 input 에 적용
				$target.find('input[name="addressFirstName"]').val($.trim(data.fullName));
				$target.find('input[name="addressPhone"]').val($.trim(data.phoneNumber));
				$target.find('input[name="addressLine1"]').val($.trim(data.addressLine1));
				$target.find('input[name="addressLine2"]').val($.trim(data.addressLine2));
				$target.find('input[name="addressPostalCode"]').val($.trim(data.postalCode));
				$target.find('input[name="addressCity"]').val($.trim(data.city));
			},

			// 실제 전송될 주소 정보를 설정하기 위해 불필요 정보 disabled
			updateAddressInput:function(){
				if( Method.$beforeAddress.hasClass('uk-active')){
					Method.isNewAddress = false;
					Method.$beforeAddress.find('input').attr('disabled', false );
					Method.$newAddress.find('input').attr('disabled', true );
				}else{
					Method.isNewAddress = true;
					Method.$beforeAddress.find('input').attr('disabled', true );
					Method.$newAddress.find('input').attr('disabled', false );

				}
				// 수거지 정보
				Method.isNewAddress = false;
			},

			// updateAddressPickupInput:function(){
			//
			// 	//Method.$beforeAddress.find('input').attr('disabled', false );
			// 	Method.$newAddress.find('input').attr('disabled', true );
			//
			// 	var $target = Method.$popModal.dialog.find('[data-before-return-address]');
			//
			// 	var pickup_fn = Method.$popModal.find('input[name="pickup_addressFirstName"]').val();
			// 	var pickup_ap = Method.$popModal.find('input[name="pickup_addressPhone"]').val();
			// 	var pickup_al1 = Method.$popModal.find('input[name="pickup_addressLine1"]').val();
			// 	var pickup_al2 = Method.$popModal.find('input[name="pickup_addressLine2"]').val();
			// 	var pickup_apc = Method.$popModal.find('input[name="pickup_addressPostalCode"]').val();
			// 	var pickup_ac = Method.$popModal.find('input[name="pickup_addressCity"]').val();
			//
			// 	$target.find('input[name="addressFirstName"]').val($.trim(pickup_fn));
			// 	$target.find('input[name="addressPhone"]').val($.trim(pickup_ap));
			// 	$target.find('input[name="addressLine1"]').val($.trim(pickup_al1));
			// 	$target.find('input[name="addressLine2"]').val($.trim(pickup_al2));
			// 	$target.find('input[name="addressPostalCode"]').val($.trim(pickup_apc));
			// 	$target.find('input[name="addressCity"]').val($.trim(pickup_ac));
			// },

			// 선택된 아이템을 하나의 form으로 만들어 리턴
			getFormByPartialItem:function( $items ){
				var $itemForm = $('<form></form>');

				//체크되어있는 아이템 가져와 form에 append
				$items.each( function(){
					var quantity = $(this).find('[name="quantity"]:enabled').val();
					var $newItem = $(this).clone();

					$newItem.find('[name="quantity"]').val(quantity);
					$newItem.appendTo( $itemForm );
				});
				return $itemForm;
			},

			returnOrderSubmit:function(e){
				e.preventDefault();

				if( Method.isAblePartialVoid ){
					//아이템 미선택 시 선택요구
					if(Method.$itemList.find('[data-return-reason-item]').find('input[type="checkbox"]:checked').length == 0){
						alert('상품을 선택해주세요');
						return false;
					}
				}

				var $modalForm = Method.$popModal.dialog.find('form');
				sandbox.validation.validate( $modalForm );

				if( sandbox.validation.isValid( $modalForm )){
					
					if( Method.isNewAddress ){
						if( !Method.deliverySearch.getValidateChk() ){
							UIkit.modal.alert("검색을 통하여 배송지를 입력해주세요.");
							return false;
						}
					}

					UIkit.modal.confirm('반품 하시겠습니까?', function(){
						// 주소에 노출된 우편번호 제거
						if( Method.isNewAddress ){
							var $addressLine1 = Method.$newAddress.find('[name="addressLine1"]');
							if( $addressLine1 ){
								var address1 = $addressLine1.val().split(')');
								if( address1.length > 1 ){
									$addressLine1.val( $.trim( address1[1]) );
								}
							}
						}

						var isPartial = false;
						var param = '';

						if( Method.isAblePartialVoid ){
					    	if(Method.hasReturnedItem == "true") {
        				    isPartial = true;
        				} else {
        				    if(Method.getIsAvailablePartialReturn()){
    						    isPartial = true;
        					} else {
        					    isPartial = false;
        					}
        				}
						}

						// 부분 취소일때는 상품별
						if( isPartial ){
							var $itemForm = Method.getFormByPartialItem( Method.$itemList.find('[data-return-reason-item]'));
							param = $itemForm.serialize() +'&'+ $modalForm.serialize();
						}else{
							var $itemForm = Method.getFormByPartialItem( Method.$itemList.find('[data-return-reason-item]'));
							param = $itemForm.serialize() +'&'+ $modalForm.serialize();
							param += '&entireReturn=true';
						}

						console.log(param);

						var paramChk = sandbox.utils.getQueryParams(param);
						if(paramChk.addressLine1 == "" || paramChk.addressLine1 == undefined || paramChk.addressLine1 == null ){
						    alert('수거지 정보가 없습니다. 수거지 정보를 입력해 주세요.');
						    return false;
						}

						// Method.updateSubmitBtn( false );

						Core.Utils.ajax( sandbox.utils.contextPath + $modalForm.attr('action'), 'POST', param, function(data){
							var data = sandbox.rtnJson(data.responseText, true);
							var result = data['result'];
							if( result == true ){
								if( marketingData.useGa == true ){
									var paramChk = sandbox.utils.getQueryParams(param);
									var itemList = [];
									var isArrayChk = Array.isArray(paramChk.orderItemId);

									$.each( Method.$itemList.find('[data-return-reason-item]'), function( index, data ){
										var $order = $(data);
										if(isArrayChk){
											if($(this).find("input[name=orderItemId]").val() == paramChk.orderItemId[index]){
												itemList.push({
													model : $(this).find("[data-model]").data("model"),
													name : $(this).find("[data-name]").data("name"),
													quantity : paramChk.quantity[index],
													price : $(this).find("[data-price]").data("price")
												});
											}
										}else{
											if($(this).find("input[name=orderItemId]").val() == paramChk.orderItemId){
												itemList.push({
													model : $(this).find("[data-model]").data("model"),
													name : $(this).find("[data-name]").data("name"),
													quantity : paramChk.quantity,
													price : $(this).find("[data-price]").data("price")
												});
											}
										}
									});

									var orderIdChk = (Array.isArray(paramChk.orderId) ? paramChk.orderId[0] : paramChk.orderId);
									gtag('event', 'refund', {
										"transaction_id": orderIdChk,
										"value": Method.istotalRefundableAmount.amount,
										"items": itemList
									});
								}

								UIkit.modal.alert("반품 신청이 완료 되었습니다.").on('hide.uk.modal', function() {
									window.location.href = sandbox.utils.contextPath + "/account/orders/returned";
								});
							}else{
								UIkit.modal.alert(data['errorMsg']).on('hide.uk.modal', function() {
									window.location.reload();
								});
							}
							//$('.customer-contents').replaceWith($(data.responseText).find('.customer-contents'));

						},true)

					}, function(){},
					{
						labels: {'Ok': '확인', 'Cancel': '취소'}
					});
				}

			},

			// 부분반품 가능 여부 판단
			getIsAvailablePartialReturn:function(){
        var isAvailable = false;
				var $checkedList = Method.$itemList.find('[data-return-reason-item]').find('input[type="checkbox"]:checked').closest('[data-return-reason-item]');

				$checkedList.each( function(){
					//var orderItemSize = $(this).find('input[name="orderItemSize"]').val();
					//var ableEntireReturn = $(this).find('input[name="ableEntireReturn"]').val();
					//var returnedQuantity = $(this).find('input[name="returnedQuantity"]').val();
					//var orderId = $(this).find('input[name="orderId"]').val();

					var returnableQuantity = $(this).find('input[name="returnableQuantity"]').val();
					var quantity = $(this).find('[name="quantity"]:not(:disabled)').val();


					if(Number(quantity) <= Number(returnableQuantity)) {
					    isAvailable = true;
					}


					//if( itemList[orderId] == undefined ){
					//	itemList[orderId] = {};
					//	itemList[orderId].ableEntireReturn = ableEntireReturn;
					//	itemList[orderId].orderItemSize = orderItemSize;
					//	itemList[orderId].items = [];
					//}

					//var itemObj = {
					//	returnedQuantity : Number(returnedQuantity),
					//	returnableQuantity : Number(returnableQuantity),
					//	quantity : Number(quantity)
					//}

					//itemList[orderId].items.push( itemObj );
				})

				return isAvailable;

				//var isAvailable = false;
				//$.each( itemList, function(){
					// 전체 반품이 불가능하거나 현재 주문의 전체 아이템 사이즈와 선택된 아이템 사이즈가 같지 않다면
					// console.log( this.orderItemSize + ' : ' + this.items.length );
					//if( this.ableEntireReturn == "false" || this.orderItemSize != this.items.length ){
						//console.log( '전체 반품이 불가능하거나 현재 주문의 전체 아이템 사이즈와 선택된 아이템 사이즈가 같지 않다면')
					//	isAvailable = true;
					//}else{
					//	$.each( this.items, function(){
							//console.log( this.returnableQuantity + ' : ' + this.quantity);
					//		if( this.returnedQuantity != 0 || this.returnableQuantity != this.quantity ){
								//console.log('반품된 수량이 있거나 전체 수량이 아닌것 있음');
					//			isAvailable = true;
					//			return;
					//		}
					//	})
					//}

					//if( isAvailable == false ){
						//console.log('부분반품 불가능한 order가 있음');
					//	return false;
					//}
				//})
				//return isAvailable;
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-returnorder]',
					attrName:'data-module-returnorder',
					moduleName:'module_returnorder',
					handler:{
						context:this,
						method:Method.moduleInit
					}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_sc_slider', function(sandbox){
		var $this, args, endPoint;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];
				endPoint = Core.getComponents('component_endpoint');

        var $slider = $this.find('.slick-slider');

        var defaultOption = {
          dots: false,
          infinite: false,
          speed: 300,
          arrows: false,
          slidesToShow: 8,
          swipeToSlide:true,
          responsive: [
            {
              breakpoint: 1024,
              settings: {
                slidesToShow: 6,
              }
            },
            {
              breakpoint: 768,
              settings: {
                slidesToShow: 4,
              }
            },
            {
              breakpoint: 480,
              settings: {
                slidesToShow: 2,
                variableWidth: true
              }
            }
          ]
				}

        $slider.slick(defaultOption);

			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-sc-slider]',
					attrName:'data-module-sc-slider',
					moduleName:'module_sc_slider',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_returnorder_history', function(sandbox){
		var Method = {
			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);

				$this.find('button.return-cancel-item').on("click", Method.returnOrderCancelItem );
			},

			// 반품 취소 요청
			returnOrderCancelItem:function(e){
				e.preventDefault();
				var _$this = $(this);
				var $form = _$this.closest("form");

				UIkit.modal.confirm('반품 신청을 취소 하시겠습니까?', function(){
					Core.Utils.ajax($form.attr("action"), "POST", $form.serialize(), function(data){
						var data = sandbox.rtnJson(data.responseText, true);
						if( data['result'] == true){
							if( marketingData.useGa == true ){
								var parentOrderNumber = _$this.attr('data-parentorder-id'); //원 주문번호
								var orderSubTotal = _$this.attr('data-ordersubtotal'); //반품신청한 금액
								var _numberCut = parentOrderNumber.substr(parentOrderNumber.length -6,6); //orderId
								var itemList = [];
								var cancelItem = $form.find('[data-return-order-item]');
								$.each( cancelItem, function( index, data ){
									itemList.push({
										id : $(this).find("[data-model]").data("model"),
										name : $(this).find("[data-name]").data("name"),
										price : $(this).find("[data-price]").data("price") * -1,
										quantity : $(this).find("[data-quantity]").data("quantity") * -1
									});
								});

								gtag('event', 'refund', {
									"transaction_id": _numberCut,
									"value": orderSubTotal * -1,
									"items": itemList
								});
							}
						}

						//errorMsg에서 성공 및 실패 문구 노출
						UIkit.modal.alert(data['errorMsg']).on('hide.uk.modal', function() {
							window.location.reload();
						});

					},true)
				}, function(){},
				{
					labels: {'Ok': '확인', 'Cancel': '취소'}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-returnorder-history]',
					attrName:'data-module-returnorder-history',
					moduleName:'module_returnorder_history',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_order_customer', function(sandbox){
		var args = {};
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				args = arguments[0];
				sandbox.validation.init( $this.find('#order_info') );

				if( $this.find('input[name="isAlreadyRegistered"]').length > 0){
					UIkit.modal.confirm('이미 회원 가입된 아이디 입니다. 로그인 하시겠습니까?', function(){
						window.location.replace(sandbox.utils.contextPath + '/login?successUrl=/checkout');
					}, function(){},
					{
						labels: {'Ok': '로그인', 'Cancel': '비회원 주문'}
					});

				}
			}
		}


		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-order-customer]',
					attrName:'data-module-order-customer',
					moduleName:'module_order_customer',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			getOrderCustomerInfo:function(){
				return {
					name:args.name,
					phoneNum:args.phoneNum,
					emailAddress:args.emailAddress
				}
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_review', function(sandbox){
		var $deferred, $this, modal, args, arrQueryString = [], currentProductId, isSignIn;
		var Method = {

			moduleInit:function(){
				args = arguments[0];
				$this = $(this);
				Method.$reviewListModal = UIkit.modal("#modal-reviews-display", {modal: false});
				Method.$triggerClass = '.review-teaser-card-link';
				Method.$modalScroll = Method.$reviewListModal.find('.reviews-summary-scrollable');
				isSignIn = (args.isSignIn === 'true') ? true : false;

				//필터조건 초기화 ( 최신순, 도움순 )
				arrQueryString[2] = sandbox.utils.getQueryParams($('.reviews-summary-options').find('.review-filter').filter('.active').attr('href'), 'array').join('&');

				//modal init
				modal = UIkit.modal('#common-modal', {center:true});
				modal.off('.uk.modal.review').on({
					'hide.uk.modal.review':function(){
						console.log('review modal hide');
						$this.find('.contents').empty();
						if(isSignIn != sandbox.getModule('module_header').getIsSignIn()){
							if(currentProductId) Method.reviewProcessorController(currentProductId);
						}
					}
				});


				$this.find(Method.$triggerClass).click(function(){
					Method.$reviewListModal.show();
					var reviewid = $(this).data('reviewid');
					if (reviewid) {
						reviewid = Method.$reviewListModal.find('[data-reviewid="' + reviewid + '"]');
						setTimeout(function(){
							var scrollable = 'm' == Core.getModule('module_gnb').deviceMedia() ? Method.$modalScroll : Method.$reviewListModal.element,
								scrollTop = reviewid.position().top;
							scrollable.scrollTop(scrollTop);

							reviewid.addClass('set-highlighted');
							setTimeout(function(){
								reviewid.removeClass('set-highlighted');
							}, 639);
						},426);
					}

				});

				// product detail 상품 리뷰 쓰기
				$('.review-write-btn').off('click').on('click',function(e){
					e.preventDefault();

					var target = $(this).attr('href');
					var productId = $(this).attr('data-productid');

					if(!productId){
						UIkit.notify('productID 가 없습니다.', {timeout:3000,pos:'top-center',status:'warning'});
						return;
					}

					Method.reviewTask(target, productId);
				});


				//review feedback
				var feedBack = sandbox.getComponents('component_like', {context:$this}, function(){
					this.addEvent('likeFeedBack', function(data){
						if(data.hasOwnProperty('HELPFUL')){
							$(this).parent().siblings().find('.like-num').text(data.HELPFUL);
						}else if(data.hasOwnProperty('NOTHELPFUL')){
							console.log(data.NOTHELPFUL);
						}
					});
				});


				// 상품 리뷰 수정
				$('.review-modify').off('click').on('click',function(e){
					e.preventDefault();

					var target = $(this).attr('href');
					var url = $(this).attr('data-link');
					var productId = $(this).attr('data-productid');
					var defer = $.Deferred();
					var successMsg = $(this).attr('data-successmsg');

					//review 모달 css 추가
					$(target).addClass('window-modal modal-reviews-submit');

					sandbox.utils.promise({
						url:url,
						type:'GET',
						data:{'redirectUrl':location.pathname}
					}).then(function(data){
						$(target).find('.contents').empty().append(data).css('height','100%');
						sandbox.moduleEventInjection(data, defer);
						return defer.promise();
					}).then(function(data){
						//arrQueryString = [];
						UIkit.notify(successMsg, {timeout:3000,pos:'top-center',status:'success'});
						Method.reviewProcessorController(productId);
						modal.hide();
						location.reload();
					}).fail(function(msg){
						defer = null;
						UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
						if(modal.isActive()) modal.hide();
					});
				});



				// 상품 리뷰 삭제
				$('.review-remove').off('click').on('click',function(e){
					e.preventDefault();
					var _self = this;
					var url = $(this).attr('href');
					var productId = $(this).attr('data-productid');
					var reviewId = $(this).attr('data-reviewId');
					var successMsg = $(this).attr('data-successmsg');

					UIkit.modal.confirm("삭제 할까요?", function(){
						sandbox.utils.ajax(url, 'GET', {}, function(data){
							var data = sandbox.rtnJson(data.responseText);
							if(data.result){
								UIkit.notify(successMsg, {timeout:3000,pos:'top-center',status:'success'});
								Method.reviewProcessorController(productId);
                				location.reload();
							}else{
								UIkit.notify(data.errorMessage, {timeout:3000,pos:'top-center',status:'danger'});
							}
						});
					});
				});


				//review filter
				$('.review-filter').off('click').on('click',function(e){
					e.preventDefault();
					var _this = $(this);
					var query = sandbox.utils.getQueryParams($(this).attr('href'), 'array').join('&');
					var productId = $(this).attr('data-productid');

					sandbox.utils.ajax(args.api, 'GET', 'productId='+ productId + '&' + query + '&mode=template&resultVar=reviewSummaryDto', function(data){
						var domObject = $(data.responseText).find('.reviews-summary-list');
						_this.addClass('active').siblings().removeClass('active');
						$(data.responseText).find('.reviews-summary-list');
						Method.$reviewListModal.find('.reviews-summary-list').empty().append(domObject[0].outerHTML);
						sandbox.moduleEventInjection(domObject[0].outerHTML);
					})
				});

				$('.review-filter-delete').off('click').on('click',function(e){
					e.preventDefault();

					var query = sandbox.utils.getQueryParams($(this).attr('href'), 'array').join('&');
					var productId = $(this).attr('data-productid');

					arrQueryString = [];
					arrQueryString[2] = query;
					Method.reviewProcessorController(productId);
				});



				/* browse history back */
				if(Core.Utils.mobileChk) {
					$(window).on('popstate', function(e) {
						var data = e.originalEvent.state;
						if(modal && modal.active){
							modal.hide();
						}
					});
				}
			},
			reviewTask:function(target, productId){
				var defer = $.Deferred();
				currentProductId = productId;

				sandbox.getModule('module_header').setLogin(function(data){
					//console.log('review : ', data);
					var isSignIn = data.isSignIn;
					sandbox.utils.promise({
						url:sandbox.utils.contextPath + '/review/reviewWriteCheck',
						type:'GET',
						data:{'productId':productId}
					}).then(function(data){
						//data.expect 기대평
						//data.review 구매평
						if(data.expect || data.review){
							/* review history */
							if(Core.Utils.mobileChk) history.pushState({page:'review'}, "review", location.href);

							isSignIn = isSignIn;
							modal.show();
							return sandbox.utils.promise({
								url:sandbox.utils.contextPath + '/review/write',
								type:'GET',
								data:{'productId':productId, 'redirectUrl':location.pathname, 'isPurchased':data.review}
							})
						}else{
							defer.reject('리뷰를 작성할 수 없습니다.');
						}
					}).then(function(data){
						$(target).removeClass('modal-account-auth');
						$(target).addClass('window-modal modal-reviews-submit');
						$(target).find('.contents').empty().append(data);
						sandbox.moduleEventInjection(data, defer);
						return defer.promise();
					}).then(function(data){
						Method.reviewProcessorController(productId);
						modal.hide();
						location.reload();
					}).fail(function(msg){
						defer = null;
						UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
						if(modal.isActive()) modal.hide();
					});
				});
			},
			reviewProcessorController:function(productId){
				var arrData = [];
				var obj = {
					/*'mode':'template',
					'templatePath':'/modules/productListReview',
					'resultVar':'review',*/
					'productId':productId
				}

				for(var key in obj){
					arrData.push(key+'='+obj[key]);
				}

				///processor/execute/review      /review/list, /account/reviewlist
				//console.log(arrQueryString.join('&'));

				//템플릿 캐시로 인해 추가된 로딩바 상태
				sandbox.setLoadingBarState(true);
				sandbox.utils.ajax(args.api, 'GET', arrData.join('&') + '&' + arrQueryString.join('&') + '&mode=template&resultVar=reviewSummaryDto', function(data){
					// var articleGet = $(data.responseText).find('.reviews-summary-list');
					// console.log(articleGet);
					//
					// var listWrap = $(args.target).find('.reviews-summary-list');
					// listWrap.empty().append(articleGet);


					// var cnt = $(data.responseText).find(".star-review-num").attr("data-totalratingcount");
					// if(typeof(cnt) == "undefined"){
					// 	cnt=0;
					// }
					// if(Core.Utils.mobileChk) {
					// 	$("div[data-module-review]").empty().append(data.responseText);
					// 	$(".detail-review").find(".detail-title").text('상품평 ('+cnt+')');
					// 	$(".detail-review").find(".detail-title").append("<i class='icon-arrow_bottom'></i>");
					// }else{
					 	$(args.target).empty().append(data.responseText);
					//
					// 	//상품평개수 변경
          //   $(".review-cnt").text(cnt);
          //   $(".n-review-sort").find(".review-cnt").text("총 "+cnt+" 건 상품평");
          //   $(".total-cnt").text("총 "+cnt+"건 상품평");
					// 	//상세 밑에 리뷰추가
					// 	$(".detail-review").empty().append(data.responseText);
					// }
					// setTimeout( function(){
					// 	$(".review-write-btn").attr("data-productid",productId);
					// }, 500);
					sandbox.moduleEventInjection(data.responseText);
				}, false, false);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-review]',
					attrName:'data-module-review',
					moduleName:'module_review',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				$deferred = null;
				$this = null;
				args = null;
				modal = null;

				console.log('destroy reveiw module');
			},
			setDeferred:function(defer){
				$deferred = defer;
			},
			history:function(){

			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_order_payment', function(sandbox){
		var endPoint;
		var Method = {
			$that:null,
			$submitBtn:null,
			$usafeContent:null,
			$agreeForm:null,
			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				endPoint = Core.getComponents('component_endpoint');

				var $this = $(this);
				Method.$that = $this;
				Method.$submitBtn = $this.find('[data-checkout-btn]');
				Method.$submitBtn.on("click", Method.checkout );
				$this.find('.payment-item').on('click', Method.changePaymentMethod);
				$this.find('[data-cod-btn]').on("click", Method.codCheckout );

				if($('.payment-method-item.active').attr('data-pausable') == 'false'){
					Method.$submitBtn.prop('disabled', false);
				}

				/*
				Method.$agreeForm = $this.find('form[name="checkout-agree-form"]');
				sandbox.validation.init( Method.$agreeForm );
				*/

				Method.$usafeContent = $this.find('[data-usafe-content]');

				sandbox.getComponents('component_radio', {context:$this}, function(i){
					this.addEvent('change', function(target, val){
						if( $(this).attr('name') == 'usafeIsAgree'){
							Method.toggleUsafeContent( val == "true" );
						}
					});
				});
			},

			toggleUsafeContent:function( $bool ){
				if( $bool ){
					Method.$usafeContent.removeClass('hidden');
				}else{
					Method.$usafeContent.addClass('hidden');
				}
			},

			// payment 정보 선택시
			changePaymentMethod:function(e){
				e.preventDefault();
				var $item = $(this).closest('.payment-method-item');
				if($($item).attr('data-pausable') == 'true'){
					if(!$item.hasClass('active')){
						$item.siblings().removeClass('active');
						$item.addClass('active');
						Method.$submitBtn.prop('disabled', true);
					}
				}else{
					$item.siblings().removeClass('active');
					$item.addClass('active');

					Method.$submitBtn.prop('disabled', false);
				}
			},

			updateSubmitBtn:function( $bool ){
				if( $bool ){
					Method.$submitBtn.removeAttr('disabled').removeClass('disabled');
				}else{
					Method.$submitBtn.attr('disabled','true').addClass('disabled');
				}
			},

			checkout:function(e){
				e.preventDefault();
				$(this).attr("enabled")
				var isCheckoutAgree = Method.$that.find('[name="isCheckoutAgree"]').is(':checked');
				var _self = $(this);

				/*
				sandbox.validation.validate( Method.$agreeForm );
				if(sandbox.validation.isValid( Method.$agreeForm )){

				}
				*/


				// 결제 방법에 따른 처리
				var $activeItem = Method.$that.find("[data-payment-method]").find(".payment-method-item.active");
				// 무통장일때
				if( $activeItem.data("type") == 'WIRE' ){
					var $form = $activeItem.find('form[name="checkout-useInsureGarantee-form"]');

					// 보증보험 사용할 때
					if( $form.length > 0 ){
						var usafeIsAgree = $activeItem.find('[name="usafeIsAgree"]:checked').val();

						if( usafeIsAgree == 'true'){
							sandbox.validation.init( $form );
							sandbox.validation.reset( $form );
							sandbox.validation.validate( $form );

							// 모두 선택 체크하고
							if( sandbox.validation.isValid( $form )){
								// 동의 여부 체크
								if( !$activeItem.find('[name="usafeInfoAgree"]').is(':checked')){
									UIkit.modal.alert("개인정보 이용동의에 동의해주세요");
									return;
								}
							}else{
								return;
							}
						}
					}
				}

				if( !isCheckoutAgree ){
					UIkit.modal.alert("상품, 가격, 할인, 배송정보에 동의해주세요");
					return;
				}

				// Google recaptcha
				if ($("span[recaptchayn]").length>0){
					if (grecaptcha.getResponse() == ""){
						UIkit.modal.alert("리캡챠를 체크해야 합니다.");
						return;
					}
				};


				/*
					checkoutIamport를 실행하기 전에 checkout-request 에 먼저 결제가 가능한지 체크하고
					상태가 true 일떄 checkoutIamport를 호출한다.
					as-is : checkoutIamport
					to-be : checkoutRequest -> true -> checkoutIamport
				*/

				Method.updateSubmitBtn( false );

				var isSignIn = _GLOBAL.CUSTOMER.ISSIGNIN;
				var personalCode =$('[name="personalCode"]').val();

				if(isSignIn && personalCode == ''){
					UIkit.modal.confirm('상품 구매는 본인인증이 완료 된 아이디만 가능합니다.', function(){
						location.href = '/cart';
					});
					return;
				}


				sandbox.utils.promise({
					url:sandbox.utils.contextPath + '/checkout/request?_=' + new Date().getTime(),
					type:'GET'
				}).then(function(data){
					sandbox.setLoadingBarState(true);
				    if(data.isError == false){
				    	var paymentType = ($activeItem.length > 0) ? $activeItem.data("type") : null;
				    	endPoint.call("orderSubmit", { 'paymentType' : paymentType });
								// 결제 완료 상태 일때
				        if( _self.data('checkout-btn') == 'complete'){
        					_self.closest('form').submit();
        					return;
        				}

								//iamport 모듈
        				if( $activeItem.data('provider') == 'IAMPORT' ){
	    						Method.checkoutIamport( $activeItem, data.total_amount );
	    					}
				    }else{
							sandbox.setLoadingBarState(false);

							if(data._global == '선택 한 상품의 재고가 없습니다' || data.errorCode == 'error.checkout.quantity.lacked'){
								if( _self.data('physical-type') == 'PHYSICAL_PICKUP'){
									//픽업상품의 재고가 없을 경우 product로 이동
									var productUrl = _self.parents('body').find('.order-list a').attr('href');
									UIkit.modal.alert(data._global).on('hide.uk.modal', function(){
										location.href = sandbox.utils.contextPath + productUrl;
									});
								}else{
									var dataProduct = data.errorProduct;
									var productList = '';
									var errorTxt = '';
									if(dataProduct != null){
										for(var i = 0; i < dataProduct.length; i++){
											productList += dataProduct[i] + '<br/>';
										}
										errorTxt = '<br/>'+ productList +'해당상품의 수량변경 또는 삭제하여야 주문이 가능합니다.<br/>장바구니로 이동하시겠습니까?';
									}else{
										errorTxt = '<br/>해당상품의 수량변경 또는 삭제하여야 주문이 가능합니다.<br/>장바구니로 이동하시겠습니까?';
									}

									UIkit.modal.confirm(data._global + errorTxt, function(){
										location.href = sandbox.utils.contextPath + '/cart';
									});
								}
							}else{
								Method.updateSubmitBtn( true );
								UIkit.modal.alert(data._global);
							}
				    }
				}).fail(function(msg){
					sandbox.setLoadingBarState(false);
					UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
					Method.updateSubmitBtn( true );
				});
			},
			codCheckout:function(e){
				e.preventDefault();
				var _self = $(this);
				sandbox.utils.promise({
					url:sandbox.utils.contextPath + '/checkout/request',
					type:'GET'
				}).then(function(data){
					sandbox.setLoadingBarState(true);
				    if(data.isError == false){
						_self.closest('form').submit();
						return;
				    }else{
						UIkit.modal.alert(data._global);
				    }
				}).fail(function(msg){
					sandbox.setLoadingBarState(false);
					UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
				});
			},
			checkoutIamport:function( $activeItem, totalAmount ){
				// 결제 전일때
				var $orderinfo = $("#orderinfo-review");
				var $shippingInfo = $("#shipping-review");
				var $priceInfo = $("#order-summary");

				var IMP = window.IMP;
				//var in_app = $(frm.in_app).is(':checked');

				//IMP.init('imp29019801');
				//결제 처리 전에 이미 전달해놓은 상품가격 값과 비교해야함
				//$paymentInfo.find("input[name='cartId']").val()
				var $activePayment = $activeItem.data();
				var paymentMethod = $activePayment.method; // 결제 수단
				var mRedirectUrl = $activePayment.mRedirectUrl; // 모바일 url
				var noticeUrl = $activePayment.noticeUrl; // 노티피케이션 url
				var version = $activePayment.version || 'old'; // 에스크로 분기 처리를 위한 값  new or old
				var escrow = $activePayment.escrow; // 에스크로 사용 여부

				var useReplaceReturnUrl = false;
				var cUrl = Core.Utils.url.getCurrentUrl();

				// 접근한 URL이 mshop 일 때
				if( cUrl.indexOf( 'mshop' ) > -1 ){
					useReplaceReturnUrl = true;
				}else{
					// 접근한 URL이 mshop 이 아닌데 deviceOs 가 ios 일때
					if( String(Core.Utils.url.getQueryStringParams(cUrl).deviceOs ).toLowerCase() == 'ios' ){
						useReplaceReturnUrl = true;
					}
				}

				if( useReplaceReturnUrl ){
					if( mRedirectUrl != null ){
						mRedirectUrl = mRedirectUrl.replace('shop', 'mshop');
					}
				}

				var appScheme = $activePayment.appScheme; // 모바일 앱 스키마 정보
				var identityCode = $activePayment.identityCode; // iamport key
				var pg = $activePayment.pg;

				if( paymentMethod == '' || identityCode == '' || pg == ''){
					UIkit.modal.alert('결제 수단 정보로 인한 문제가 발생하였습니다.<br/>고객센터('+_GLOBAL.SITE.TEL+ ')로 문의 주시면 신속히 처리 도와드리겠습니다.');
					return;
				}

				IMP.init(identityCode);

				var $orderList = $priceInfo.find('[data-order]');
				var name = $orderList.find('[data-name]').text();
				if( $orderList.length > 1 ){
					name += ' 외 ' + ($orderList.length-1);
				}
				var buyerName = $.trim($orderinfo.find('[data-name]').data('name')) || $shippingInfo.find('[data-name]').data('name');

		    	var param = {
					//pay_method : _GLOBAL.PAYMENT_TYPE_BY_IAMPORT[ paymentMethod ], // 추후 provider 에 따라 변수변경 *서버에서 내려오고 있음
					pg : pg,
					pay_method : paymentMethod, // 추후 provider 에 따라 변수변경
					merchant_uid : Method.$that.find("input[name='cartId']").val() + '_' + new Date().getTime(),
					name: name,
					amount:totalAmount.amount || $priceInfo.find('[data-amount]').data('amount'),
					buyer_email:$orderinfo.find('[data-email]').data('email'),
					//buyer_name:$orderinfo.find('[data-email]').data('email'),
					buyer_name:buyerName,
					buyer_tel:$shippingInfo.find('[data-phone]').data('phone'),
					buyer_addr:$shippingInfo.find('[data-address]').data('address'),
					buyer_postcode:$shippingInfo.find('[data-zipcode]').data('zipcode'),
					m_redirect_url:mRedirectUrl,
					app_scheme:appScheme,
					notice_url:noticeUrl,
					bypass:{acceptmethod:"SKIN(#111)"}
				};

				var depositPeriod = $activeItem.find('[name="depositPeriod"]').val() || 2;

				if( paymentMethod == 'vbank' ) {
					param.vbank_due = moment().add(depositPeriod, 'day').format('YYYYMMDD2359');
					param.custom_data = $activeItem.find('form').serialize().replace(/=/gi, ':').replace(/&/gi, '|');
				}
				if ($activePayment.type == 'NAVER_PAY'){
					param.naverPopupMode = true;
					param.naverProducts = [];
					$orderList.filter('.product-mini').each(function(_, el){
						el = $(el);
						param.naverProducts.push({
							categoryType: 'PRODUCT',
							categoryId: 'GENERAL',
							uid: el.find('[data-id]').data('id'),
							name: el.find('[data-name]').data('name'),
							count: el.find('[data-quantity]').data('quantity'),
						})
					});
					param.name = param.naverProducts[0].name;
				}
				if( escrow == true ){
					param.escrow = true;
				}
				console.log(param);
				/*
				if( paymentMethod == 'escrow') {
					if( version == 'new'){
						// 신 버전
					    param.pay_method='vbank';
						param.escrow = true;
					}else{
						// 기존 버전
						param.vbank_due = moment().add(depositPeriod, 'day').format('YYYYMMDD2359');
						param.custom_data = 'paymethod:escrow';
						param.escrow = false;
					}
				}
				*/

				IMP.request_pay(param, function(rsp) {
					//결제 완료시
					if ( rsp.success ) {
						var msg = '결제가 완료되었습니다.<br>';
						msg += '고유ID : ' + rsp.imp_uid + '<br>';
						msg += '상점 거래ID : ' + rsp.merchant_uid + '<br>';
						msg += '결제 금액 : ' + rsp.paid_amount + '<br>';
						msg += 'custom_data : ' + rsp.custom_data + '<br>';

						if ( rsp.pay_method === 'card' ) {
							msg += '카드 승인번호 : ' + rsp.apply_num + '<br>';
						} else if ( rsp.pay_method === 'vbank' ) {
							msg += '가상계좌 번호 : ' + rsp.vbank_num + '<br>';
							msg += '가상계좌 은행 : ' + rsp.vbank_name + '<br>';
							msg += '가상계좌 예금주 : ' + rsp.vbank_holder + '<br>';
							msg += '가상계좌 입금기한 : ' + rsp.vbank_date + '<br>';
						}
						//alert( msg );
						sandbox.setLoadingBarState(true);

						_.delay(function(){
							location.href = sandbox.utils.contextPath + '/checkout/iamport-checkout/hosted/return?imp_uid=' + rsp.imp_uid + '&pay_method=' + rsp.pay_method + '&pg_provider=' + rsp.pg_provider + '&custom_data=' + rsp.custom_data;
						}, 3000);

					} else {

						//실패 메시지에 따라 그냥 넘길것인지 어떤 액션을 취할것인지 확인
						//var msg = '결제에 실패하였습니다.' + '<br>';
						//msg += '에러내용 : ' + rsp.error_msg + '<br>';
//						UIkit.modal.alert(rsp.error_msg);

						sandbox.setLoadingBarState(false);

						if( rsp.error_msg == '사용자가 결제를 취소하셨습니다'){
							endPoint.call('orderCancel');
						}

						UIkit.modal.alert( rsp.error_msg ).on('hide.uk.modal', function() {
							sandbox.setLoadingBarState(true);
							var cartId = Method.$that.find("input[name='cartId']").val();
							location.href = sandbox.utils.contextPath + '/checkout/request/'+ cartId;
						});

					}
					//alert( msg );
				});
			}

		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-order-payment]',
					attrName:'data-module-order-payment',
					moduleName:'module_order_payment',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';
	Core.register('module_review_write', function(sandbox){
		var $deferred = null;
		var imgCount = 0;
		var removeId = null;
		var maxCount = 5;
		var currentStarCount = 0;
		var starCountIS = false;
		var fileLoad = null;
		var arrDescription = ['별로에요.', '그저 그래요.', '나쁘지 않아요.', '마음에 들어요.', '좋아요! 추천합니다.'];
		var imgTemplate = '<span class="preview-up-img hidden"><img src="{{imgUrl}}" alt="{{imgAlt}}" /></span>';
		var inputHiddenTemplate = '<input type="hidden" name="fileList[{{id}}].fullUrl" class="file-{{id}}" value={{fullUrl}} /><input type="hidden" name="fileList[{{id}}].fileName" class="file-{{id}}" value={{fileName}} />';
		var Method = {
			$reszieEvent : 'orientationchange' in window ? 'orientationchange' : 'resize',
      $tiggerClass : '.reviews-modal-trigger',
      $modalClass : '.modal-reviews-submit',
      $progressClass : '.review-submit-progress',
      $stepWrapperClass : '.review-submit-steps',
      $stepClass : '.review-submit-step',
      $activeClass : '.active',
      $completeClass : '.complete',
      $active : 'active',
      $complete : 'complete',
      $stepCount : 0,
      $modal : null,
			moduleInit:function(){
				var $this = $(this);
				var $form = $this.find('#review-write-form');
				var $thumbNailWrap = $this.find('.thumbnail-wrap');
				var $textArea = sandbox.getComponents('component_textarea', {context:$this});

				Method.$modal = $(Method.$modalClass);
          Method.$stepCount = Method.$modal.find(Method.$stepClass).not('.step-intro').length;
          Method.$modal.on('click' + Method.$stepClass + Method.$complete, Method.$stepClass + Method.$completeClass, function(){
            var step = $(this);
            step.removeClass(Method.$complete).addClass(Method.$active).nextAll().removeClass(Method.$complete).removeClass(Method.$active);
            step.find('input').prop('checked',false);
            step.nextAll().find('input').prop('checked',false);
            Method.progress(step);
          });
          Method.startStep();
          Method.rateStep();
          Method.rangeStep();
          Method.mediaStep();
          Method.textAreaStep();

				/*  상품리뷰 rating default 상태 변경 */
				// if(marketingData.isProduct){
				// 	$this.find('.rating-star a').addClass('active');
				// };
				// $this.find('input[name=rating]').val(80);
				// $this.find('input[name=starCount]').val(4);
				// $this.find('.rating-description').text(arrDescription[4]);
				// starCountIS = true;
				// currentStarCount=4;
        Method.image = new Image();
        Method.image.addEventListener('load', function(e){
          Method.drawImage(document.querySelector('.review-submit-media-canvas').getContext("2d"), Method.image);
        },false);
				fileLoad = sandbox.getComponents('component_file', {context:$this}, function(){
					var _self = this;
					this.addEvent('error', function(msg){
						UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'warning'});
					});

					this.addEvent('upload', function(fileName, fileUrl){
            Method.image.src = fileUrl;
            
						var step = $('.step-media');
            step.addClass('set-media-added');
            step.find('.step-title').addClass('set-collapsed');

						$thumbNailWrap.empty().append(sandbox.utils.replaceTemplate(imgTemplate, function(pattern){
							switch(pattern){
								case 'imgUrl' :
									return fileUrl;
									break;
								case 'imgAlt' :
									return fileName;
									break;
							}
						}));

						imgCount++;
						_self.setCurrentIndex(imgCount);
					});
        });

				$this.find('.rating-star a').click(function(e) {
					e.preventDefault();
					var index = $(this).index() + 1;
					$(this).parent().children('a').removeClass('active');
					$(this).addClass('active').prevAll('a').addClass('active');

					$this.find('input[name=rating]').val(index*20);
					$this.find('input[name=starCount]').val(index);
					$this.find('.rating-description').text(arrDescription[index-1]);

					starCountIS = true;
				});

				if(currentStarCount >= 0){
					$this.find('.rating-star a').eq(currentStarCount).trigger('click');
				}

        if ($thumbNailWrap.find('img').length) {
          Method.image.src = $thumbNailWrap.find('img').attr('src');
          var step = $('.step-media');
          step.addClass('set-media-added');
          step.find('.step-title').addClass('set-collapsed');
        }
        
        $this.find('button[type=submit]').click(function(e){
					e.preventDefault();

					$thumbNailWrap.children().each(function(i){
						var $this = $(this);
						$form.append(sandbox.utils.replaceTemplate(inputHiddenTemplate, function(pattern){
							switch(pattern){
								case 'id' :
									return i;
									break;
								case 'fileName' :
									return $this.find('img').attr('alt');
									break;
								case 'fullUrl' :
									return $this.find('img').attr('src');
									break;
							}
						}));
					});

					var itemRequest = BLC.serializeObject($form);
					sandbox.utils.ajax($form.attr('action'), $form.attr('method'), itemRequest, function(res){
						var data = sandbox.rtnJson(res.responseText);

						if(data.error || !data){
							if($deferred) $deferred.reject(data.error);
							else UIkit.notify(data.error, {timeout:3000,pos:'top-center',status:'danger'});
						}else{
							if($deferred) $deferred.resolve(data);
							else location.href = data.redirectUrl;
						}
					}, true);
        });
        
			},
      startStep : function(){
        var trigger = '.review-submit-start';
        Method.$modal.off('click'+trigger).on('click'+trigger, trigger, function(){
          var introStep = $(Method.$stepClass + '.step-intro'),
              next = introStep.next();
          introStep.removeClass(Method.$active).addClass('complete-hidden');
          next.addClass(Method.$active);
          Method.progress(next);
          $(Method.$modalClass).find('.uk-modal-dialog').addClass('step-progress-active');
          return false;
        });
      },
      rateStep : function(){
        var trigger = '.review-submit-rating-radio';
        Method.$modal.off('change'+trigger,trigger).on('change'+trigger,trigger,function(){
          var item = $(this).closest('.review-submit-rating-item');
					var item_value = item.find('input[name=review_submit_rating]').val();
          item.siblings().removeClass('set-checked');
          item.addClass('set-checked').prevAll().addClass('set-checked');
          item.closest(Method.$stepClass).addClass(Method.$complete);


					Method.$modal.find('input[name=rating]').val(item_value*20);
					Method.$modal.find('input[name=starCount]').val(item_value);

          setTimeout(function(){
            Method.nextStep();
          },426);
        });
      },
      rangeStep : function(){
        var trigger = '.review-submit-range-input';
        Method.$modal.off('change'+trigger).on('change'+trigger,trigger,function(){
          var item = $(this).closest('.review-submit-range-item');
          item.siblings().removeClass('set-checked');
          item.addClass('set-checked');
          item.closest('.review-submit-step-preview').find('.step-title').text(item.text());
          item.closest(Method.$stepClass).addClass(Method.$complete);
          setTimeout(function(){
            Method.nextStep();
          },426);
        });
      },
      mediaStep : function(){
        var triggerFile = '.review-submit-media-file';
        var triggerSkip = '.review-submit-sign-skip';
        var triggerNext = '.review-submit-sign-next';
        Method.$modal.off('click' + triggerSkip).on('click' + triggerSkip, triggerSkip, function(){
          $(this).closest(Method.$stepClass).addClass(Method.$complete);
          setTimeout(function(){
            Method.nextStep();
          },426);
        });
        Method.$modal.off('click' + triggerNext).on('click' + triggerNext, triggerNext, function(){
          $(this).closest(Method.$stepClass).addClass(Method.$complete);
          setTimeout(function(){
            Method.nextStep();
          },426);
        });
      },
      textAreaStep : function(){
        var triggerInput = '.review-submit-descr',
          trigger = '.review-submit-descr-trigger-container',
          triggerTarget = '.review-submit-descr-trigger-target',
          subtitleIntro = Method.$modal.find('.review-submit-descr-subtitle-intro'),
          buttonSubmit = Method.$modal.find('.button-submit');
        Method.$modal.off('keyup' + triggerInput).on('keyup' + triggerInput, triggerInput, function(){
          var input = $(this),
          data = input.data(),
          count = input.val().length;
          input.height(1).height( input.prop('scrollHeight') );
          Method.$modal.find(data.characterCounter).text(data.characterLimit - count);
          if (count){
            if (!input.parent(triggerTarget).length) {
              subtitleIntro.addClass('set-collapsed');
              buttonSubmit.removeClass('set-invisible');
            }
            setTimeout(function(){
              Method.$modal.find('.review-submit-descr-trigger-container').removeClass('set-invisible');
            },426);
          } else {
            if (!input.parent(triggerTarget).length) {
              subtitleIntro.removeClass('set-collapsed');
              buttonSubmit.addClass('set-invisible');
            }
          }
        });
        Method.$modal.off('keydown' + triggerInput).on('keydown' + triggerInput, triggerInput, function(){
          var input = $(this),
          data = input.data();
          input.height(1).height( input.prop('scrollHeight') );
        });
        Method.$modal.off('focusin' + triggerInput).on('focusin' + triggerInput, triggerInput, function(){
          var input = $(this),
          parent = input.parent(triggerTarget);
          if (parent.length) {
            parent.addClass('active');
            parent.prev().addClass('active');
          }
        });
        Method.$modal.off('focusout' + triggerInput).on('focusout' + triggerInput, triggerInput, function(){
          var input = $(this),
          parent = input.parent(triggerTarget);
          if (parent.length && !input.val().length) {
            parent.removeClass('active');
            parent.prev().removeClass('active');
          }
        });
        $(window).on(Method.$reszieEvent + triggerInput,function(){
          Method.$modal.find(triggerInput).trigger('keyup' + triggerInput);
        }).trigger(Method.$reszieEvent + triggerInput);
        Method.textAreaInit(triggerInput);
      },
      textAreaInit : function(triggerInput){
        Method.$modal.find(triggerInput).each(function(){
          var input = $(this),
            data = input.data(),
            count = input.val().length;
          input.trigger('focusin' + triggerInput).trigger('focusout' + triggerInput)
          Method.$modal.find(data.characterCounter).text(data.characterLimit - count);
        });
      },
      nextStep : function(){
        var before = $(Method.$stepClass + Method.$activeClass),
            next = before.next(),
            wrapper = $(Method.$stepWrapperClass);
        before.removeClass(Method.$active).addClass(Method.$complete);
        next.addClass(Method.$active);
        Method.progress(next);
        setTimeout(function(){
          wrapper.animate({'scrollTop': wrapper.prop('scrollHeight')},852);
        },426);
      },
      drawImage : function(ctx, img, x, y, w, h, offsetX, offsetY) {
        console.log(img);
        if (arguments.length === 2) {
            x = y = 0;
            w = ctx.canvas.width;
            h = ctx.canvas.height;
        }
        offsetX = typeof offsetX === "number" ? offsetX : 0.5;
        offsetY = typeof offsetY === "number" ? offsetY : 0.5;
        if (offsetX < 0) offsetX = 0;
        if (offsetY < 0) offsetY = 0;
        if (offsetX > 1) offsetX = 1;
        if (offsetY > 1) offsetY = 1;
        var iw = img.width,
            ih = img.height,
            r = Math.min(w / iw, h / ih),
            nw = iw * r,
            nh = ih * r,
            cx, cy, cw, ch, ar = 1;
        if (nw < w) ar = w / nw;
        if (Math.abs(ar - 1) < 1e-14 && nh < h) ar = h / nh;
        nw *= ar;
        nh *= ar;
        cw = iw / (nw / w);
        ch = ih / (nh / h);
        cx = (iw - cw) * offsetX;
        cy = (ih - ch) * offsetY;
        if (cx < 0) cx = 0;
        if (cy < 0) cy = 0;
        if (cw > iw) cw = iw;
        if (ch > ih) ch = ih;
        ctx.drawImage(img, cx, cy, cw, ch,  x, y, w, h);
      },
      progress : function(next){
        $(Method.$progressClass).width( ((next.index()) / Method.$stepCount * 100) + '%' );
      }
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-review-write]',
					attrName:'data-module-review-write',
					moduleName:'module_review_write',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				$deferred = null;
				console.log('destroy review-write module');
			},
			setDeferred:function(defer){
				$deferred = defer;
			},
			moduleConnect:function(){
				fileLoad.setToappUploadImage({
					fileName:arguments[0],
					fullUrl:arguments[1],
					result:(arguments[2] === '1') ? true : false
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_date_filter', function(sandbox){
		var Method = {
			$that:null,
			moduleInit:function(){
				var $this = $(this);
				Method.$that = $this;
				Method.$start = Method.$that.find('#start-date');
				Method.$end = Method.$that.find('#end-date');
				$this.find('[data-date-list] li a').on('click', function(){
					var value = $(this).data('date').split(',');
					if( value != '' ){
						Method.searchSubmit( moment().add(value[1], value[0]).add(1, 'd').format('YYYYMMDD'), moment().format('YYYYMMDD'), 'type'+$(this).parents('li').index() );
					}else{
						Method.searchSubmit();
					}
				});

				$this.find('[data-search-btn]').on('click', function(){
					if( Method.getValidateDateInput() ){
						var start = Method.$start.val().toString();
						var end = Method.$end.val().toString();

						//alert( start );
						//alert( moment(start, 'YYYYMMDD') );
						//alert( moment(start, 'YYYY.MM.DD').format('YYYYMMDD'));
						Method.searchSubmit( moment(start, 'YYYY.MM.DD').format('YYYYMMDD'), moment(end, 'YYYY.MM.DD').format('YYYYMMDD'), 'detail' );
					}else{
						UIkit.modal.alert( '기간을 선택해 주세요' );
					}
				});

				// 초기화
				$this.find('[data-reset-btn]').on('click', Method.reset);

				// uikit datepicker module 적용
				$this.find('input.date').each( function(){
					var dateinput = $(this);
					if (dateinput.val().length) {
						dateinput.val(moment(dateinput.val(), 'YYYYMMDD').format('YYYY.MM.DD')).change();
					}
					var datepicker = UIkit.datepicker(dateinput, {
						maxDate : true,
						format : 'YYYY.MM.DD'
					});
					switch (dateinput.attr('id')) {
						case Method.$start.attr('id') : Method.$start.ukdatepicker = datepicker;
						case Method.$end.attr('id') : Method.$end.ukdatepicker = datepicker;
					}

					//Method.datepicker.push(datepicker);
					datepicker.on( 'hide.uk.datepicker', function(){
						dateinput.trigger('focusout');
						Method.updateDateInput();
					})
				})
				Method.updateDateInput();
			},

			// 앞보다 뒤쪽 날짜가 더 뒤면 두값을 서로 변경
			updateDateInput:function(){
				var format = 'YYYY.MM.DD';
				var today = moment().format(format);
				var start = String(Method.$start.val());
				var end = String(Method.$end.val());
				
				if( $.trim(start).length && $.trim(end).length ){
					var dateterm = [start, end];
					dateterm = dateterm.sort();
					start = dateterm[0];
					end = dateterm[1];
					Method.$start.val( start );
					Method.$end.val( end );
				}
				if ($.trim(end).length) {
					Method.$start.ukdatepicker.options.minDate = moment(end).subtract(6, 'M').add(1, 'd').format(format);
					Method.$start.ukdatepicker.options.maxDate = end;
					Method.$start.ukdatepicker.update();
				}

				if ($.trim(start).length) {
					var after = moment(start).add(6, 'M').subtract(1, 'd').format(format);
					Method.$end.ukdatepicker.options.minDate = start;
					Method.$end.ukdatepicker.options.maxDate = [today, after].sort()[0];
					Method.$end.ukdatepicker.update();
				}
				// 같다면
				//var isSame = moment(Method.$start.val()).isSame(Method.$end.val());
				// 작다면
				//var isBefore = moment(Method.$start.val()).isBefore(Method.$end.val());
				// 크다면
				/*
				var isAfter = startDate.isAfter(endDate);

				if( isAfter ){
					var temp = Method.$end.val();
					Method.$end.val( Method.$start.val() );
					Method.$start.val( temp );
				}
				*/
			},
			getValidateDateInput:function(){
				var start = String(Method.$start.val());
				var end = String(Method.$end.val());

				if( moment( start, 'YYYY.MM.DD' ).isValid() && moment( end, 'YYYY.MM.DD' ).isValid() ){
					return true;
				}
				return false;
			},
			searchSubmit:function( start, end, type ){
				var url = sandbox.utils.url.getCurrentUrl();
				url = sandbox.utils.url.removeParamFromURL( url, 'dateType' );

				// 전체 검색
				if(_.isUndefined( start )){
					url = sandbox.utils.url.removeParamFromURL( url, 'stdDate' );
					url = sandbox.utils.url.removeParamFromURL( url, 'endDate' );
				}else{
					var opt = {
						stdDate : start,
						endDate : end,
						dateType : type
					}

					url = sandbox.utils.url.appendParamsToUrl( url, opt )
				}
				console.log(url);

				window.location.href = url;

			},
			reset:function(){
				//Method.$start.val('').trigger('focusout');
				//Method.$end.val('').trigger('focusout');
				window.location.href = location.pathname;
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-date-filter]',
					attrName:'data-module-date-filter',
					moduleName:'module_date_filter',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_search', function(sandbox){
		var $this, args, clickIS, endPoint, latestKeywordList, arrLatestKeywordList = [];

		var setSearchKeyword = function(keyword){
			var pattern = new RegExp(keyword, 'g');
			arrLatestKeywordList = sandbox.utils.rtnMatchComma(latestKeywordList.replace(pattern, ''));
			arrLatestKeywordList.unshift(keyword);

			if(arrLatestKeywordList.length >= args.keywordMaxLen){
				arrLatestKeywordList = arrLatestKeywordList.slice(0, -1);
			}
			$.cookie('latestSearchKeyword', arrLatestKeywordList.join(','), {path:'/'});
		}

		var Method = {
			$shown : 'set-search-shown',
			$toggleClass : '.toggle',
			$wrap : $('#wrapper'),
			$utilClass : '.header-utility',
			$dropDownClass : '.header-search-dropdown',
			$dropDown : null,
			$search : null,
			$searchInput : $('.header-search-input'),
			$searchResult: $(".header-search-results-list"),
			$searchLWrap: $('.header-search-search-top-results'),
			$productListWrap: $('.search-suggestions-items'),
			keywordData : null,
			regExp : /[\{\}\[\]\/?.,;:|\)*~`!^\-+<>@\#$%&\\\=\(\'\"]/gi,
			moduleInit : function(){
				Method.$dropDown = $(Method.$dropDownClass);
				Method.$search = $(Method.$utilClass).find('.search');

				Method.$search.find(Method.$toggleClass).on('click', function(){
					if (!Method.$search.hasClass(Method.$shown)){
						//window.headModule.flyoutHidden();
						Core.getModule('module_gnb').flyoutHidden();
						Method.show();
					} else {
						Method.hide();
					}
				});
				Method.$productListWrap.on('click','.header-search-suggestions-text-cta',function(){
					console.log(123);
					Method.$searchInput.closest('form').trigger('submit');
					return false;
				})
				Method.$searchInput.on("keyup paste", function(){
					var thisVal = $(this).val();
					if(thisVal.length >= 2){
						Method.searchResult(thisVal);
					}else{
						Method.$searchResult.empty();
						Method.$searchLWrap.removeClass('hidden');
						Method.$productListWrap.addClass('hidden');
					}
					
				});
				Method.$searchInput.closest('form').on('submit',function(e){
					var form = $(this),
						action = form.attr('action') + '?',
						data = form.serializeArray();
					data.forEach(function(row){
						Method.regExp.test(row.value) && (row.value = $.trim(row.value.replace(Method.regExp, ' ')));
						if (action) {
							action += row.name + '=';
							action += encodeURIComponent(row.value) + '&';
						}
						if (!$.trim(row.value).length) {
							action = null;
						}
					});
					if (action) {
						location.href = action;
					} else {
						UIkit.notify('검색어를 입력해 주세요.', {timeout:3000,pos:'top-center',status:'danger'});
					}
					setTimeout(function(){
						Core.Loading.hide();
					});
					return false;
				});
				// 오늘 날짜 location 대입
				var today = new Date(),
						yyyy = today.getFullYear(),
						mm = today.getMonth() + 1,
						dd = today.getDate();

				if (dd < 10) dd = '0' + dd
				if (mm < 10) mm = '0' + mm
				today = String(yyyy) + String(mm) + String(dd);

				//연관 검색어 키워드
				sandbox.utils.promise({
					isLoadingBar: false,
					url: sandbox.utils.contextPath + '/cmsstatic/autoComplete/file/autoComplete-'+ today +'.json',//location-'+ today +'.json',
					type: 'GET'
				}).then(function (data) {
					var $defer = $.Deferred();
					if(data !== ''){
						Method.keywordData = JSON.parse(data);
						$defer.resolve(data);
					}else{
						$defer.reject('data is empty');
					}
					return $defer.promise();
				})
      		},
			searchResult : function(thisVal){

				Method.keywordResult(Method.keywordData, thisVal);

				//추천상품
				sandbox.utils.promise({
					isLoadingBar: false,
					url: sandbox.utils.contextPath + '/search/recommend',//location-'+ today +'.json',
					type: 'GET',
					data: {
						'q': thisVal,
					}
				}).then(function (data) {
					var jsonData = data;

					if(jsonData.productList.length !== 0){
						Method.$searchLWrap.addClass('hidden');
						Method.$productListWrap.removeClass('hidden');

						var productListTemplate = Handlebars.compile($("#search-product-list").html())(jsonData);
						$(".product-suggestions").empty().append(productListTemplate);

					}else{
						Method.$searchLWrap.removeClass('hidden');
						Method.$productListWrap.addClass('hidden');
					}

				});

			},
			keywordResult : function (jsonData, thisVal){
				$.cookie('autoCompleteList', 'true');

				var val = Method.regExp.test(thisVal) ? $.trim(thisVal.replace(Method.regExp, ' ')) : thisVal;
				var arrVal = val.split(' ');
				var regVal = new RegExp(arrVal.join('|'),'i');
				var keyword = jsonData.filter(function (row, index) {
					var str = row.name;
					var like = false;
					if (str.search(regVal) >= 0) {
						like = true;
						for(var i=0;i<arrVal.length;i++) {
							if (str.indexOf(arrVal[i]) < 0) {
								like = false;
								break;
							}
						}
					}
					return like;
				});
				var str = '';
				keyword.forEach(function (value, index){
					if(index <= 3) { // 4줄까지 노출
						var replaceValue = keyword[index].name;
						for(var i=0;i<arrVal.length;i++) {
							var replaceTag = '<strong class="match">'+ arrVal[i] +'</strong>';
							replaceValue = replaceValue.replace(arrVal[i], replaceTag);
						}
						str += "<li class='header-search-results-result text-upper text-bold'><a class='hit link-underline' href='"+keyword[index].url+"'>" + replaceValue +"</a></li>";
					}
				});
				Method.$searchResult.html(str);
			},
			show : function(){
				$('body').css('overflow','hidden');

				Method.$wrap.addClass('set-overlay');
				Method.$search.addClass(Method.$shown);
				Method.$dropDown.addClass(Method.$shown);

				if ('m' == Core.getModule('module_gnb').deviceMedia()) {
					var scroll = $(window).scrollTop(),
						offset = $('.header-general').offset().top;
					if (scroll < offset) {
						$('html,body').animate({'scrollTop': $('.header-general').offset().top}, 426);
					}
				} else {
					Method.$wrap.off('click.set-overlay').on('click.set-overlay', function(e){
						if (e.target == e.currentTarget){
							$(this).off('click.set-overlay');
							Method.hide();
						}
					});
				}

				$(document).on('keyup' + Method.$dropDownClass, function(e) {
					if (e.keyCode == 27) {
						Method.hide();
					}
				});
			},
			hide : function(){
				$('body').css('overflow','visible');

				Method.$wrap.removeClass('set-overlay');
				Method.$search.removeClass(Method.$shown);
				Method.$dropDown.removeClass(Method.$shown);

				$(document).off('keyup' + Method.$dropDownClass);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-search]',
					attrName:'data-module-search',
					moduleName:'module_search',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			searchTrigger:function(){
				$('.gnb-search-btn').trigger('click');
			},
			show:function(){
				Method.show();
			},
			hide:function(){
				Method.hide();
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_dynamicentity_board_comment', function(sandbox){
		var Method = {
			$that : null, 
			$commentContainer : null,
			dynamicName : null,
			storageId : null,
			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);				

				Method.$that = $(this);
				Method.dynamicName = $(this).find('input[name="dynamicName"]').val();
				Method.storageId = $(this).find('input[name="storageId"]').val();
				Method.$commentContainer = $(this).find('#'+ Method.dynamicName + '-comment');


				// 쓰기
				$(this).find('#comment-submit').off('click').on('click', Method.write );
				// 삭제
				$(this).find('a.deleteComment').off('click').on('click', Method.checkRemove );
				// 비빌번호 확인 후 삭제
				$(this).find('a.checkPassword').off('click').on('click', Method.togglePasswordForm );

				//paging 
				$(this).find('.btn-pagination > .paging').off('click').on('click', Method.paging );
			},
			write:function(e){
				e.preventDefault();
				if ( $.trim($("#authorName").val()) == "") {
					UIkit.notify('작성자를 입력해주세요.', {timeout:3000,pos:'top-center',status:'danger'});
					$("#authorName").focus();
					return;
				}

				if ($.trim($("#comment").val()) == "") {
					UIkit.notify('글 내용을 입력해주세요.', {timeout:3000,pos:'top-center',status:'danger'});
					$("#comment").focus();
					return;
				}

				 if( _GLOBAL.CUSTOMER.ANONYMOUS ){
					if ( $.trim($("#authorPassword").val()) == "") {
						UIkit.notify('비밀번호를 입력해주세요', {timeout:3000,pos:'top-center',status:'danger'});
						$("#authorPassword").focus();
						return;
					}
				}

				var $form = $(this).closest($('form#commentForm'));

				sandbox.utils.ajax($form.attr('action'), 'POST', $form.serialize(), function(data){
					var data = $.parseJSON( data.responseText );
					if( data.result ){
						location.reload();
					}else{
						UIkit.notify(data.errorMsg, {timeout:3000,pos:'top-center',status:'danger'});
					}
				}, true)				
			},
			// 비빌번호 확인 후 삭제 -- 사용안함
			checkPassword:function(e){
				e.preventDefault();
				var $form = $(this).closest('form');
				UIkit.modal.prompt("Password:", '', function(data){
					if( $.trim(data) != ''){
						$form.find('input[name="password"]').val(data);
						Method.remove($form);
					}
				});
			},

			togglePasswordForm:function(){
				if( $(this).hasClass('cancel')){
					$(this).removeClass('cancel').text('삭제');
					$(this).closest('form').find('.password-confirm').addClass('uk-hidden');
				}else{
					$(this).addClass('cancel').text('취소');
					$(this).closest('form').find('.password-confirm').removeClass('uk-hidden');
				}
			},

			// 삭제 확인
			checkRemove:function(e){
				e.preventDefault();

				var $form = $(this).closest('form');

				sandbox.validation.init( $form );
				sandbox.validation.validate( $form );

				if( sandbox.validation.isValid( $form )){
					UIkit.modal.confirm("삭제 하시겠습니까?", function(){
						Method.remove($form);
					});
				}
				/*
				if( $(this).hasClass('password')){
					var password = $(this).closest('form').find('input[name="password"]');
					if ( $.trim( password.val() ) == "") {
						UIkit.notify('비밀번호를 입력해주세요.', {timeout:3000,pos:'top-center',status:'danger'});
						password.focus();
						return;
					}
				}
				*/
				
				
			},
			// 삭제
			remove:function($form){
				sandbox.utils.ajax($form.attr('action'), 'POST', $form.serialize(), function(data){
					var data = $.parseJSON( data.responseText );
					if( data.result ){
						location.reload();
					}else{
						UIkit.notify(data.errorMsg, {timeout:3000,pos:'top-center',status:'danger'});
					}
				}, true)
			},

			paging:function(e){
				e.preventDefault();
				if( $(this).hasClass('active') ){
					return;
				}
				var param = _.object($(this).attr('href').split('&').map(function(p){return p.split('=');}));
				var obj = {
					'name': Method.dynamicName,
					'mode':'template',
					'storageId' : Method.storageId,
					'page' : Number(param.page) || 1,
					'pageSize' : Method.pageSize || 5,
					'pageListSize' : Method.pageListSize || 5,
					'_sort' : 'dateCreated',
					'_type_sort' : 'desc',
					'pagetype' : 'comment',
					'paging' : true,
				}

				sandbox.utils.ajax('/processor/execute/dynamic', 'GET', obj, function(data){
					var list = data.responseText;
					if( list != '' && list != undefined && list != null ){
						// TODO 페이징 타입에 따라 밑에 붙이던지 replace하던지
						Method.$commentContainer.replaceWith($(list).find('.comment-list'));
						sandbox.moduleEventInjection(list);
					}else{
						UIkit.notify('Server Error', {timeout:3000,pos:'top-center',status:'danger'});
					}
				}, true)
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-dynamicentity-board-comment]',
					attrName:'data-module-dynamicentity-board-comment',
					moduleName:'module_dynamicentity_board_comment',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_shipping_address', function(sandbox){
		var $this, args, modal = null, endPoint;
		var Method = {
			moduleInit:function(){
				// modal layer UIkit 사용
				$this = $(this);
				args = arguments[0];
				modal = UIkit.modal('#common-modal');
				endPoint = Core.getComponents('component_endpoint');
				var addressModal = UIkit.modal('#address-modal');

				$this.on('click', '.defaultAddress', function(e){
					e.preventDefault();
					endPoint.call('updateProfile', 'address book:select default shipping');
					$(this).parent().submit();
				});

				$this.on('click', '.add-address', function(e){
					e.preventDefault();
					Method.modalInit($(this).attr('href'));
				});

				$this.on('click', '.modify', function(e){
					e.preventDefault();
					Method.modalInit($(this).attr('href'));
				});

				$this.on('click', '.remove', function(e){
					e.preventDefault();
					var _self = this;
					UIkit.modal.confirm('삭제 하시겠습니까?', function(){
						$(_self).parent().submit();
					});
				});

				//$this.find('.address-form').remove();
			},
			modalInit:function(url){
				sandbox.utils.ajax(url, 'GET', {}, function(data){
					var appendHtml = $(data.responseText).find('.address-form').html();
					UIkit.modal('#address-modal').element.find('.address-body').empty().append(appendHtml);
					sandbox.moduleEventInjection(appendHtml);
					
					// 배송지 수정시 주소부분 최초 readonly 처리
					var addressInput = UIkit.modal('#address-modal').find('.addressSerch');
					if(addressInput.val()){
						addressInput.css('background','#ddd').prop('readonly', true);
						$('.btn_search').text('재검색');
					}
					
					UIkit.modal('#address-modal').show();
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-shipping-address]',
					attrName:'data-module-shipping-address',
					moduleName:'module_shipping_address',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_filter', function(sandbox){
		'use strict';

		var $filter, args, currentMinPrice, currentMaxPrice, minPrice, maxPrice, limit, arrInputPrice = [], arrQuery = [], currentRangePrice = '', endPoint;
		var pricePattern = 'price=range[{{minPrice}}:{{maxPrice}}]';

		var limitPrice = function(price){
			if(price < minPrice) return minPrice;
			else if(price > maxPrice) return maxPrice;
			else return price;
		}

		var replaceComma = function(str){
			return str.replace(/,|\.+[0-9]*/g, '');
		}

		var getPriceByPercent = function(price){
			return (price-minPrice) / (maxPrice-minPrice) * 100;
		}

		var getPercentByPrice = function(per){
			return Math.round(minPrice+(limit * per)/ 100);
		}


		var callEndPoint = function( option ){
			var temp = option.split("=");
			if( temp.length > 1){
				var opt = {
					key : temp[0],
					value : temp[1]
				}
				endPoint.call( 'applyFilter', opt );
			}
		}

		var initSearchOption = function() {
			$('input[type=checkbox]').prop('checked', false);
			$('.checked-txt').text('전체');
		}

		var getPriceVal = function(val) {
			var priceVal = JSON.parse(val.replace('range','').replace(":",","));
			return Core.Utils.price(priceVal[0]) + " ~ " + Core.Utils.price(priceVal[1]);
		}

		var serachOptionNameVal = function(sel,title,arr) {
			var sumVal = '';
			var colorName = '';
			var tempLen = 0;
			for(var i=0; i<arr.length; i++) {
				var temp = arr[i].split("=");
				if(temp.length > 1){
					var opt = {
						key : temp[0],
						value : temp[1]
					}
					var colorName = $('input[value='+decodeURIComponent(opt.value)+']').parents('li').attr('title');
					if(title == opt.key) {
						if(tempLen > 0) sumVal += ',';
						if(title == 'price') {
							var priceVal = getPriceVal(decodeURIComponent(opt.value));
							sumVal += decodeURIComponent(priceVal);
						} else if (title == 'color') {
							sumVal += colorName;
						} else {
							sumVal += decodeURIComponent(opt.value);
						}
						tempLen ++;
					}
				}
			}
			$(sel).closest('.f-refine-sect').find('.checked-txt').text(sumVal);
		}

		function mobileFilter(e) {
			console.log('aaa');
			var $this = e;
			var url = "";
			if( $this.data('sort') === "" || $this.data('sort') === "default"){
				url = Core.Utils.url.removeParamFromURL( Core.Utils.url.getCurrentUrl(), 'sort' );
			}else{
				url = Core.Utils.url.updateParamFromURL( Core.Utils.url.getCurrentUrl(), 'sort', $this.data('sort') );
			}

			console.log(url);
			window.location.href = url;
		}

		var Method = {
			$toggle : $('.filter-toggle'),
      $refinements : $('.plp-refinements-container'),
      $content : $('.plp-list-content'),
      $active : 'active',
			moduleInit:function(){
				args = arguments[0];
				$filter = $(this);
				endPoint = Core.getComponents('component_endpoint');

				if (!Method.$refinements.length) return false;

				Method.$toggle.on('click',function(){
          var toggle = $(this);
          if (toggle.hasClass(Method.$active)){
            Method.refinementsInActive();
          } else {
            Method.refinementsActive();
          }
          return false;
        });

				//모바일 필터 - 정렬
				$(".mobile-sort-list li a").click(function(){
					var url = "";
					if( $(this).data('sort') === "" || $(this).data('sort') === "default"){
						url = Core.Utils.url.removeParamFromURL( Core.Utils.url.getCurrentUrl(), 'sort' );
					}else{
						url = Core.Utils.url.updateParamFromURL( Core.Utils.url.getCurrentUrl(), 'sort', $(this).data('sort') );
					}
					window.location.assign( url );
				});

				Method.$refinements.find('[data-toggle-close]').on('click',function(){
          Method.refinementsInActive();
        });

				$('.refinements-list').on('click', '.refinement-link',function(){
					$(this).toggleClass('set-checked');
				});

				$('.refinement-swatches').on('click', '.swatch',function(){
					$(this).toggleClass('selected');
				});


				// $(window).off('scroll.plpActions-fixit').on('scroll.plpActions-fixit',function(){
        //   var scrollTop = $(this).scrollTop() + $('.header-general').height(),
        //     target = $('.plp-actions'),
        //     targetTop = target.offset().top,
        //     flagText = 'fixit-active';
        //   if (scrollTop >= targetTop){
        //     target.addClass(flagText);
        //   } else {
        //     target.removeClass(flagText);
        //   }
        // }).trigger('scroll.plpActions-fixit');

				//$('input[type=checkbox]').prop('checked', false);


				//초기 query 분류
				//arrQuery = sandbox.utils.getQueryParams(location.href, 'array');
				var query = sandbox.utils.getQueryParams(location.href);
				for(var key in query){
					if(key !== 'page'){
						if(typeof query[key] === 'string'){
							arrQuery.push(key+'='+query[key]);
						}else if(typeof query[key] === 'object'){
							for(var i=0; i < query[key].length; i++){
								arrQuery.push(key+'='+query[key][i]);
							}
						}
					}
				}

				//filter price range
				var priceRange = sandbox.getComponents('component_range', {context:$filter}, function(){
					this.addEvent('change', function(per){
						if($(this).hasClass('min')){
							currentMinPrice = getPercentByPrice(per);
							arrInputPrice[0].setValue(sandbox.rtnPrice(currentMinPrice));
						}else if($(this).hasClass('max')){
							currentMaxPrice = getPercentByPrice(per);
							arrInputPrice[1].setValue(sandbox.rtnPrice(currentMaxPrice));
						}
					});

					this.addEvent('touchEnd', function(per){
						var val = sandbox.utils.replaceTemplate(pricePattern, function(pattern){
							switch(pattern){
								case 'minPrice' :
									return currentMinPrice;
									break;
								case 'maxPrice' :
									return currentMaxPrice;
									break;
							}
						});

						if(arrQuery.indexOf(currentRangePrice) > -1){
							arrQuery.splice(arrQuery.indexOf(currentRangePrice), 1);
						}

						callEndPoint( val );
						arrQuery.push(val);
						currentRangePrice = val;

						Method.appendCateItemList();
					});
				});

				var textfield = sandbox.getComponents('component_textfield', {context:$filter}, function(){
					this.addEvent('focusout', function(e){
						var type = $(this).attr('data-name');
						var per = getPriceByPercent(limitPrice(replaceComma($(this).val())));

						if(type === 'min'){
							priceRange.getSlide(0).setPercent(per);
						}else if(type === 'max'){
							priceRange.getSlide(1).setPercent(per);
						}
					});

					arrInputPrice.push(this);
				});

				if(priceRange){
					var objPrice = (priceRange) ? priceRange.getArgs() : {min:0, max:1};
					minPrice = (objPrice.min == 'null') ? 0:parseInt(objPrice.min);
					maxPrice = (objPrice.max == 'null') ? 1:parseInt(objPrice.max);
					limit = maxPrice - minPrice;
					currentMinPrice = replaceComma(arrInputPrice[0].getValue());
					currentMaxPrice = replaceComma(arrInputPrice[1].getValue());
					priceRange.getSlide(0).setPercent(getPriceByPercent(currentMinPrice));
					priceRange.getSlide(1).setPercent(getPriceByPercent(currentMaxPrice));

					currentRangePrice = sandbox.utils.replaceTemplate(pricePattern, function(pattern){
						switch(pattern){
							case 'minPrice' :
								return currentMinPrice;
								break;
							case 'maxPrice' :
								return currentMaxPrice;
								break;
						}
					});
				}

				//모바일일때 필터 검색방법시 주석해제
				if(Core.Utils.mobileChk){
					args['data-module-filter'].filterSearchType = "all";

					//선택한 항목 표시
					var searNum = 0;
					$(".f-refine-sect").each(function(){
						$(this).find('input').each(function(){
							if($(this).parent().hasClass('checked')){
								var title = $(this).attr('name');
								serachOptionNameVal(this,title,arrQuery);
								searNum++;
							}
						});
					});
					if(searNum > 0) {
						$(".filter-etc").find('span').text('('+searNum+')');
					}

					$(document).on('touchmove', function(e) {
						if($("div").hasClass('uk-tooltip')) {
							e.preventDefault();
							if(!$(".uk-tooltip").hasClass('uk-hidden')) {
								$(".uk-tooltip").addClass("uk-hidden");
							}
						}
					});
				}


				// 필터 클릭 처리
				// sandbox.getComponents('component_radio', {context:$filter, unlock:true}, function(i){
				// 	var currentValue = '';
				//
				// 	//처음 라디오 박스에 체크 되었을때만 이벤트 발생
				// 	this.addEvent('init', function(){
				// 		var val = this.attr('name') +'='+ encodeURIComponent($(this).val());
				// 		currentValue = val;
				// 	});
				//
				// 	this.addEvent('click', function(input){
				// 		var val = $(input).attr('name') +'='+ encodeURIComponent($(input).val());
				// 		if($(this).parent().hasClass('checked')){
				// 			arrQuery.splice(arrQuery.indexOf(val), 1);
				// 		}else{
				// 			if(currentValue !== '') arrQuery.splice(arrQuery.indexOf(currentValue), 1);
				// 			callEndPoint( val );
				// 			arrQuery.push(val);
				// 			currentValue = val;
				// 		}
				//
				// 		Method.appendCateItemList();
				// 	});
				// });

				sandbox.getComponents('component_checkbox', {context:$filter}, function(){
					this.addEvent('change', function(){
						var val = $(this).attr('name') +'='+ encodeURIComponent($(this).val());
						if(arrQuery.indexOf(val) !== -1){
							arrQuery.splice(arrQuery.indexOf(val), 1);
						}else{
							callEndPoint( val );
							arrQuery.push(val);
						}

						Method.appendCateItemList();

						var title = $(this).attr('name');
						serachOptionNameVal(this,title,arrQuery);
					});
				});

				//필터 동작
				$(document).on('click', '.filter-remove-btn', function(e){
					e.preventDefault();

					//문자열 치환
					var query_replace = encodeURIComponent($(this).attr('href')).replace(/%3D/gi,'=');
					var query_replace_complete = query_replace.replace(/%25/gi,'%');
					arrQuery.splice(arrQuery.indexOf(query_replace_complete), 1);

					Method.appendCateItemList();
				});

				// $(document).on('click', args['data-module-filter'].filterOpenBtn, function(e){
				// 	e.preventDefault();
				//
				// 	$filter.show();
				// 	// $filter.stop().animate({opacity:1, left:0}, 300);
				// 	// $filter.find('.result-btn').stop().animate({opacity:1, left:0}, 300);
				// 	// $('.dim').addClass('active');
				// 	$('html').addClass('uk-modal-page');
				// 	$('body').css('paddingRight', 15);
				// });

				$(document).on('click', '.close-btn', function(e){
					$filter.hide();
					// $filter.stop().animate({opacity:0, left:-300}, 300, function(){
					// 	$(this).removeAttr('style');
					// });
					// $filter.find('.result-btn').stop().animate({opacity:0, left:-300}, 300, function(){
					// 	$(this).removeAttr('style');
					// });
					// $('.dim').removeClass('active');
					$('html').removeClass('uk-modal-page');
					$('body').removeAttr('style');
				});

				//선택해제
				$(document).on('click', '.reset-btn', function(e){
					arrQuery = [];
			    var currentParams = Core.Utils.getQueryParams(location.href);
			    if(currentParams.hasOwnProperty('q')) {
			        arrQuery.push('q=' + currentParams['q']);
			    }
					initSearchOption();
				});

				// $(document).on('click', args['data-module-filter'].filterSearchBtn, function(e){
				// 	e.preventDefault();
				// 	Method.appendCateItemList('searchBtn');
				// });

				if(args['data-module-filter'].filterSearchType == "all"){
					$(this).find(".searchFilterArea").show();
				}

				//필터 더보기 버튼
				$filter.find('.more-btn').each(function(){
					var $this = $(this);
					var $target = $this.prev();
					var minHeight = $target.height();
					var maxHeight = $target.children().height();

					$(this).click(function(e){
						e.preventDefault();

						if($this.hasClass('active')){
							$this.removeClass('active');
							$target.stop().animate({'height':minHeight}, 300);
						}else{
							$this.addClass('active');
							$target.stop().animate({'height':maxHeight}, 300);
						}
					});
				});
			},
			refinementsInActive : function(){
        Method.$toggle.removeClass(Method.$active);
        Method.$refinements.removeClass(Method.$active);
        document.cookie = '_fra=1';
      },
      refinementsActive : function(){
        Method.$toggle.addClass(Method.$active);
        Method.$refinements.addClass(Method.$active);
        document.cookie = '_fra=0';
      },

			appendCateItemList:function(param){
				//console.log(getPagingType);
				var query = arrQuery.join('&');
				query += sandbox.getModule('module_pagination') ? (sandbox.getModule('module_pagination').getPagingType() === 'number' ? '&page=1&' : '') : '';
				var searchType = args['data-module-filter'].filterSearchType;

				if(searchType == 'all') {
					if(param == 'searchBtn' || param == 'removeBtn') {
						window.location.assign(location.pathname + '?' + query);
					}
				} else {
					window.location.assign(location.pathname + '?' + query);
				}
				//

				//$(args.form).serialize();
				//$(args.form).submit();
				//console.log($('[' + args['data-module-filter'].form + ']').serialize());
				//$('[' + args['data-module-filter'].form + ']').submit();

				/*sandbox.utils.ajax(url, 'GET', queryString, function(data){
					var responseText = $(data.responseText).find(args['data-module-filter'].target)[0].innerHTML;
					$(args['data-module-filter'].target).empty().append(responseText);
					sandbox.moduleEventInjection(responseText);
				});*/
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-filter]',
					attrName:['data-module-filter'],
					moduleName:'module_filter',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_shipping_address_write', function(sandbox){
		var $this, args, endPoint;

		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];
				endPoint = Core.getComponents('component_endpoint');
				var addressSerch = $this.find('.addressSerch').val();
				var arrComponents = [];
				sandbox.getComponents('component_textfield', {context:$this}, function(){
					this.addEvent('focusout', function(){
						var input = $(this);
						var value = input.val();
						if(input.hasClass('fullName')){
							$this.find('#firstname').val(value);
							$this.find('#lastName').val(value);
						}
					});
					arrComponents.push(this);
				});
				sandbox.getComponents('component_searchfield', {context:$this, resultTemplate:'#address-find-list', isModify:args.isModify}, function(){
					this.addEvent('resultSelect', function(data){
						this.getInputComponent().setValue($(data).data('city') + ' ' + $(data).data('doro'));
						$this.find('#address1').val($(data).data('city') + ' ' + $(data).data('doro')); // 도로명 주소
						$this.find('#postcode').val($(data).data('zip-code5'));

						//상세주소 입력창으로 이동
						$this.find('#address2').focus();
					});
					var inputComponent = this.getInputComponent();
					inputComponent.addEvent('keyup', function(e){
						var input = $(this);
						if (addressSerch.length && addressSerch != input.val()) {
							addressSerch = '';
							$this.find('#postcode').val('');
						}
					});
					arrComponents.push(this);
				});

				$this.find('button[type=submit]').off().on('click', function(e){
					e.preventDefault();
					var $modalForm = $this.find('form');
					var $postCode = $this.find('#postcode');
					sandbox.validation.validate( $modalForm );
					
					if (!$postCode.val().length) {
						UIkit.notify('주소 검색을 해주세요', {timeout:3000,pos:'top-center',status:'danger'});
					} else if (sandbox.validation.isValid( $modalForm )){
						sandbox.setLoadingBarState(true);
						if( args.isModify == "true" ){
							endPoint.call('updateProfile', 'address book:shipping');
						}else{
							endPoint.call('addNewAddress');
						}
						$this.find('form').submit();
					}

					/*var count = 0;
					$.each(arrComponents, function(i){
						if(!this.getValidateChk()){
							this.setErrorLabel();
						}else{
							count++;
						}
					});

					if(arrComponents.length === count){
						if( args.isModify == "true" ){
							endPoint.call('updateProfile', 'address book:shipping');
						}else{
							endPoint.call('addNewAddress');
						}
						$this.find('form').submit();
					}*/ 
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-shipping-address-write]',
					attrName:'data-module-shipping-address-write',
					moduleName:'module_shipping_address_write',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				$this = null;
				args = null;
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_giftcard', function(sandbox){
		var Method = {
			moduleInit:function(){
				
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-giftcard]',
					attrName:'data-module-giftcard',
					moduleName:'module_giftcard',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_slick_slider', function(sandbox){
		var Method = {
			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				//Method.opts = args || {}

				// method.opts 로 정의되던 값을 data로 변경
				// module 단위는 개별 instance로 사용될 수 없어서 dom 기준으로 다시 처리
				// 추후 html에서 data로 처리 하던, component로 처리하던 하자

				for( var i in args ){
					$(this).data( i, args[i] );
				}
				Method.resizeEventList = [];
				Method.startSlider( $(this), Method.resizeEventList );
			},

			probablyMobile:function() {
				var Y = navigator.appVersion;
				var isAndroid = ( /android/gi ).test( Y );
				var isIOS = ( /iphone|ipad|ipod/gi ).test( Y );
				return ( isAndroid || isIOS || /(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test( navigator.userAgent ) );
			},

			getCssInt:function( $item, attr ) {
				var val = parseInt( (''+$item.css(attr)).replace('px',''), 10 );
				return isNaN(val) ? 0 : val;
			},

			// 고정 비율로 리사이즈 처리
			// 리사이즈시 성능 이슈가 있음..
			// 슬라이더의 배경이 보이고, 커짐.
			// 그리고 슬라이드 1번째가 아닌 경우 좌표를 재계산하느라 버벅임..
			// Slick.prototype.setPosition 참고..
			enableResponsiveResize:function( slick ) {
				var $slider = slick.$slider;

				var sliderWidth 	 = parseInt($slider.data('width'), 10);
				var sliderHeight 	 = parseInt($slider.data('height'), 10);
				var sliderMaxWidth 	 = typeof $slider.data('maxWidth') === 'undefined' ? 0 : parseInt($slider.data('maxWidth'), 10);
				var sliderResponseRate = sliderHeight / sliderWidth;
				var isFullWidth = $slider.data('fullWidth');
				// fade 가 아닌 경우 다시 받아야 함
				var $slideList = $slider.find('.slider-slide');
				var $sliderTrack = $slider.find('.slick-track');
				var $layerList = $slider.find('.slider-layer-position');
				var $layerContents = $slider.find('.slider-layer-content');
				var $item,tagName;
				$slideList.hide();

				//var w = $slider.width();
				//var w = $slider.parent().width();
				var w = $slider.parent().css({'transition':'none'}).innerWidth();

				// fullwidth 가 아닐때
				if( !isFullWidth ){
					// 가로 사이즈가 maxwidth를 못넘기도록 처리
					if( sliderMaxWidth !== 0 && sliderMaxWidth < w ) {
						w = sliderMaxWidth;
					}
				}

				var h = Math.ceil(sliderResponseRate * w);

				var itemWidth, itemHeight, itemPosition, itemStyle;
				$slider.css({width:w+'px',height:h+'px'});
				$slideList.css({width:w+'px',height:h+'px'});

				// console.log('brz_col-1of2' + ' = ' + $('.brz_col-1of2').first().innerWidth() );
				// console.log($slider.attr('id') + ' = ' + w);

				//Layer 비율에 의한 위치 이동
				$layerList.each(function( idx, item ){
					$item = $(item);
					itemWidth = $item.data('left');
					itemHeight = $item.data('top');
					//itemPosition = $item.position();
					// 좌표 % 선언시 고정 위치 환산하여 재계산 넣을거면 position 기반 환산 처리
					itemStyle = $item[0].style;
					if( itemWidth.indexOf('%') < 0 ) {
						itemWidth = parseInt(itemWidth.replace('px',''), 10);
						$item.css('left', Math.ceil(w * itemWidth / sliderWidth) +'px');
					}
					if( itemHeight.indexOf('%') < 0 ) {
						itemHeight = parseInt(itemHeight.replace('px',''), 10);
						$item.css('top', Math.ceil(h * itemHeight / sliderHeight) +'px');
					}
				});

				// layer 원본 비율 처리
				$layerContents.each(function( idx, item ){
					$item = $(item);
					tagName = ('' + item.tagName).toLowerCase();
					if( tagName == 'div' ) {
						$item.css('fontSize', Math.ceil(w * $item.data('fontSize') / sliderWidth) );
					} else if ( tagName == 'img' ) {
						$item.css('width', Math.ceil(w * $item.data('width') / sliderWidth) );
						$item.css('height', Math.ceil(h * $item.data('height') / sliderHeight) );
					}
				});


				// 리사이즈 버그 처리
				slick.setPosition();

				$slideList.show();
			},

			videoPlay:function(slider){
				var $slider = slider;
				//다음슬라이드 재생
				var activeVideo = $slider.find('.slick-active iframe');
				var src = activeVideo.attr('src');
				if(src !== undefined){
					if( src.indexOf('youtube') > -1 ){
						activeVideo[0].contentWindow.postMessage('{"event":"command", "func":"playVideo", "args":""}','*');
					}

					if( src.indexOf('vimeo') > -1 ){
						$(this)[0].contentWindow.postMessage('{"method":"play"}','*');
					}
				}
			},

			videoPause:function( slider ){
				var $video = slider.find('.slider-layer-content iframe');
				$.each( $video, function(){
					var src = $(this).attr('src');
					if( src.indexOf('youtube') > -1 ){
						$(this)[0].contentWindow.postMessage('{"event":"command", "func":"pauseVideo", "args":""}','*');
					}

					if( src.indexOf('vimeo') > -1 ){
						$(this)[0].contentWindow.postMessage('{"method":"pause"}','*');
					}
				})

			},

			resizeEvent:function( slick ){
				//console.time( 'resizeEvent' );
				var $slider = slick.$slider;
				var enableResponsive = $slider.data('enableResponsive');	// 고정비율 리사이즈 사용 처리 여부
				var hideOnMobile	 = $slider.data('hideOnMobile');		// 모바일 일때 숨김
				var hideUnder		 = $slider.data('hideUnder');			//
				var hideOver		 = $slider.data('hideOver');			//

				var isShow = true;
				if( hideOnMobile ) {
					isShow = isShow && (Method.probablyMobile() ? false  : true);
				}
				if( hideUnder !== 0 ) {
					isShow = isShow && ($slider.width() < hideUnder ? false  : true);
				}
				if( hideOver !== 0) {
					isShow = isShow && ($slider.width() > hideOver ? false  : true);
				}

				var $parent = null;

				if( $slider.parent().hasClass('content-container') ){
					$parent = $slider.parent();
				}

				if(isShow) {
					$slider.show();
					if( $parent != null ) $parent.removeClass('uk-margin-bottom-remove');
				} else {
					$slider.hide();
					Method.videoPause( $slider );
					if( $parent != null ) $parent.addClass('uk-margin-bottom-remove');
				}

				if( enableResponsive ) {
					setTimeout(function(){Method.enableResponsiveResize( slick );}, 0);
				}else {
					slick.$slides.show();
				}
				//console.timeEnd( 'resizeEvent' );
			},
			startSlider:function( $slider, resizeEventList ) {

				// admin setting 처리
				var $slideList = $slider.find('.slider-slide');
				var $layerList = $slider.find('.slider-layer-position');
				var $layerContents = $slider.find('.slider-layer-content');
				var $track = $slider.find('.slick-track');
				var sliderResponseRate = 0.4; // 최초 슬라이더 비율 (600/1500)

				// 슬라이더 배경 이미지
				if( $slider.data('backgroundImage') != 'null' ) {
					$slider.css('background-image', 'url(' + $slider.data('backgroundImage') +')');
				}

				var enableResponsive = $slider.data('enableResponsive');	// 고정비율 리사이즈 사용 처리 여부
				var autoplay 		 = $slider.data('startSlideShow'); 		//
				var sliderWidth 	 = parseInt($slider.data('width'), 10); 				//
				var sliderHeight 	 = parseInt($slider.data('height'), 10); 				//
				var sliderMaxWidth 	 = typeof $slider.data('maxWidth') === 'undefined' ? 0 : parseInt($slider.data('maxWidth'), 10);
				if( sliderMaxWidth !== 0 && sliderMaxWidth < sliderWidth ) {
					sliderWidth = sliderMaxWidth;
				}
				var $item, tagName, $video;
				var baseWidth;

				if ( enableResponsive ) {
					sliderResponseRate = sliderHeight / sliderWidth;
					baseWidth = $slider.parent().width();
					$slider.data("base-width", baseWidth);
					$slider.css({width:baseWidth+'px',height:Math.ceil(sliderResponseRate * baseWidth)+'px'});
				} else {
					$slider.css({width:sliderWidth+'px',height:sliderHeight+'px'});
					$slideList.css({width:sliderWidth+'px',height:sliderHeight+'px'});
				}

				// layer 원본 사이즈 data 기록
				$layerContents.each(function( idx, item ){
					$item = $(item);
					tagName = ('' + item.tagName).toLowerCase();
					$video = $item.find('iframe');
					$.each( $video, function(){
						var src = $(this).attr('src');
						if( src.indexOf('youtube') > -1 ){
							var param = {
								enablejsapi : 1,
								rel : 0
							}
							$(this).attr('src', Core.Utils.url.appendParamToURL($(this).attr('src'), 'enablejsapi', 1));
							$(this).attr('src', Core.Utils.url.appendParamToURL($(this).attr('src'), 'autoplay', 1));
							$(this).attr('src', Core.Utils.url.appendParamToURL($(this).attr('src'), 'rel', 0));
						}
						if( src.indexOf('vimeo') > -1 ){
							$(this).attr('src', Core.Utils.url.appendParamToURL(src, 'api', 1));
						}
						//console.log( $(this).attr('src') );
					});



					if( tagName == 'div' ) {
						$item.data('font-size', Method.getCssInt($item, 'fontSize'));
					} else if ( tagName == 'img' ) {
						if( typeof $item.data('width') === 'undefined' ) {
							$item.data('width', Method.getCssInt($item, 'width'));
						} else {
							$item.data('width', $item.data('width').replace('px',''));
						}
						if( typeof $item.data('height') === 'undefined' ) {
							$item.data('height', Method.getCssInt($item, 'height'));
						} else {
							$item.data('height', $item.data('height').replace('px',''));
						}
					}
					//  else {
					// 	// $item.find("img");
					// 	// $item.data('width', Method.getCssInt($item, 'width'));
					// 	// $item.data('height', Method.getCssInt($item, 'height'));
					// }
				});

				resizeEventList.push(Method.resizeEvent);


				var _slider = $slider.slick({
				    autoplay 		: autoplay,										// 자동 시작 여부
				    autoplaySpeed 	: 4000, 										// slide 넘어가는 속도   			=> slide 별 , slide.slideDuration
				    initialSlide	: $slider.data('startWithSlide'),				// 시작 슬라이드 번호
				    rtl 			: $slider.data('twoWaySlideShow'),				// 슬라이더 방향 전환 (right to left)
				    accessibility 	: $slider.data('keyboardNavigation'),			// 키보드 방향 전환 - Enables tabbing and arrow key navigation
				    draggable 		: true,											// Enables desktop dragging
				    swipe 			: $slider.data('touchNavigation'),				// 터치 방향 전환 - Enables touch swipe
				    touchMove 		: $slider.data('touchNavigation'),				// 터치 방향 전환 - Enables slide moving with touch
				    infinite		: true,											// 반복될 방향으로 무제한 이동 , false 인 경우 1,2,3,2,1,2,3  순으로 이동
				    fade 			: false,											// 넘김시 fade 효과 사용
				    speed 			: $slider.data('fadeDuration'),					// 장면이 변하는 속도 (애니메이션 처리 속도) Slide/Fade animation speed
				    arrows  		: $slider.data('showPrevNextButton'),			// 좌, 우 버튼 노출 여부
				    dots: true,														// 하단 네비게이션 컨트롤바
				    //easing:'linear',
				    waitForAnimate: false,
				    slidesToShow: 1,
				    adaptiveHeight: false,
				    prevArrow:'<button type="button" class="icon-rotate-h display-small-up slick-prev slick-arrow"><svg class="icon"><use xlink:href="#icon-arrow"></use></svg></button>',
				    nextArrow:'<button type="button" class="display-small-up slick-next slick-arrow"><svg class="icon"><use xlink:href="#icon-arrow"></use></svg></button>'
				});

				var limitLoopCount = 0;
				if( $slider.data('forceStopAfterLoop') == true ){
					limitLoopCount = $slider.data('loops');
				}

				var loopCount = 0;
				if( limitLoopCount > 0 ) {
					_slider.on('afterChange', function(event, slick, currentSlide, nextSlide){
						Method.videoPlay($slider);
						if( currentSlide === slick.slideCount-1 ){
							loopCount++;
							if( loopCount >= limitLoopCount) {
								slick.paused = true;
							}
						}
					});
				}

				if( $slider.data('pauseOnHover') && autoplay ) {
					_slider.mouseenter(function(){_slider.slick('slickPause');}).mouseleave(function(){
						if(limitLoopCount < 1 || loopCount<limitLoopCount){_slider.slick('slickPlay');}
					});
				}

				if( $slider.data('showPrevNextButtonOnHover') ) {
					var arrowBtns = _slider.find(".slick-arrow").hide();
					_slider.mouseenter(function(){arrowBtns.show();}).mouseleave(function(){arrowBtns.hide();});
				}


				var naviDots = _slider.find(".slick-dots").hide();
				if( $slider.data('showSlideNavigationButton') ) {
					naviDots.show();
				} else {
					if( $slider.data('showSlideNavigationButtonOnHover') ) {
						_slider.mouseenter(function(){naviDots.show();}).mouseleave(function(){naviDots.hide();});
					}
				}

				_slider.on('beforeChange', function(event, slick, currentSlide, nextSlide){
					Method.videoPause(slick.$slider);
					var $thumb = $(this).parent().find(".slider-thumb ul>li");
					if( $thumb.length > 0 ){
						$thumb.removeClass("active");
						$thumb.eq(nextSlide).addClass("active");
					}
				});

				_slider.on('breforeResize', function(event, slick){
					//console.log(slick);
					Method.resizeEvent( slick );
				});

				// layer hover 구현 - image 등록시만 동작
				/*
				$slider.find('img.slider-layer-content').hover(function(event){
					var _this = $(this);
					var _hover = _this.data( 'hover' );
					if( !brz.util.isEmpty(_hover) ) {
						_this.attr( 'src', _hover );
					}
				}, function(event){
					var _this = $(this);
					var _primary = _this.data( 'primary' );
					if( !brz.util.isEmpty( _primary ) ) {
						_this.attr( 'src', _primary );
					}
				});
				*/

				// 최초 실행
				if( _slider.length > 0 ) {
					Method.resizeEvent( _slider.get(0).slick );
				}
			}


		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-slick-slider]',
					attrName:'data-module-slick-slider',
					moduleName:'module_slick_slider',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_text_banner', function(sandbox){
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var $banner = $this.find('.slick-slider');

				var defaultOption = {
					autoplay : true,
					prevArrow : '<button type="button" class="icon-rotate-h display-small-up slick-prev slick-arrow" title="Go to Previous"><svg class="icon"><use xlink:href="#icon-arrow"></use></svg></button>',
          nextArrow : '<button type="button" class="display-small-up slick-next slick-arrow" title="Go to Next"><svg class="icon"><use xlink:href="#icon-arrow"></use></svg></button>',
				}


				$banner.slick(defaultOption);
				//$banner.addClass('slick-initialized');

				// $(this).find('.bxslider-controls .btn-next').on('click', function(e) {
				// 	e.preventDefault();
				// 	slider.goToNextSlide();
				// });
				// $(this).find('.bxslider-controls .btn-prev').on('click', function(e) {
				// 	e.preventDefault();
				// 	slider.goToPrevSlide();
				// });
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-text-banner]',
					attrName:'data-module-text-banner',
					moduleName:'module_text_banner',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_social_login', function(sandbox){
		var Method = {
			moduleInit:function(){
				$this = $(this);
				sandbox.getComponents('component_select', {context:$this}, function(){
					this.addEvent('change', function(val){
						Method.submitFormByName( val );
					});
				});

				$(this).find('[data-social-btn]').on('click', function(e){
					e.preventDefault();
					var type = $(this).data('social-btn');
					Method.submitFormByName( type );
				})


			},
			submitFormByName:function(name){
				var $form = $this.find('form[name="' + name + '"]');
				var url = sandbox.utils.url.getUri(sandbox.utils.url.getCurrentUrl());	
				var locationHref = window.location.href;
				var locationPathname = window.location.pathname;

				if (!_.isEmpty(url.queryParams.successUrl)){
					locationHref = url.queryParams.successUrl;
				} else if (locationPathname == '/login' || locationPathname == '/register' || locationPathname == '/login/forgotUsername' || locationPathname == '/login/forgotPassword') {
                    locationHref = url.url.replace(locationPathname, '');
                }
                if ( locationHref.indexOf( 'http' ) == -1){
                    locationHref = url.protocol + '//' + url.host + sandbox.utils.contextPath + locationHref;
                }
				if( $form ){
					$form.append('<input type="hidden" name="state" value="'+ locationHref.replace(/&/g, '%26') +'" />');
					$form.submit();
				}
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-social-login]',
					attrName:'data-module-social-login',
					moduleName:'module_social_login',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_global_popup', function(sandbox){
		var Method = {
			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var options = {
					id : Method.id,
					width : Method.width,
					height : Method.height,
					marginLeft : Method.marginLeft || 0,
					marginTop : Method.marginTop || 0,
					marginBottom : Method.marginBottom || 0,
					layoutType : Method.layoutType,
					backgroundColor : Method.backgroundColor,
					borderWidth : Method.borderWidth || 0,
					boxPosition : Method.boxPosition,
					triggerActionType : Method.triggerActionType,
					triggerActionValue : Method.triggerActionValue,
					animationType : Method.animationType,
					closeExpireTime : Method.closeExpireTime,
					useCloseMessage : Method.useCloseMessage,
					closeType : Method.closeType,
					closePosition : Method.closePosition,
					closeMarginTop : Method.closeMarginTop || 0,
					closeMarginLeft : Method.closeMarginLeft || 0,
					closePaddingTop : Method.closePaddingTop || 0,
					closePaddingRight : Method.closePaddingRight || 0,
					closePaddingBottom : Method.closePaddingBottom || 0,
					closePaddingLeft : Method.closePaddingLeft || 0,
					closeBackgroundHeight : Method.closeBackgroundHeight || 0
				}
				$("#global_popup_" + options.id).brzPopup(options);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-global-popup]',
					attrName:'data-module-global-popup',
					moduleName:'module_global_popup',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_social_share', function(sandbox){
		var endPoint, $this;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				endPoint = Core.getComponents('component_endpoint');

				$this.on('click', '#kakao-btn-wrapper', function(){
					endPoint.call('socialShareClick', {service : 'kakaotalk'});
				})

				$this.on('click', '.at-share-btn-elements a', function(){
					var service = '';
					var className = String( $(this).attr("class") );
					if( className.indexOf('facebook') > -1){
						service = 'facebook';
					}

					if( className.indexOf('twitter') > -1){
						service = 'twitter';
					}

					if( className.indexOf('kakao') > -1){
						service = 'kakao';
					}

					if( className.indexOf('email') > -1){
						service = 'email';
					}

					if( className.indexOf('lineme') > -1){
						service = 'lineme';
					}

					if( className.indexOf('pinterest') > -1){
						service = 'pinterest';
					}
					endPoint.call('socialShareClick', {service : service});
				})
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-social-share]',
					attrName:'data-module-social-share',
					moduleName:'module_social_share',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				if($this) $this.off();
				endPoint = null;
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_guest_order_search', function(sandbox){
		var Method = {
			$that:null,
			$form:null,
			$stepContainer:null,
			$errorAlert:null,
			moduleInit:function(){

				// listSize = 검색 결과 한번에 보여질 리스트 수
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);
				Method.$that = $this;
				Method.$form = $this.find("form");

				Method.$stepContainer = $this.parents(".account-container");
				Method.$errorAlert = Method.$that.find('[data-error-alert]');
				Method.$search = $this.find('.search-container');

				Core.getComponents('component_textfield', {context:$this}, function(){
					this.addEvent('enter', function(){
						Method.searchSubmit();
					});
				});

				$this.find('button[type="submit"]').on('click', function(e){
					e.preventDefault();
					Method.searchSubmit();
				} );


				// 로그인 버튼
				$this.on('click', '[data-login-btn]',  Method.customerLogin );

				// 인증하기 버튼
				$('.order-list-container.step-2').on('click', '[data-certify-btn]', Method.guestCertify );

				// $('.account-auth-content.step-2').on('click', '[data-back-btn]', function(){
				// 	Method.viewStep(1);
				// });

				sandbox.validation.init( Method.$form );
			},

			updateSelectOrder:function(e){
				e.preventDefault();
				// 자신 버튼 숨기기
				$(this).parent().hide();
				// 자신 컨텐츠 켜기
				$(this).parents('.order-info-item').find('.account-auth-order').addClass('active');
				// 다른 버튼 보이기
				$(this).parents('.order-info-item').siblings('.order-info-item').find('.order-search-confirm').show();
				// 다른 컨텐츠 숨기기
				$(this).parents('.order-info-item').siblings('.order-info-item').find('.account-auth-order').removeClass('active');
			},
			searchSubmit:function(){
				sandbox.validation.validate( Method.$form );
				if( sandbox.validation.isValid( Method.$form )){
					sandbox.utils.ajax(Method.$form.attr("action"), 'POST', Method.$form.serialize(), function(data){
						Method.createGuestOrderList(JSON.parse( data.responseText ));
					});
				}
			},
			viewStep:function(num){
				if(num !== 2){
					Method.$stepContainer.find('.account-auth-content').addClass('uk-hidden');
				}

				Method.$stepContainer.find('.step-' + num).find('input[name="identifier"]').val('');
				Method.$stepContainer.find('.step-' + num).removeClass('uk-hidden');

			},
			showAlert:function(msg){
				UIkit.modal.alert(msg);
				//UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
				/*
				Method.$errorAlert.text(msg);
				Method.$errorAlert.removeClass('uk-hidden');
				*/
			},
			hideAlert:function(){
				Method.$errorAlert.addClass('uk-hidden');
			},
			createGuestOrderList:function(data){
				var result = data['result'];
				var $listContainer = $('.order-list-container.step-2');
				var list = data['ro'];
				var html = '';

				if( result == true ){
					if( list.length == 0 ){
						Method.showAlert('검색결과가 없습니다. <br />다른 정보를 이용해 다시 검색해 주십시오.');
						$listContainer.addClass('uk-hidden').find('.list-container').empty();
					}else{
						//orderNumber, phoneNumber, emailAddress, 주문자명(name), 뭐가 들어 올지 모름
						//주문자명의 경우 list에 매칭 값이 넘어 오지 않음.
						//넘어 오는 값 정보는
						//customerId, isGuestCustomer, guestOrderDTOs
						//guestOrderDTOS: orderNumber, submitDate, emailAddress, phoneNumber
						Method.$searchKey = Method.$stepContainer.find('input[name="identifier"]').val();
						var orderNumberPattern = /[0-9]{12,30}$/;  //입력값이 orderNum인 경우 orderNum이 일치 하면 목록에 추가
						var orderNumberSearch = false;
						if(orderNumberPattern.test(Method.$searchKey)){
							orderNumberSearch = true;
						}
						var addList = [];
						var addListItem = {};
						$.each( list, function( index, li ){
							for(var i=0; i<li.guestOrderDTOs.length; i++){
								addListItem = li.guestOrderDTOs[i];
								addListItem.isGuestCustomer = li.isGuestCustomer;
								addListItem.customerId = li.customerId;
								addListItem.isItems = (li.guestOrderDTOs[i].orderItemNames.length > 1);
								addListItem.itemLength = li.guestOrderDTOs[i].orderItemNames.length-1;
								addListItem.orderItemName = li.guestOrderDTOs[i].orderItemNames[0];
								addListItem.totalAmount = sandbox.rtnPrice(li.guestOrderDTOs[i].totalAmount.amount);
								addListItem.isPhoneNum = (li.guestOrderDTOs[i].phoneNumber) ? true : false;
								addList.push(addListItem);
							}

							// for(var i=0; i<li.guestOrderDTOs.length; i++){
							// 	// addListItem.guestOrderDTO = li.guestOrderDTOs[i];
							// 	addListItem.num = i;
							// 	addListItem.orderNumber = li.guestOrderDTOs[i].orderNumber;
							// 	// addListItem.guestOrderDTO.orderItemName = li.guestOrderDTOs[i].orderItemNames[0];
							// 	// addListItem.isItems = (li.guestOrderDTOs.length > 1);
							// 	// addListItem.itemLength = li.guestOrderDTOs.length-1;
							// 	// addListItem.totalAmount = sandbox.rtnPrice(li.guestOrderDTOs[i].totalAmount.amount);
							// 	// addListItem.isPhoneNum = (li.guestOrderDTOs[i].phoneNumber) ? true : false;
							// }
						});
						
						html = Handlebars.compile($("#guest-order-list").html())(addList);

						$listContainer.removeClass('uk-hidden').find('.list-container').html( html );
						$listContainer.find('.order-search-confirm').addClass('active');
						sandbox.moduleEventInjection( html );

						// 검색된 리스트중 선택시
						Method.$stepContainer.on('click', '[data-order-select-btn]',  Method.updateSelectOrder );
						//Method.viewStep(2);
					}
				}else{
					Method.showAlert(data['errorMsg']);
				}
			},
			customerLogin:function(){
				var orderNumber = $(this).closest('li').find('input[name="orderNumber"]').val();

				// 회원 주문
				var modal = UIkit.modal('#common-modal');
				var promise = null;
				promise = sandbox.utils.promise({
					url:sandbox.utils.contextPath + '/dynamicformpage',
					type:'GET',
					data:{'name':'login', 'dataType':'model'}
				}).then(function(data){
					var defer = $.Deferred();
					var appendTxt = $(data).find('.content-area').html();
					$('#common-modal').find('.contents').empty().append(appendTxt);
					sandbox.moduleEventInjection(appendTxt, defer);
					modal.show();
					return defer.promise();
				}).then(function(){
					//window.document.location.href = "/account/orders/" + orderNumber
					window.document.location.href = "/account/orders/";
				}).fail(function(msg){
					UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
					modal.hide();
				});
			},

			// 비회원 인증 처리
			guestCertify:function(){
				var type = $(this).attr('data-type');
				var orderNumber = $(this).closest('.order-info-item').find('input[name="orderNumber"]').val();
				var customerId = $(this).closest('.order-info-item').find('input[name="customerId"]').val();
				var email = $(this).closest('.order-info-item').find('input[name="email"]').val();
				var phoneNum = $(this).closest('.order-info-item').find('input[name="phonenum"]').val();
				var url = "/guest/orders/requestAuthUrl?customer=" + customerId;

				if( type === 'email'){
					url += '&orderNumber=' + orderNumber + '&messageType=EMAIL';
				}else if( type === 'sms'){
					url += '&orderNumber=' + orderNumber + '&messageType=KAKAO';
				}

				sandbox.utils.ajax(url, 'GET', {}, function(data){
					var responseData = sandbox.rtnJson(data.responseText);
					if(responseData.result == true){
						Method.$search.hide();
						if(type === 'email'){

							Method.viewStep(3);
							Method.$stepContainer.find('.step-2').addClass('uk-hidden');
						}else if(type === 'sms'){
							Method.viewStep(4);
							Method.$stepContainer.find('.step-2').addClass('uk-hidden');
						}
					}else{
						Method.showAlert(responseData['errorMsg']);
					}

				}, true );

				return;
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-guest-order-search]',
					attrName:'data-module-guest-order-search',
					moduleName:'module_guest_order_search',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_store', function(sandbox){
		var $this, $infoViewContainer, filterQuery = [], searchQueryString = '';
		/*
			store-info-view 에 추가되는 dom object

			<h2 class="tit">명동</h2>
			<span class="address">서울 영등포구 여의도동</span>
			<span class="phonenum">070-0000-0000</span>
			<dl class="info">
				<dt class="key">운영시간</dt>
				<dd class="value">평일 10:00, 주말 11:00</dd>
				<dt class="key">매장정보</dt>
				<dd class="value">네이버 지도 API v3는 JavaScript 형태로 제공되는 NAVER 지도 플랫폼으로써</dd>
			</dl>
			<button class="close-btn"><i class="icon-delete_thin"></i></button>
		*/

		/**************************

			매장검색
			매장이름, 지역검색 : _find=지하철&_search=name&_condition=like
			필터 : _find={{매장타입}}&_search=storeType&_condition=or||and

			admin에서 재고위치/대리점의 추가속성에 storeType, icon은 각각, 검색필터와 마커의 아이콘의 클래스를 입력하는 속성이다.

			membership: 나이키 멤버십 및 티켓을 사용 할 수 있는 매장
			nrc: nike running club
			ntc: nike traingin club
			reservation: 매장 상품 예약 서비스 제공 하는 매장

		***************************/

		var submitSearchMap = function(){
			//_find=서울&_search=name&_condition=like&_find=손목시계,지하철&_search=storeType&_condition=or

			var filterParams = location.pathname + '?';
			if(searchQueryString !== '') filterParams += searchQueryString + '&';
			if(filterQuery.length > 0){
				filterParams += '_find='+filterQuery.join(',')+'&_search=storeType&_condition=like';
			}
			location.href = filterParams.replace(/[?|&]$/, '');
		}

		var Method = {
			moduleInit:function(){
				var args = arguments[0];
				$this = $(this);
				$infoViewContainer = $(this).find(args.infoview);

				var currentParams = sandbox.utils.getQueryParams(location.href);
				var arrCurrentFilters = [];
				var currentStoreIndex = 0;
				if(currentParams.hasOwnProperty('_find') && currentParams['_find'] instanceof Array){
					arrCurrentFilters = currentParams['_find'][1].split(',');
				}else{
					currentParams = null;
					arrCurrentFilters = null;
				}

				var mapComponent = sandbox.getComponents('component_map', {context:$this}, function(){
					this.addEvent('openMarker', function(storeInfo, i){
						//var objStoreInfo = Method.getStoreList($(this).attr('data-store-id'));
						Method.showInfoDetail(storeInfo);
						currentStoreIndex = i;
						if($('body').attr('data-device') !== 'pc') $this.find('.search-result').css('display','none');
					});

					this.addEvent('closeMarker', function(i){
						$infoViewContainer.stop().animate({'left':$infoViewContainer.outerWidth(true)}, 300, function(){
							$infoViewContainer.removeAttr('style');
							$this.find('.search-result').removeAttr('style');
						});
					});
				});

				var searchField = sandbox.getComponents('component_searchfield', {context:$this}, function(){
					/*this.addEvent('beforeSubmit', function(){
						var val = arguments[0];
						$('input[name=_find]').val(val);
					});*/
					this.addEvent('searchEmpty', function($form){
						searchQueryString = $form.serialize();
						submitSearchMap();
					});

					this.addEvent('searchKeyword', function($form, value){
						searchQueryString = $form.serialize();
						submitSearchMap();
					});
				});

				var searchCheckBox = sandbox.getComponents('component_checkbox', {context:$this}, function(i, dom){
					this.addEvent('change', function(val){
						var index = filterQuery.indexOf(val);
						if(index === -1){
							// filterQuery.push(val);
							//value가 '매장 상품 예약 서비스'로 들어와서 search안됨.name ='reservation'을 넣어 준다.
							filterQuery.push(this.name);
						}else{
							filterQuery.splice(index, 1);
						}
					});

					if(arrCurrentFilters !== null && arrCurrentFilters.indexOf(encodeURI(this.getThis().val())) > -1){
						this.getThis().prop('checked', true);
						this.getThis().trigger('change');
					}
				});

				$(this).find('.filter-btn').click(function(e){
					e.preventDefault();

					/*if(filterQuery.length > 0){
						var filterQueryParams = sandbox.utils.getQueryParams($(this).closest('form').serialize());
						filterQueryString = '_find='+filterQuery.join(',');
						if(filterQueryParams._search) filterQueryString += '&_search='+filterQueryParams._search;
						if(filterQueryParams._condition) filterQueryString += '&_condition='+filterQueryParams._condition;
					}else{
						filterQueryString = '';
					}*/

					searchField.externalAction();
				});

				$(this).find('a').click(function(e){
					e.preventDefault();
					mapComponent.mapEvent($(this).parent().index());

					$this.find('.search-result').removeAttr('style');
					if($('body').attr('data-device') !== 'pc') {
						$this.find('.search-result').css('display', 'none');
					}
				});

				$(this).on('click', '.close-btn', function(e){
					mapComponent.mapEvent(currentStoreIndex);
				});

				//service filter area show and hide
				$(this).on('click', '#service-filter-btn', function(e){
					var target = '#service-filter-area';
					if($(target).is(":visible")){
						$(target).hide();
						$(target).addClass('close');
					} else {
						$(target).show();
						$(target).removeClass('close');
					}
				});

				Method.updateCheckAll();

				// 매장찾기 전체 체크시
				$(this).find('input#check-all-store[type="checkbox"]').on('change', Method.changeAllCheck);
				// 아이템 체크박스 선택시
				$(this).find('input#check-item-store[type="checkbox"]').on("change", Method.changeItemCheck);

			},
			// 매장찾기 전체 체크 처리
			changeAllCheck:function(e){
				e.preventDefault();
				var isCheck = $(this).prop('checked');
				$('input#check-item-store[type="checkbox"]').each( function(){
					if(isCheck == true && !$(this).prop('checked')){
						$(this).prop('checked', isCheck ).trigger('change');
					}
					if(isCheck == false && $(this).prop('checked')){
						$(this).prop('checked', isCheck ).trigger('change');
					}
				});
			},
			// 아이템 체크박스 선택시
			changeItemCheck:function(e){
				var isCheck = $(this).prop('checked');
				if( isCheck ){
					$(this).parent().addClass('checked');
				}else{
					$(this).parent().removeClass('checked');
				}
				Method.updateCheckAll();
			},
			// 아이템 체크박스 변경시 전체 선택 체크박스 상태처리
			updateCheckAll:function(){

				if($('input#check-item-store[type="checkbox"]').length == $('input#check-item-store[type="checkbox"]:checked').length ){
					$('input#check-all-store[type="checkbox"]').prop( 'checked', true);
				}else{
					$('input#check-all-store[type="checkbox"]').prop( 'checked', false);
				}
			},
			//Store 선택 시 상세 정보 만드는 스크립트 실행
			showInfoDetail:function(data){
				var template = Handlebars.compile($('#map-store-info').html())(data);

				$infoViewContainer.empty().append(template);
				$infoViewContainer.stop().animate({'left':0}, 300);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-store]',
					attrName:'data-module-store',
					moduleName:'module_store',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_header', function(sandbox){
		var $this, $headerMenuWrap, args, isSignIn = false, modal, isModalHide = false, isRefresh = false, reDirectUrl = '', endPoint, errorCount=0, customer={};
		var Method = {
			moduleInit:function(){
				$this = $(this);
				$headerMenuWrap = $this.find('.header-mymenu');
				args = arguments[0];
				isSignIn = (args.isSignIn === 'true') ? true : false;
				modal = UIkit.modal('#common-modal', {center:true});
				endPoint = Core.getComponents('component_endpoint');

				//customer = args;
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-header]',
					attrName:'data-module-header',
					moduleName:'module_header',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			setLogin:function(callBackFunc){
				var _self = this;

				if(!isSignIn){
					//로그인 전
					$('#common-modal').removeClass('quickview');

					sandbox.utils.promise({
						url:sandbox.utils.contextPath + '/dynamicformpage',
						type:'GET',
						data:{'name':'login', 'dataType':'model'}
					}).then(function(data){
						var defer = $.Deferred();
						var appendTxt = $(data).find('.content-area').html();
						$('#common-modal').addClass('modal-account-auth');
						$('#common-modal').find('.contents').empty().append(appendTxt);
						sandbox.moduleEventInjection(appendTxt, defer);
						endPoint.call("openLogin");
						modal.show();
						return defer.promise();
					}).then(function(data){
						$headerMenuWrap.find('li').eq(0).empty().append($(args.template).html());
						isSignIn = true;
						endPoint.call("loginSuccess");

						if(isModalHide) modal.hide();
						if(!isRefresh && typeof callBackFunc === 'function') callBackFunc({isSignIn:true});
						else if(isRefresh) location.href = reDirectUrl;
					}).fail(function(data){
						// changsoo.rhi
						if(data instanceof Object) {
					        _self.popForgotPassword(callBackFunc, data.failureType);
					    } else {
    						defer = null;
		    				//로그인 실패시 재귀호출
    						if(errorCount > 3){
    							UIkit.notify('일시적인 장애로 인해 잠시후 이용해 주시기 바랍니다.', {timeout:3000,pos:'top-center',status:'danger'});
    						}else{
    							UIkit.notify(data, {timeout:3000,pos:'top-center',status:'danger'});
    							_self.setLogin(callBackFunc);
								errorCount++;
    						}
					    }
					});
				}else{
					//로그인 후
					$('#common-modal').removeClass('modal-account-auth');
					if(typeof callBackFunc === 'function') callBackFunc({isSignIn:true});
				}
			},
			getIsSignIn:function(){
				return isSignIn;
			},
			setModalHide:function(isHide){
				isModalHide = isHide;
				return this;
			},
			reDirect:function(url){
				isRefresh = true;
				reDirectUrl = (url) ? url : location.href;
				return this;
			},
			popRegister:function(callBackFunc, errorMsg){
				var _self = this;
				var isCheckedReceiveEmail = false;

				sandbox.utils.promise({
					url:sandbox.utils.contextPath + '/dynamicformpage',
					type:'GET',
					data:{'name':'register', 'dataType':'model'}
				}).then(function(data){
					// 팝업 노출
					var defer = $.Deferred();
					var appendTxt = $(data).find('.content-area').html();
					$('#common-modal').find('.contents').empty().append(appendTxt);
					sandbox.moduleEventInjection(appendTxt, defer);
					endPoint.call("openRegister");
					modal.show();
					//errorMsg 처리
					if(errorMsg){
						for(var key in errorMsg){
							$('#common-modal').find('#'+key).parent().addClass('error').append('<span class="error-message">' + errorMsg[key] + '</span>');
						}
					}
					return defer.promise();
				}).then(function(data){
					isCheckedReceiveEmail = $(modal.dialog).find("#receiveEmail").is(":checked");
					isCheckedReceiveSms = $(modal.dialog).find("#smsAgree").is(":checked");
					return sandbox.utils.promise({
						url: data.redirectUrl,
						type:'GET'
					});
				}).then( function(data){
					//회원가입 성공시
					$headerMenuWrap.find('li').eq(0).empty().append($(args.template).html());

					var appendTxt = $(data).find('.content-area').html();
					$('#common-modal').find('.contents').empty().append(appendTxt);

					endPoint.call("registerComplete", { isReceiveEmail : isCheckedReceiveEmail, isCheckedReceiveSms : isCheckedReceiveSms });
					modal.show();

					$('#common-modal').find('.register-success-btn').click(function(e){
						e.preventDefault();
						if(typeof callBackFunc === 'function'){
							callBackFunc(data);
						}
					});

					//modal hide
					UIkit.modal('#common-modal').off('hide.uk.modal.register').on({
						'hide.uk.modal.register':function(){
							callBackFunc(data);
						}
					});
				}).fail(function(msg){
					_self.popRegister(callBackFunc, msg);
				});
			},
			popForgotPassword:function(callBackFunc, type){
				var _self = this;
				sandbox.utils.promise({
					// url:'sandbox.utils.contextPath + /forgotPassword',
					url:sandbox.utils.contextPath + '/dynamicformpage?failureType='+type, // changsoo.rhi - failureType add
					type:'GET',
					data:{'name':'forgotPassword', 'dataType':'model'}
				}).then(function(data){
					var defer = $.Deferred();
					var appendTxt = $(data).find('.content-area').html();
					$('#common-modal').find('.contents').empty().append(appendTxt);
					sandbox.moduleEventInjection(appendTxt, defer);
					modal.show();
					return defer.promise();
				}).then(function(data){
					//find password success
					console.log(data);
				}).fail(function(msg){
					defer = null;
					console.log('msg:' , msg);
					UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
					//회원 가입 실패시 재귀호출
					_self.popForgotPassword(callBackFunc);
				});
			},
			getCustomer:function(){
				return customer;
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_switcher', function(sandbox){
		var Method = {
			moduleInit:function(){
				// structured content에서 ukkit에 switcher module를 사용할 때 categoryslider 리셋 처리
				$(this).on('show.uk.switcher', function(event, area){
					var $container = $(this).closest('.content-container').find('.tab-container.uk-switcher > *').eq($(area).index());
					var $slider = $container.find('[data-component-slider]');
					if( $slider.length > 0){

						Core.getComponents('component_slider', {context:$container}, function(){
							$(this)[0].redrawSlider();
						});

						//$slider.bxSlider().reloadSlider();
					}

					/* image lazeload를 사용하지 않아 주석처리함 */
					/*setTimeout(function(e){
						$(window).trigger("scroll");
					}, 10);*/
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-switcher]',
					attrName:'data-module-switcher',
					moduleName:'module_switcher',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_inquiry', function(sandbox){
		var $appendListWrap = null;
		var fileLoad = null;
		var fileInfoTemplate = '<input type="hidden" name="fileList[{{id}}].fullUrl" class="file-{{id}}" value="{{fullUrl}}" /><input type="hidden" name="fileList[{{id}}].fileName" class="file-{{id}}" value="{{fileName}}" />';
		var Method = {
			moduleInit:function(){
				setTimeout(function(){
					$('.uk-modal-page').removeClass('uk-modal-page');
				}, 2000);
				var $this = $(this);
				var $fileInfo = $this.find('.file-info');
				var args = arguments[0];
				var subInquiryJson = args['data-sub-inquiry'];
				var subInquiryEmpty = false;
				var arrSelectBox = [];
				var modal = {
					'order' : UIkit.modal('#inquiry-order'),
					'product' : UIkit.modal('#inquiry-product'),
				};
				var isOrderInquery = false;
				var objOrderData = {};
				
				var textComponent = sandbox.getComponents('component_textarea', {context:$this}, function(){
					this.addEvent('focusout', function(){
						var value = $(this).val();
						$this.find('#title').val(value);
						$this.find('#detail').val(value);
						objOrderData.value = value;
						if(isOrderInquery){
							$this.find('#detail').val(Handlebars.compile($('#inquery-order-list').html())(objOrderData));
						}
					});
				});

				var selectComponent = sandbox.getComponents('component_select', {context:$this}, function(i){
					var INDEX = i;
					arrSelectBox.push(this);
					this.addEvent('change', function(val){
						if(INDEX === 0){
							isOrderInquery = false;
							for(var key in subInquiryJson){
								if(key === val){
									var obj = {};
									obj.name = 'subInquiryType';
									obj.option = subInquiryJson[key];
									arrSelectBox[1].replaceSelectBox(Handlebars.compile($(args['data-module-inquiry'].template).html())(obj));
									break;
								}
							}
							if (arrSelectBox[1]) {
								subInquiryEmpty = !obj || $.isEmptyObject(obj.option);
								$(arrSelectBox[1].getThis()).find('select').prop('disabled', subInquiryEmpty);
							}

							/* 세금계산서문의 배송문의, 상품문의, A/S, 반품 취소 문의 일떼 자신이 주문한 상품 (orderItemList) 리스트를 불러온다. */
							if(val === 'BILL' || val === 'DELIVERY' || val === 'PRODUCT' || val === 'AS' || val === 'RETURN' || val === 'CANCEL' || val === 'EXCHANGE' || val == 'ADDRESS'){
								var obj = {
									'mode':'template',
									'resultVar':'orderList',
									'proceedOrderList':''
								}

								switch(val){
									case 'PRODUCT' :
										obj.templatePath = '/account/partials/productItemListInquiry';
										obj.needWishList = 'Y';
										obj.modalType = 'product';
										break;
									default :
										obj.templatePath = '/account/partials/orderItemListInquiry';
										obj.needOrderList = 'Y';
										obj.modalType = 'order';
										break;
								}

								sandbox.utils.ajax('/processor/execute/customer_info', 'GET', obj, function(data){
									if (!$.trim(data.responseText).length) return false;
									modal[obj.modalType].element.find('.customer-product').empty().append(data.responseText);
									UIkit.modal.confirm("상품을 선택하시면 빠른 문의가 가능합니다.<br/>상품을 선택하시겠어요?", function(){
										modal[obj.modalType].show();
									});
								});
							}
						}
					});
				});

				
				fileLoad = sandbox.getComponents('component_file', {context:$this}, function(){
					var _self = this;
					this.addEvent('error', function(msg){
						UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'warning'});
					});

					this.addEvent('upload', function(fileName, fileUrl){
						$fileInfo.empty().append(sandbox.utils.replaceTemplate(fileInfoTemplate, function(pattern){
							$this.find('.file-name').text(fileName);
							switch(pattern){
								case 'id' :
									return 0;
									break;
								case 'fileName' :
									return fileName;
									break;
								case 'fullUrl' :
									return fileUrl;
									break;
							}
						}));
					});
				});

				$('.window-modal').on('change','.i-radio > input',function(){
					$(this).closest('form').find('.button').trigger('click');
				});
				$('.window-modal').on('click','.button',function(){
					var $this = $(this).closest('form').find('.i-radio > input:checked'),
						$modalType = $this.closest('.window-modal').data('modalType');
					isOrderInquery = true;
					objOrderData = $this.data();
					if($this.attr('data-order-type') === 'products'){
						objOrderData.isInquery = false;
					}else if($this.attr('data-order-type') === 'orders'){
						objOrderData.isInquery = true;
					}
					$('.selection-product').empty().append(Handlebars.compile($('#inquery-order-item').html())(objOrderData));
					
					$(textComponent.getThis()).trigger('focusout');
					modal[$modalType].hide();
					return false;
				});

				$('.selection-product').on('click','a.remove',function(){
					$(this).closest('.product-item').remove();
					objOrderData = {};
					isOrderInquery = false;
					$(textComponent.getThis()).trigger('focusout');
				});

				$this.find('.submit-btn').click(function(e){
					if(!selectComponent[0].getValidateChk() || (!subInquiryEmpty && !selectComponent[1].getValidateChk()) || !textComponent.getValidateChk()) {
						e.preventDefault();
					}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-inquiry]',
					attrName:['data-module-inquiry', 'data-sub-inquiry'],
					moduleName:'module_inquiry',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			moduleConnect:function(){
				fileLoad.setToappUploadImage({
					fileName:arguments[0],
					fullUrl:arguments[1],
					result:(arguments[2] === '1') ? true : false
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';
	Core.register('module_wishlist', function(sandbox){

		var $this, modal;
		var Method = {
			moduleInit:function(){
				var miniCartModule = sandbox.getModule('module_minicart');
				$this = $(this);
				modal = UIkit.modal('#quickview-modal');
				$this.find('.wish-delete_btn').on('click', function(){
					var $that = $(this);
					UIkit.modal.confirm('위시리스트에서 삭제 하시겠습니까?', function(){
						setTimeout(function(){
							location.href = $that.attr('href');
						});
					});
					return false;
				});

				$this.find('.addtocart').each(function(i){
					var target = $(this).attr('data-target');
					var url = $(this).attr('data-href');

					$(this).click(function(e){
						e.preventDefault();

						Core.Utils.ajax(url, 'GET', {quickview:true}, function(data){
							var domObject = $(data.responseText).find('#quickview-wrap');

							if (domObject.length == 0) {
								UIkit.modal.alert('판매 중지된 상품입니다.');
							} else {
								//$(target).addClass('window-modal modal-quickview');
								$(target).find('.contents').empty().append(domObject[0].outerHTML);
								Core.moduleEventInjection(domObject[0].outerHTML);
								modal.show();
							}
						});

						/*sandbox.utils.ajax(url, 'POST', data, function(data){
							var jsonData = sandbox.rtnJson(data.responseText);
							if(jsonData.hasOwnProperty('error')){
								UIkit.notify(jsonData.error, {timeout:3000,pos:'top-center',status:'warning'});
							}else{
								//UIkit.notify('쇼핑백에 상품이 담겼습니다.', {timeout:3000,pos:'top-center',status:'success'});
								miniCartModule.update();
							}
						});*/
					});
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-wishlist]',
					attrName:'data-module-wishlist',
					moduleName:'module_wishlist',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_instagram_feed', function(sandbox){
		var $this, args;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];

				var url = 'https://api.instagram.com/v1/users/self/media/recent';  // 가입한 user의 feedData;
				var obj = {client_id:args.clientkey, access_token:args.token, count:args.count}
				var template = $(args.template).html();

				sandbox.utils.jsonp(url, obj, 'callback', function(data){
					var feedData = data.data;

					if(data.meta.hasOwnProperty('error_message')){
						UIkit.notify(data.meta.error_message, {timeout:3000,pos:'top-center',status:'error'});
						return
					}

					/* 인스타그램에서 보내주는 이미지 크기가 달라 thumbnail_high 를 따로 가공해서 넣어준다. */
					for(var i=0; i<feedData.length; i++){
						feedData[i]['images']['thumbnail_high'] = {
							width:320,
							height:320,
							url:feedData[i]['images']['thumbnail']['url'].replace('s150x150', 's320x320')
						}
					}

					var source = $(args.template).html();
					var template = Handlebars.compile(source);
					var bindingHtml = template({instagram:feedData});



					$this.append(bindingHtml);
					sandbox.moduleEventInjection(bindingHtml);
				}, true);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-instagram-feed]',
					attrName:'data-module-instagram-feed',
					moduleName:'module_instagram_feed',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				console.log('product destory');
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_endpoint', function(sandbox){
		var $this;
		var Method = {
			moduleInit:function(){
				$this = $(this);
			},

			call:function( status, data ){
				switch( status ){
					case "loadMoreProducts":

					break;

					// filter.js  
					case "applyFilter":
					break;

					case "quickView":
					break;

					case "addToCart":
					break;

					case "addToWishlist":
					break;

					case "pdpColorClick":
					break;

					case "pdpImageClick":
					break;

					case "pdpSizeGuideClick":
					break;

					case "pdpDeliveryGuideClick":
					break;

					// 검색어를 선택했을때 ( 직접 입력이 아닌 링크를 통한 검색시 )
					case "searchSuggestionClick":
					break;

					case "removeFromCart":
					break;

					case "removeAllFromCart":
					break;

					case "cartAddQuantity":
					break;

					case "applyPromoCode":
					break;

					case "newsletterSubscribed":
					break;

					case "newAccountCreated":
					break;

					case "login":
					break;

					case "logout":
					break;

					case "socialShareClick":
					break;

					case "addNewAddress":
					break;
				}
			}

		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[ data-module-endpoint]',
					attrName:'data-module-endpoint',
					moduleName:'module_endpoint',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_checkout', function(sandbox){
		var Method = {
			moduleInit:function(){
				var $this = $(this);

				// header
				$this.find('[data-order-tab] .header').on("mousedown", Method.updateOrderTab);

				var sumtit = "";
				$("#order-summary").find(".order-info").find(".tit").each(function(i){
					if(i>0) {
						sumtit += ",";
					}
					sumtit += $(this).text();
					//console.log(sumtit);
					$(".product-checkout").find(".preview").text(sumtit);
				});
			},

			updateOrderTab:function(e){
				e.preventDefault();
				var $icon = $(this).find('[class^="icon-toggle-"]');
				var $view = $(this).closest('.order-tab').find('.view');
				var $preview = $(this).find('.preview');

				if( $view.length > 0 ){
					$preview.toggleClass('uk-hidden');
					$icon.toggleClass('uk-hidden');
					$view.toggleClass('uk-hidden');
				}
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-checkout]',
					attrName:'data-module-checkout',
					moduleName:'module_checkout',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_category', function(sandbox){
		var $that;
		var arrViewLineClass=['uk-width-medium-1-3', 'uk-width-large-1-2', 'uk-width-large-1-3', 'uk-width-large-1-4', 'uk-width-large-1-5'];
		var Method = {
			$reszieEvent : 'orientationchange' in window ? 'orientationchange.flyout' : 'resize.flyout',
      $productTileClass : '.product-tile',
      $productWishClass : '.product-wish',
      $productImgClass : '.product-img',
      $productUrlClass : '.product-url',
      $wishActionClass : '.wish-action',
      $wishActive : 'set-active',
      $wishChange : 'set-changed',
      $wishSuccess : 'set-wish-success',
      $colorClass : '.swatch-color',
      $colorMore : 'data-swatch-count',
      $colorSeleted : 'selected',
      $lazyLoadInstance : null,
			moduleInit:function(){
        //Method.addEventWishAction();
        Method.imgLazyLoad();
        Method.addEventColorAction();
        Method.addEventMoreColor();

				$this = $(this);
				var $filterWrap = $this.find('.filter-wrapper');
				//uk-width-medium-1-3 uk-width-large-1-3
				//view Length 2:maxLen
				// $this.find('.select-view > button').click(function(e){
				// 	e.preventDefault();
				//
				// 	if(!$(this).hasClass('active')){
				// 		$(this).addClass('active').siblings().removeClass('active');
				// 		$this.find('[data-component-categoryitem]').parent()
				// 		.removeClass(arrViewLineClass.join(' '))
				// 		.addClass('uk-width-large-1-'+$(this).attr('data-value'));
				// 		$this.find('[data-component-categoryitem1]').parent()
				// 		.removeClass(arrViewLineClass.join(' '))
				// 		.addClass('uk-width-large-1-'+$(this).attr('data-value'));
				// 		$this.find('[data-component-categoryitem2]').parent()
				// 		.removeClass(arrViewLineClass.join(' '))
				// 		.addClass('uk-width-large-1-'+$(this).attr('data-value'));
				//
				// 		//category lineSize
				// 		sandbox.getModule('module_pagination').setLineSize($(this).attr('data-value'));
				// 	}
				// });
				//
				// $this.find('.filter-btn').click(function(e){
				// 	e.preventDefault();
				//
				// 	if($filterWrap.hasClass('pc-only')){
				// 		$filterWrap.removeClass('pc-only');
				// 	}else{
				// 		$filterWrap.addClass('pc-only');
				// 	}
				//
				// });
			},
      moreColorCount : function(){
        $('.swatch-list-color').each(function(){
          var el = $(this),
          morePrint = el.closest(Method.$productTileClass).find('[' + Method.$colorMore + ']'),
          boxSize = el.width(),
          hiddenColorSize = 0;
          el.find(Method.$colorClass).removeClass('hidden').each(function(){
            var color = $(this);
            if (boxSize < color.position().left + color.width()){
              color.addClass('hidden');
              hiddenColorSize++;
            } else {
              color.removeClass('hidden');
            }
          });
          if (hiddenColorSize){
            morePrint.removeClass('hidden').attr(Method.$colorMore, hiddenColorSize);
          } else {
            morePrint.addClass('hidden');
          }
        });
      },
      changeImage : function(tile, data){
        tile.find(Method.$productImgClass).each(function(eq){
          $(this).find('img').attr('src',data[eq]);
        });
      },
      addEventMoreColor : function(){
        $(window).on(Method.$reszieEvent + Method.$colorClass, function(){
          Method.moreColorCount();
        }).trigger(Method.$reszieEvent + Method.$colorClass);
      },
      removeEventMoreColor : function(){
        $(window).off(Method.$reszieEvent + Method.$colorClass);
      },
      addEventColorAction : function(){
        $(document).on('click' + Method.$colorClass, Method.$colorClass,function(){
          var anchor = $(this),
              data = anchor.data(),
              productTile = anchor.closest(Method.$productTileClass);

          if (productTile.length) {
            anchor.addClass(Method.$colorSeleted);
            anchor.siblings('.' + Method.$colorSeleted).removeClass(Method.$colorSeleted);
            productTile.find(Method.$productWishClass).data('productId',data.productId);
            productTile.find(Method.$productUrlClass).attr('href',anchor.attr('href'));
            Method.changeImage(productTile, data.productImage);
            return false;
          }
        }).on('mouseenter' + Method.$colorClass, Method.$colorClass,function(){
          var anchor = $(this),
              data = anchor.data(),
              productTile = anchor.closest(Method.$productTileClass);

          productTile.length && Method.changeImage(productTile, data.productImage);
        }).on('mouseleave' + Method.$colorClass, Method.$colorClass,function(){
          var anchor = $(this),
              productTile = anchor.closest(Method.$productTileClass),
              activeAnchor = productTile.find(Method.$colorClass + '.' + Method.$colorSeleted),
              activeData = activeAnchor.data();

          productTile.length && Method.changeImage(productTile, activeData.productImage);
        });
      },
      removeEventColorAction : function(){
        $(document).off('click' + Method.$colorClass, Method.$colorClass)
        .off('mouseenter' + Method.$colorClass, Method.$colorClass)
        .off('mouseleave' + Method.$colorClass, Method.$colorClass);
      },
      // addEventWishAction : function(){
      //   $(document).on('click' + Method.$wishActionClass, Method.$wishActionClass,function(){
      //     var el = $(this),
      //       action = el.data('wish-type'),
      //       product = el.closest(Method.$productTileClass),
      //       parent = product.find(Method.$productWishClass),
      //       tileMain = product.find('.product-tile-main');
      //     if (parent.hasClass(Method.$wishChange)) return false;
      //     parent.addClass(Method.$wishChange);
      //     el.removeClass(Method.$wishActive).siblings().addClass(Method.$wishActive);
      //     action == 'add' && tileMain.addClass(Method.$wishSuccess);
      //
      //     setTimeout(function(){
      //       parent.removeClass(Method.$wishChange);
      //       action == 'add' && (tileMain.removeClass(Method.$wishSuccess), window.headModule.addWish());
      //     },426);
      //     return false;
      //   });
      // },
      removeEventWishAction : function(){
        $(document).off('click' + Method.$wishActionClass, Method.$wishActionClass);
      },
      imgLazyLoad : function(){
        if (!LazyLoad) {
          return false;
        }
        Method.imgLazyInit();
        Method.lazyLoadInstance = new LazyLoad({
          elements_selector: '.lazy',
          class_loading: 'lazy-loading',
          callback_error:function(img){
            img = $(img);
            img.attr('src', img.data('error'));
          }
        });
        $(window).on(Method.$reszieEvent + '.lazy', function(){
            setTimeout(function(){
              Method.imgLazyInit();
              Method.lazyLoadInstance.update();
            });
        });
      },
      imgLazyInit : function(){
        var lazyImg = $('.lazy').not('.set-lazy');
        lazyImg.each(function(a,b){
          var img = $(this),
            src = img.attr('src');
            img.data('error',src).addClass('set-lazy');
        });
      }
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-category]',
					attrName:'data-module-category',
					moduleName:'module_category',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destory : function(){
        Method.removeEventWishAction();
        Method.removeEventColorAction();
        Method.removeEventMoreColor();
      }
		}
	});
})(Core);

(function(Core){
	Core.register('module_mobilegnb', function(sandbox){

		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var args = arguments[0];
				var clickIS = false;
				var isSearch = false;

				var $modile = $('#mobile-menu');
				$modile.find('.mobile-onedepth_list').on('click', '> a', function(e){
					if(!$(this).hasClass('link')){
						e.preventDefault();
						//$(this).siblings().show().stop().animate({'left':0}, 300);
					}
				});

				$modile.find('.location').on('click', function(e){
					e.preventDefault();
					$(this).parent().stop().animate({'left':-270}, 300, function(){
						$(this).css('left', 270).hide();
					});
				});

				$('.gnb-search-btn').click(function(e){
					e.preventDefault();
					$('.header-menu_etc > ul').css('display', 'block');
					$('.search-panel').css('display', 'block');
					$('.etc-search-wrap').addClass('active');
					$("label[for='search-header']").text('검색어를 입력해주세요.');
					$('body').append('<div class="dimed"></div>');
					$('.dimed').click(function(){
						$('.header-menu_etc > ul').css('display', 'none');
						$(this).remove();
					})
				});


				$modile.on('show.uk.offcanvas', function(event, area){
					Core.ga.pv('pageview', '/mobileMenu');
					//android 기본 브라우저에서 scroll down 시 메뉴 노출되지 않은 현상 때문에 clip css 삭제처리
					$('.uk-offcanvas-bar').removeAttr("style");
				});

				$modile.on('hide.uk.offcanvas', function(event, area){
					if(isSearch){
						sandbox.getModule('module_search').searchTrigger();
					}
					isSearch = false;
					$('.dimed').remove();
				});

				$modile.find('.mobile-lnb-search').on('click', function(e){
					e.preventDefault();
					isSearch = true;
					UIkit.offcanvas.hide();
				});

				//모바일에서 프로모션영역 제거
				$(this).find(".mobile-onedepth_list a span").each(function(index){
					if($(this).text() == "FEATURED" || $(this).text() == "BRAND") {
						$(this).closest("li").empty();
					}
				});

				//모바일에서 프로모션영역 제거
				$(this).find(".mobile-twodepth_list a span").each(function(index){
					if($(this).text() == "promoArea") {
						$(this).closest("li").empty();
					}
				});
			}
		}
		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-mobilegnb]',
					attrName:'data-module-mobilegnb',
					moduleName:'module_mobilegnb',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_cart', function(sandbox){
		var $this, endPoint;
		var Method = {
			moduleInit:function(){
				// modal layer UIkit 사용
				$this = $(this);
				var modal = UIkit.modal('#common-modal');
				endPoint = Core.getComponents('component_endpoint');

				var addonComponents = sandbox.getComponents('component_addon_option', {context:$this, optionTemplate:'#order-addon-sku-option'}, function(i){
					var _self = this;

					this.addEvent('submit', function(data){
						var $this = $(this);

						UIkit.modal.confirm('장바구니에 상품을 담으시겠습니까?', function(){
							var itemRequest = {};
							var addToCartItems = _self.getChildAddToCartItems();
							var keyName='';

							for(var i=0; i<addToCartItems.length; i++){
								keyName = 'childOrderItems[' + i + ']';
								for(var key in addToCartItems[i]){
									itemRequest['childAddToCartItems['+i+'].'+key] = addToCartItems[i][key];
								}
							}

							//애드온 orderId 알아야함
							itemRequest['addOnOrderId'] = _self.getAddOnOrderId();
							itemRequest['isAddOnOrderProduct'] = true;
							itemRequest['csrfToken'] = $this.closest('form').find('input[name=csrfToken]').val();

							BLC.ajax({
								url:$this.closest('form').attr('action'),
								type:"POST",
								dataType:"json",
								data:itemRequest
							}, function(data){
								if(data.error){
									UIkit.modal.alert(data.error);
								}else{
									location.href = sandbox.utils.url.getCurrentUrl();
								}
							});
						});
					});
				});


				//주문하기
				$(this).on('click', '.btn-order', function(e){
					e.preventDefault();
					var href = $(this).attr('href');
					sandbox.utils.promise({
						url:sandbox.utils.contextPath + '/cart/checkSkuInventory',
						type:'GET'
					}).then(function(data){
						if (data.error) {
							UIkit.modal.alert('품절된 상품을 장바구니에서 삭제 후 주문해주세요.');
						} else {
							endPoint.call('checkoutSubmit');
							if (_GLOBAL.DEVICE.IS_KAKAO_INAPP && !_GLOBAL.CUSTOMER.ISSIGNIN) {
								sandbox.getModule('module_kakao_in_app').submit('/checkout');
							} else {
								if(addonComponents){
									e.preventDefault();
									if(sandbox.utils.getValidateChk(addonComponents)){
										var isAddOnOrderNoChoice = $("input[name='isAddOnOrderNoChoice']").is(":checked");
										var param = "";
			
										if( isAddOnOrderNoChoice  == true ){
											param = "?isAddOnOrderNoChoice=true";
										}
			
										location.href = href + param;
									}
								}else{
									location.href = href;
								}
							}
						}
	
					})
					return false;
				});


				//옵션 변경
				$(this).on('click', '.optchange-btn', function(e){
					e.preventDefault();

					var target = $(this).attr('href');
					var $parent = $(this).closest('.product-opt_cart');
					var id = $parent.find('input[name=productId]').attr('value');
					var quantity = $parent.find('input[name=quantity]').attr('value');
					var url = $parent.find('input[name=producturl]').attr('value');
					var orderItemId = $parent.find('input[name=orderItemId]').attr('value');
					var obj = {'qty':quantity, 'orderitemid':orderItemId, 'quickview':false}

					$parent.find('[data-opt]').each(function(i){
						var opt = sandbox.rtnJson($(this).attr('data-opt'), true);
						for(var key in opt){
							obj[key] = opt[key];
						}
					});

					sandbox.utils.ajax(url, 'GET', obj, function(data){
						var domObject = $(data.responseText).find('#quickview-wrap');
						$(target).find('.contents').empty().append(domObject[0].outerHTML);
						$(target).find('#quickview-wrap').addClass('cart_opt_chg');
						$(target).addClass('cart_opt_chg window-modal modal-quickview');
						sandbox.moduleEventInjection(domObject[0].outerHTML);
						UIkit.modal($(target)).show();
					});
				});

				//옵션수량 변경
				quantity = sandbox.getComponents('component_cart_quantity', {context:$(this)}, function(i){
					var INDEX = i;
					this.addEvent('change', function(qty){
						for(var i=0;i<quantity.length;i++){
							if(i !== INDEX){
								quantity[i].setQuantity(qty);
							}
						}
						//Method.changeQuantity(this, qty);

						var $parent = $(this).parents('.product-opt_cart');
						var id = $parent.find('input[name=productId]').attr('value');
						var orderItemId = $parent.find('input[name=orderItemId]').attr('value');
						var quantityValue = $parent.find('input[name=quantity]').attr('value');
						//var sessionId = $parent.find('input[name=csrfToken]').val();
						var sessionId = $parent.find('input[name=csrfToken]').val();
						var obj = {'productId':id, 'orderItemId':orderItemId ,'quantity':qty, 'csrfToken':sessionId};
						var url = $(this).closest('form').attr('action');
						var method = $(this).closest('form').attr('method');

						$parent.parents('.cart-items').find('.cart-item').each(function(i){
							var parentId = $(this).find('input[name=parentId]').val();
							if(parentId == orderItemId){
								obj['childAddToCartItems[0].productId'] = $(this).find('input[name=productId]').attr('value');
								obj['childAddToCartItems[0].quantity'] = $(this).find('input[name=quantity]').attr('value');
							}
						});

						sandbox.utils.ajax(url, method, obj, function(data){
							var jsonData = sandbox.rtnJson(data.responseText, true);
							var url = sandbox.utils.url.removeParamFromURL( sandbox.utils.url.getCurrentUrl(), $(this).attr('name'));
							if(jsonData['result'] == false){
								//$.cookie('pageMsg', jsonData.error);
								UIkit.modal.alert('구매 가능 수량을 초과하였습니다.').on('hide.uk.modal', function() {
									window.location.assign(url);
								});
							}else{
								window.location.assign(url);
							}
						});
					});
				});


				//나중에 구매하기
				$(this).on('click', '.later-btn', function(e){
					e.preventDefault();

					$.cookie('pageMsg', $(this).attr('data-msg'));
					Method.addItem.call(this, {type:'later'});
				});

				//카트에 추가
				$(this).on('click', '.addcart-btn', function(e){
					e.preventDefault();

					$.cookie('pageMsg', $(this).attr('data-msg'));
					Method.addItem.call(this, {type:'addcart'});
				});

				//카트 삭제
				//$(this).on('click', '.trigger-remove', Method.removeItem );
				//마케팅데이터 전송을 위한 수정
				$(this).on('click', '.trigger-remove',  function(e){
					e.preventDefault();
					var model = $(this).parents("[data-product-item]").find("input[name='productModel']").val();
					var name = $(this).parents("[data-product-item]").find("[data-name]").data("name");
					var category = $(this).parents("[data-product-item]").find("[data-category]").data("category");
					Method.removeItem( $(this).attr('href'), model, name, category);
				});

				//카트 전체삭제
				//$(this).on('click', '.trigger-cart-clear', Method.removeAllItem );
				$(this).on('click', '.trigger-cart-clear',  function(e){
					e.preventDefault();
					var itemList = [];
					var $itemList = $(".cart-items").find("[data-product-item]");
					$.each( $itemList, function( index, data ){
						var $item = $(data);
						itemList.push({
							id : $item.find("[data-model]").data("model"),
							name : $item.find("[data-name]").data("name"),
							category : $item.find("[data-category]").data("category")
						});
					});

					Method.removeAllItem( $(this).attr('href'), itemList);
				});

				//페이지 상태 스크립트
				var pageMsg = $.cookie('pageMsg');
				if(pageMsg && pageMsg !== '' && pageMsg !== 'null'){
					$.cookie('pageMsg', null);
					UIkit.notify(pageMsg, {timeout:3000,pos:'top-center',status:'success'});
				}
			},
			addItem:function(opt){

				var $parent = $(this).closest('.product-opt_cart');
				var id = $parent.find('input[name=productId]').attr('value');
				var orderItemId = $parent.find('input[name=orderItemId]').attr('value');
				var quantity = $parent.find('input[name=quantity]').attr('value');
				var sessionId = $(this).siblings().filter('input[name=csrfToken]').val();
				var obj = {'productId':id, 'orderItemId':orderItemId ,'quantity':quantity, 'csrfToken':sessionId}
				var url = $(this).closest('form').attr('action');
				var method = $(this).closest('form').attr('method');

				$parent.find('[data-opt]').each(function(i){
					var opt = sandbox.rtnJson($(this).attr('data-opt'), true);
					for(var key in opt){
						obj['itemAttributes['+ $(this).attr('data-attribute-name') +']'] = opt[key];
					}
				});

				sandbox.utils.ajax(url, method, obj, function(data){
					var jsonData = sandbox.rtnJson(data.responseText, true) || {};
					var url = sandbox.utils.url.removeParamFromURL( sandbox.utils.url.getCurrentUrl(), $(this).attr('name') );

					if(jsonData.hasOwnProperty('error')){
						$.cookie('pageMsg', jsonData.error);
					}
					window.location.assign(url);
				});
			},
			removeItem:function( url, model, name, category ){
				UIkit.modal.confirm('삭제하시겠습니까?', function(){
					Core.Loading.show();
					var param = sandbox.utils.url.getQueryStringParams( url );

					param.model = model;
					param.name = name;
					param.category = category;
					endPoint.call( 'removeFromCart', param );
					
					_.delay(function(){
						window.location.href = url;
					}, 1000);
				}, function(){},
				{
					labels: {'Ok': '확인', 'Cancel': '취소'}
				});
			},
			removeAllItem:function(url, itemList){
				UIkit.modal.confirm('장바구니를 비우시겠습니까?', function(){
					Core.Loading.show();
					sandbox.utils.promise({
						url:url,
						type:'GET'
					}).then(function(data){
						var param = sandbox.utils.url.getQueryStringParams( url );
						param.itemList = itemList;

						endPoint.call( 'removeAllFromCart', param );
						_.delay(function(){
							window.location.href = '/cart';
						}, 1000);
					}).fail(function(msg){
						sandbox.setLoadingBarState(false);
						UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
					});
				}, function(){},
				{
					labels: {'Ok': '확인', 'Cancel': '취소'}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-cart]',
					attrName:'data-module-cart',
					moduleName:'module_cart',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){

	Core.register('module_order', function(sandbox){
		var $this = null,
			$allCheck = null, 					// 팝업 전체 선택 체크박스
			$itemList = null, 					// 선택 해서 popup에 노출되는 아이템 리스트
			$itemListObj = null, 				// addon 이 제거된 아이템들
			$popModal = null, 					// 취소 팝업
			cancelOrderId = null, 				// 취소할 주문 id
			$popSubmitBtn = null, 				// 취소 submit 버튼
			$previewContainer = null, 			// 사용안함
			isAllFg = null, 					// 취소 선택시 모든 fulfilment가 취소 가능했는지 여부
			isAblePartialVoid = null, 			// 부분 취소 가능여부
			beforeSelectedOrder = null, 		// 사용안함
			$refundAccountInfo = null, 			//환불정보 입력 폼
			oldOrderUrl = null, 				//이전 사이트 주문 정보 URL
			args = null,
			objStore = {store:[]};

		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var args = arguments[0] || {};

				//modal init
				var modal = UIkit.modal('#order-cancel-modal', {center:false});
				// 오늘 날짜 location 대입
		        var today = new Date(),
		            yyyy = today.getFullYear(),
		            mm = today.getMonth() + 1,
		            dd = today.getDate();

		        if (dd < 10) dd = '0' + dd
		        else if (mm < 10) mm = '0' + mm
		        today = yyyy + mm + dd;

				//주문취소 시작
				//상점정보 가져오기
				var orderHistoryContainer = new Vue({
					el:'[data-vue-orderhistory]',
					data:objStore,
					created:function(){
						objStore['store'] = 1;
						sandbox.utils.promise({
							url:sandbox.utils.contextPath +'/processor/execute/store',
							method:'GET',
							data:{
								'mode':'template',
								'templatePath':'/page/partials/storeList',
								'isShowMapLocation':false,
							},
							isLoadingBar:false
						}).then(function(data){
							objStore['store'] = sandbox.utils.strToJson(data.replace(/&quot;/g, '"'));
						}).fail(function(data){
							UIkit.notify(data, {timeout:3000,pos:'top-center',status:'danger'});
						});
					},
					components:{
						'location':{
							props:['store']
						},
						'order-cencel-button':{
							props:['orderId', 'isJustReservation'],
							template:'<button class="anchor button button-small" v-on:click="orderCencel">{{rtnLabel}}</button>',
							computed:{
								rtnLabel:function(){
									return (this.isJustReservation) ? '예약취소' : '주문취소';
								}
							},
							methods:{
								orderCencel:function(e){
									e.preventDefault();
									var orderId = this.orderId;

									sandbox.utils.promise({
										url:sandbox.utils.contextPath + '/account/order/cancel/' + orderId,
										method:'GET'
									}).then(function(data){
										var defer = $.Deferred();
										$('#order-cancel-modal').find('.contents').empty().append(data);
										sandbox.moduleEventInjection(data, defer);
										modal.show();
										return defer.promise();
									}).then(function(data){
										UIkit.modal.alert("취소 되었습니다.").on('hide.uk.modal', function() {
											window.location.reload();
										});
									}).fail(function(error){
										if(error){
											UIkit.modal.alert(error).on('hide.uk.modal', function() {
												window.location.reload();
											});
										}else{
											window.location.reload();
										}
									});
								}
							}
						}
					},
					methods:{
						findLocation:function(locationId){
							try{
								for(var i=0; i<this.store.length; i++){
									if(this.store[i]['id'] == locationId){
										return this.store[i]['name'];
									}
								}
							}catch(e){
								console.log(e);
							}
						},
						shipType:function(locationId){
							try{
								var rtnState;
								if(locationId == '1'){
									rtnState = '온라인 물류센터';
								}else{
									rtnState = '매장';
								}
								return rtnState;

								// var rtnState = '온라인 물류센터';
								// for(var i=0; i<this.store.length; i++){
								// 	if(this.store[i]['id'] == locationId){
								// 		rtnState = this.store[i]['isDefault'] ? '온라인 물류센터':'매장';
								// 		break;
								// 	}
								// }
								return rtnState;
							}catch(e){
								console.log(e);
							}
						}
					}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-order]',
					attrName:'data-module-order',
					moduleName:'module_order',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_authenticate', function(sandbox){

		var customerListVue, args, $this, isDirectAuth, authData, customText, customerInfo = {isAuth:false, isSms:false, customers:[], authPhoneNum:null}, isConfirmed = false, sucCallback=null, failCallback=null, isTimerCounter=false;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];
				if( isDirectAuth == true ){
					Method.setDirectAuthType();
				}else{
					Method.setDefaultType();
				}

				// 최종 확인 버튼
				$this.find('.btn-use-search-member').off('click').on('click',function(e){
					if(isConfirmed){
						isConfirmed = false;
						if( sucCallback != null ){
							e.preventDefault();
							Method.callSuccessCallback();
						}
					}else{
						e.preventDefault();
						UIkit.modal.alert('OTP인증을 진행해주세요.');
					}
				});

				$this.find('[data-authenticate-test-btn]').off('click').on('click',function(e){
					e.preventDefault();
					Method.confirmSuccess();
				});

				$('#popup-layer-order-custom').on({
					'hide.uk.modal': function(){
						if( isDirectAuth == true ){
							sandbox.setLoadingBarState(true);
							location.reload();
							/*
							if( _.isFunction(customerListVue.$destroy)){
								customerListVue.$destroy();
							}
							*/
						}else{
							customerInfo.isAuth = false;
							customerInfo.isSms = false;
							customerInfo.customers = [];
							customerInfo.autoPhoneNum = null;
							isConfirmed = false;
							isTimerCounter = false;
						}
					}
				});
			},
			// 검색 없이 바로 인증 진행시
			setDirectAuthType:function(){
				$this.find('#customText').html( customText );

				if( authData == null ){
					UIkit.modal.alert('인증 정보가 올바르지 않습니다. 관리자에게 문의 하세요.').on('hide.uk.modal', function(){
						Method.callFailCallback();
					});
					return false;
				}

				customerInfo = {
					isAuth:true,
					isSms:false,
					customers:[{
						isSmsConfirm:false,
						time:null,
						isRequest:false,
						isOverTime:false,
					}],
					isAuthSuccess:false,
					authPhoneNum:null
				}

				customerListVue = new Vue({
					el:'#opt-direct-auth',
					data:customerInfo,
					watch:{

					},

					methods:{
						authSms:function(e){
							if( e ) e.preventDefault();
							var _self = this;
							var index = 0;
							customerInfo.isSms = true;

							/*
							isTimerCounter = true;
							customerInfo.customers[index]['isSmsConfirm'] = true;
							customerInfo.customers[index]['time'] = 120//parseInt(args.limitMin) * 60;
							_self.countdown(index, parseInt(120));
							return;
							*/

							// 여기가 진짜 처리 위에는 임시로 돌려놓은것
							sandbox.utils.promise({
								url:'/otp/request',
								method:'POST',
								data:authData
							}).then(function(data){
								//카운터 시작
								isTimerCounter = true;
								customerInfo.customers[index]['isOverTime'] = false;
								customerInfo.customers[index]['isSmsConfirm'] = true;
								customerInfo.customers[index]['time'] = parseInt(args.limitMin) * 60;
								_self.countdown(index, parseInt(args.limitMin) * 60);
							}).fail(function(msg){
								customerInfo.isSms = false;
								UIkit.modal.alert('고객정보를 찾을수 없습니다.').on('hide.uk.modal', function(){
									Method.callFailCallback();
								});
							});
						},
						authConfirm:function(e){
							e.preventDefault();
							//otp 인증 비동기 처리
							if(!isConfirmed){
								var _self = this;
								var index = e.target.getAttribute('data-index');
								var $form = $(e.target).closest('form');
								var data = sandbox.utils.getQueryParams($form.serialize());
								sandbox.utils.promise({
									url:'/otp/confirm',
									method:'POST',
									data:$.extend( data, authData )
								}).then(function(data){
									customerInfo.customers[index]['isOverTime'] = false;
									customerInfo.customers[index]['isSmsConfirm'] = false;
									_self.isAuthSuccess=true;
									Method.confirmSuccess();
								}).fail(function(data){
									UIkit.modal.alert(data.errors || '인증번호가 일치하지 않습니다. 다시 시도해 주세요.');
								});
							}else{
								UIkit.modal.alert('인증번호가 확인되었습니다. 확인을 클릭하여 다음단계를 진행해주세요.');
							}
						},
						countdown:function(index, time){
							/*
							console.log( 'index : ', index )
							console.log( 'time : ', time )
							console.log( 'isConfirmed : ', isConfirmed )
							console.log( 'isTimerCounter : ', isTimerCounter )
							*/
							var count = time;
							var _self = this;

							setTimeout(function(){
								if(!isTimerCounter) return;
								customerInfo.customers[index]['time'] = --count;
								if(count > 0 && !isConfirmed){
									_self.countdown(index, count);
								}else{
									customerInfo.customers[index]['isOverTime'] = true;
									customerInfo.customers[index]['time'] = null;
									customerInfo.customers[index]['isSmsConfirm'] = false;
									customerInfo.isSms = false;
								}
							}, 1000);
						}
					},
					created: function () {
						console.log( 'created' );
						this.$nextTick( function(){
							Core.moduleEventInjection($this.html());
						})
						this.authSms();
					}
				});
			},
			// 일반적인 검색 후 인증 사용시
			setDefaultType:function(){
				$this.find('[data-authenticate-btn]').click(function(e){
					e.preventDefault();
					//costomer 비동기 처리
					var $form = $(this).closest('form');
					var data = sandbox.utils.getQueryParams($form.serialize());
					customerInfo.authPhoneNum = data.identifier;
					sandbox.utils.ajax($form.attr('action'), 'POST', data, function(data){
						var customerData = sandbox.rtnJson(data.responseText);
						if(customerData.result){
							for(var i=0; i<customerData.customerList.length; i++){
								customerData['customerList'][i]['isSmsConfirm'] = false;
								customerData['customerList'][i]['time'] = null;
							}
						}
						customerInfo.isAuth = true;
						customerInfo.customers = (customerData.result) ? customerData.customerList : [];
					});
				});

				customerListVue = new Vue({
					el:'#custom-list',
					data:customerInfo,
					watch:{
						customers:function(){
							this.$nextTick(function(){
								UIkit.accordion('#accordion-wrap', {showfirst:false});
							});
						}
					},
					methods:{
						authSms:function(e){
							e.preventDefault();

							if(!isConfirmed && !customerInfo.isSms){
								var _self = this;
								var index = e.target.getAttribute('data-index');
								customerInfo.isSms = true;

								UIkit.modal.confirm(this.authPhoneNum + '로 OTP(인증번호)를 전송하시겠습니까?', function(){
									var $form = $(e.target).closest('form');
									var data = sandbox.utils.getQueryParams($form.serialize());
									data['userName'] = _self.customers[index]['username'];

									sandbox.utils.promise({
										url:$form.attr('action'),
										method:'POST',
										data:data
									}).then(function(data){
										//카운터 시작
										isTimerCounter = true;
										customerInfo.customers[index]['isSmsConfirm'] = true;
										customerInfo.customers[index]['time'] = parseInt(args.limitMin) * 60;
										_self.countdown(index, parseInt(args.limitMin) * 60);
									}).fail(function(msg){
										customerInfo.isSms = false;
										UIkit.modal.alert('고객정보를 찾을수 없습니다.').on('hide.uk.modal', function(){
											Method.callFailCallback();
										});
									});

								}, function(){
									customerInfo.isSms = false;
								}, {bgclose:false});
							}else{
								if(isConfirmed) UIkit.modal.alert('인증번호가 확인되었습니다. 확인을 클릭하여 다음단계를 진행해주세요.');
							}
						},
						authConfirm:function(e){
							e.preventDefault();
							//otp 인증 비동기 처리
							if(!isConfirmed){
								var _self = this;
								var index = e.target.getAttribute('data-index');
								var $form = $(e.target).closest('form');
								var data = sandbox.utils.getQueryParams($form.serialize());
								data['userName'] = _self.customers[index]['username'];

								sandbox.utils.promise({
									url:$form.attr('action'),
									method:'POST',
									data:data
								}).then(function(data){
									customerInfo.customers[index]['isSmsConfirm'] = false;
									Method.confirmSuccess();
								}).fail(function(data){
									UIkit.modal.alert(data.errors || '인증번호가 일치하지 않습니다. 다시 시도해 주세요.');
								});
							}else{
								UIkit.modal.alert('인증번호가 확인되었습니다. 확인을 클릭하여 다음단계를 진행해주세요.');
							}
						},
						countdown:function(index, time){
							var count = time;
							var _self = this;

							setTimeout(function(){
								if(!isTimerCounter) return;
								customerInfo.customers[index]['time'] = --count;
								if(count > 0 && !isConfirmed){
									_self.countdown(index, count);
								}else{
									customerInfo.customers[index]['time'] = null;
									customerInfo.customers[index]['isSmsConfirm'] = false;
									customerInfo.isSms = false;
								}
							}, 1000);
						}
					}
				});

				var tabComponent = sandbox.getComponents('component_tabs', {context:$this}, function(){
					this.addEvent('tabClick', function(index){
						$this.find('.authenticate-type').eq(index).addClass('active').siblings().removeClass('active');
					});
				});


			},
			callSuccessCallback:function(){
				if( sucCallback != null ){
					sucCallback.call();
				}
			},
			callFailCallback:function(){
				if( failCallback != null ){
					failCallback.call();
				}
			},
			confirmSuccess:function(){
				UIkit.modal.alert('인증번호가 확인되었습니다. 확인을 클릭하여 다음단계를 진행해주세요.');
				isConfirmed = true;
				$this.find('.btn-use-search-member.disabled').removeClass('disabled');
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-authenticate]',
					attrName:'data-module-authenticate',
					moduleName:'module_authenticate',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			customText:function( text ){
				customText = text;
				return this;
			},
			isDirectAuth:function(isDirect){
				isDirectAuth = isDirect || false;
				return this;
			},
			reset:function(otp){
				isDirectAuth = otp.isDirectAuth || false;
				customText = otp.customText || '';
				authData = otp.authData || null;
				this.init();
			},
			success:function( callback ){
				if( _.isFunction(callback)){
					sucCallback = callback;
				}
				return this;
			},
			fail:function( callback ){
				if( _.isFunction(callback)){
					failCallback = callback;
				}
				return this;
			}
		}
	});

	Vue.component('countdown', {
		props:['time'],
		template:'<span class="timer" v-if="time !== null">{{rtnTimer(Math.floor(time / 60 % 60))}}:{{rtnTimer(Math.floor(time % 60))}}</span>',
		methods:{
			rtnTimer:function(time){
				var numToString = time.toString();
				return (numToString.length > 1) ? numToString : '0' + numToString;
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_pagination', function(sandbox){
		var $this, args, currentPage, totalPageNum, totalPageCount, lineSize, pageSize, isHistoryBack = false, endPoint;

		var setSessionPaging = function(){
			sessionStorage.setItem('categoryPagingType', args.type);
			sessionStorage.setItem('categoryCurrentPage', currentPage + 1);
		}

		var Method = {
			moduleInit:function(){
				var sessionCurrentPage = sessionStorage.getItem('categoryCurrentPage');
				var sessionLineSize = sessionStorage.getItem('categoryLineSize');
				endPoint = Core.getComponents('component_endpoint');

				$this = $(this);
				args = arguments[0];
				currentPage = (sessionCurrentPage) ? sessionCurrentPage : args.currentPage;
				pageSize = Number(args.pageSize);
				totalPageNum = Math.ceil(args.totalCount / pageSize);
				lineSize = (sessionLineSize !== null) ? sessionLineSize : args.lineSize;

				switch(args.type){
					case 'more' :
						Method.typeMore();
						break;
					case 'scroll' :
						Method.typeScroll();
						break;
				}
			},
			getPaging:function(){
				return (args.totalCount > pageSize * currentPage && totalPageNum > currentPage) ? currentPage++ : null;
			},
			typeMore:function(){
				if(currentPage >= totalPageNum){
					$this.find('button, a').remove();
					return;
				}

				$this.find('button, a').click(function(e){
					e.preventDefault();

					var _self = this;
					if(Method.getPaging()){
						sandbox.utils.ajax(args.api, 'GET', {'page':currentPage, 'pageSize':pageSize, 'lineSize':lineSize}, function(data){
							$(args.target).append($(data.responseText).find(args.target)[0].innerHTML);
							sandbox.moduleEventInjection($(data.responseText).find(args.target)[0].innerHTML);
							$(window).trigger('resize');
							Method.setEndPoint( data );
							if(currentPage >= totalPageNum){
								$(_self).off('click');
								$(_self).remove();
							}

							setSessionPaging();
						});
					}
				});
			},
			typeScroll:function(){
				if(currentPage >= totalPageNum) return;
				var _self = this;
				var isFirst = true;
				var isLoaded = true;
				var prevScrollTop = 0;
				var contentsHeightPer = 0;
				var scrollController = sandbox.scrollController(window, document, function(percent){
					contentsHeightPer = this.getScrollTop($(args.target).offset().top + $(args.target).height());

					if(percent > contentsHeightPer && isLoaded && !isHistoryBack && this.getScrollPer() < percent && !isFirst){
						isLoaded = false;
						if(Method.getPaging()){
							sandbox.utils.ajax(args.api, 'GET', {'page':currentPage, 'pageSize':pageSize, 'lineSize':lineSize}, function(data){
								$(args.target).append($(data.responseText).find(args.target)[0].innerHTML);
								sandbox.moduleEventInjection($(data.responseText).find(args.target)[0].innerHTML);
								$(window).trigger('resize');
								Method.setEndPoint( data );
								if(currentPage >= totalPageNum){
									scrollController.destroy();
								}else{
									isLoaded = true;
									setSessionPaging();
								}
							});
						}
					}

					//새로고침, 히스토리백을 했을경우 돔오브젝트가 생성되지 못한 상황에서 스크롤의 위치가 최 하단으로 이동 하기 때문에
					//처음 로드 시점에서는 무조건 scroll 이벤트를 막는다.
					isFirst = false;

				}, 'pagination');
			},

			setEndPoint:function( data ){
				var $products = $(data.responseText).find('.categoryMarketingScript #products div');
				var itemList = [];
				$products.each(function(index, data){
					itemList.push({
						id : $(data).data("id"),
						name : $(data).data("name"),
						model : $(data).data('model'),
						category : $(data).data('category')
					});
				})
				// 로드한 정보를 기존 정보에 추가해야 할지? 우선은 이벤트쪽으로만 정보 전달
				endPoint.call('loadMoreProducts', {page : currentPage, pageSize: pageSize, lineSize: lineSize, itemList: itemList  })
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-pagination]',
					attrName:'data-module-pagination',
					moduleName:'module_pagination',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			setLineSize:function(size){
				lineSize = size;
				sessionStorage.setItem('categoryLineSize', lineSize);
			},
			getPagingType:function(){
				return args.type;
			},
			destroy:function(){
				if(args.type === 'scroll' && args.scrollContainer !== 'document') scrollArea.destroy();
			}
		}
	});
})(Core);

(function(Core){
	'use strict';
	Core.register('module_account_writelist', function(sandbox){
		var $this, modal, args;
		var Method = {
			moduleInit:function(){
				//main이고 리뷰쓸 상품이 있을경우
				var mainReviewOpenIS = false;
				var currentStarCount = null;

				args = arguments[0];
				$this = $(this);
				modal = UIkit.modal('#common-modal');
				modal.on({
					'show.uk.modal':function(){
						//console.log("Modal is visible.");
					},

					'hide.uk.modal':function(){
						$this.find('.contents').empty();
						$(currentStarCount).removeClass('active').siblings().removeClass('active');
					}
				});

				$this.on('click', '.btn-delete', function(e){
					e.preventDefault();

					if(mainReviewOpenIS){
						$this.find('.review-summary-group').fadeOut();
						$this.find('.review-write-wrap').stop().animate({width:375, height:190}, 300, function(){
							mainReviewOpenIS = false;
							$this.find('.review-main-msg').fadeIn();
							$('html').removeClass('uk-modal-page');
						});
					}else{
						$(args.target).remove();
					}
				});
				$this.on('click', '.review-open', function(e){
					e.preventDefault();

					$this.find('.review-main-msg').fadeOut();
					$this.find('.review-write-wrap').stop().animate({width:400, height:500}, 300, function(){
						mainReviewOpenIS = true;
						$this.find('.review-summary-group').fadeIn();
						$('html').addClass('uk-modal-page');
					});
				});

				//account reviewWrite rating-star count
				// $this.find('.rating-star').each(function(i){
				// 	var $this = $(this);
				// 	$this.find('a').click(function(e) {
				// 		e.preventDefault();
				//
				// 		var index = $(this).index() + 1;
				// 		var target = $(this).parent().attr('data-target');
				// 		var productId = $(this).parent().attr('data-productid');
				// 		var orderItemId = $(this).parent().attr('data-orderitemid')
				//
				// 		$(this).parent().children('a').removeClass('active');
				// 		$(this).addClass('active').prevAll('a').addClass('active');
				//
				// 		currentStarCount = this;
				// 		Method.reviewTask(target, productId, orderItemId, index);
				// 	});
				// });

				// 마이페이지 에서 리뷰 작성시
				$this.find('[data-review-submit]').on('click', function(){
					var target = $(this).parents('.product-tile-actions').data('target');
					var productId = $(this).parents('.product-tile-actions').data('productid');
					var orderItemId = $(this).parents('.product-tile-actions').data('orderitemid');

					console.log(target,productId, orderItemId);
					Method.reviewTask(target, productId, orderItemId);
				});
			},


			reviewTask:function(target, productId, orderItemId){
				var defer = $.Deferred();

				sandbox.utils.promise({
					url:sandbox.utils.contextPath + '/review/reviewWriteCheck',
					type:'GET',
					data:{'productId':productId, 'orderItemId':orderItemId}
				}).then(function(data){
					//data.expect 기대평
					//data.review 구매평
					if(data.expect || data.review){
						return sandbox.utils.promise({
							url:sandbox.utils.contextPath + '/review/write',
							type:'GET',
							data:{'productId':productId, 'redirectUrl':location.pathname, 'isPurchased':data.review, 'orderItemId':orderItemId}
						});
					}else{
						$.Deferred().reject('리뷰를 작성할 수 없습니다.');
					}

				}).then(function(data){
					modal.show();

					$(target).addClass('window-modal modal-reviews-submit');
					$(target).find('.contents').empty().append(data);
					sandbox.moduleEventInjection(data, defer);
					return defer.promise();
				}).then(function(data){
					Method.reviewProcessorController();
					modal.hide();
				}).fail(function(msg){
					//console.log('write fail');
					defer = null;
					UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
				});
			},
			reviewProcessorController:function(){
				var arrData = [];
				var obj = {
					'mode':'template',
					'templatePath':'/modules/myReviewWriteList',
					'resultVar':'review',
					'reviewType':'writeList',
					'_sort':'id',
					'_type_sort':'desc',
					'reviewLocation':'account'
				}

				sandbox.utils.ajax(args.api, 'GET', obj, function(data){
					location.reload();
					/*
					$(args.target).empty().append(data.responseText);
					sandbox.moduleEventInjection(data.responseText);
					*/
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-account-writelist]',
					attrName:'data-module-account-writelist',
					moduleName:'module_account_writelist',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_pickup_product', function(sandbox){
		var $this, $deferred;
		var setStoreListTemplate = function(data, qty){

			$this.find('.store-list').empty().append(
				Handlebars.compile($("#store-list").html())({
					result:(data.length>0)?true:false,
					list:data,
					locationQuantity:qty
				})
			);
		}
		var Method = {
			moduleInit:function(){
				$this = $(this);
				//해당 skuPricing에서 넘어온 locationQuantity 값을 가지고 스토어 리스트를 불러온다.
				//var arrStoreList=[{151:1},{151:4},{151:26},{151:3},{151:65}];
				var itemRequest = sandbox.getModule('module_product').getItemRequest();
				var locationQuantity = sandbox.getModule('module_product').getSkuData().locationQuantity;
				var arrStoreList = [];
				var currentDate = new Date();
				var disabledDays = [];
				var defer = $.Deferred();

				for(var key in locationQuantity){
					arrStoreList.push(key);
				}

				sandbox.utils.promise({
					url:sandbox.utils.contextPath + '/processor/execute/store',
					type:'GET',
					data:{
						'mode':'template',
						'templatePath':'/page/partials/storeList',
						'storeId':arrStoreList.join(','),
						'resultVar':'stores',
						'cache':new Date().getTime()
					}
				}).then(function(data){
					var data = sandbox.utils.strToJson(data.replace(/&quot;/g, '"'));
					data.forEach(function(a,b,c){
						a['quantity'] = locationQuantity[a.id]
					});

					var mapComponent = sandbox.getComponents('component_map', {context:$this, storeList:data});
					var searchComponent = sandbox.getComponents('component_searchfield', {context:$this}, function(){
						this.addEvent('searchKeyword', function(e, keyword){
							var pattern = keyword + '[a-z0-9A-Z가-힣]*';
							var regex = new RegExp(pattern);
							var result = [];

							for(var i=0; i<data.length; i++){
								if(regex.test(data[i].address1) || regex.test(data[i].address2) || regex.test(data[i].city)|| regex.test(data[i].name)|| regex.test(data[i].state)){
									result.push(data[i]);
								}
							}

							setStoreListTemplate(result);
							mapComponent.reInit(result);
						});
					});

					setStoreListTemplate(data);
					$(document).off().on('click', '.location-btn', function(e){
						e.preventDefault();
						mapComponent.mapEvent($(this).closest('.shipping-list').index());
					});
					$this.off().on('click', '.reservation-apply', function(e){
						e.preventDefault();

						var index = $(this).closest('.shipping-list').index();
						itemRequest['fulfillmentLocationId'] = data[index].id;
						disabledDays = data[index].holidayClosedDates;

						$this.find('.datepicker').datepicker('refresh');
						$this.find('.datepicker-wrap').addClass('active');
						$this.find('.dim').addClass('active');
					});
				}).fail(function(msg){
					defer = null;
					UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
				});

				$this.find('.confirm-btn').addClass('disabled').off().on('click', function(e){
					e.preventDefault();
					if(!$(this).hasClass('disabled')){
						$deferred.resolve(itemRequest);
					}
				});

				$this.find('.cancel-btn').off().on('click', function(e){
					e.preventDefault();
					$deferred.reject();
				});

				//datapicker
				$this.find('.datepicker').datepicker({
					dateFormat: "yy-mm-dd",
					minDate:new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate()),
					maxDate:'+20D',
					onSelect:function(date){
						itemRequest['reservedDate'] = date;
						$this.find('.timepicker').focus();

					},
					beforeShowDay:function(date){
						var string = jQuery.datepicker.formatDate('yy-mm-dd', date);
						return [ disabledDays.indexOf(string) == -1 ];
					}
				});

				//timepicker
				$this.find('.timepicker').focusout(function(e){
					var _self = $(this);
					setTimeout(function(){
						var time = _self.val();
						itemRequest['reservedDate'] += ' ' + time + ':00';
						$this.find('.datepicker-wrap').removeClass('active');
						$this.find('.dim').removeClass('active');
						$this.find('.confirm-btn').removeClass('disabled');
					},200);
				});

				//dim click addEvent
				$this.find('.dim').off().on('click', function(e){
					$(this).removeClass('active').parent().removeClass('active');
				});

			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-pickup-product]',
					attrName:'data-module-pickup-product',
					moduleName:'module_pickup_product',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			setDeferred:function(defer){
				$deferred = defer;
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_checkout_address_review', function(sandbox){
		var $this, args;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];

				sandbox.utils.ajax(sandbox.utils.contextPath + '/checkout/orderRegeneration', 'GET', {}, function(data){
					var data = sandbox.rtnJson(data.responseText);
					if(!data['result']){
						UIkit.modal.alert(data['errorMsg']).on('hide.uk.modal', function() {
							location.href = sandbox.utils.contextPath + '/cart';
						});
					}
				}, false, true);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-checkout-address-review]',
					attrName:'data-module-checkout-address-review',
					moduleName:'module_checkout_address_review',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				console.log('module_checkuot_address_review destory');
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_qna_product', function(sandbox){
		var $this, $writeBtn, modal, textarea, args;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				$writeBtn = $this.find('.qna-write');
				modal = UIkit.modal('#common-modal');
				args = arguments[0];

				$writeBtn.click(function(e){
					e.preventDefault();

					sandbox.getModule('module_header').setLogin(function(){
						var url = $(this).attr('href');
						var param = sandbox.utils.getQueryParams(url);
						sandbox.utils.ajax(url, 'GET', {}, function(data){
							var responseText = data.responseText;
							$('#common-modal').find('.contents').empty().append(responseText);
							modal.show();
						});
					});
				});

				sandbox.getComponents('component_textarea', {context:$this}, function(){
					var _this = this;
					_this.getThis().closest('form').submit(function(e){
						e.preventDefault();

						if(sandbox.getModule('module_header').getIsSignIn()){
							if(!_this.getValidateChk()){
								UIkit.notify(args.errMsg, {timeout:3000,pos:'top-center',status:'danger'});
							}else{
								var param = $(this).serialize();
								sandbox.utils.ajax($(this).attr('action'), $(this).attr('method'), $(this).serialize(), function(data){
									if(data.readyState === 4 && data.status === 200 && data.statusText === 'success'){
										location.reload();
									}else{
										UIkit.notify(args.errMsg, {timeout:3000,pos:'top-center',status:'danger'});
									}
								});
							}
						}else{
							sandbox.getModule('module_header').setLogin(function(data){
								if(data.isSignIn){
									location.reload();
								}
							});
						}
					});
				});

			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-qna-product]',
					attrName:'data-module-qna-product',
					moduleName:'module_qna_product',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	var marketingData = _GLOBAL.MARKETING_DATA();
	var isSetBase = false;
	var eventList = [];
	var useAa = marketingData.useAa;
	var traceType = "";
	var pageName = "";
	var pageType = "";
	var breadcrumb = "";
	var processorUrl = "/processor/execute/adobe_enhanced_ec";

	function isValid() {
		return useAa;
	}
	function updateMarketingData(){
		marketingData = _GLOBAL.MARKETING_DATA();
	}
	function pv(){
		if( isValid()){
			traceType = "default";
			pageName = marketingData.pathName.split('/');
			pageType = marketingData.pageType;
			breadcrumb = marketingData.pathName;
			var newAcount = false;
			var newLogin = false;

			if( marketingData.pathName.length == 1 ){
				pageName = pageName[0];
			}else{
				pageName = pageName[ pageName.length - 1 ];
			}

			if( marketingData.pageType == 'home' ){
				pageName = 'Home';
				breadcrumb = 'Home';
			}

			if( marketingData.pageType == 'registerSuccess'){
				//newAcount = true;
				traceType = 'createAccount';
				setEventData( 'newAccountCreated', {});
			}

			var param = getPageData( traceType, pageName, pageType, breadcrumb, newAcount, newLogin );
			processor( param );
		}
	}
	function commerce( type ){
		updateMarketingData();
		var param = {};

		switch( type ){
			case 'category' :
				if( marketingData.categoryInfo == null ){
					return;
				}
				var categoryInfo = marketingData.categoryInfo;
				var itemList = marketingData.itemList;

				if( categoryInfo.paging == null ){
					return;
				}

				if( itemList != null ){
					var productIds = $.map(itemList, function(item){ return item.id });
					param.productIds = String(productIds);
				}					

				traceType = 'plp';
				pageName = categoryInfo.name;
				pageType = 'plp';
				breadcrumb = getBreadcrumbData(categoryInfo.breadcrumbs);

				/*
				var page = categoryInfo.paging.page - 1;
				var pageSize = categoryInfo.paging.pageSize;
				param.categoryId = categoryInfo.id;
				param.limit = pageSize;
				param.offset = page * pageSize;
				param.url = marketingData.pathName;
				*/

				param.categoryId = categoryInfo.id;
				param.totalCount = categoryInfo.totalCount;
			break;

			case 'product' :
				if( marketingData.productInfo == null ){
					return;
				}
				var categoryInfo = marketingData.categoryInfo;
				var productInfo = marketingData.productInfo;

				traceType = 'pdp';
				pageName = productInfo.name;
				pageType = 'pdp';
				breadcrumb = getBreadcrumbData(categoryInfo.breadcrumbs);

				param.categoryId = categoryInfo.id;
				param.productIds = productInfo.id;
				param.url = marketingData.pathName;
				//param.colorName = productInfo.color;
				//param.url = breadcrumb;
			break;
			case 'search' :
				if( marketingData.searchInfo == null ){
					return;
				}

				var searchInfo = marketingData.searchInfo;
				var itemList = marketingData.itemList;


				traceType = 'searchResult';
				pageName = 'search result'; // productName을 노출해야 하는데
				pageType = 'search result';
				breadcrumb = 'Search';

				param.totalResultCount = searchInfo.totalCount;
				param.searchTerm = searchInfo.keyword;

				if( itemList != null ){
					var productIds = $.map(itemList, function(item){ return item.id });
					param.productIds = String(productIds);
				}

				if( productIds == "" ){
					param.productIds = "0";
					param.totalResultCount = 0;
					//return;
				}

			break;
			case 'cart' :
				traceType = 'cartView';
				pageName = 'Cart'
				pageType = 'cart';
				breadcrumb = 'Cart';
			break;

			case 'checkout' :
				// || _.isEmpty( checkoutInfo )
				if( marketingData.checkoutInfo == null ){
					return;
				}

				var checkoutInfo = marketingData.checkoutInfo;

				var step = checkoutInfo.step;
				if( step == "order" ){
					step = "billing";
				}
				step = step.charAt(0).toUpperCase() + step.slice(1);

				traceType = 'checkout';
				pageName = 'Checkout: ' + step;
				pageType = 'checkout';
				breadcrumb = 'Checkout';

				param.checkoutStepName = step;
			break;

			case 'confirmation' :
				traceType = 'orderConfirm';
				pageName = 'Checkout : Order Confirmation'
				pageType = 'order confirmation';
				breadcrumb = 'Checkout/Order confirmation';

				param.orderNumber = marketingData.orderNumber;
			break;
		}

		param = $.extend( param, getPageData( traceType, pageName, pageType, breadcrumb ));
		processor( param );
	}

	function getPageData(traceType, name, type, breadcrumb, newAcount, newLogin, errorCode ){
		var page = {};
		page.traceType = traceType;
		page.pageName = name;
		page.pageType = type;

		if( breadcrumb != null ){
			page.breadcrumb = breadcrumb;
		}

		if( type == 'error' && errorCode != null){
			page.errorCode = errorCode;
		}

		if( newAcount == true ){
			page.newAccountCreated = true;
		}

		if( newLogin == true ){
			page.newLogin = true;
		}

		return page;
	}
	// 포멧에 맞도록 카테고리 정보 재정의
	function getCategoryData( str, breadcrumb, totalCount ){

		var pattern = /\"category\":{.+\"page\"/;

		var category = {};
		var categoryList = breadcrumb.split("/");

		$.each( categoryList, function( index, data ){
			if( index == 0 ){
				category.primaryCategory = data;
			}else{
				category['subCategory'+ index ] = data;
			}
		});

		if( totalCount != null){
			category.totalResultCount = totalCount;
		}

		var result = String(str).replace(pattern, '"category":'+ JSON.stringify(category) +'},"page"' );	

		return result;
	}
	function getBreadcrumbData( breadcrumb ){
		if( breadcrumb != '' ){
			var breadcrumbList = String(breadcrumb).split('||');
			breadcrumbList = _.without( breadcrumbList, 'home', 'Home', 'HOME').join('/');
			return String(breadcrumbList);
		}
		return '';
	}
	function processor( param, sc ){
		//console.log( param );
		Core.Utils.ajax(processorUrl, 'GET', param, function(data){
			//console.log( data );
			printScript( data, param );
		}, true, true, 100, sc );
	}

	function addEvent(){
		var endPoint = Core.getComponents('component_endpoint');

		endPoint.addEvent('loadMoreProducts', function( data ){
			//console.log( data );

			updateMarketingData();
			if( marketingData.categoryInfo == null && marketingData.searchInfo == null ){
				return;
			}
			
			var itemList = data.itemList;	
			var param = {};
			var categoryInfo = {};

			if( itemList  != null ){
				var productIds = $.map(itemList, function(item){ return item.id });
				param.productIds = String(productIds);
			}

			if( marketingData.categoryInfo != null ){
				categoryInfo = marketingData.categoryInfo;
				param.categoryId = categoryInfo.id;
				param.traceType = "plpMore";
			}


			if( marketingData.searchInfo != null ){
				param.traceType = "plpMore";
			}
			
			/*
			var page = data.page - 1;
			var pageSize = data.pageSize;


			param.limit = pageSize;
			param.offset = page * pageSize;
			*/

			processor( param );
		});
		endPoint.addEvent('applyFilter', function( data ){
			//console.log( data );
			/*
			digitalData.eventData = {
				filterCategory : data.key,
				filterOption : data.value
			}
			digitalData.event = 'applyFilter';
			
			var param = {
				traceType : "search",
				filter : 'Y',
				filterCategory : data.key,
				filterOption : data.value
			}
			processor( param );
			*/

			setEventData("applyFilter", { filterCategory : data.key, filterOption : decodeURIComponent(data.value)});
			
		});
		endPoint.addEvent('quickView', function( data ){
			//console.log( data );

			var param = {
				traceType : "search",
				quickview : "Y",
				productIds : data.product.id
			}
			processor( param );
		});
		endPoint.addEvent('addToCart', function( data ){

			var param = {
				traceType : 'addToCart',
				cartType : 'add to cart',
				skuIds : data.skuId,
				quantities : data.quantity
			}
			processor( param );

		});
		endPoint.addEvent('buyNow', function( data ){
			//console.log( data );

			var param = {
				traceType : "addToCart",
				cartType : 'buy now',
				skuIds : data.skuId,
				quantities : data.quantity
			}
			processor( param );
		});
		endPoint.addEvent('addToWishlist', function( data ){
			//console.log( data );
		});
		endPoint.addEvent('pdpColorClick', function( data ){
			console.log( data );
			/*
			var param = {
				traceType : "colorClick",
				colorName : data.color
			}
			processor( param );
			
			var digitalData = digitalData || {};
			
			digitalData.eventData = {
				colorName : data.color
			}
			digitalData.event = 'pdpColorClick';
			*/

			setEventData("pdpColorClick", { colorName : data.color });
		});
		endPoint.addEvent('pdpImageClick', function( data ){
			//console.log( data );
			/*
			var param = {
				traceType : "imgClick"
			}
			processor( param );
			*/
			//digitalData.event = 'pdpImageClick';

			setEventData("pdpImageClick", {});

		});
		endPoint.addEvent('pdpSizeGuideClick', function( data ){
			//console.log( data );
			/*
			var param = {
				traceType : "sizeGuide"
			}
			processor( param );
			*/
			setEventData("pdpSizeGuideClick", {});
		});
		endPoint.addEvent('searchSuggestionClick', function( data ){
			// 한글을 사용하면 안되는데 검색어가 한글이 많다.
			// 바로 리다이텍트 걸려서 타이밍이 나올지 확인
			//console.log( data );
			/*
			var param = {
				traceType : 'searchSuggest',
				searchTerm : data.key,
				searchSuggestionName : data.text
			}
			processor( param, false );
			*/
			var param = {
				searchResults : {
					searchTerm : data.key,
					searchSuggestionName : data.text
				}
			}
			setEventData("searchSuggestionClick", param );

		});
		endPoint.addEvent('removeFromCart', function( data ){

			var param = {
				traceType : "removeCart",
				itemIds : data.orderItemId
			}

			//processor( param, false );
			//임시로 ajax를 빼서 작업( async 때문에 )
			$.ajax({
				url : processorUrl, 
				type : 'GET',
				data : param,
				async : false,
				complete : function(data){
					printScript( data );
				}
			})
		});
		endPoint.addEvent('cartAddQuantity', function( data ){
			//console.log( data );
			var param = {
				traceType : 'addCartQuantity',
				skuIds : data.skuId,
				quantities : data.quantity
			}
			//processor( param );

			$.ajax({
				url : processorUrl, 
				type : 'GET',
				data : param,
				async : false,
				complete : function(data){
					printScript( data );
				}
			})

		});
		endPoint.addEvent('applyPromoCode', function( data ){
			console.log( data );
			//valid, invalid, expired
			//만료된 코드를 알수는 있지만 메시지 처리 된 상태로 전달되고 있어 공통으로 처리가 불가능해 우선은 두가지로만 처리
			var result = ( data.promoAdded == false ? 'invalid' : 'valid' );

			if( data.exceptionKey == 'Offer Has Expired' ){
				result = "expired";
			}
			/*
			var param = {
				traceType : 'applyPromoCode',
				result : result,
				code : data.promoCode
			}
			processor( param );

			*/
			var param = {
				promoCode : {
					result : result,
					code : data.promoCode
				}
			}
			setEventData("applyPromoCode", param );
		});
		endPoint.addEvent('newsletterSubscribed', function( data ){
			//console.log( data );
			/*
			var param = {
				traceType : "newsletter",
				location : marketingData.pathName
			}
			processor( param );
			*/
			setEventData("newsletterSubscribed", { newsletterSubscriptionLocation : marketingData.pathName } );
		});

		/*
		endPoint.addEvent('newAccountCreated', function( data ){
			//console.log( data );
			var param = {
				traceType : "createAccount"
			}
			processor( param );
		});
		*/
		endPoint.addEvent('login', function( data ){
			//console.log( data );
			//digitalData.event = 'newLogin';
			setEventData("newLogin", {} );
		});
		endPoint.addEvent('socialShareClick', function( data ){
			//console.log( data );
			/*
			var param = {
				traceType : "socialShareService",
				socialShareServiceName : data.service
			}
			
			processor( param );
			*/

			setEventData("socialShareClick", { socialShareServiceName : data.service } );
		});
		endPoint.addEvent('addNewAddress', function( data ){
			//console.log( data );
			/*
			var param = {
				traceType : "addNewAddress"
			}
			processor( param );
			*/
			setEventData("addNewAddress", {} );
		});
		endPoint.addEvent('productRecommendationClick', function( data ){
			var param = {
				product : [
					{
						id : data.productId,
						name : data.name
					}
				]
			}
			setEventData("productRecommendationClick", param );
		});
	}

	function isBaseData(){
		var digitalData = digitalData || {};
		return !_.isEmpty(digitalData);
	}

	function printScript( data, param ){
		//console.log( data.responseText );
		if( data.status == 200){
			try{
				isSetBase = true;
				var result = data.responseText;

				if( param != null ){
					// plp 시 전체 수 수정
					if( param.pageType == "plp" ){
						if( param.breadcrumb != null && param.breadcrumb != "" ){
							//var pattern = /{\"totalResultCount\":[0-9]+}/;
							//result = String(result).replace(pattern, '{"totalResultCount":'+ param.totalCount +'}' );
							result = getCategoryData( result, param.breadcrumb, param.totalCount );							
						}
					}

					if( param.pageType == "pdp"){

						if( param.breadcrumb != null && param.breadcrumb != "" ){

							/*
							var pattern = /\"category\":{.+\"page\"/;

							var category = {};
							var categoryList = param.breadcrumb.split("/");

							$.each( categoryList, function( index, data ){
								if( index == 0 ){
									category.primaryCategory = data;
								}else{
									category['subCategory'+ index ] = data;
								}
							});

							result = String(result).replace(pattern, '"category":'+ JSON.stringify(category) +'},"page"' );	
							*/
							result = getCategoryData( result, param.breadcrumb );
						}
						
					}
				}
				console.log(result);
				$("body").append( result );
			}catch(e){
				//console.log(e);
			}
			printEventData();
		}
	}

	function setEventData( event, data ){
		if( isSetBase ){
			digitalData.event = event;
			digitalData.eventData = data
		}else{
			eventList.push({
				event : event, 
				eventData : data
			})
		}
	}

	// ajax 통신이 끝나지 않은 상황에서 호출되는 경우가 있어 통신 이후 처리
	function printEventData(){
		if( eventList.length > 0 ){
			console.log( "남은거 있음");
			$.each( eventList, function( i, list ){
				console.log( list );
				digitalData.event = list.event;
				digitalData.eventData = list.eventData;
			})
		}
	}

	Core.aa = {
		// 함수를 구분짓는것이 큰 의미는 없지만 추후 형태의 변화가 있을것을 대비해서 구분
		init : function(){
			addEvent();	
		},
		pv : pv,
		commerce : commerce
		//addEvent : addEvent,
		//error : error
	}

})(Core);
(function(Core){
	Core.register('module_refund_account', function(sandbox){
		var serialize = function($form){
			//jquery에 있는 serialize가 한글을 escape 치리가 되어 처리 안되게 따로 만듬;
			var inputs = $form.find('input[type=hidden]');
			var queryParams = {};
			for(var i=0; i<inputs.length; i++){
				queryParams[inputs.eq(i).attr('name')] = inputs.eq(i).val();
			}
			return queryParams;
		}
		var Method = {
			$that:null,
			$popModal:null,
			$popSubmitBtn:null,
			$refundAccountInfo:null,
			moduleInit:function(){
				var $this = $(this);
				Method.$that = $this;
				Method.$popModal = UIkit.modal("#popup-refund-account");
				Method.$popSubmitBtn = Method.$popModal.find('[data-refund-account-submit]');
				Method.$refundAccountInfo = Method.$popModal.find('[data-refund-account-info]');

				// 환불 신청 팝업 open
				$this.find('[data-refund-account-btn]').on('click', function(e){
					e.preventDefault();
					Method.openRefundAccountPopup( $(this).closest('form') );
				});

				// 환불 신청 submit
				Method.$popSubmitBtn.on('click', Method.refundAccountSumit );
			},
			openRefundAccountPopup:function($form){
				/*var id = $form.closest('[data-order]').find('[name="id"]').val();
				var amount = $form.closest('[data-order]').find('[name="amount"]').val();*/
				var formData = serialize($form);

				if(formData.hasOwnProperty('account')){
					for(var key in formData){
						if(key === 'amount'){
							Method.$popModal.dialog.find('[data-total-amount]').find('.price').text(sandbox.utils.price(formData[key]));
						}else if(key === 'accountCode'){
							Method.$popModal.dialog.find('select[name="accountCode"]').val(formData[key]);
						}else{
							Method.$popModal.dialog.find('input[name="'+ key +'"]').val(formData[key]);
						}
					}

					sandbox.getComponents('component_textfield', {context:Method.$that}, function(i){
						//초기값에 따라 인풋라벨 초기화
						this.setValueLabel();
					});

					sandbox.getComponents('component_select', {context:Method.$that}, function(i){
						//초기값에 따라 셀랙트박스 리페인팅
						this.rePaintingSelect();
					});

					Method.$popModal.dialog.find('[data-refund-account-submit]').text('수정');
				}

				sandbox.moduleEventInjection(Method.$popModal.dialog.html());
				Method.$popModal.show();

				// 숨겨있는 내용은 init에 처리 되지 않아 show이후
				sandbox.validation.reset( Method.$refundAccountInfo.find('form'));
			},
			refundAccountSumit:function(e){
				e.preventDefault();
				var $refundAccountInfoForm = Method.$refundAccountInfo.find('form');
				sandbox.validation.validate( $refundAccountInfoForm );

				if( !sandbox.validation.isValid( $refundAccountInfoForm )){
					return;
				}

				//전체 form을 체크하여 체크된 아이템 처리
				UIkit.modal.confirm("환불을 요청 하시겠습니까?", function(){
					var accountName = $refundAccountInfoForm.find('[name="accountCode"] option:selected').text();
					$refundAccountInfoForm.find('[name="accountName"]').val(accountName);

					var url = $refundAccountInfoForm.attr('action');
					var method = $refundAccountInfoForm.attr('method');

					Core.Utils.ajax(url, method, $refundAccountInfoForm.serialize(), function(data){
					//Core.Utils.ajax(url + Method.cancelOrderId, "GET", "", function(data){
						var data = sandbox.rtnJson(data.responseText, true);
						var result = data['result'];
						if( result == true ){
							UIkit.modal.alert("환불 요청 되었습니다.").on('hide.uk.modal', function() {
								window.location.reload();
							});
						}else{
							UIkit.modal.alert(data['errorMsg']).on('hide.uk.modal', function() {
								window.location.reload();
							});
						}
					}, true);
				}, function(){},
				{
					labels: {'Ok': '확인', 'Cancel': '취소'}
				});

			}
		}
		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-refund-account]',
					attrName:'data-module-refund-account',
					moduleName:'module_refund_account',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_certification', function(sandbox){
		var args;
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var certificationYnModal = UIkit.modal('#certification-yn-modal', {center:true, bgclose:false, keyboard:false});
				//certificationYnModal.show();
				args = arguments[0];

				//이전페이지로 이동
				$this.find('#btn-go-back').on('click', function(){
					certificationYnModal.hide();
				});

				//인증화면으로 이동
				$this.find('#btn-go-certification').click(function(){
    	    window.crPop = window.open('/ipinKmcConfirmation/kmcRequest',"crPop","width=430, height=560, resizable=1, scrollbars=no, status=0, titlebar=0, toolbar=0, left=300, top=200","_blank");
    		});

				window.addEventListener( 'message', function( e ) {
          // e.data가 전달받은 메시지
          if(e.data == "isOverByAge"){
          	window.certificationYnModal.hide();
          }
	    	});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-certification]',
					attrName:'data-module-certification',
					moduleName:'module_certification',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_reservation_product', function(sandbox){
		var $this, $btn, args, serviceMenData={}, reservationData={}, arrInventoryList, itemRequest, confirmData, selectedProduct, hasLocalNo, needMakeMap, areaMap = new Map();

		var loadStore = function(){
			if(!serviceMenData.hasOwnProperty('goodsCode')) return;
			if(serviceMenData.hasOwnProperty('localNo')) hasLocalNo = true;

			if(serviceMenData['goodsCode'] !== selectedProduct){
				selectedProduct = serviceMenData['goodsCode'];
				needMakeMap = true;
			} else{
				needMakeMap = false;
			}

			if(needMakeMap){
				//새로운 상품 재고 검색 시 맵 초기화
				//상품(사이즈) 별로 맵을 만든다
				// var keys = areaMap.keys();
				areaMap.forEach(function(item, key, mapObj){
					areaMap.set(key, 0);
				});
				// for(var index = 0; keys.length > index; index++ ){
				// 	areaMap.set(keys[index], 0);
				// }
			}
			//serviceMenData['mode'] = 'template';
			//serviceMenData['templatePath'] = '/page/partials/reservedInventory';
			//serviceMenData['cache'] = new Date().getTime();

			sandbox.utils.promise({
				//url:'/processor/execute/reserved_inventory',
				url:sandbox.utils.contextPath + '/reservedInventory',
				type:'GET',
				cache:false,
				data:serviceMenData
			}).then(function(data){
				// 은정 배포 후 적용 라인
				var inventoryList = data; //sandbox.utils.strToJson(data.replace(/&quot;/g, '"'));

				arrInventoryList = [];
				//API 호출시 마다 매장 수량 결과가 다시 오기 때문에 기존의 값을 지운다.
				inventoryList.forEach(function(a,i){
				    if(a.quantity > 0){
						arrInventoryList.push(a);
						if(needMakeMap){
							//새로운 사이즈로 검색한 경우에만 만들어 준다.
							//지역별 매장 개수 표시를 위해 직접 센다.
							if(areaMap.has(a.state)){
								var agencyCnt = areaMap.get(a.state);
								if(agencyCnt !== undefined || agencyCnt !== null){
									areaMap.set(a.state, ++agencyCnt);
								}
							}
						}
						// console.log('list:', arrInventoryList);
					}
				});

				//Hide size-chart when inventory list exist.
				$this.find('.size-select-txt').text($this.find('.reservation-product-size.checked').attr('typename'));
				if($this.find('#reservation-size-title-area').hasClass('uk-active')){
					$this.find('#reservation-size-title-area').click();
				}
				if(hasLocalNo || arrInventoryList.length > 0){
					$this.find('.location-search').empty().append(
						Handlebars.compile($("#store-list").html())({
							result:(arrInventoryList.length > 0)?true:false,
							list:arrInventoryList
						})
					);
				} else {
					// $this.find('.location-search').empty().append('<div style="padding:30px 0; text-align:center;"><p style="padding-top:35px;lign-height:18px;color:#838383">매장에 수량이 없는 상품입니다.</p></div>');
				    $this.find('.location-search').empty().append('<div class="less-items uk-text-center"><i class="ns-alert color-less"></i><br />매장에 수량이 없는 상품입니다.</div>');
				}

				//목록이 만들어 진 후에 '매장명''수량'에 대해 온클릭 이벤트를 걸어 소트 기능을 붙일 수 있음
				//매장명으로 정렬
				$this.find('.shipping-header .store-name').on('click', function(){
					Method.sortAgencyList('store');
				});
				//수량으로 정렬
				$this.find('.shipping-header .prd-cnt').on('click', function(){
					Method.sortAgencyList('quantity');
				});
                //지역별 대리점 선택 창 닫기
				$this.find('.btn-location-code-close').on('click', function(){
					$this.find('.location-code-wrap').removeClass('active');
					$this.find('.dim').removeClass('active');
				});

				//대리점 목록을 업뎃한다.
				Method.updateAreaAgencyCnt();
			}).fail(function(msg){
				defer = null;
				UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
			});
		}

		var Method = {
			moduleInit:function(){
				args = arguments[0];
				$this = $(this);
				$btn = $this.find('.reservation-btn');

				var currentDate = new Date();
				var reservationModal = UIkit.modal('#reservation-modal', {center:true});
				var disabledDays = [];
				var skuData = sandbox.getComponents('component_product_option', {context:$(document)}).getDefaultSkuData(); //sandbox.utils.strToJson($(this.getThis()).find("[data-sku]").attr("data-sku"));
				
				var radioComponent = sandbox.getComponents('component_radio', {context:$this}, function(i){
					var _self=this;
					var INDEX = i;

					this.addEvent('change', function(val){
						switch(INDEX){
							case 0 :
								for(var i=0; i<skuData.length; i++){
									for(var j=0; j<skuData[i].selectedOptions.length; j++){
										if($(this).attr('data-id') == skuData[i].selectedOptions[j]){
											serviceMenData['goodsCode'] = escape(skuData[i].externalId);
											loadStore();
											return;
										}
									}
								}
								break;
							case 1 :
								serviceMenData['localNo'] = val;
								$this.find('.location').text(val);
								$this.find('.dim').removeClass('active');
								$this.find('.location-code-wrap').removeClass('active');
								loadStore();
								break;
						}
					});
				});

				//지역 브랜치 맵 생성, 도시이름(한글)이 key가 되고 개수가 value
				$this.find('[data-area-info]').each(function(){
					areaMap.set($(this).attr('id'), 0);
				});

				$this.on('click', '.location-select', function(e){
					e.preventDefault();
					$this.find('.location-code-wrap').addClass('active');
					$this.find('.dim').addClass('active');
				});

				$this.on('click', '.reservation-apply', function(e){
					e.preventDefault();
					var $form = $(this).closest('form');
					var INDEX = $(this).closest('.shipping-list').index();

					confirmData = {};

					$this.find('input[name=fulfillmentLocationId]').val($(this).attr('data-locationid'));
					itemRequest = BLC.serializeObject($form);
					//사이즈 정보 추가
					itemRequest.size = $this.find('.reservation-product-size.checked').attr('typename');
					//가격에 콤마 + 원 추가
					itemRequest.retailprice = sandbox.rtnPrice(itemRequest.retailprice);
					itemRequest.saleprice = sandbox.rtnPrice(itemRequest.saleprice);
					itemRequest.price = sandbox.rtnPrice(itemRequest.price);

					/* 예약주문 확인 */
					//전화번호 정보 추가
					var phoneNumber = itemRequest['phone'], tempPhone, formatPhone;
					if(phoneNumber.length == 0){
						formatPhone = '정보없음';
					} else if(phoneNumber.length > 10){
						tempPhone = phoneNumber.match(/^(\d{3})(\d{4})(\d{4})$/);
						formatPhone = tempPhone[1] + '-' + tempPhone[2] + '-' + tempPhone[3];
					}
          var isSignIn = (args.isSignIn === 'true')? true:false;
					confirmData.customer = {name:_GLOBAL.CUSTOMER.FIRSTNAME, phone:formatPhone, isSignIn:isSignIn}
					confirmData.storeInfo = arrInventoryList[INDEX];
					confirmData.product = itemRequest;
					disabledDays = arrInventoryList[INDEX].fulfillmentLocationCloseDates;

					// $this.find('.datepicker').datepicker('refresh');
					// $this.find('.datepicker-wrap').addClass('active');
					// $this.find('.dim').addClass('active');
					// $this.find('input[name=fulfillmentLocationId]').val($(this).attr('data-locationid'));

          //현재시간 확인
					var d = new Date(new Date().getTime());
					var date_format_str = d.getFullYear().toString()+"-"+((d.getMonth()+1).toString().length==2?(d.getMonth()+1).toString():"0"+(d.getMonth()+1).toString())+"-"+(d.getDate().toString().length==2?d.getDate().toString():"0"+d.getDate().toString())+" "+(d.getHours().toString().length==2?d.getHours().toString():"0"+d.getHours().toString())+":"+((parseInt(d.getMinutes()/5)*5).toString().length==2?(parseInt(d.getMinutes()/5)*5).toString():"0"+(parseInt(d.getMinutes()/5)*5).toString())+":00";
					confirmData['reservedDate'] = date_format_str;

					//확인화면으로 넘김
					var reservationConfirmTemplate = Handlebars.compile($("#store-confirm").html())(confirmData);
					$this.find('.reservation-confirm-wrap').empty().append(reservationConfirmTemplate);
					$this.find('.reservation-confirm-wrap').addClass('active');
					$this.find('input[name=reservedDate]').val(confirmData['reservedDate']);
					itemRequest['reservedDate'] = confirmData['reservedDate'];
				});

				$this.on('click', '.reservation-confirm-btn', function(e){
					e.preventDefault();
					var _self = this;
					sandbox.getModule('module_header').setModalHide(true).setLogin(function(){
						Method.requestReservation.call(_self);
					});
				});

				$this.on('click', '.cencel-btn', function(e){
					e.preventDefault();
					$this.find('.reservation-confirm-wrap').removeClass('active');
					$this.find('.datepicker').removeClass('active');
					$this.find('.dim').removeClass('active');
				});

				//datapicker
				$this.find('.datepicker').datepicker({
					dateFormat: "yy-mm-dd",
					minDate:new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate()),
					onSelect:function(date){
						confirmData['reservedDate'] = date;
						$this.find('.timepicker').focus();
					},
					beforeShowDay:function(date){
						var string = jQuery.datepicker.formatDate('yy-mm-dd', date);
						return [ disabledDays.indexOf(string) == -1 ];
					}
				});

				//timepicker
				$this.find('.timepicker').focusout(function(e){
					var _self = $(this);
					setTimeout(function(){
						var time = _self.val();
						confirmData['reservedDate'] += ' ' + time + ':00';
					},200);
				});

				$this.find('.btn-time-submit').click(function(e){
					e.preventDefault();

					if(!confirmData['reservedDate']){
						UIkit.notify('방문 날짜와 시간을 선택해 주세요.', {timeout:3000,pos:'top-center',status:'warning'});
						return;
					}

					$this.find('.datepicker-wrap').removeClass('active');
					$this.find('.dim').removeClass('active');

					var reservationConfirmTemplate = Handlebars.compile($("#store-confirm").html())(confirmData);
					$this.find('.reservation-confirm-wrap').empty().append(reservationConfirmTemplate);
					$this.find('.reservation-confirm-wrap').addClass('active');
					$this.find('input[name=reservedDate]').val(confirmData['reservedDate']);
					itemRequest['reservedDate'] = confirmData['reservedDate'];
				});

				//dim click addEvent
				$this.find('.dim').off().on('click', function(e){
					$this.find('.reservation-confirm-wrap').removeClass('active');
					$this.find('.datepicker').removeClass('active');
					$this.find('.dim').removeClass('active');
					$this.find('.location-code-wrap').removeClass('active');
				});
			},
			updateAreaAgencyCnt:function(){
				$this.find('[data-area-info]').each(function(){
					$this.find('#area-branch-cnt-' + $(this).attr('value')).text(areaMap.get($(this).attr('id')));
				});
			},
			sortAgencyList:function(key){
				// console.log('key:', key);
				if(arrInventoryList.length > 0){
					if(key==='store'){
						arrInventoryList.sort(function(a,b){
							return a.name < b.name ? -1 : a.name > b.name ? 1:0;
						});
					} else {
						//quantity
						arrInventoryList.sort(function(a,b){
							return b['quantity'] - a['quantity'];
						});
					}

					$this.find('.location-search').empty().append(
						Handlebars.compile($("#store-list").html())({
							result:(arrInventoryList.length > 0)?true:false,
							list:arrInventoryList
						})
					);

					//대리점 목록을 업뎃한다.
					Method.updateAreaAgencyCnt();
				}
			},
			requestReservation:function(){
				var $form = $(this).closest('form');
				itemRequest = BLC.serializeObject($form);

				/* 예약주문 필수값 처리 */
				// if(!itemRequest.reservedDate || itemRequest.reservedDate === ''){
				// 	UIkit.notify('방문 날짜/시간를 선택해주세요', {timeout:3000,pos:'top-center',status:'danger'});
				// 	return false;
				// }

				sandbox.setLoadingBarState(true);
				BLC.ajax({
					url:$form.attr('action'),
					type:"POST",
					dataType:"json",
					data:itemRequest
				},function(data){
					if(data.error){
						sandbox.setLoadingBarState(false);
						UIkit.modal.alert(data.error);
					}else{
						/*var reservationComplateTemplate = Handlebars.compile($("#store-complate").html())();
						$('#reservation-modal').find('.contents').empty().append(reservationComplateTemplate);*/
						_.delay(function(){
							window.location.assign( sandbox.utils.contextPath + '/checkout' );
						}, 300);
					}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-reservation-product]',
					attrName:'data-module-reservation-product',
					moduleName:'module_reservation_product',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

    Core.register('module_date_filter_draw', function(sandbox){
        var drawTypeValue = "";
        var Method = {

            $that:null,
            moduleInit:function(){
                var $this = $(this);
                Method.$that = $this;
                Method.$start = Method.$that.find('#start-date');
                Method.$end = Method.$that.find('#end-date');
                drawTypeValue = $this.find('[data-type-list] .active').attr('data-type');

                setTimeout(function(){
                    $this.find('.uk-accordion').css('height','auto');
                }, 100);

                $this.find('[data-type-list] a').on('click', function(){
                    drawTypeValue = $(this).attr('data-type');
                    var value = [];
                    var index = $this.find('[data-date-list] .active').parents('li').index();
                    // if(index < 0 ){
                    //     index = 2;
                    //     var value = 'M,-3'.split(',');
                    // }else{
                    var activeDate = $this.find('[data-date-list] .active');
                    if (activeDate.length) {
                        activeDate = activeDate.data('date').split(',');
                        value = [moment().add(activeDate[1], activeDate[0]).format('YYYYMMDD'), moment().format('YYYYMMDD')];
                    } else {
                        value = [moment(Method.$start.val()).format('YYYYMMDD'), moment(Method.$end.val()).format('YYYYMMDD')];
                    }
                    //}
                    Method.searchSubmit( value[0], value[1], index);
                });

                $this.find('[data-date-list] a').on('click', function(){
                    var value = $(this).data('date').split(',');
                    Method.searchSubmit( moment().add(value[1], value[0]).add(1, 'd').format('YYYYMMDD'), moment().format('YYYYMMDD'), $(this).parents('li').index());
                });

                $this.find('[data-search-btn]').on('click', function(){
                    if( Method.getValidateDateInput() ){

                        var today = new Date();   //오늘 날짜 가져오기
                        var dd = today.getDate();
                        var mm = today.getMonth()+1; //January is 0!
                        var yyyy = today.getFullYear();
                        if(dd < 10) {
                            dd='0'+dd
                        }
                        if(mm < 10) {
                            mm='0'+mm
                        }
                        var str_today = yyyy+'-' + mm+'-'+dd;
                        var start    = Method.$start.val().toString();
                        var end      = Method.$end.val().toString();
                        var date_chk = Method.dateDiff(moment(start, 'YYYY.MM.DD').format('YYYY-MM-DD'), str_today);  //2년 체크..

                        if(!date_chk){
                            UIkit.modal.alert( '조회기간은 최대 2년 이내로 자료가 조회 가능합니다.' );
                            return;
                        }

                        Method.searchSubmit( moment(start, 'YYYY.MM.DD').format('YYYYMMDD'), moment(end, 'YYYY.MM.DD').format('YYYYMMDD'), 'detail');

                    }else{
                        UIkit.modal.alert( '기간을 선택해 주세요!' );
                    }
                });


                // 초기화
                $this.find('[data-reset-btn]').on('click', Method.reset);

                // uikit datepicker module 적용
                $this.find('input.date').each( function(){
                    var dateinput = $(this);
                    if( !moment(dateinput.val(), 'YYYY.MM.DD').isValid() ){
                        dateinput.val('');
                    }
                    if( $.trim( dateinput.val() ) != ''){
                        dateinput.val( moment(dateinput.val(), 'YYYYMMDD').format('YYYY.MM.DD'));
                    }
                    var datepicker = UIkit.datepicker(dateinput, {
                        maxDate : true,
                        format : 'YYYY.MM.DD'
                    });

					switch (dateinput.attr('id')) {
						case Method.$start.attr('id') : Method.$start.ukdatepicker = datepicker;
						case Method.$end.attr('id') : Method.$end.ukdatepicker = datepicker;
                    }
                    
                    datepicker.on( 'hide.uk.datepicker', function(){
                        dateinput.trigger('focusout');
                        Method.updateDateInput();
                    })
                })
                Method.updateDateInput();
            },

            dateDiff:function(_date1, _date2) {
                var diffDate_1 = _date1 instanceof Date ? _date1 : new Date(_date1);
                var diffDate_2 = _date2 instanceof Date ? _date2 : new Date(_date2);

                diffDate_1 = new Date(diffDate_1.getFullYear(), diffDate_1.getMonth()+1, diffDate_1.getDate());
                diffDate_2 = new Date(diffDate_2.getFullYear(), diffDate_2.getMonth()+1, diffDate_2.getDate());

                var d = true;
                var diff = Math.abs(diffDate_2.getTime() - diffDate_1.getTime());
                diff = Math.ceil(diff / (1000 * 3600 * 24));

                if(diff > 730){
                    d = false;
                }
                return d;
            },
            // 앞보다 뒤쪽 날짜가 더 뒤면 두값을 서로 변경
            updateDateInput:function(){
				var format = 'YYYY.MM.DD';
				var today = moment().format(format);
				var start = String(Method.$start.val());
				var end = String(Method.$end.val());

                if( $.trim(start).length && $.trim(end).length ){
					var dateterm = [start, end];
					dateterm = dateterm.sort();
					start = dateterm[0];
					end = dateterm[1];
					Method.$start.val( start );
					Method.$end.val( end );
                }
				if ($.trim(end).length) {
					Method.$start.ukdatepicker.options.minDate = moment(end).subtract(6, 'M').add(1, 'd').format(format);
					Method.$start.ukdatepicker.options.maxDate = end;
					Method.$start.ukdatepicker.update();
				}

				if ($.trim(start).length) {
					var after = moment(start).add(6, 'M').subtract(1, 'd').format(format);
					Method.$end.ukdatepicker.options.minDate = start;
					Method.$end.ukdatepicker.options.maxDate = [today, after].sort()[0];
					Method.$end.ukdatepicker.update();
				}
				// 같다면
				//var isSame = moment(Method.$start.val()).isSame(Method.$end.val());
				// 작다면
				//var isBefore = moment(Method.$start.val()).isBefore(Method.$end.val());
				// 크다면
				/*
				var isAfter = startDate.isAfter(endDate);

				if( isAfter ){
					var temp = Method.$end.val();
					Method.$end.val( Method.$start.val() );
					Method.$start.val( temp );
				}
				*/
            },
            getValidateDateInput:function(){
                var start = String(Method.$start.val());
                var end = String(Method.$end.val());

                if( moment( start, 'YYYY.MM.DD' ).isValid() && moment( end, 'YYYY.MM.DD' ).isValid() ){
                    return true;
                }
                return false;
            },
            searchSubmit:function( start, end, type ){
                var url = sandbox.utils.url.getCurrentUrl();
                url = sandbox.utils.url.removeParamFromURL( url, 'drawType' );
                url = sandbox.utils.url.removeParamFromURL( url, 'dateType' );
                url = sandbox.utils.url.removeParamFromURL( url, 'page' );
                url = sandbox.utils.url.removeParamFromURL( url, 'stdDt' );
                url = sandbox.utils.url.removeParamFromURL( url, 'endDt' );

                // 전체 검색
                if(_.isUndefined( start )){
                    url = sandbox.utils.url.removeParamFromURL( url, 'stdDt' );
                    url = sandbox.utils.url.removeParamFromURL( url, 'endDt' );
                }else{
                    var opt = {
                        stdDt : start,
                        endDt : end,
                        dateType : type,
                        drawType : drawTypeValue
                    }
                    url = sandbox.utils.url.appendParamsToUrl( url, opt );
                }
                window.location.href = url;
            },
            reset:function(){
                Method.$start.val('').trigger('focusout');
                Method.$end.val('').trigger('focusout');
            }
        }
        return {
            init:function(){
                sandbox.uiInit({
                    selector:'[data-module-date-filter-draw]',
                    attrName:'data-module-date-filter-draw',
                    moduleName:'module_date_filter-draw',
                    handler:{context:this, method:Method.moduleInit}
                });
            }
        }
    });
})(Core);

(function(Core){
	Core.register('module_order_pickup', function(sandbox){
		var args;
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				args = arguments[0];

				//주문자 인풋 컴포넌트
				var inputComponent = sandbox.getComponents('component_textfield', {context:$this}, function(i){
					//노스페이스는 사용자 정보를 입력 및 체크하는 부분이 없으므로 자동으로 주문자 정보가 넣어지도록 수정
					var customerInfo = sandbox.getModule('module_order_customer').getOrderCustomerInfo();
					$this.find('#fullname').val(customerInfo.name).focusout();
					$this.find('#phonenumber').val(customerInfo.phoneNum).focusout();
				});

				//주문자와 동일
				var checkoutComponent = sandbox.getComponents('component_checkbox', {context:$this}, function(i){

					// //노스페이스는 사용자 정보를 입력 및 체크하는 부분이 없으므로 자동으로 주문자 정보가 넣어지도록 수정
					// var customerInfo = sandbox.getModule('module_order_customer').getOrderCustomerInfo();
					// $this.find('#fullname').val(customerInfo.name).focusout();
					// $this.find('#phonenumber').val(customerInfo.phoneNum).focusout();

					// this.addEvent('change', function(isChecked){
					// 	if(isChecked){
					// 		var customerInfo = sandbox.getModule('module_order_customer').getOrderCustomerInfo();
					// 		$this.find('#fullname').val(customerInfo.name).focusout();
					// 		$this.find('#phonenumber').val(customerInfo.phoneNum).focusout();
					// 	}else{
					// 		$this.find('#fullname').val('').focusout();
					// 		$this.find('#phonenumber').val('').focusout();
					// 	}
					// });
				});


				$this.find('[data-order-pickup-submit-btn]').click(function(e){
					if(!inputComponent[0].getValidateChk('errorLabel') || !inputComponent[1].getValidateChk('errorLabel')){
						e.preventDefault();
					}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-order-pickup]',
					attrName:'data-module-order-pickup',
					moduleName:'module_order_pickup',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_exchange_filter', function(sandbox){
		var Method = {
			$that:null,
			moduleInit:function(){
				var $this = $(this);
				Method.$that = $this;
				Method.$start = Method.$that.find('#start-date');
				Method.$end = Method.$that.find('#end-date');

				$this.find('[data-date-list] a').on('click', function(){
					var value = $(this).data('date').split(',');
					if( value != '' ){
						Method.searchSubmit( moment().add(value[1], value[0]).add(1, 'd').format('YYYYMMDD'), moment().format('YYYYMMDD'), 'type'+$(this).index() );
					}else{
						Method.searchSubmit();
					}
				});

				$this.find('[data-search-btn]').on('click', function(){
					if( Method.getValidateDateInput() ){
						var start = Method.$start.val().toString();
						var end = Method.$end.val().toString();
						Method.searchSubmit( moment(start, 'YYYY.MM.DD').format('YYYYMMDD'), moment(end, 'YYYY.MM.DD').format('YYYYMMDD'), 'detail' );
					}else{
						UIkit.modal.alert( '기간을 선택해 주세요' );
					}
				});

				// 초기화
				$this.find('[data-reset-btn]').on('click', Method.reset);

				// uikit datepicker module 적용
				$this.find('input[class="date"]').each( function(){
					if( !moment($(this).val(), 'YYYY.MM.DD').isValid() ){
						$(this).val('');
					}
					if( $.trim( $(this).val() ) != ''){
						$(this).val( moment($(this).val(), 'YYYYMMDD').format('YYYY.MM.DD'));
					}
					var datepicker = UIkit.datepicker($(this), {
						maxDate : true,
						format : 'YYYY.MM.DD'
					});

					datepicker.on( 'hide.uk.datepicker', function(){
						$(this).trigger('focusout');
						Method.updateDateInput();
					})
				})
			},

			// 앞보다 뒤쪽 날짜가 더 뒤면 두값을 서로 변경
			updateDateInput:function(){
				var start = String(Method.$start.val());
				var end = String(Method.$end.val());

				if( $.trim( start ) == '' || $.trim( end ) == ''  ){
					return;
				}

				var isAfter = moment(start, 'YYYY.MM.DD').isAfter(moment(end, 'YYYY.MM.DD'));

				if( isAfter ){
					var temp = Method.$end.val();
					Method.$end.val( Method.$start.val() );
					Method.$start.val( temp );
				}
			},
			getValidateDateInput:function(){
				var start = String(Method.$start.val());
				var end = String(Method.$end.val());

				if( moment( start, 'YYYY.MM.DD' ).isValid() && moment( end, 'YYYY.MM.DD' ).isValid() ){
					return true;
				}
				return false;
			},
			searchSubmit:function( start, end, type ){
				var url = sandbox.utils.url.getCurrentUrl();
				url = sandbox.utils.url.removeParamFromURL( url, 'dateType' );

				// 전체 검색
				if(_.isUndefined( start )){
					url = sandbox.utils.url.removeParamFromURL( url, 'stdDate' );
					url = sandbox.utils.url.removeParamFromURL( url, 'endDate' );
				}else{
					var opt = {
						stdDate : start,
						endDate : end,
						dateType : type
					}

					url = sandbox.utils.url.appendParamsToUrl( url, opt )
				}

				window.location.href = url;

			},
			reset:function(){
				Method.$start.val('').trigger('focusout');
				Method.$end.val('').trigger('focusout');
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-exchange-filter]',
					attrName:'data-module-exchange-filter',
					moduleName:'module_exchange_filter',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_dynamicform', function(sandbox){
		var $deferred = null, endPoint;
		var Method = {
			$that:null,
			$form:null,
			moduleInit:function(){
				$.extend(Method, arguments[0]);

				var $this = $(this);
				Method.$that = $this;
				endPoint = Core.getComponents('component_endpoint');

				Method.$form = $this.find("form");
				var $submitBtn = $this.find('button[type="submit"]');

				sandbox.getComponents('component_textfield', {context:$this}, function(){
					this.addEvent('enter', function(e){
						$submitBtn.trigger('click');
					});
				});

				var datepicker = UIkit.datepicker(Method.$form.find('[data-uk-datepicker]'), {"format" : "YYYYMMDD"});
				datepicker.on('hide.uk.datepicker', function(){
					if( $(this).val() != ''){
						$(this).keydown();
					}
					/*
					console.log( "A" );
					var $input = sandbox.getComponents('component_textfield', {context:$(this).closest(".uk-form-row")} );
					console.log( $input);
					$input.fireEvent('')
					console.log("hide");
					*/
				});
				var agreeArea = $('.col-agree-field');
				if (agreeArea.length){
					var totalAgree = agreeArea.find('.total-agree input'),
						inputAgree = agreeArea.find('input[type="checkbox"]').not(totalAgree);

					totalAgree.on('change', function(){
						var agree = $(this).is(':checked');
						inputAgree.prop('checked', agree);
					});
					inputAgree.on('change',function(){
						var agree = inputAgree.length;
						inputAgree.each(function(){
							$(this).is(':checked') && --agree;
						});
						totalAgree.prop('checked', !agree);
					});
				}
				/*
				$(".total-agree").on('change',function(val){
					var checkboxWarp = $(this).parents('.account-signup-field').find('.field-row');
					checkboxWarp.each(function(){
						$(this).find('label').trigger('click');
					});

				});
				*/
				$submitBtn.on("click", function(e){
					e.preventDefault();
					sandbox.validation.validate( Method.$form );
					if( sandbox.validation.isValid( Method.$form )){
						if ($this.find('input[name=checkTerms]').length > 0) {
                if(!$this.find('input[name=checkTerms]').parents('label').hasClass('checked')){
                   UIkit.modal.alert('(필수) 이용약관에 동의 해주세요.');
                   return;
                }
             }
             if ($this.find('input[name=privacy_AgreePolicy]').length > 0) {
                if(!$this.find('input[name=privacy_AgreePolicy]').parents('label').hasClass('checked')){
                   UIkit.modal.alert('(필수) 개인정보 수집 및 이용에 동의해주세요.');
                   return;
                }
            	}
						var msg = $(this).data('confirm-msg');
						var endPointType = $(this).data('endpoint-type');
						var endPointValue = $(this).data('endpoint-value');
						if( msg != null){
							UIkit.modal.confirm(msg, function(){
								if( endPointType != null ){
									endPoint.call( endPointType, endPointValue );
								}
								Method.submit();
							}, function(){},
							{
								labels: {'Ok': '확인', 'Cancel': '취소'}
							});
						}else{
							if( endPointType != null ){
								endPoint.call( endPointType, endPointValue );
								if(endPointValue == 'personal info'){

									var defaultValue = Method.$form[0][5].defaultValue; //기존 핸드폰번호
									var modifyValue = Method.$form.find('input#phone').val();
									var defaultChk_email = Method.$form[0][7].defaultChecked; // 기존 이메일 수신동의
									var modifyChk_email = Method.$form.find('input#receiveEmail').prop('checked');
									var defaultChk_sms = Method.$form[0][9].defaultChecked; //기존 sms 수신동의
									var modifyChk_sms = Method.$form.find('input[name="ATTRIBUTE@smsAgree"]').prop('checked');

									if(defaultValue == modifyValue && defaultChk_email == modifyChk_email && defaultChk_sms == modifyChk_sms){
										// UIkit.modal.alert('변경사항이 없습니다.', function(){
										// 	return false;
										// });
										Method.submit();
									}else{
										Method.submit();
									}
								}else {
									Method.submit();
								}
							}else{
								Method.submit();
							}
						}
					}
				});

				sandbox.validation.init( Method.$form );


				//ios AppView 일때 자동로그인 체크박스 숨김처리
				// var pattern = new RegExp(/iPhone/);
				// if(sandbox.utils.mobileChk && pattern.test(sandbox.utils.mobileDetect.ua)){
				// 	$this.find('input[name=breeze-me]').eq(0).closest('.input-form-group').css('display','none');
				// }
			},
			SHA256:function(s){

				var chrsz   = 8;
				var hexcase = 0;

				function safe_add (x, y) {
					var lsw = (x & 0xFFFF) + (y & 0xFFFF);
					var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
					return (msw << 16) | (lsw & 0xFFFF);
				}

				function S (X, n) { return ( X >>> n ) | (X << (32 - n)); }
				function R (X, n) { return ( X >>> n ); }
				function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }
				function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }
				function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }
				function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }
				function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }
				function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }

				function core_sha256 (m, l) {
					var K = new Array(0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5, 0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5, 0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3, 0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174, 0xE49B69C1, 0xEFBE4786, 0xFC19DC6, 0x240CA1CC, 0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA, 0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7, 0xC6E00BF3, 0xD5A79147, 0x6CA6351, 0x14292967, 0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13, 0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85, 0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3, 0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070, 0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5, 0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3, 0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208, 0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2);
					var HASH = new Array(0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19);
					var W = new Array(64);
					var a, b, c, d, e, f, g, h, i, j;
					var T1, T2;

					m[l >> 5] |= 0x80 << (24 - l % 32);
					m[((l + 64 >> 9) << 4) + 15] = l;

					for ( var i = 0; i<m.length; i+=16 ) {
						a = HASH[0];
						b = HASH[1];
						c = HASH[2];
						d = HASH[3];
						e = HASH[4];
						f = HASH[5];
						g = HASH[6];
						h = HASH[7];

						for ( var j = 0; j<64; j++) {
							if (j < 16){W[j] = m[j + i];} else {W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);}

							T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);
							T2 = safe_add(Sigma0256(a), Maj(a, b, c));

							h = g;
							g = f;
							f = e;
							e = safe_add(d, T1);
							d = c;
							c = b;
							b = a;
							a = safe_add(T1, T2);
						}

						HASH[0] = safe_add(a, HASH[0]);
						HASH[1] = safe_add(b, HASH[1]);
						HASH[2] = safe_add(c, HASH[2]);
						HASH[3] = safe_add(d, HASH[3]);
						HASH[4] = safe_add(e, HASH[4]);
						HASH[5] = safe_add(f, HASH[5]);
						HASH[6] = safe_add(g, HASH[6]);
						HASH[7] = safe_add(h, HASH[7]);
					}
					return HASH;
				}

				function str2binb (str) {
					var bin = Array();
					var mask = (1 << chrsz) - 1;
					for(var i = 0; i < str.length * chrsz; i += chrsz) {
						bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - i%32);
					}
					return bin;
				}

				function Utf8Encode(string) {
					string = string.replace(/\r\n/g,"\n");
					var utftext = "";

					for (var n = 0; n < string.length; n++) {

						var c = string.charCodeAt(n);

						if (c < 128) {
							utftext += String.fromCharCode(c);
						}
						else if((c > 127) && (c < 2048)) {
							utftext += String.fromCharCode((c >> 6) | 192);
							utftext += String.fromCharCode((c & 63) | 128);
						}
						else {
							utftext += String.fromCharCode((c >> 12) | 224);
							utftext += String.fromCharCode(((c >> 6) & 63) | 128);
							utftext += String.fromCharCode((c & 63) | 128);
						}

					}

					return utftext;
				}

				function binb2hex (binarray) {
					var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
					var str = "";
					for(var i = 0; i < binarray.length * 4; i++) {
						str += hex_tab.charAt((binarray[i>>2] >> ((3 - i%4)*8+4)) & 0xF) +
						hex_tab.charAt((binarray[i>>2] >> ((3 - i%4)*8  )) & 0xF);
					}
					return str;
				}

				s = Utf8Encode(s);
				return binb2hex(core_sha256(str2binb(s), s.length * chrsz));

			},
			submit:function(){
				//Method.$form.submit();

				if( _GLOBAL.PASSWORD_LEGACY_SHA_ENCODER ){
					sandbox.validation.destroy( Method.$form );
					Method.$form.find('input[type="password"]').each( function(){
						$(this).val( Method.SHA256( $(this).val() ));
					});
				}

				if( Method.isAjax === 'true'){
					sandbox.utils.ajax(Method.$form.attr('action'), 'POST', Method.$form.serialize(), function(data){
						var responseData = sandbox.rtnJson(data.responseText, true)['ResponseObject'];
						if(responseData){
							if($deferred){
								if(!responseData.isError || responseData.isError === 'false'){
									$deferred.resolve(responseData);
								}else{
								// changsoo.rhi
								    if(responseData instanceof Object && responseData.failureType == 'withoutpassword') {
								        $deferred.reject(responseData);
								    } else {
								        $deferred.reject(responseData.errorMap || Method.errMsg);
								    }
								}
							}
						}
					}, true);
				}else{
					Method.$form.submit();
				}
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-dynamicform]',
					attrName:'data-module-dynamicform',
					moduleName:'module_dynamicform',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				$deferred = null;
				console.log('destroy dynamicForm module');
			},
			setDeferred:function(defer){
				$deferred = defer;
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_exchangeable', function(sandbox){
		var Method = {
			$that:null,
			$allCheck:null, // 팝업 전체 선택 체크박스
			$itemList:null, // 선택 해서 popup에 노출되는 아이템 리스트
			$popModal:null,
			$returnItemList:null,
			$popSubmitBtn:null,
			$beforeAddress:null,
			$newAddress:null,
			isAblePartialVoid:null,
			ex_deliverySearch:null,
			ex_deliverySearchAnother:null,
			isAddress:false,
			isNewAddress:false,
			isDoubleClickFlag:true,
			isCheckeds:false,
			$errorMessage:'<p class="error-message essential-select"><span class="parsley-required">필수 입력 항목입니다.</span></p>',

			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);
				Method.$that = $this;
				Method.$popModal = UIkit.modal("#popup-exchange");
				Method.$ex_paymentPopModal = UIkit.modal("#popup-exchange-step02",{bgclose:false});
				Method.$popCuntBtn = Method.$popModal.find('[data-cunt-submit]');
				Method.$popSubmitBtn = Method.$popModal.find('[data-exchange-submit]');
				Method.$popCompleteBtn = Method.$ex_paymentPopModal.find('[exchange-complete-btn]');
				Method.$popAddressModal01 = UIkit.modal("#popup-customer-address01", {modal: false});
				Method.$popAddressModal02 = UIkit.modal("#popup-customer-address02", {modal: false});
				Method.$beforeAddress01 = Method.$popModal.dialog.find('[data-before-exchange-address01]');
				Method.$beforeAddress02 = Method.$popModal.dialog.find('[data-before-exchange-address02]');
				Method.$newAddress01 = Method.$popModal.dialog.find('[data-new-exchange-address01]');
				Method.$newAddress02 = Method.$popModal.dialog.find('[data-new-exchange-address02]');
				Method.$refundAccountInfo = Method.$popModal.find('[data-refund-account-info]');
				Method.$popAddressInputModal = UIkit.modal("#ex_addressSelectPopup",{modal: false, center: true});
				Method.$popNewAddressInputModal = UIkit.modal("#ex_newAddressSelectPopup",{modal: false, center: true});



				// 주문별 전체 교환
				$this.find('[data-exchange-order-btn]').on('click', function(e){
					e.preventDefault();
					Method.openExchangPopup($(this).data("orderid"));
				});

				// 교환 사유 변경시
				Method.$ex_paymentPopModal.find('[data-exchange-reason-type]').on("change", Method.ex_updateStatus);

				//교환신청 주소 tab 기능 - 삭제
				//Method.$ex_paymentPopModal.find('[data-order-tab]').on("mousedown", Method.updateOrderTab);

				//수거지 정보동일 버튼 해제 - 새로입력
				Method.$newAddress01.find('input').on('mousedown',function(){
					$("#add-duplication").removeAttr('checked').parents('.input-checkbox').removeClass('checked');
				});
				Method.$newAddress02.find('input').on('mousedown',function(){
					$("#add-duplication").removeAttr('checked').parents('.input-checkbox').removeClass('checked');
				});

				// 신청완료 전 팝업 종료시 새로고침
				Method.$ex_paymentPopModal.find('.uk-modal-close').click(function(){
					window.location.reload();
				});

				Method.$ex_paymentPopModal.find('.payment-method-item').on('click',function(){
					var paymentType = $(this).data('type');
					$('.payment-method-item').removeClass('active');
					$('.payment-method-item[data-type="'+paymentType+'"]').addClass('active');
					return false;
				});


				Method.ex_deliverySearch = sandbox.getComponents('component_searchfield', {context:Method.$popModal, selector:'.search-field.exchange', resultTemplate:"#address-find-list"}, function(){
					// 수거지주소 입력 처리
					var $zipCodeInput = Method.$popModal.find('[name="addressPostalCode"]');
					var $cityInput = Method.$popModal.find('[name="addressCity"]');

					// 검색된 내용 선택시 zipcode 처리
					this.addEvent('resultSelect', function(data){
						var zipcode = $(data).data('zip-code5');
						var city = $(data).data('city');
						var doro = $(data).data('doro');

						var $input = this.getInputComponent().setValue( city + ' ' + doro );

						$zipCodeInput.val( zipcode );
						$cityInput.val( city.split(' ')[0] );
					});
				});



				Method.ex_deliverySearchAnother = sandbox.getComponents('component_searchfield', {context:Method.$popModal, selector:'.search-field.exchangeNew', resultTemplate:"#address-find-list"}, function(){
					// 받는 주소 입력 처리
					var $zipCodeInput = Method.$popModal.find('[name="newAddressPostalCode"]');
					var $cityInput = Method.$popModal.find('[name="newAddressCity"]');

					// 검색된 내용 선택시 zipcode 처리
					this.addEvent('resultSelect', function(data){
						var zipcode = $(data).data('zip-code5');
						var city = $(data).data('city');
						var doro = $(data).data('doro');

						var $input = this.getInputComponent().setValue( city + ' ' + doro );

						$zipCodeInput.val( zipcode );
						$cityInput.val( city.split(' ')[0] );
					});
				});




				// 수거지 선택 버튼
				Method.$popModal.find('[data-customer-address-btn01]').on('click', function(e){
					e.preventDefault();
					Method.$popAddressModal01.show();
				});

				// 받는주소 선택 버튼
				Method.$popModal.find('[data-customer-address-btn02]').on('click', function(e){
					e.preventDefault();
					Method.$popAddressModal02.show();
				});



				// 수거지 주소와 동일
				$("#add-duplication").change(function(){
					var $target01 = Method.$popModal.dialog.find('[data-before-exchange-address01]');
					var $target02 = Method.$popModal.dialog.find('[data-before-exchange-address02]');
					var $newtarget01 = Method.$popModal.dialog.find('[data-new-exchange-address01]');

	        		if($(this).is(":checked")){
						if ($target01.find('input').is(':disabled')){
							var $fullName = $newtarget01.find('input[name="addressFirstName"]').val();
							var $phone = $newtarget01.find('input[name="addressPhone"]').val();
							var $address1 = $newtarget01.find('input[name="addressLine1"]').val();
							var $address2 = $newtarget01.find('input[name="addressLine2"]').val();
							var $postalCode = $newtarget01.find('input[name="addressPostalCode"]').val();
							var $addressCity = $newtarget01.find('input[name="addressCity"]').val();
						} else{
							var $fullName = $target01.find('input[name="addressFirstName"]').val();
							var $phone = $target01.find('input[name="addressPhone"]').val();
							var $address1 = $target01.find('input[name="addressLine1"]').val();
							var $address2 = $target01.find('input[name="addressLine2"]').val();
							var $postalCode = $target01.find('input[name="addressPostalCode"]').val();
							var $addressCity = $target01.find('input[name="addressCity"]').val();
						}
						$target02.find('[data-user-name]').html($fullName);
						$target02.find('[data-phone]').html($phone);
						$target02.find('[data-postalCode]').html($postalCode);
						$target02.find('[data-address1]').html($address1);
						$target02.find('[data-address2]').html($address2);
						$target02.find('input[name="newAddressFirstName"]').val($fullName);
						$target02.find('input[name="newAddressPhone"]').val($phone);
						$target02.find('input[name="newAddressLine1"]').val($address1);
						$target02.find('input[name="newAddressLine2"]').val($address2);
						$target02.find('input[name="newAddressPostalCode"]').val($postalCode);
						$target02.find('input[name="newAddressCity"]').val($addressCity);
	        		}
		    	});



				// 수거메모 선택시
				Method.$popModal.find('[data-personal-message-select]').on('change', Method.updatePersonalMessage );
				Method.$popModal.find('[data-newPersonal-message-select]').on('change', Method.updateNewPersonalMessage );

				Method.$popSubmitBtn.on('click', Method.exchangeOrderSubmit );
			},

			// updateOrderTab:function(e){
			// 	e.preventDefault();
			// 	var $icon = $(this).find('[class^="icon-toggle-"]');
			// 	var $view = $(this).closest('.order-tab').find('.view');
			// 	var $preview = $(this).find('.preview');
			//
			// 	if( $view.length > 0 ){
			// 		$preview.toggleClass('uk-hidden');
			// 		$icon.toggleClass('uk-hidden');
			// 		$view.toggleClass('uk-hidden');
			// 	}
			// },

			updatePersonalMessage:function(e){
				e.preventDefault();
				var $msgContainer = Method.$popModal.dialog.find('[data-personal-message]');
				var $personalMsg = $msgContainer.find('[name="personalMessageText"]');

				var value = $(this).val();
				if(value == ''){
					$personalMsg.val('');
					$msgContainer.addClass('uk-hidden');
				}else if(value == 'dt_1'){
					// 직접입력일 경우
					$personalMsg.val('');
					$msgContainer.removeClass('uk-hidden');
				}else{
					//$personalMsg.val( $(this).find("option:selected").val() + "||" + $(this).find("option:selected").text() );
					$personalMsg.val( $(this).find("option:selected").text());
					$msgContainer.addClass('uk-hidden');
				}
			},

			updateNewPersonalMessage:function(e){
				e.preventDefault();
				var $msgContainer = Method.$popModal.dialog.find('[data-newpersonal-message]');
				var $personalMsg = $msgContainer.find('[name="newPersonalMessageText"]');

				var value = $(this).val();
				if(value == ''){
					$personalMsg.val('(교환) ');
					$msgContainer.addClass('uk-hidden');
				}else if(value == 'dt_1'){
					// 직접입력일 경우
					$personalMsg.val('(교환) ');
					$msgContainer.removeClass('uk-hidden');
				}else{
					//$personalMsg.val( $(this).find("option:selected").val() + "||" + $(this).find("option:selected").text() );
					$personalMsg.val('(교환) ' + $(this).find("option:selected").text());
					$msgContainer.addClass('uk-hidden');
				}
			},

			// 교환 신청 팝업
			openExchangPopup:function( orderId ){

				var $modal = Method.$popModal;
				var $modalForm = $modal.dialog.find('form');
				Method.$itemList = $modal.dialog.find('[data-exchange-reason-list] #exChangeItem');

				var $reasonItem = $modal.dialog.find('[data-exchange-reason-item]');
				var $returnAddress = $modal.dialog.find('input[name="return-address"]');

				// 전체 선택 체크박스 처리
				Method.$allCheck = Method.$popModal.find('input[name="ex_check-all"]');
				Method.$allCheck.on("change", Method.ex_changeAllCheck );


				// 배송지 입력 타입 버튼 선택시
				$modal.find('[data-return-address-type]').on('show.uk.switcher', function(){
					Method.updateAddressInput();
				});

				// 배송지 선택 모듈 select 이벤트 호출( 배송지 선택했을때 호출됨 )
				Core.getComponents('component_customer_address', {context: $('[id*="popup-customer-address"]')}, function(){
					this.addEvent('select', function(data){
						if( Method.$popAddressModal01.isActive()){
							Method.updateCustomerAddress01(data);
							Method.$popAddressModal01.hide();
							$("#add-duplication").removeAttr('checked').parents('.input-checkbox').removeClass('checked');
						};
						if( Method.$popAddressModal02.isActive()){
							Method.updateCustomerAddress02(data);
							Method.$popAddressModal02.hide();
							$("#add-duplication").removeAttr('checked').parents('.input-checkbox').removeClass('checked');
						};
					});
				});

				Method.$itemList.empty();

				//sandbox.getModule('module_header').reDirect().setLogin(function(){
					sandbox.utils.promise({
						url:sandbox.utils.contextPath + '/account/orders/exchangeable/request/' + orderId,
						method:'GET'
					}).then(function(data){
						var defer = $.Deferred();
						$modal.find('[data-exchange-reason-list]').find('#exChangeItem').remove();
						$modal.find('[data-exchange-reason-list]').append(data);

						/*
						isAble 				: 주문 취소, 교환 가능 여부
						isAblePartial   	: 부분 취소, 교환 가능 여부
						*/
						//Method.isAblePartialVoid = $modal.find('#exChangeItem').find('.exchange-item').data('isablepartial');

						var $newItem = $reasonItem.removeClass("uk-hidden");
						var $info = $newItem.find('[exchange-reason-info]');
						var $thumb = $newItem.find('[exchange-reason-thumb]');
						var $item = $modal.find('[data-exchange-reason-list] [data-exchange-reason-item]');

						//팝업내 select 리셋
						//$modal.find('.select-body li:first-child span').trigger('click').parents('.select-box').removeClass('checked');

						//부분교환 확인
						var exchangeableQuantitySum = [];
						$item.each(function(){
							var $this_exchangeableQuantity = $(this).find('input[name="quantity"]').val();
							exchangeableQuantitySum.push($this_exchangeableQuantity);
						});
						var sumTotal = exchangeableQuantitySum.reduceRight(function(a,b){return a+b;});
						if(sumTotal == $item.length){
							Method.isAblePartialVoid = false;
						} else {
							Method.isAblePartialVoid = true;
						}

						$item.each(function () {
							// 교환 가능 수량
							var quantity = $(this).find('input[name="quantity"]').val();

							//사이즈 change 처리
							var skuId = $(this).find('input[name="skuId"]');
							$(this).find('select[name="skuSizeSel"]').change(function () {
						     var valueSelected  = $(this).find("option:selected").val();
								 skuId.val(valueSelected);
								 $(this).parents('[data-exchange-reason-item]').find('.complet-size span').text($(this).find("option:selected").text());

						     if(valueSelected == "" && $(this).find('.error-message').length == 0){
										$(this).parent('.select-box').after(Method.$errorMessage);
						     } else{
										$(this).parent('.select-box').next('.error-message').remove();
						     }
							 });

							 if( Method.isAblePartialVoid ){
  								var $quantity = $(this).find('[exchange-partials-quantity]');
 									$quantity.find("select").removeAttr('disabled');


								// 부분교환시 아이템 가능 수량이 1개 이상 일때
 								if(quantity > 1){
 									for( var i=1; i<=quantity; i++){
 										$quantity.find("select").append( '<option value="' + i + '">' + i +'</option>');
 	 								}
 									$(this).find('input[name="quantity"]').removeAttr('disabled').val(1);
									if($(this).closest('#exChangeItem').find('[data-exchange-reason-item]').length == 1){
										$quantity.show();
									}
 								}else{
									// 부분교환시 아이템 가능 수량이 1개 일때
 									var $quantity = $(this).find('input[name="quantity"]');
 	 								$quantity.removeAttr('disabled').val(quantity);
 								}

  							}else{
  								var $inputQuantity = $(this).find('input[name="quantity"]');
  								$inputQuantity.removeAttr('disabled').val(quantity);
  							}

 							$(this).find('.exchangeQuantity select').change(function () {
 								var valueSelected  = $(this).find("option:selected").val();
 								$(this).parents('[data-exchange-reason-item]').find('.complet-quantity span').text(valueSelected);
 								$(this).parents('[data-exchange-reason-item]').find('input[name="quantity"]').removeAttr('disabled').val(valueSelected);
 							});

 						});

						//상품이 1개 이면 체크박스 X , 이상이면 O
						var itemPartial = $item.length > 1; //1개이면 false, 이상이면 true

						if(!itemPartial){
							var itemError = $item.find('#skuSizeSel').val() == '';
							if(itemError){
								$item.find('#skuSizeSel').parent('.select-box').removeClass('hidden');
								$item.find('#skuSizeSel').parent('.select-box').after(Method.$errorMessage);
							}

							Method.updateSubmitBtn( true );
						}else{
							Method.updateSubmitBtn( !itemPartial );
							$modal.find('[data-exchange-reason-list] [data-exchange-reason-item]').find('input[type="checkbox"]').on("change", Method.changeItemCheck );
						}

						Method.updateInfoByIsPartial( itemPartial ); //단일상품 or 복수상품에 대한 UI처리
						Method.defaultAddressInput(); //주문주소지로 기본설정


						//$modal.find('[data-exchange-reason-list]>ul>li').find('select').on("change", Method.updateStatus );

						// 전체 취소로 초기화
						Method.$allCheck.prop('checked', false ).trigger('change');
						$modal.show();
						sandbox.validation.reset( $modal.dialog.find('form'));

						sandbox.getComponents('component_select', {context:$modal.dialog}, function(i){
							this.addEvent('change', function(val, $selected, index){
								if($(this).attr('name') == 'accountCode'){
									$(this).siblings().filter('input[name=accountName]').val($selected.text());
								}
							});
						});

						sandbox.moduleEventInjection(data, defer);

						Method.$itemList = $modal.dialog.find('[data-exchange-reason-list] #exChangeItem');

						return defer.promise();
					}).then(function(data){
						// UIkit.modal.alert("취소 되었습니다.").on('hide.uk.modal', function() {
						// 	window.location.reload();
						// });
					}).fail(function(error){
						// if(error){
						// 	UIkit.modal.alert(error).on('hide.uk.modal', function() {
						// 		window.location.reload();
						// 	});
						// }else{
						// 	window.location.reload();
						// }
					});
				//});
			},

			// 교환 사유에 따른 배송비 계산
			ex_updateStatus:function(e){
				e.preventDefault();

				var $item = Method.$popModal.find('[data-exchange-reason-list] [data-exchange-reason-item]');
				//상품이 1개이면 전체교환 not 부분교환
				var itemPartial = $item.length > 1; //1개이면 false, 이상이면 true
				if(itemPartial){
					var $items = Method.$itemList.find('[data-exchange-reason-item]').find('input[type="checkbox"]:checked').closest('[data-exchange-reason-item]');
				}else{
					var $items = Method.$itemList.find('[data-exchange-reason-item]');
				}

				var $modal = Method.$ex_paymentPopModal;
				var $form = $modal.dialog.find('form');
				var $itemForm = Method.getFormByPartialItem( $items );
				var action = $form.attr('action') + '/calculatorFee';
				var param = $itemForm.serialize() + '&' + $form.serialize();

				Core.Utils.ajax( action, 'POST', param, function(data){

					var data = sandbox.rtnJson(data.responseText, true);
					var $paymentAmount = $modal.find('[data-exchange-amount]');
					//var $paymentItem = $modal.find('.uk-hidden[data-payment-item]');
					//$paymentList.empty();

					if( !data ){
						// var $newItem = Method.getReplacePaymentItem( $paymentItem, '서버 통신 오류' );
						// $newItem.appendTo( $paymentList );
						console.log('데이터오류?'+data);
					}
					var result = data.result;
					if( result == true ){
						// 배송비
						var addFulfillmentChargeFee = data.addFulfillmentChargeFee.amount;
						$paymentAmount.text(sandbox.utils.price(addFulfillmentChargeFee));
						// if(addFulfillmentChargeFee != 0){
						$modal.find('[exchange-payment-item]').removeAttr('disabled').removeClass('disabled');
						// 	$modal.find('[exchange-payment-item]').removeClass('uk-hidden');
						// }else{
						// 	$modal.find('[exchange-complete-btn]').removeAttr('disabled').removeClass('disabled').show();
						// 	$modal.find('[exchange-payment-item]').addClass('uk-hidden');
						// }
						var paymentGroup = $modal.find('[data-exchange-payment-group]');
						if(addFulfillmentChargeFee == 0){
							paymentGroup.addClass('uk-hidden');
						} else {
							paymentGroup.removeClass('uk-hidden');
						}
					}else{
						// var $newItem = Method.getReplacePaymentItem( $paymentItem, data.errorMsg );
						// $newItem.appendTo( $paymentList );
						//Method.updatePaymentInfo( false );
						//Method.isCheckeds = false;
						UIkit.modal.alert(data.errorMsg);
					}
				}, true);

			},

			defaultAddressInput:function(){
				// 주문시 주소로 기본입력처리
				var $orderAddress = Method.$popModal.dialog.find('[order-address]');
				var $addressArea = Method.$popModal.dialog.find('.return-address');

				//실제 주문시 입력한 주소정보
				var $order_firstName = $orderAddress.find('input[name="order_addressFirstName"]').val();
				var $order_phone = $orderAddress.find('input[name="order_addressPhone"]').val();
				var $order_addressLine1 = $orderAddress.find('input[name="order_addressLine1"]').val();
				var $order_addressLine2 = $orderAddress.find('input[name="order_addressLine2"]').val();
				var $order_postalCode = $orderAddress.find('input[name="order_addressPostalCode"]').val();
				var $order_city = $orderAddress.find('input[name="order_addressCity"]').val();

				//수거지 및 배송지 공통 주소 정보 입력
				$addressArea.find(".addressFirstName").val($order_firstName);
				$addressArea.find(".addressPhone").val($order_phone);
				$addressArea.find(".addressLine1").val($order_addressLine1);
				$addressArea.find(".addressLine2").val($order_addressLine2);
				$addressArea.find(".addressPostalCode").val($order_postalCode);
				$addressArea.find(".addressCity").val($order_city);

				$addressArea.find('[data-user-name]').html($order_firstName);
				$addressArea.find('[data-phone]').html($order_phone);
				$addressArea.find('[data-postalCode]').html($order_postalCode);
				$addressArea.find('[data-address1]').html($order_addressLine1);
				$addressArea.find('[data-address2]').html($order_addressLine2);
			},

			// 아이템 단위로 사이즈 선택할 수 있는 select 노출 처리
			showHideAvailabeSize:function( $checkbox ){
				var $exchangeSize = $checkbox.parents('.order-product-item').find('[exchange-reason-partials-size]');
				var itemPartial = Method.$popModal.dialog.find('[data-exchange-reason-item]');
				$exchangeSize.next('.error-message').remove();

				if( $checkbox.prop('checked')){
					$exchangeSize.removeClass('hidden');
					$exchangeSize.after(Method.$errorMessage);
					// if(itemPartial.find('.error-message').length == 0 && $exchangeSize.find('#skuSizeSel').val() == ''){
					// 	$exchangeSize.after(Method.$errorMessage);
					// }
				}else{
					if(itemPartial.length == 1){ //상품이 1개일 때
						itemPartial.find('[exchange-reason-partials-size]').removeClass('hidden');
						if(itemPartial.find('.error-message').length == 0 && $exchangeSize.find('#skuSizeSel').val() == ''){
							itemPartial.find('[exchange-reason-partials-size]').after(Method.$errorMessage);
						}
					}else{
						$exchangeSize.addClass('hidden');
						$exchangeSize.find('#skuSizeSel').val('');
						$exchangeSize.next('.error-message').remove();
					}
				}
			},

			// 아이템 단위로 수량 선택할 수 있는 select 노출 처리
			showHideAvailabeQuantity:function( $checkbox ){
				var $selectQuantity = $checkbox.closest('[data-exchange-reason-item]').find('[exchange-partials-quantity]');
				var availableQuantity = $checkbox.closest('[data-exchange-reason-item]').find('input[name=quantity]').val();
				var $inputQuantity = $checkbox.closest('[data-exchange-reason-item]').find('[exchange-quantity]');
				if( $checkbox.prop('checked')){
					if(availableQuantity >= 1){
						$selectQuantity.show();
						$inputQuantity.show();
					}
				}else{
					if($checkbox.closest('#exChangeItem').find('[data-exchange-reason-item]').length == 1 && availableQuantity > 1){
						$selectQuantity.show();
					}else if($checkbox.closest('#exChangeItem').find('[data-exchange-reason-item]').length == 1 && availableQuantity == 1){
						$inputQuantity.show();
					}else{
						$selectQuantity.hide();
						$inputQuantity.hide();
					}
				}
			},

			// 부분 교환 가능 여부에 따른 정보 노출 처리
			updateInfoByIsPartial:function( $bool ){
				var $checkAllContainer = Method.$popModal.dialog.find('.ex_check-all');
				var $checkboxs = Method.$popModal.dialog.find('[data-exchange-reason-list] #exChangeItem').find('.checkbox');
				var $info = Method.$popModal.dialog.find('[data-info-text]');

				if( $bool ){
					$checkAllContainer.show();
					$checkboxs.show();
					$checkboxs.siblings('svg').addClass('icon').show();
					//$info.show();
				}else{
					$checkAllContainer.hide();
					$checkboxs.hide();
					$checkboxs.siblings('svg').removeClass('icon').hide();
					//$info.hide();
				}
			},

			// modal에서 전체 선텍
			ex_changeAllCheck:function(e){
				var isCheck = $(this).prop('checked');
				Method.$itemList.find('[data-exchange-reason-item]').each( function(){
					$(this).find('input[type="checkbox"]').prop( 'checked', isCheck );
					Method.showHideAvailabeSize( $(this).find('input[type="checkbox"]') );
					Method.showHideAvailabeQuantity( $(this).find('input[type="checkbox"]') );
				});
				Method.updateStatusChecked();

				if (Method.isCheckeds) {
					Method.updatePaymentInfo( false );
					Method.isCheckeds = false;
				}
			},

			// modal에서 체크박스 선택시
			changeItemCheck:function(e){
				var isCheck = $(this).prop('checked');
				Method.showHideAvailabeSize( $(this ));
				Method.showHideAvailabeQuantity( $(this ));
				//$(this).parents('[data-exchange-reason-item]').find('select[name="skuSizeSel"]').val( $(this).parents('[data-exchange-reason-item]').find('select[name="skuSizeSel"]') ).trigger('update');

				Method.updateStatusChecked();
				Method.updateCheckAll(isCheck);

				if (Method.isCheckeds) {
					Method.updatePaymentInfo( false );
					Method.isCheckeds = false;
				}
			},

			// 아이템 체크박스 변경시 전체 선택 체크박스 상태처리
			updateCheckAll:function(isCheck){
				var checkboxList = Method.$itemList.find('[data-exchange-reason-item] .i-checkbox');
		    if(isCheck){
	        if(checkboxList.length == checkboxList.find('input[type="checkbox"]:checked').length ){
				    Method.$allCheck.prop( 'checked', true );
  				}else{
  					Method.$allCheck.prop( 'checked', false );
  				}
		    }else{
	        Method.$allCheck.prop( 'checked', false );
		    }
			},

			// 리턴 상황에 따른 가격정보와
			updatePaymentInfo:function( $bool ){
				var $paymentContainer = Method.$popModal.find('[data-payment-conatiner]');

				if( $bool ){
					$paymentContainer.show();
					Method.$popCuntBtn.hide();
				}else{
					Method.$popCuntBtn.show();
				}
			},

			updateStatusChecked:function(){
				var $modal = Method.$popModal;
				var $items = Method.$itemList.find('[data-exchange-reason-item]').find('input[type="checkbox"]:checked').parents('[data-exchange-reason-item]');

				if( $items.length > 0 ){
					if (Method.isDoubleClickFlag) {
						Method.updateSubmitBtn( true ); // 체크박스 선택 가능
						Method.isDoubleClickFlag = false;
					}
				} else {
					// 아이템 없을때
					// 부분 취소, 교환 가능 여부
					var isablepartial = true;

					if (!isablepartial) {
						Method.updateSubmitBtn( true );
					} else {
						if (!Method.isDoubleClickFlag) {
							Method.updateSubmitBtn( false ); // 체크박스 선택 불가능
							Method.isDoubleClickFlag = true;
						}
					}
				}
			},

			// 버튼 활성화/비활성화 처리
			updateSubmitBtn:function( $bool ){
				var $paymentContainer = Method.$popModal.find('[data-payment-conatiner]');
				var _disabledCheck;
				// Method.$popModal.find('[data-exchange-reason-list] [data-exchange-reason-item]').each( function(){
				// 	var _disabled = $(this).find('input[type="checkbox"]').attr('disabled');
				// 	var _bool = _disabled == 'disabled';
				// 	_disabledCheck = _.some([_bool], Boolean); // true
				// });
				// if (_disabledCheck) {
				// 	Method.$allCheck.attr('disabled', true).closest('.input-checkbox').addClass('disabled');
				// } else {
				// 	Method.$allCheck.attr('disabled', false).closest('.input-checkbox').removeClass('disabled');
				// }
				if ($bool) {
					Method.$popSubmitBtn.removeAttr('disabled').removeClass('disabled');
				} else {
					Method.$popSubmitBtn.attr('disabled','true').addClass('disabled');
				}
			},

			// 선택된 아이템의 order dom
			getOrderElementByChecked:function($checkbox){
				var $order = $checkbox.closest('[data-exchange-order]');
				return {
					order : $order,
					allCheckbox : $order.find('input[name="ex_check-all"]'),
					itemList : $order.find('[data-exchange-order-list]')
				}
			},

			// 배송지 선택으로 주소 입력시
			updateCustomerAddress01:function( data ){
				// 수거지 주소
				var $target01 = Method.$popModal.dialog.find('[data-before-exchange-address01]');
				if( $target01.find('[data-user-name]').length > 0 ){
					$target01.find('[data-user-name]').html($.trim(data.fullName));
				}

				if( $target01.find('[data-phone]').length > 0 ){
					$target01.find('[data-phone]').html($.trim(data.phoneNumber));
				}

				if( $target01.find('[data-postalCode]').length > 0 ){
					$target01.find('[data-postalCode]').html($.trim(data.postalCode));
				}

				if( $target01.find('[data-address1]').length > 0 ){
					$target01.find('[data-address1]').html($.trim(data.addressLine1));
				}

				if( $target01.find('[data-address2]').length > 0 ){
					$target01.find('[data-address2]').html($.trim(data.addressLine2));
				}

				// 변경된 값 input 에 적용
				$target01.find('input[name="addressFirstName"]').val($.trim(data.fullName));
				$target01.find('input[name="addressPhone"]').val($.trim(data.phoneNumber));
				$target01.find('input[name="addressLine1"]').val($.trim(data.addressLine1));
				$target01.find('input[name="addressLine2"]').val($.trim(data.addressLine2));
				$target01.find('input[name="addressPostalCode"]').val($.trim(data.postalCode));
				$target01.find('input[name="addressCity"]').val($.trim(data.city));
			},
			updateCustomerAddress02:function( data ){
				// 받으실 주소
				var $target02 = Method.$popModal.dialog.find('[data-before-exchange-address02]');
				if( $target02.find('[data-user-name]').length > 0 ){
					$target02.find('[data-user-name]').html($.trim(data.fullName));
				}

				if( $target02.find('[data-phone]').length > 0 ){
					$target02.find('[data-phone]').html($.trim(data.phoneNumber));
				}

				if( $target02.find('[data-postalCode]').length > 0 ){
					$target02.find('[data-postalCode]').html($.trim(data.postalCode));
				}

				if( $target02.find('[data-address1]').length > 0 ){
					$target02.find('[data-address1]').html($.trim(data.addressLine1));
				}

				if( $target02.find('[data-address2]').length > 0 ){
					$target02.find('[data-address2]').html($.trim(data.addressLine2));
				}

				// 변경된 값 input 에 적용
				$target02.find('input[name="newAddressFirstName"]').val($.trim(data.fullName));
				$target02.find('input[name="newAddressPhone"]').val($.trim(data.phoneNumber));
				$target02.find('input[name="newAddressLine1"]').val($.trim(data.addressLine1));
				$target02.find('input[name="newAddressLine2"]').val($.trim(data.addressLine2));
				$target02.find('input[name="newAddressPostalCode"]').val($.trim(data.postalCode));
				$target02.find('input[name="newAddressCity"]').val($.trim(data.city));
			},

			// 실제 전송될 주소 정보를 설정하기 위해 불필요 정보 disabled
			updateAddressInput:function(){
				// 수거지 주소
				// if( Method.$beforeAddress01.hasClass('uk-active')){
				// 	Method.isAddress = false;
				// 	Method.$beforeAddress01.find('input').attr('disabled', false );
				// 	Method.$newAddress01.find('input').attr('disabled', true );
				// } else{
				// 	Method.isAddress = true;
				// 	Method.$beforeAddress01.find('input').attr('disabled', true );
				// 	Method.$newAddress01.find('input').attr('disabled', false );

				// 	//Method.$newAddress01.find('input#addressLine1').attr('disabled', true);
				// 	//Method.$popModal.find("#add-duplication").removeAttr('checked').parents('.input-checkbox').removeClass('checked');
				// }

				// 받으실 주소
				if( Method.$beforeAddress02.hasClass('uk-active')){
					Method.isNewAddress = false;
					Method.$beforeAddress02.find('input').attr('disabled', false );
					Method.$newAddress02.find('input').attr('disabled', true );
				} else{
					Method.isNewAddress = true;
					Method.$beforeAddress02.find('input').attr('disabled', true );
					Method.$newAddress02.find('input').attr('disabled', false );

					//Method.$newAddress02.find('input#addressLine1').attr('disabled', true);
					//Method.$popModal.find("#add-duplication").removeAttr('checked').parents('.input-checkbox').removeClass('checked');
				}


			},

			// 선택된 아이템을 하나의 form으로 만들어 리턴
			getFormByPartialItem:function( $items ){
				var $itemForm = $('<form></form>');

				//체크되어있는 아이템 가져와 form에 append
				$items.each( function(){
					var quantity = $(this).find('[name="quantity"]:enabled').val();
					var $newItem = $(this).clone();

					$newItem.find('[name="quantity"]').val(quantity);
					$newItem.appendTo( $itemForm );
				});
				return $itemForm;
			},

			exchangeOrderSubmit:function(e){
				e.preventDefault();

				// $itemList에 에러메시지가 없으면 실행
				if(Method.$itemList.find('.error-message.essential-select').length == 0){
					var $modalForm = Method.$popModal.dialog.find('form');
					sandbox.validation.validate( $modalForm );
					if( sandbox.validation.isValid( $modalForm )){

						// if( Method.isAddress ){
						// 	if( !Method.ex_deliverySearch.getValidateChk()){
						// 		UIkit.modal.alert("검색을 통하여 배송지를 입력해주세요.");
						// 		return false;
						// 	}
						// }

						if( Method.isNewAddress ) {
							if( !Method.ex_deliverySearchAnother.getValidateChk() ){
								UIkit.modal.alert("검색을 통하여 배송지를 입력해주세요.");
								return false;
							}
						}

						//console.log( $modalForm.attr('action'))
						UIkit.modal.confirm('교환 하시겠습니까?', function(){
							// 주소에 노출된 우편번호 제거
							if( Method.isAddress ){
								var $addressLine1 = $modalForm.find('[name="addressLine1"]:hidden');
								if( $addressLine1 ){
									if( $addressLine1.val().indexOf(')') >= 1 ){
										var address1 = $addressLine1.val().split(')');
										if( address1.length > 1 ){
										$addressLine1.val( $.trim( address1[1]) );
										}
									}
								}
							}

							if( Method.isNewAddress ){
								var $newAddressLine1 = $modalForm.find('[name="newAddressLine1"]:hidden');
								if( $newAddressLine1 ){
									if( $newAddressLine1.val().indexOf(')') >= 1 ){
										var newAddress1 = $newAddressLine1.val().split(')');
										if( newAddress1.length > 1 ){
											$newAddressLine1.val( $.trim( newAddress1[1]) );
										}
									}
								}
							}


							var isPartial = Method.$itemList.find('[data-exchange-reason-item]').length != 1; //신청 상품개수가 단일인지 판단
							var param = '';

							//신청 다음단계에서 보여줄 상품리스트
							var exchangeCompleteList = Method.$ex_paymentPopModal.find('[data-exchange-complete-list]');
							exchangeCompleteList.html(' ');

							// 부분 교환일때는 상품별
							if( isPartial ){
								var $itemForm = Method.getFormByPartialItem( Method.$itemList.find('[data-exchange-reason-item]').find('input[type="checkbox"]:checked').parents('[data-exchange-reason-item]') );
								param = $itemForm.serialize() +'&'+ $modalForm.serialize();

								//신청 다음단계에서 보여줄 상품리스트 clone & append
								var exchangeComplete = Method.$itemList.find('[data-exchange-reason-item]').find('input[type="checkbox"]:checked').parents('[data-exchange-reason-item]').clone();
								exchangeCompleteList.append(exchangeComplete);

							}else{
								var $itemForm = Method.getFormByPartialItem( Method.$itemList.find('[data-exchange-reason-item]') );
								param = $itemForm.serialize() +'&'+ $modalForm.serialize();
								param += '&entireReturn=true';

								//신청 다음단계에서 보여줄 상품리스트 clone & append
								var exchangeComplete = Method.$itemList.find('[data-exchange-reason-item]').clone();
								exchangeCompleteList.append(exchangeComplete);
							}

							//다음단계에서 주소 가져오기
							Method.updateSubmitBtn( false );
							Core.Utils.ajax( $modalForm.attr('action'), 'POST', param, function(data){
								var data = sandbox.rtnJson(data.responseText, true);
								var result = data['result'];
								if( result == true ){

									//교환 ga 미사용(미개발) 주석처리
									// if( _GLOBAL.MARKETING_DATA().useGa == true ){
									// 	var marketingOption = {
									// 		orderType : 'RETURN',
									// 		orderId : data.ro.returnOrderId
									// 	};
									// 	Core.ga.processor( marketingOption );
									// }

									//step 01 아이템 정보에서 step 02 노출
									Method.$ex_paymentPopModal.find(".exchange_02").removeClass('hidden');
									Method.$ex_paymentPopModal.find("[exchange-reason-partials-size]").addClass('hidden');
									Method.$ex_paymentPopModal.find("[exchange-partials-quantity]").addClass('hidden');

									//var addFulfillmentchargeFee = data['addFulfillmentChargeFee']; //배송비
									var exchangeReturnOrderId = data['exchangeReturnOrderId'];
									var ex_ReturnOrderIdInput = Method.$ex_paymentPopModal.find('[name="returnOrderId"]');
									ex_ReturnOrderIdInput.val(exchangeReturnOrderId);

									//param으로 전송되는 주소값을 가지고 최종 팝업에 주소입력
									var paramChk = sandbox.utils.getQueryParams(param);
									var nextBeforeAddressWrap = Method.$ex_paymentPopModal.find('.address1 .address-info');
									var nextAfterAddressWrap = Method.$ex_paymentPopModal.find('.address2 .address-info');

									//수거지 주소
									nextBeforeAddressWrap.find('[data-user-name]').text(decodeURIComponent(paramChk.addressFirstName).replace(/[+]/gi, " "));
									nextBeforeAddressWrap.find('[data-postalcode]').text(decodeURIComponent(paramChk.addressPostalCode).replace(/[+]/gi, " "));
									nextBeforeAddressWrap.find('[data-address1]').text(decodeURIComponent(paramChk.addressLine1).replace(/[+]/gi, " "));
									nextBeforeAddressWrap.find('[data-address2]').text(decodeURIComponent(paramChk.addressLine2).replace(/[+]/gi, " "));
									nextBeforeAddressWrap.find('[data-phone]').text(decodeURIComponent(paramChk.addressPhone));
									//Method.$ex_paymentPopModal.find('.address1 .preview').text(nextBeforeAddressWrap.find('li:nth-child(2)').text());
									if(decodeURIComponent(paramChk.personalMessageText) == ''){
										nextBeforeAddressWrap.find('[data-personalMessageText]').hide();
									}else{
										nextBeforeAddressWrap.find('[data-personalMessageText]').text(decodeURIComponent(paramChk.personalMessageText).replace(/[+]/gi, " "));
									}

									//받는주소
									nextAfterAddressWrap.find('[data-user-name]').text(decodeURIComponent(paramChk.newAddressFirstName).replace(/[+]/gi, " "));
									nextAfterAddressWrap.find('[data-postalcode]').text(decodeURIComponent(paramChk.newAddressPostalCode).replace(/[+]/gi, " "));
									nextAfterAddressWrap.find('[data-address1]').text(decodeURIComponent(paramChk.newAddressLine1).replace(/[+]/gi, " "));
									nextAfterAddressWrap.find('[data-address2]').text(decodeURIComponent(paramChk.newAddressLine2).replace(/[+]/gi, " "));
									nextAfterAddressWrap.find('[data-phone]').text(decodeURIComponent(paramChk.newAddressPhone));
									//Method.$ex_paymentPopModal.find('.address2 .preview').text(nextAfterAddressWrap.find('li:nth-child(2)').text());
									if(decodeURIComponent(paramChk.newPersonalMessageText) == ''){
										nextAfterAddressWrap.find('[data-personalMessageText]').hide();
									}else{
										nextAfterAddressWrap.find('[data-personalMessageText]').text(decodeURIComponent(paramChk.newPersonalMessageText).replace(/[+]/gi, " "));
									}

									//UIkit.modal.alert(".").on('hide.uk.modal', function() {
										//window.location.href = sandbox.utils.contextPath + "/account/orders/returned";
										Method.$popModal.hide();
										Method.$ex_paymentPopModal.show();
									//});

								}else{
									UIkit.modal.alert(data['errorMsg']).on('hide.uk.modal', function() {
										window.location.reload();
									});
								}
								//$('.customer-contents').replaceWith($(data.responseText).find('.customer-contents'));

							},true)

						}, function(){},
						{
							labels: {'Ok': '확인', 'Cancel': '취소'}
						});
					}
				} else{
					Method.$itemList.find('select').focus();
				}
			},

			// 부분교환 가능 여부 판단
			getIsAvailablePartialReturn:function(){

				var itemList = {};
				var $checkedList = Method.$itemList.find('[data-exchange-reason-item]').find('input[type="checkbox"]:checked').parents('[data-exchange-reason-item]');

				$checkedList.each( function(){
					isAvailable = false;
					var quantity = $(this).find('input[name="quantity"]').val();
					var skuId = $(this).find('input[name="skuId"]').val();
					var orderId = $(this).find('input[name="orderId"]').val();
					var orderItemId = $(this).find('input[name="orderItemId"]').val();
					var fulfillmentGroupId = $(this).find('input[name="fulfillmentGroupId"]').val();

					if( itemList[orderId] == undefined ){
						itemList[orderId] = {};
						itemList[orderId].items = [];
					}

					var itemObj = {
						skuId : Number(skuId),
						orderItemId : Number(orderItemId),
						quantity : Number(quantity),
						fulfillmentGroupId : Number(fulfillmentGroupId)
					}

					itemList[orderId].items.push( itemObj );
				})

				var isAvailable = false;
				$.each( itemList, function(){
					// 전체 교환이 불가능하거나 현재 주문의 전체 아이템 사이즈와 선택된 아이템 사이즈가 같지 않다면
					// console.log( this.orderItemSize + ' : ' + this.items.length );
					/*
					if( this.ableEntireReturn == "false" || this.orderItemSize != this.items.length ){
						//console.log( '전체 교환이 불가능하거나 현재 주문의 전체 아이템 사이즈와 선택된 아이템 사이즈가 같지 않다면')
						isAvailable = true;
					}else{
						$.each( this.items, function(){
							//console.log( this.quantity + ' : ' + this.quantity);
							if( this.skuId != 0 || this.quantity != this.quantity ){
								//console.log('교환된 수량이 있거나 전체 수량이 아닌것 있음');
								isAvailable = true;
								return;
							}
						})
					}
					*/

					if( isAvailable == false ){
						//console.log('부분교환 불가능한 order가 있음');
						return false;
					}
				})
				return isAvailable;
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-exchangeable]',
					attrName:'data-module-exchangeable',
					moduleName:'module_exchangeable',
					handler:{
						context:this,
						method:Method.moduleInit
					}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_giftcard_credit', function(sandbox){
		var Method = {
			moduleInit:function(){
				var $this = $(this);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[ data-module-giftcard-credit]',
					attrName:'data-module-giftcard-credit',
					moduleName:'module_giftcard_credit',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_exchanged_history', function(sandbox){
		var Method = {
			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);

				$this.find('button.exchanged-cancel-item').on("click", Method.exchangedCancelItem );
			},

			// 교환 취소 요청
			exchangedCancelItem:function(e){
				e.preventDefault();
				var $form = $(this).closest("form");

				UIkit.modal.confirm('교환을 취소 하시겠습니까?', function(){
					Core.Utils.ajax("/account/orders/exchanged/cancel", "POST", $form.serialize(), function(data){

						UIkit.modal.alert("교환이 취소 되었습니다.").on('hide.uk.modal', function() {
							window.location.reload();
						});

					});
				}, function(){},
				{
					labels: {'Ok': '확인', 'Cancel': '취소'}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-exchanged-history]',
					attrName:'data-module-exchanged-history',
					moduleName:'module_exchanged_history',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_gnb', function(sandbox){

		var Method = {
        $moveEnd : 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend',
        $reszieEvent : 'orientationchange' in window ? 'orientationchange.flyout' : 'resize.flyout',
        $flag : null,
        $active : 'active',
        $activeClass : '',
        $anchorClass : '.anchor.level-1',
        $wrap : $('#wrapper'),
        $nav : $('.header-flyout'),
        $toggle : $('.header-flyout-toggle').find('.toggle'),
        $head : null,
        $flyout : null,
        moduleInit : function(){
          Method.$activeClass = '.' + Method.$active;
          Method.$head = Method.$nav.find('.head-overlay');
          Method.$flyout = Method.$nav.find('.header-flyout-container');

          Method.$nav.on('click', Method.$anchorClass, function(){
            var selector = {}
            selector.anchor = $(this);
            selector.item = selector.anchor.parent(),
            selector.flyout = selector.item.children('.header-flyout-container'),
            selector.siblings = selector.item.siblings(Method.$activeClass);
            selector.wide = selector.flyout.data('flyoutWide');
						if(selector.anchor.hasClass('link')){
							return true;
						}
            if (!selector.anchor.hasClass(Method.$active)) {
              if ('m' != Method.deviceMedia()) {
                Method.PCflyoutVisible(selector);
              } else {
                Method.MCflyoutDetailVisible(selector);
              }
            }
            else {
              Method.PCflyoutHidden();
            }
            return false;
          });
          Method.$toggle.off('click').on('click',function(){
            Method.MCflyoutVisible();
            return false;
          });

          $(window).on('scroll.header-fixit',function(){
            var scrollTop = $(this).scrollTop(),
              header = $('.header-general'),
              headerTop = header.offset().top,
              flagText = 'fixit-active';
            if (scrollTop >= headerTop){
              header.addClass(flagText);
            } else {
              header.removeClass(flagText);
            }
          }).trigger('scroll.header-fixit');
        },
        deviceMedia : function(){
          var flag = $('body').css('zIndex');
          if ('1' == flag) {flag = 'm'}
          if ('2' == flag) {flag = 't'}
          if ('3' == flag) {flag = 'p'}
          return flag;
        },
        PCflyoutVisible : function(selector){
          if (selector.wide) { Method.$flyout.addClass('wide'); }
          else { Method.$flyout.removeClass('wide'); }
          if (!Method.$wrap.hasClass('set-overlay')) { Method.$wrap.addClass('set-overlay'); }

          selector.item.add(Method.$head).add(selector.anchor).add(selector.flyout).addClass(Method.$active);
          selector.siblings.removeClass(Method.$active).find(Method.$activeClass).removeClass(Method.$active);
          Method.$flyout.off(Method.$moveEnd);
          selector.flyout.one(Method.$moveEnd, function(){
            selector.anchor.hasClass(Method.$active) && Method.$nav.addClass(Method.$active);
          });

          Method.$wrap.off('click.set-overlay').on('click.set-overlay', function(e){
            if (e.target == e.currentTarget){
              $(this).off('click.set-overlay');
              Method.PCflyoutHidden();
            }
          });
          $('.header-flyout-close').one('click',function(){
            Method.PCflyoutHidden();
          });
          $(window).on( (Method.$reszieEvent + 'PC') , function(){
            if ( 'm' == Method.deviceMedia() ){
              Method.PCflyoutHidden();
            }
          });
        },
        PCflyoutHidden : function(){
          Method.$wrap.removeClass('set-overlay');
          Method.$nav.removeClass(Method.$active).find(Method.$activeClass).removeClass(Method.$active);
          Method.$flyout.removeClass('wide');

          $(window).off( (Method.$reszieEvent + 'PC') );
        },

        MCflyoutVisible : function(){
          if (!Method.$nav.hasClass('set-flyout-shown')) {
            Method.$nav.addClass('set-flyout-shown');
            $('body').css('overflow','hidden');
          }
          $('.header-flyout-close').one('click',function(){
            Method.MCflyoutHidden();
          });
          $(window).on( (Method.$reszieEvent + 'MC') , function(){
            if ( 'm' != Method.deviceMedia() ){
              Method.MCflyoutHidden();
            }
          });
        },
        MCflyoutHidden : function(){
          if (Method.$nav.hasClass('set-flyout-shown')) {
            Method.$nav.removeClass('set-flyout-shown');
            Method.PCflyoutHidden();
            Method.MCflyoutDetailHidden();

            $('body').css('overflow','visible');
            $(window).off( (Method.$reszieEvent + 'MC') );
          }
        },

        MCflyoutDetailVisible : function(selector){
          var method = this,
            resizeContain = function(flyout){
              flyout.closest('.list.level-1').animate({
                'height' : flyout.height()
              }, 213)
            }
					Method.$head.find('.head-title').text(selector.anchor.text());
          selector.item.add(Method.$head).add(selector.anchor).add(selector.flyout).addClass(Method.$active);
          resizeContain(selector.flyout);

          Method.$nav.find('.head-back').on('click',function(){
            Method.MCflyoutDetailHidden();
          })
          $(window).on( (Method.$reszieEvent + 'MCDetail') , function(){
            resizeContain(selector.flyout);
            if ( 'm' != Method.deviceMedia() ){
              Method.MCflyoutDetailHidden();
            }
          });
        },
        MCflyoutDetailHidden : function(){

          Method.$nav.find('.list.level-1').css({'height':'auto'});
          Method.$nav.removeClass(Method.$active).find(Method.$activeClass).removeClass(Method.$active);

          $(window).off( (Method.$reszieEvent + 'MCDetail') );
        }
      }

			$('.column-family-sites').on('click','.column-item-title',function(){
      if ('m' == Method.deviceMedia()){
        var el = $(this),
          parent = el.closest('.column-family-sites'),
          content = parent.find('.column-links'),
          speed = 250;
        if (!parent.hasClass('active')){
          parent.addClass('way');
          content.slideDown(speed, function(){
            parent.removeClass('way').addClass('active');
            content.removeAttr('style');
          });
        } else {
          parent.removeClass('active').addClass('way');
          content.show().slideUp(speed, function(){
            parent.removeClass('way');
            content.removeAttr('style');
          });

        }
      }
      return false;
    });

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-gnb]',
					attrName:'data-module-gnb',
					moduleName:'module_gnb',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			deviceMedia : function(){
        return Method.deviceMedia();
      },
			flyoutHidden : function(){
        Method.PCflyoutHidden();
        Method.MCflyoutHidden();
      },
			addWish : function (){
        var wish = $('.header-favorites');
        wish.addClass('set-changed');
        setTimeout(function(){
          wish.removeClass('set-changed');
        },426);
      }
		}
	});
})(Core);

(function(Core){
    Core.register('module_exchanged_payment', function(sandbox){
		var Method = {
		    $that:null,
			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);
				Method.$that = $this;
				$this.siblings('#popup-exchange-step02').find('button.exchange-payment-item').on("click", Method.checkout );
        //Method.$activeItem = $this.find(".payment-method-item.active");
				/* PAYMENT 다각화 대비
				Method.$submitBtn = $this.find('[data-checkout-btn]');
				Method.$submitBtn.on("click", Method.checkout );
				$this.find('[data-payment-method]').find('.payment-method-item-title').on('click', Method.changePaymentMethod);
				$this.find('[data-cod-btn]').on("click", Method.codCheckout );

				$(document).on('click','.payment-method-item-title', Method.changePaymentMethod_1);  //payment 종류 선택.
				*/

			},

	checkout:function(e){
        e.preventDefault();
          $(this).attr("enabled");

          var _self = $(this);
          var payItemList = $(this).closest("#popup-exchange").closest(".order-item-wrap");
          var orderItemList = $(this).closest("#popup-exchange-step02").find('[data-exchange-complete-list]');
          var orderNumber = $(this).closest("form").find('[name="orderReturnNumber"]').val();
          var $activeItem = Method.$that.find(".payment-method-item.active");
          var orderId = $(this).closest("#popup-exchange").find('[name="orderId"]').val();
          var returnOrderId = $(this).closest("#popup-exchange-step02").find('[name="returnOrderId"]').val();
          var exchageAmount = $(this).closest("#popup-exchange-step02").find('[data-exchange-amount]').text().replace(/[^0-9]/g,'');

          var $form = $(this).closest("#popup-exchange-step02").find('form');
          var param = $form.serialize() + '&exchageAmount=' + exchageAmount;

          if( $activeItem.data("type") == 'CREDIT_CARD' ){
            param += '&pay_method=card';
          } else {
            param += '&pay_method='+$activeItem.data("method");
          }

          sandbox.validation.validate( $form );
          if( sandbox.validation.isValid($form)){
            sandbox.utils.promise({
              url:sandbox.utils.contextPath + '/account/orders/exchangeable/requestPay',
              type:'POST',
              data:param
            }).then(function(data){
              sandbox.setLoadingBarState(true);
              if(data.isError == false){
                sandbox.setLoadingBarState(false);
                var paymentType = ($activeItem.length > 0) ? $activeItem.data("type") : null;
                endPoint.call("orderSubmit", { 'paymentType' : paymentType });

                if(data.payStatus == true){
                  //iamport 모듈
                  if( $activeItem.data('provider') == 'IAMPORT' ){
                    Method.checkoutIamport( $activeItem, data ,returnOrderId, payItemList, orderItemList);
                  }
                } else {
                  UIkit.modal.alert("교환 신청이 완료 되었습니다.").on('hide.uk.modal', function(){
                    location.href = sandbox.utils.contextPath + "/account/orders/returned";
                  });
                }
              }else{
                sandbox.setLoadingBarState(false);
                UIkit.modal.alert( data._global ).on('hide.uk.modal', function() {
                  location.reload();
                });

                // if(data._global == '선택 한 상품의 재고가 없습니다'){
                //   UIkit.modal.confirm(data._global + '<br/>해당상품의 수량변경 또는 삭제하여야 주문이 가능합니다.<br/>장바구니로 이동하시겠습니까?', function(){
                //     location.href = sandbox.utils.contextPath + '/account/orders/returned';
                //   });
                // }else{
                //   //Method.updateSubmitBtn( true );
                //   UIkit.modal.alert(data._global);
                // }
              }
            }).fail(function(msg){
                sandbox.setLoadingBarState(false);
                UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
                //Method.updateSubmitBtn( true );
            });
          }else{
            UIkit.modal.alert("교환 사유를 입력하여 주시기 바랍니다.");
          }

      },
      checkoutIamport:function( $activeItem, data ,returnOrderId, payItemList, orderItemList){
        // 결제 전일때

        var IMP = window.IMP;

        var paymentMethod = $activeItem.data("method"); // 결제 수단
        var mRedirectUrl = $activeItem.data("m-redirect-url"); // 모바일 url
        var noticeUrl = $activeItem.data("notice-url"); // 노티피케이션 url
        var version = $activeItem.data("version") || 'old'; // 에스크로 분기 처리를 위한 값  new or old
        var escrow = $activeItem.data("escrow"); // 에스크로 사용 여부

        var useReplaceReturnUrl = false;
        var cUrl = Core.Utils.url.getCurrentUrl();

        // 접근한 URL이 mshop 일 때
        if( cUrl.indexOf( 'www.' ) > -1 ){
          useReplaceReturnUrl = true;
        }else{
          // 접근한 URL이 mshop 이 아닌데 deviceOs 가 ios 일때
          if( String(Core.Utils.url.getQueryStringParams(cUrl).deviceOs ).toLowerCase() == 'ios' ){
            useReplaceReturnUrl = true;
          }
        }

        if( useReplaceReturnUrl ){
          if( mRedirectUrl != null ){
            mRedirectUrl = mRedirectUrl.replace('m.', 'www.');
          }
        }

        var appScheme = $activeItem.data("app-scheme"); // 모바일 앱 스키마 정보
        var identityCode = $activeItem.data("identity-code"); // iamport key
        var pg = $activeItem.data("pg");

        if( paymentMethod == '' || identityCode == '' || pg == ''){
          UIkit.modal.alert('결제 수단 정보로 인한 문제가 발생하였습니다.<br/>고객센터('+_GLOBAL.SITE.TEL+ ')로 문의 주시면 신속히 처리 도와드리겠습니다.');
          return;
        }

        IMP.init(identityCode);

        var $orderList = orderItemList.find("ul").find("li");
        var name = '(교환비) ' + $orderList.eq(0).find('.tit').text();
        if( $orderList.length > 1 ){
          name += ' 외 ' + ($orderList.length-1);
        }
        var buyerName = data.return_address.fullName;
        var param = {
          //pay_method : _GLOBAL.PAYMENT_TYPE_BY_IAMPORT[ paymentMethod ], // 추후 provider 에 따라 변수변경 *서버에서 내려오고 있음
          pg : pg,
          pay_method : paymentMethod, // 추후 provider 에 따라 변수변경
          merchant_uid : returnOrderId + '_' + new Date().getTime(),
          name: name,
          amount:data.total_amount.amount,
          buyer_email:data.emailAddress,
          buyer_name:buyerName,
          buyer_tel:data.return_address.phonePrimary.phoneNumber,
          buyer_addr:data.return_address.addressLine1 +' '+ data.return_address.addressLine2,
          buyer_postcode:data.return_address.postalCode,
          m_redirect_url:mRedirectUrl,
          app_scheme:appScheme,
          notice_url:noticeUrl,
          bypass:{acceptmethod:"SKIN(#111)"}
        };

        var depositPeriod = $activeItem.find('[name="depositPeriod"]').val() || 2;
        if( paymentMethod == 'vbank' ) {
          param.vbank_due = moment().add(depositPeriod, 'day').format('YYYYMMDD2359');
          param.custom_data = $activeItem.find('form').serialize().replace(/=/gi, ':').replace(/&/gi, '|');
        }
        if ($activeItem.data('type') == 'NAVER_PAY'){
					param.naverPopupMode = true;
					param.naverProducts = [];
					param.naverProducts.push({
            categoryType: 'ETC',
            categoryId: 'ETC',
            uid: 1,
            name: name,
            count: 1,
          })
				}
        if( escrow == true ){
          param.escrow = true;
        }
        console.log(param);
        IMP.request_pay(param, function(rsp) {
          //결제 완료시
          if ( rsp.success ) {
            var msg = '결제가 완료되었습니다.<br>';
            msg += '고유ID : ' + rsp.imp_uid + '<br>';
            msg += '상점 거래ID : ' + rsp.merchant_uid + '<br>';
            msg += '결제 금액 : ' + rsp.paid_amount + '<br>';
            msg += 'custom_data : ' + rsp.custom_data + '<br>';

            if ( rsp.pay_method === 'card' ) {
              msg += '카드 승인번호 : ' + rsp.apply_num + '<br>';
            } else if ( rsp.pay_method === 'vbank' ) {
              msg += '가상계좌 번호 : ' + rsp.vbank_num + '<br>';
              msg += '가상계좌 은행 : ' + rsp.vbank_name + '<br>';
              msg += '가상계좌 예금주 : ' + rsp.vbank_holder + '<br>';
              msg += '가상계좌 입금기한 : ' + rsp.vbank_date + '<br>';
            }
            //alert( msg );
            sandbox.setLoadingBarState(true);
            _.delay(function(){
              UIkit.modal.alert("배송비 결제가 완료되었습니다.");
              location.href = sandbox.utils.contextPath + '/checkout/iamport-checkout/hosted/return?imp_uid=' + rsp.imp_uid + '&pay_method=' + rsp.pay_method + '&pg_provider=' + rsp.pg_provider + '&custom_data=' + rsp.custom_data;
            }, 3000);
          }else{
            sandbox.setLoadingBarState(false);
            if( rsp.error_msg == '사용자가 결제를 취소하셨습니다'){
              endPoint.call('orderCancel');
            }
            UIkit.modal.alert( rsp.error_msg ).on('hide.uk.modal', function() {
              sandbox.setLoadingBarState(true);
              var cartId = Method.$that.find("input[name='cartId']").val();
              location.href = sandbox.utils.contextPath + '/account/orders/returnable';
            });
          }
        });
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-exchanged-payment]',
					attrName:'data-module-exchanged-payment',
					moduleName:'module_exchanged_payment',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_image_list', function(sandbox){
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var $item = $this.find('[data-image-item]');
				var total = $item.length;

				$item.on('mouseenter', function(){
					$(this).find('.hover').show();
				});

				$item.on('mouseleave', function(){
					$(this).find('.hover').hide();
				});
				
				if( $this.find('.not').length > 0 ){
				    $item.addClass('uk-width-medium-1-' + total); 
				}
				$this.show();
			},
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-image-list]',
					attrName:'data-module-image-list',
					moduleName:'module_image_list',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_forgot_username', function(sandbox){
		var Method = {
			$that:null,
			$form:null,
			$stepContainer:null,
			$errorAlert:null,
			moduleInit:function(){

				// listSize = 검색 결과 한번에 보여질 리스트 수
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);
				var $submitBtn = $this.find('button[type="submit"]');

				Method.$that = $this;
				Method.$form = $this.find("form");

				Method.$stepContainer = $this.find(".account-forgot");
				Method.$errorAlert = Method.$that.find('[data-error-alert]');

				$submitBtn.on('click', function(e){
					e.preventDefault();
					Method.searchSubmit();
				});


				// 검색된 리스트중 선택시
				// Method.$that.on('click', '[data-customer-select-btn]', Method.selectCutomer );

				$this.on('click', '[data-certify-btn]', Method.guestCertify );

				Method.$that.on('click', '[data-back-btn]', function(){
					Method.historyBack();
				});
				if(Method.$that.data('is-customer') === false){
					Method.showAlert('검색하신 내용을 찾을 수 없습니다. 다른 정보를 이용해 다시 검색해 주십시오.');
				}
				if(Method.$that.data('is-customer') === true){
					Method.viewCustomerList();
				}
			},

			updateSelectOrder:function(e){
				e.preventDefault();
				// 자신 버튼 숨기기
				$(this).parent().hide();
				// 자신 컨텐츠 켜기
				$(this).closest('li').find('[data-certify-content]').slideDown('300');
				// 다른 버튼 보이기
				$(this).closest('li').siblings().find('[data-customer-select-btn]').parent().show();
				// 다른 컨텐츠 숨기기
				$(this).closest('li').siblings().find('[data-certify-content]').hide();
			},

			searchSubmit:function(){
				sandbox.validation.validate( Method.$form );
				if( sandbox.validation.isValid( Method.$form )){
					sandbox.utils.ajax(Method.$form.attr("action"), 'POST', Method.$form.serialize(), function(data){
						Method.createCustomerList(JSON.parse( data.responseText ));
					});
				}
			},
			viewStep:function(num){
				Method.$stepContainer.addClass('uk-hidden');
				Method.$that.find('.step-' + num ).find('input[name="identifier"]').val('');
				Method.$that.find('.step-' + num ).removeClass('uk-hidden');
			},
			showAlert:function(msg){
				UIkit.modal.alert(msg);
			},
			hideAlert:function(){
				Method.$errorAlert.addClass('uk-hidden');
			},
			historyBack:function(){
				window.history.back();
			},
			viewCustomerList:function(){
				Method.$that.on('click', '[data-customer-select-btn]',  Method.updateSelectOrder );
				Method.viewStep(2);
			},
			createCustomerList:function(data){
				var result = data['result'];
				var $listContainer = Method.$that.find('.list-container');
				var list = data['ro'];
				var html = '';

				console.log(result);

				// if( result == true ){
				// 	if( list.length == 0 ){
				// 		Method.showAlert('검색하신 내용을 찾을 수 없습니다. 다른 정보를 이용해 다시 검색해 주십시오.');
				// 	}else{
				// 		$.each( list, function( index, li ){
				// 			li.useName = (li.fullName!=null && $.trim(li.fullName)!='');
				// 			li.dateCreated = li.dateCreated.slice(0, 10).split("-").join(".");
				// 		});
				//
				// 		html = Handlebars.compile($("#forgot-password-list").html())(list);
				//
				// 		$listContainer.html( html );
				// 		//console.log( list );
				// 		sandbox.moduleEventInjection( html );
				//
				// 		Method.$that.on('click', '[data-customer-select-btn]',  Method.updateSelectOrder );
				//
				// 		Method.viewStep(2);
				// 	}
				// }else{
				// 	Method.showAlert('검색하신 내용을 찾을 수 없습니다. 다른 정보를 이용해 다시 검색해 주십시오.');
				// }
				///customer/requestPasswordChangeUrl?successUrl=/recover&customer=
			},

			// 비회원 인증 처리
			guestCertify:function(){
				var type = $(this).attr('data-type');
				var customerId = $(this).closest('li').find('input[name="customerId"]').val();
				var email = $(this).closest('li').find('input[name="email"]').val();
				var phoneNum = $(this).closest('li').find('input[name="phonenum"]').val();
				var url = sandbox.utils.contextPath + "/login/requestPasswordChangeUrl";
				var messageType;

				if( type === 'email'){
					messageType = 'EMAIL';
				} else if ( type === 'sms' ){
					messageType = 'KAKAO';
				}
				sandbox.utils.ajax(url, 'POST', {
					customer : customerId,
					messageType : messageType,
					csrfToken : $('[name="csrfToken"]').val()
				}, function(data){
					var responseData = sandbox.rtnJson(data.responseText);
					if(responseData.result == true){
						if(type === 'email'){
							Method.viewStep(3);
						}else if(type === 'sms'){
							Method.viewStep(4);
						}
					}else{
						Method.showAlert(responseData['errorMsg']);
					}

				}, true );

				return;
			}

		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[ data-module-forgot-username ]',
					attrName:'data-module-forgot-username',
					moduleName:'module_forgot_username',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_kakao', function(sandbox){
		var $this, args;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];

				if(args.appid === 'null') console.log('kakao appid is defined');

				Kakao.init(args.appid);
				Kakao.Link.createDefaultButton({
					container:args.btnContainer,
					objectType:'feed',
					content:{
						title:$('title').text(),
						imageUrl:location.origin + args.feedImg,
						link:{
							mobileWebUrl:location.href,
							webUrl:location.href
						}
					},
					buttons:[
						{
							title:'웹으로 보기',
							link: {
								mobileWebUrl:location.href,
								webUrl:location.href
							}
						}
					]
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-kakao]',
					attrName:'data-module-kakao',
					moduleName:'module_kakao',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				console.log('product destory');
			}
		}
	});
})(Core);

// kakao 앱 브라우저에서의 동작 처리를 위한 모듈
// 회원가입, 로그인, 구매버튼 클릭시 카카오 로그인을 선 처리 한다.

// TODO inapp 에서만 처리 되는 내용이 아닌것으로 변경되어 네이밍 변경필요

(function (Core) {
    Core.register('module_kakao_in_app', function (sandbox) {
        var $this;

        var Method = {
            moduleInit: function () {
                $this = $(this);    
            },
            submitFormKakao: function (redirectUrl){
                var $form = $this.find('form[name="social_kakao_in_app"]');
                var url = sandbox.utils.url.getUri(sandbox.utils.url.getCurrentUrl());
                /*
                var locationHref = redirectUrl || url.path.replace(sandbox.utils.contextPath, '') + url.query;
                */
                var locationHref = redirectUrl || window.location.href;
                var locationPathname = window.location.pathname;
                
                // 현재 url param에 successUrl 정보가 있으면 그쪽으로 이동
                if (_.isEmpty(redirectUrl) && !_.isEmpty(url.queryParams.successUrl)) {
                    locationHref = url.queryParams.successUrl;
                } else if (locationPathname == '/login' || locationPathname == '/register' || locationPathname == '/login/forgotUsername' || locationPathname == '/login/forgotPassword') {
                    locationHref = url.url.replace(locationPathname, '');
                }
                if ( locationHref.indexOf( 'http' ) == -1){
                    locationHref = url.protocol + '//' + url.host + sandbox.utils.contextPath + locationHref;
                }
                if ($form) {
                    $form.append('<input type="hidden" name="state" value="' + locationHref.replace(/&/g, '%26') + '" />');
                    $form.submit();
                }
            }
        }

        return {
            init: function () {
                sandbox.uiInit({
                    selector: '[data-module-kakao-in-app]',
                    attrName: 'data-module-kakao-in-app',
                    moduleName: 'module_kakao_in_app',
                    handler: { context: this, method: Method.moduleInit }
                });
            },
            submit: function( redirectUrl ){
                Method.submitFormKakao(redirectUrl);
            }
        }
    });

})(Core);

(function(Core){
	Core.register('module_newsletter', function(sandbox){
		var $this, args, $submitBtn, endPoint;
		var Method = {
			moduleInit:function(){
				$this = $(this);
				$submitBtn = $this.find('.btn_join')
				args = arguments[0];
				endPoint = Core.getComponents('component_endpoint');

				var modal = UIkit.modal('#common-modal');
				var checkboxComponent = sandbox.getComponents('component_checkbox', {context:$this});
				var inputComponent = sandbox.getComponents('component_textfield', {context:$this}, function(){
					this.addEvent('enter', function(e){
						$submitBtn.trigger('click');
					});
				});

				$submitBtn.click(function(e){
					e.preventDefault();
					var _self = this;

					var $form = $(_self).closest('form');
					var param = $form.serialize();

					if(inputComponent.getValidateChk() && checkboxComponent.getValidateChk()){
						sandbox.utils.ajax($form.attr('action'), $form.attr('method'), param, function(data){
							var response = sandbox.rtnJson(data.responseText);

							if(response.hasOwnProperty('isSuccess')){
								endPoint.call('newsletterSubscribed');
								UIkit.notify(args.successMsg, {timeout:3000,pos:'top-center',status:'success'});
							}else if(response.hasOwnProperty('error')){
								UIkit.notify(response.error, {timeout:3000,pos:'top-center',status:'success'});
							}

							inputComponent.setValue('');
							checkboxComponent.getThis().trigger('click');
						});
					}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-newsletter]',
					attrName:'data-module-newsletter',
					moduleName:'module_newsletter',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				console.log('newsLetter destory');
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_launchcategory', function(sandbox){
		var $that, category;
		// var arrViewLineClass=['uk-width-medium-1-3', 'uk-width-large-1-2', 'uk-width-large-1-3', 'uk-width-large-1-4', 'uk-width-large-1-5'];
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var $cate = $(".launch-category");
				var $cate_header = $(".launch-lnb");

                if(arguments[0] && undefined != arguments[0].category){
					category = arguments[0].category;
				}

				//upcoming일때는 헤더 우측 뷰 변경 아이콘 숨기기
				if(category === 'upcoming'){
					$this.find('.toggle-box').hide();
				}
				// console.log('category:', category);
				

				var Listform = {
				    grid : function(setCookie){
				        $(".launch-list-item", $cate).removeClass("gallery").addClass("grid");
						$(".toggle-box span", $cate_header).removeClass("ns-grid").addClass("ns-feed");
						if(setCookie){$.cookie("launch_view_mode", "grid" , {path : "/"});}
				        
				    },
				    gallery : function(setCookie){
				        $(".launch-list-item", $cate).removeClass("grid").addClass("gallery");
				        $(".toggle-box span", $cate_header).removeClass("ns-feed").addClass("ns-grid");
				        if(setCookie){$.cookie("launch_view_mode", "gallery" , {path : "/"});}
					}
				};
				
				//날짜 순으로 상품 정렬
				var productListOrderedByDate = $cate.find('.launch-list-item').slice().sort(function(el1, el2){
					// var date1 = new Date($(el1).data('active-date')).getTime();
					// var date2 = new Date($(el2).data('active-date')).getTime();
					var date1 = Method.DateParse($(el1).data('active-date'));
					var date2 = Method.DateParse($(el2).data('active-date'));
				
					//descending
					//return -(date1 > date2) || +(date1 < date2) || (isNaN(date1)) - (isNaN(date2));
					//ascending
					return +(date1 > date2) || -(date1 < date2) || (isNaN(date1)) - (isNaN(date2));
				});

                //up-coming의 경우 날짜 순으로 정렬필요
				if(category ==="upcoming"){				
					$cate.find('.uk-grid').empty().append(productListOrderedByDate);
					
					(function(list){
						 var xYear = "", xMonth = "", xDay = "";
						 list.each(function(){
							 var 
								 $this = $(this),
								 date = $this.attr("data-active-date").split(" ")[0],
								 arrDate = date.split("-"),
								 year = arrDate[0],
								 month = arrDate[1],
								 day = arrDate[2];
								 
								 //월이나 일이 바뀌면
								 if ( xMonth !== month || xDay !== day ){
									 $this.before("<em class='upcoming-tit-date'>" + month + "월 " + day + "일</em>")
								 }
								 
								 //update state
								 xYear = year;
								 xMonth = month;
								 xDay = day;
 
						});
					
					})($cate.find('.launch-list-item'));
				 }

				if( $.cookie("launch_view_mode") && category !== "upcoming" ){
					( $.cookie("launch_view_mode") === "gallery" ) ? Listform.gallery(true) : Listform.grid(true);
				} 
				//쿠키가 없는 경우(우측 뷰 변경 아이콘을 누르지 않은 경우)
				//feed는 기본이 gallery, in-stock는 기본이 grid, updoming은 gallery만 있음.
				else if(!$.cookie("launch_view_mode")){
                    if(category ==="in-stock"){
						Listform.grid(false);
					} else {
						Listform.gallery(false)
					}
				}
				else {
					( category === "in-stock" ) && Listform.grid(true);
				}				

				$cate.css("opacity", "1");

                //마우스 클릭시 탭 하단 선택 표시
				$('.launch-menu').on('click', 'li', function(){
					$('.launch-menu li.on').removeClass('on');
					$(this).addClass('on');
				});
                //우측 뷰 변경 아이콘 
				$this.find('.toggle-box a').on('click', function(e){
				    
				    if( category === "feed" || category === "in-stock" ){
				        if( $(".launch-list-item", $cate).eq(0).hasClass("gallery") ){
				            Listform.grid(true);
				        }
				        else {
				            Listform.gallery(true);
				        }
				    }
				    else {
				    }
				    
					e.preventDefault();
					
				});
				//카테고리에서 상픔 클릭시 상단 탭 선택표시 off 및 우측 아이콘 숨김
				$('.launch-category .uk-grid div a').on('click', function(){
					$('.launch-menu li.on').removeClass('on');
				});
				Method.Counter();
			},
			DateParse:function(dateStr){
				var a=dateStr.split(" ");
				var d=a[0].split("-");
				var t=a[1].split(":");
				return new Date(d[0],(d[1]-1),d[2],t[0],t[1],t[2]);
			},
			Counter: function(){
				var aDate, dDate;
				var cDate = moment();
				var item = $('[data-active-date]');
				var zf = function(num){
					num = Math.abs(num).toString();
					if (num.length < 2) {
						num = '0' + num;
					}
					return num;
				};
				if (item.length) {
					var locationSearch = Core.Utils.getQueryParams(location.href);
					if (locationSearch.type && locationSearch.type == 'upcoming') {
						var locationSearchStr = '';
						Object.keys(locationSearch).forEach(function(key, eq){
							locationSearchStr +=  eq == 0 ? '?' : '&';
							locationSearchStr += key + '=';
							switch (key){
								case 'type': locationSearchStr += 'in-stock';break;
								case 'activeDate': locationSearchStr += 'date-filter:BEFORE';break;
								default : locationSearchStr += locationSearch[key];break;
							}
						});
					}
					item.each(function(_,el){
						el = $(el);
						aDate = moment(el.data('activeDate'));
						dDate = moment.duration(aDate.diff(cDate));
						if (dDate._milliseconds > 0){
							dDate = dDate._data;
							dDate = zf(( Math.abs(dDate.days) * 24 ) + Math.abs(dDate.hours) ) + ':' + zf(dDate.minutes) + ':' + zf(dDate.seconds);
							el.find('.product-countdown').find('.countdown-display').html(dDate);
						} else {
							el.removeAttr('data-active-date');
							el.find('.product-countdown').remove();
							if (Method.interval) {
								if (locationSearch.type && locationSearch.type == 'upcoming') {
									window.location.hash = 'limited-edition-list';
									window.location.search =locationSearchStr;
								} else {
									window.location.reload(true);
								}
							}
						}
					});
					if (!Method.interval) Method.interval = setInterval(Method.Counter, 999);
				} else {
					clearInterval(Method.interval);
				}
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-launchcategory]',
					attrName:'data-module-launchcategory',
					moduleName:'module_launchcategory',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){ /* BOPIS & LOPIS PICKUP LOCATION LAYER */
    Core.register('module_pickup_location', function(sandbox){
    var $this,
        hasLocalNo,
        storeMap,
        storeInfo,

        pickupLocation = {
            currentLocation: null,
            storeList: [],
            localSelect: [],
            locationCodeWrap: false,
            storeAll: false,
            sortLt: false,
            sortNa: false,
            sortQt: false,
        },
        pickupshippingInfo = { isshippingInfo: false, storeInfo: null, itemRequest: null},

        pickupQuantity={
            isTaskQuantity:false,
            productPrice:0,
            newValue:0,
            min:0,
            max:0,
            size:0,
            quantity:{
                maxQuantity:1,
                msg:'개 까지만 구매가능 합니다.',
                quantityStateMsg:'상품의 수량이 없습니다.'
            }
        },

        totalPickupLocation = {},
        location_inventory = {},

        args={},

        $btn,
        serviceMenData={},
        reservationData={},
        arrInventoryList,
        itemRequest,
        confirmData,
        selectedProduct,
        hasLocalNo,
        needMakeMap,
        areaMap = new Map();


    // 내 주변순 위도 : 경도
    function calculateDistance (lat1, lon1, lat2, lon2) {

        var theta = lon1 - lon2;
        var dist = Math.sin(deg2rad(lat1)) * Math.sin(deg2rad(lat2)) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.cos(deg2rad(theta));

        dist = Math.acos(dist);
        dist = rad2deg(dist);

        dist = dist * 60 * 1.1515;
        dist = dist * 1.609344; // 킬로미터 단위적용

        function deg2rad (deg) {
            return (deg * Math.PI / 180.0);
        }

        function rad2deg (rad) {
            return (rad * 180 / Math.PI);
        }

        return dist;
    }

    //사이즈 선택
    var sizeOptionToggle = function (size, skuID) {
        $this.find('.size-select-txt').text(size);
        $this.find('#reservation-size-title-area').removeClass('uk-active');
        $this.find('.uk-accordion-content').removeClass('uk-active');
        $this.find('.accordion-wrapper').animate({'height':0}, 300, "linear", function () {});

        $this.find('input[name="itemAttributes[size]"]').val(size);

        pickupQuantity.size = parseInt(size);
        vueContainer.pickupLocation(size, skuID);
    }

    // vue 컴포넌트 초기화
    var vueContainer = new Vue({
      el:'#idLocationSearch',
      data: {
        'location': pickupLocation,
        'shippinginfo': pickupshippingInfo,
        'quantity': pickupQuantity,
        'quantityNo': 0,

        'skuIdNe': '',
        'sizeIdNe': '',
        'localSelect': [],
        'stateList': [],
        'storeType': [],
        'sortCheck': 'allcheck',

        'dataList': [],
        'inventory': [],

        'currentSort': 'name',
        'currentSortDir': 'asc',

        'tag': false,
        'flag': false,
      },
      created: function () {
          var vm = this;

          // 오늘 날짜 location 대입
          var today = new Date(),
              yyyy = today.getFullYear(),
              mm = today.getMonth() + 1,
              dd = today.getDate();

          if (dd < 10) dd = '0' + dd
          if (mm < 10) mm = '0' + mm
          today = String(yyyy) + String(mm) + String(dd);


          sandbox.utils.promise({
            url: sandbox.utils.contextPath + '/cmsstatic/fulfillment-location-json/file/fulfill-location.json',//location-'+ today +'.json',
            type: 'GET'
          }).then(function (data) {
      			var $defer = $.Deferred();
      			if(data !== ''){
      				vm.dataList = JSON.parse(data);
      				$defer.resolve(data);
      			}else{
      				$defer.reject('location info is empty');
      			}
      			return $defer.promise();
          })
          .then(function(data){

            vm.dataList.filter(function (row, index) {

              vm.localSelect[index] = {
                active: true,
                'view': 'hide',
                'id': row.id,
                'name': row.name,
                'state': row.state,
                'latitude': row.latitude,
                'longitude': row.longitude,
                'externalId': row.externalId
               };

              // 사이즈 선택 시 해당 지역만 필터에 노출
              vm.localSelect.filter(function (row) {
                  var _id = row.id;
                  var _externalId = row.externalId;
                  vm.inventory.some(function (size) {
                    var _size = size.fulfillmentLocationId;
                    if (_id == _size && _externalId !== undefined) row.view = 'show';
                  });
                  if (row.view !== 'show') row.state = '';
              });
            });
            //중복처리
            vm.localSelect = _.unionBy(vm.localSelect, vm.localSelect, 'state');
      		})
          .fail(function (msg) {
            UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'danger'});
          });
        },

        computed: {
          localSelect: function () {
            return this.localSelect;
          },
          storeList: function (s) {
            var vm = this;
            var flag = this.flag;

            vm.stateList = vm.storeType.concat(vm.localSelect);

            return this.dataList.filter(function (row, index) {

              var _id = row.id;
              var _state = row.state;
              var _externalId = row.externalId;

              if( _externalId !== undefined){

                row.locationTarget = calculateDistance(serviceMenData.latitude, serviceMenData.longitude, row.latitude, row.longitude);

                row.isAbleCod = (args.ableCod === 'true') ? true : false;
                row.isAblePickup = (args.ablePickup === 'true') ? true : false;

                return vm.inventory.some(function (size) {

                  var _size = size.fulfillmentLocationId;

                  if (_id == _size) {
                    row.quantityNo = size.quantityAvailable;
                  }

                  return vm.stateList.some(function (tag) {
                    if (!flag) {
                      return _id == _size && tag.active === true;
                    } else {
                      return _id == _size && tag.state == _state && tag.active === true;
                    }
                  });
                });
              }

            }).sort(function (a, b) {

              // 정렬기준 변경 시 스크롤 top
              $(".reservation-wrap .store-list, .Store_sortArea").scrollTop(0);

              if (vm.currentSortDir === 'desc') {
                if (a[vm.currentSort] < b[vm.currentSort]) return 1;
                if (a[vm.currentSort] > b[vm.currentSort]) return -1;
              } else {
                if (a[vm.currentSort] < b[vm.currentSort]) return -1;
                if (a[vm.currentSort] > b[vm.currentSort]) return 1;
              }
              return 0;
            });
          },

          storeType: function () {
            return this.storeType
          },

          localSelect: function () {
            return this.localSelect
          }
        },

      methods:{
        closeModal: function(){
          $this.find('.dim').removeClass('active');
          $('#store_info_Modal').hide();
        },
        pickupLocation: function (size, skuId) {
          var vm = this;

          this.skuIdNe = skuId;
          this.sizeIdNe = size;

          sandbox.utils.promise({
            url: sandbox.utils.contextPath + '/processor/execute/pickable_inventory',
            type: 'GET',
            data: {
              'skuId': skuId,
              'json': 'true',
              'fType': 'PHYSICAL_PICKUP',
              'jsonCache': 'false'
            }
          }).then(function (data) {
            vm.inventory = data;

            vm.dataList.filter(function (row, index) {
              vm.localSelect[index] = {
                active: true,
                'view': 'hide',
                'id': row.id,
                'name': row.name,
                'state': row.state,
                'latitude': row.latitude,
                'longitude': row.longitude,
                'externalId': row.externalId
               };
            });

            // 사이즈 선택 시 해당 지역만 필터에 노출
            vm.localSelect.filter(function (row) {
                var _id = row.id;
                var _externalId = row.externalId;
                vm.inventory.some(function (size) {
                    var _size = size.fulfillmentLocationId;
                    if (_id == _size && _externalId !== undefined) row.view = 'show';
                });
                if (row.view !== 'show') row.state = '';

            });

            vm.localSelect = _.unionBy(vm.localSelect, vm.localSelect, 'state');

            // 사이즈 변경 시 초기화
            vm.localSelect.filter(function (row) {
                row.active = true;
            });
            pickupLocation.storeAll = true;


            // 사이즈 변경 시 스크롤 top
            $(".reservation-wrap .store-list, .Store_sortArea").scrollTop(0);

          }).fail(function (msg) {

          });
        },

        sort: function (s) {
          switch (s) {
            case 'locationTarget': this.currentSortDir = 'asc'; break;
            case 'name': this.currentSortDir = 'asc'; break;
            case 'quantityNo': this.currentSortDir = 'desc'; break;
          }

          this.currentSort = s;
        },

        toggle: function (bools) {
          this.flag = JSON.parse(bools);
          var vm = this;

          if (this.flag) { // 지역선택

            pickupLocation.storeAll = false;

          } else { // 전체

            if(pickupLocation.storeAll) {
              vm.localSelect.filter(function (row) {
                  row.active = false;
              });
              pickupLocation.storeAll = false;

            } else {
              vm.localSelect.filter(function (row) {
                  row.active = true;
              });
              pickupLocation.storeAll = true;
            }

          }
        },

        pickupOrderQuantity: function (storeId, pickupType, maxQuantity) { // 수량 선택
          var $form = $this.find('form');
          var itemRequest = BLC.serializeObject($form);

            var _pickupType = (pickupType === 'lopis') ? true : false;

            itemRequest.isJustReservation = _pickupType
            itemRequest.titleName = (pickupType === 'lopis') ? '예약' : '픽업';

            $this.find('#isJustReservation').val(_pickupType);
            $this.find('#fulfillmentLocationId').val(storeId);

          itemRequest.fulfillmentLocationId = storeId;
          pickupshippingInfo.itemRequest = itemRequest;

          for (var i = 0; i < totalPickupLocation.length; i++) {
            if (totalPickupLocation[i].id == storeId) {
              pickupshippingInfo.storeInfo = totalPickupLocation[i];
            }
          }

          pickupQuantity.isTaskQuantity = true;
          pickupQuantity.quantity.maxQuantity = pickupQuantity;
          $this.find('.dim').addClass('active');
        },

        orderConfirmSubmit: function() {
          Method.executeOrderCountFinish();
        },

        orderCancel: function (status) {
          $this.find('.dim').removeClass('active');

          var _productPriceDefault = $this.find('#productPriceDefault').val();

          // 상품가격 초기화
          $this.find('#productPrice').val(_productPriceDefault);
          $this.find('#retailPrice').val(_productPriceDefault);

          switch (status) {
            case 'shippinginfo' :
              pickupshippingInfo.isShippingInfo = false;
              break;
            case 'quantity' :
              pickupQuantity.isTaskQuantity = false;
              break;
          }
        }
      }
    });

    // template
    Vue.component('pickup-location', {
      props: ['currentLocation', 'locationCodeWrap', 'storeAll', 'storeList', 'dp', 'st', 'ls', 'sort', 'toggle', 'sortLt', 'sortNa', 'sortQt'],
      template:'<div>\
          <div class="Store_sortArea">\
      			<dl>\
      				<dt>정렬방식</dt>\
  						<dd class="btn-location-self mobile-only" v-bind:class="{active:sortLt}">\
                <span class="input-radio">\
                  <input type="radio" id="MyLocation_Sort" name="Store_SortName" />\
                  <label for="MyLocation_Sort" v-on:click="findLocation">\
                    <i class="brz-icon-radio"></i>\
                    내 주변 순\
                  </label>\
                </span>\
              </dd>\
  						<dd class="store-name" v-bind:class="{active:sortNa}">\
                <span class="input-radio">\
                  <input type="radio" id="Store_Sort" name="Store_SortName" checked />\
                  <label for="Store_Sort" v-on:click="sort(\'name\')">\
                    <i class="brz-icon-radio"></i>매장명 순\
                  </label>\
                </span>\
              </dd>\
  						<dd class="prd-cnt" v-bind:class="{active:sortQt}" >\
                <span class="input-radio">\
                  <input type="radio" id="quantity_Sort" name="Store_SortName" />\
                  <label for="quantity_Sort" v-on:click="sort(\'quantityNo\')">\
                    <i class="brz-icon-radio"></i>\
                    재고 순\
                  </label>\
                </span>\
              </dd>\
            </dl>\
            <dl class="code-wrap_radio">\
              <dt>지역선택</dt>\
							<dd>\
                <span class="input-checkbox">\
                <input type="checkbox" id="storeAll" name="storelocalAll" v-model="storeAll" />\
                <label for="storeAll" id="storeAll" v-on:click="toggle(\'false\')"><i class="brz-icon-checkbox"></i>전체</label>\
                </span>\
							</dd>\
							<dd v-for="(tag, index) in ls" v-if="tag.view === \'show\'">\
                <span class="input-checkbox">\
                <input type="checkbox" name="storelocal" v-model="tag.active" v-bind:id="\'storelocal\' + index" />\
                <label v-bind:for="\'storelocal\' + index" v-on:click="toggle(\'true\')"><i class="brz-icon-checkbox"></i>{{ tag.state }}</label>\
                </span>\
							</dd>\
      			</dl>\
      		</div>\
          <div class="dim"></div>\
          <div class="store-list">\
            <!--/* 상품예약 서비스 상점 리스트 */-->\
            <div class="shipping-body">\
              <template v-if="dp.length">\
                <div v-for="store in dp" class="shipping-list" v-bind:data-locationid="store.id">\
                  <div class="column column-addr" v-on:click="shippinginfo(store.id)" style="cursor:pointer;">\
                    <h2 class="tit">{{store.name}}</h2>\
                    <dl class="address-wrap">\
                      <dd class="addr">({{store.zip}}) {{store.address1}} {{store.address2}}</dd>\
                      <dd class="addr">{{store.phone}}</dd>\
                    </dl>\
                  </div>\
                  <div class="column column-reserve">\
                    <span class="quantity" v-if="store.quantityNo <= 10">{{store.quantityNo}}</span>\
                    <span class="quantity" v-if="store.quantityNo > 10">10+</span>\
                    <button v-on:click="runOrderTask" v-bind:data-locationid="store.id" v-bind:data-maxquantity="store.quantityNo" data-pickup-type="bopis" class="pickup-apply btn-link mini">픽업 신청</button>\
                  </div>\
                </div>\
              </template>\
              <template v-else>\
                <div class="less-items uk-text-center">\
                  <i class="icon-search color-less x2large"></i><br />\
                  해당 지역의 매장정보가 없습니다.\
                </div>\
              </template>\
            </div>\
          </div>\
        </div>',
      methods:{
        currentLocation:function(e){
          e.preventDefault();
          /* 위치기반 서비스 개발 */
          this.$emit('currentLocation');
        },
        runOrderTask:function(e){

            e.preventDefault();

            var storeId = e.target.getAttribute('data-locationid');
            var pickupType = e.target.getAttribute('data-pickup-type');
            var maxQuantity = e.target.getAttribute('data-maxquantity');

            pickupQuantity.min = 1;
            pickupQuantity.newValue = 1;
            pickupQuantity.max = maxQuantity;

            for (var i = 0; i < this.dp.length; i++) {
                if (this.dp[i].id == storeId) {
                    pickupshippingInfo.storeInfo = this.dp[i];
                }
            }

            pickupQuantity.productPrice = sandbox.rtnPrice($this.find('#productPriceDefault').val());

            this.$emit('ordertask', storeId, pickupType, maxQuantity);
        },

        locationCodeClose: function (e) {
          e.preventDefault();
          pickupLocation.locationCodeWrap = false;
        },

        locationSelect: function (e) {
          e.preventDefault();
          pickupLocation.locationCodeWrap = true;
        },
        findLocation:function(e){
          // 사용자 위치 정보 조회 (재고 보유 매장의 위치 정보를 얻어와 내주변 정렬하기 위한 기능)
          Core.Loading.show();

          var vm = this;
          var positionOpt = {
              enableHighAccuracy : true,
              maximumAge : 5000,
          };

          if (!navigator.geolocation) {

              UIkit.notify("내 위치 정보를 찾을 수 없습니다.", {timeout:3000, pos:'top-center',status:'warning'});
              //showPositionError({"error":"ERROR - Geolocation is not supported by this agent"});
              Core.Loading.hide();
          }

          function success(position){
            if(serviceMenData['latitude'] != position.coords.latitude || serviceMenData['longitude'] != position.coords.longitude) {
                serviceMenData['latitude']  = position.coords.latitude;  // API RESERVE
                serviceMenData['longitude'] = position.coords.longitude; // API RESERVE
            }

            pickupLocation.currentLocation = serviceMenData;
            // if(isOnLoad===false) {
            //     loadStoreIfRadioChange();
            // }
            vm.sort('locationTarget');
            Core.Loading.hide();
          }

          function error(){
            Core.Loading.hide();
            //에러 시 radio의 checked 를 재고명 radio로 변경
            vm.sort('name');
            $("#MyLocation_Sort").attr('checked',false)
            $("#Store_Sort").attr('checked',true)

            alert('위치정보를 이용할 수 없습니다.')
            //UIkit.notify("내 위치 정보를 찾을 수 없습니다..", {timeout:3000, pos:'top-center',status:'warning'});
          }

          navigator.geolocation.getCurrentPosition(success, error);
        },
        shippinginfo:function(storeId){
          var $form = $this.find('form');
          var itemRequest = BLC.serializeObject($form);

          itemRequest.fulfillmentLocationId = storeId;
          pickupshippingInfo.itemRequest = itemRequest;

          for (var i = 0; i < this.dp.length; i++) {
              if (this.dp[i].id == storeId) {
                  pickupshippingInfo.storeInfo = this.dp[i];
              }
          }

          var storeLat = pickupshippingInfo.storeInfo.latitude;
          var storeLong = pickupshippingInfo.storeInfo.longitude;

          var Setpositon = new naver.maps.LatLng (storeLat, storeLong)

          //맵크기 조정
          var $thisWidth = $this.width();
          storeMap.setSize(new naver.maps.Size($thisWidth,200));
          $(window).resize(function(){ //with 반응형
            var $thisWidth = $this.width();
            storeMap.setSize(new naver.maps.Size($thisWidth,200));
          });



          //위도, 경도 값으로 지도 마커 찍어내기
          var marker = new naver.maps.Marker({
            map:storeMap,
            position:Setpositon,
            title:pickupshippingInfo.storeInfo.longitude.name,
            icon:"https://image.converse.co.kr/assets/images/marker-converse.png",
            zoom: 10
          });

          //팝업닫으면 찍었던 마크 삭제
          $('#store_info_Modal .uk-close').click(function(){
            marker.setMap(null);
          })

          //맵 해당 매장 포지션 Center
          storeMap.setCenter(Setpositon);
          storeMap.setZoom(10);

          $this.find('.dim').addClass('active');
          $("#store_info_Modal").show();
          $("#store_info_Modal .address-wrap").scrollTop(0);
          pickupshippingInfo.isShippingInfo = true;
        }
      }
    });

    Vue.component('pickup-shippinginfo', {
      props:['isshippingInfo', 'storeInfo', 'itemRequest'],
      template:'<div class="contents store" v-bind:class="{active:isshippingInfo}" v-if="storeInfo != null">\
            <p>{{storeInfo.name}}</p>\
            <dl class="address-wrap">\
              <dt class="addr-type">주소</dt>\
              <dd class="addr">({{storeInfo.zip}}) {{storeInfo.address1}} {{storeInfo.address2}}</dd>\
              <dt class="addr-type">전화번호</dt>\
              <dd class="addr">{{storeInfo.phone}}</dd>\
              <dt class="addr-type">영업시간</dt>\
              <dd class="addr">{{ storeInfo.additionalAttributes["caTimeTxt"] == null || storeInfo.additionalAttributes["caTimeTxt"] == " " ? "매장으로 연락 주시기 바랍니다."  : storeInfo.additionalAttributes["caTimeTxt"] }}</dd>\
              <dt class="addr-type">휴무일</dt>\
              <dd class="addr">{{ storeInfo.additionalAttributes["holidayTxt"] == null || storeInfo.additionalAttributes["holidayTxt"] == " " ? "별도 휴무일이 없습니다." : storeInfo.additionalAttributes["holidayTxt"] }}</dd>\
            </dl>\
          </div>',
      methods: {
        cancel: function () {
          this.$emit('cancel', 'shippinginfo');
        }
      }
    });

    Vue.component('pickup-quantity', {
      props:['isTaskQuantity', 'productPrice', 'quantity', 'cf', 'newValue', 'max', 'min', 'itemRequest'],
      template:'<article id="order-count-select" class="order-count" v-bind:class="{active:isTaskQuantity}" v-bind:data-component-quantity="quantity">\
          <a class="uk-close order-count-select-close" v-on:click="cancel"></a>\
          <h2 class="title">수량 선택</h2>\
          <div class="body">\
            <div class="count">\
              <div class="count-box">\
                <input type="number" v-model="newValue" class="label" readonly />\
                <button type="button" id="count-plus" v-on:click="plusBtn" class="plus"><i class="icon-plus"></i><span>1개씩 추가</span></button>\
                <button type="button" id="count-minus" v-on:click="minusBtn" class="minus"><i class="icon-minus"></i><span>1개씩 삭제</span></button>\
              </div>\
              <div class="price-box">{{productPrice}}</div>\
            </div>\
            <p class="msg" v-if="newValue == max">{{max + quantity.msg}}</p>\
            <!--/* <button type="button" class="qty-selected btn-link width-max large" v-on:click="selected">선택완료</button>*/-->\
            <a href="javascript:;" class="reservation-apply btn-link width-max large" data-click-area="inventory" v-on:click="submit">픽업하기</a>\
          </div>\
        </article>',
      methods: {
        plusMinusFun: function (operator, num) {

          var productPrice = $this.find('#productPrice').val();
          var productPriceDefault = $this.find('#productPriceDefault').val();

          if (operator == 'plus') {
            var count = parseInt(productPrice) + parseInt(productPriceDefault);
          } else {
            var count = parseInt(productPrice) - parseInt(productPriceDefault);
          }

          $this.find('#productPrice').val(count);
          $this.find('#retailPrice').val(count);
          $this.find('#quantity').val(num);

          pickupshippingInfo.itemRequest.quantity = num;
          pickupshippingInfo.itemRequest.retailprice = sandbox.rtnPrice(String($this.find('#productPrice').val()));

          this.productPrice = sandbox.rtnPrice(String($this.find('#productPrice').val()));
        },
        plusBtn: function () {
          if(this.max == undefined || (this.newValue < this.max)) {
            this.newValue = this.newValue + 1;
            this.plusMinusFun('plus', this.newValue);
          }
        },
        minusBtn: function () {
          if((this.newValue) > this.min) {
            this.newValue = this.newValue - 1;
            this.productPrice = this.productPrice * 2;
            this.plusMinusFun('minus', this.newValue);
          }
        },
        selected: function (e) {
            e.preventDefault();
            pickupshippingInfo.itemRequest.size = pickupQuantity.size;
            this.$emit('selected', 1);
            this.$emit('submit');
        },
        submit:function(e){
            e.preventDefault();

            this.$emit('selected', 1);
            this.$emit('submit');
        },
        cancel: function () {
          //pickupQuantity.isTaskQuantity = false;
          this.$emit('cancel', 'quantity');
        }
      },
      created: function() {

      }
    });

    var Method = {
        updateAreaAgencyCnt:function(hasLocalNo, areaMap){
            try {
                var countVal,
                    areaId;

                if(hasLocalNo==false) {//지역미선택
                    $this.find('[data-area-info]').each(function(){
                        areaId = $(this).attr('value');
                        countVal = areaMap[areaId];
                        if(typeof(countVal)==="undefined") {
                            countVal = "0";
                          }
                        $this.find('#area-branch-cnt-' + areaId).text(countVal);
                    });
                } else { //지역선택시 해당 지역만 초기화
                    var areaList = [];
                    for(var areaId in areaMap){
                        $this.find('#area-branch-cnt-' + areaId).text(areaMap[areaId]);
                    }
                }
            } catch (e) {
                //alert("지역 초기화중 에러 : "+ e);
            }
        },

        executeOrderCountFinish:function(){
            Core.getModule('module_header').setLogin(function(){
                var $form = $this.find('form');

                // form value
                var itemRequest = BLC.serializeObject($form);

                sandbox.setLoadingBarState(true);

                BLC.ajax({
                    url:$form.attr("action"),
                    type:"POST",
                    dataType:"json",
                    data: itemRequest
                },function (data) {
                    if(data.error){
                        sandbox.setLoadingBarState(false);
                        UIkit.modal.alert(data.error);
                        UIkit.modal('#common-modal').hide();
                    }else{
                        Core.Loading.show();
                        endPoint.call( 'buyNow', itemRequest);
                        _.delay(function(){
                            window.location.assign(sandbox.utils.contextPath +'/checkout' );
                        }, 500);
                    }
                }).fail(function(msg){
                    if(commonModal.active) commonModal.hide();
                    Core.Loading.hide();
                    if(msg !== '' && msg !== undefined){
                        UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'warning'});
                    }
                });
            });
        },

        moduleInit:function () {
            $this = $(this);
            args = arguments[0];
            var skuData;

            if(!window.naver){
              $.getScript("https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=" + args.mapkey, function(){
                //지도생성
                storeMap = new naver.maps.Map('map_area', {
                    center: new naver.maps.LatLng(37.3595704, 127.105399),
                    zoom: 10
                });
              });
            };

            var currentDate = new Date();
            var reservationModal = UIkit.modal('#reservation-modal', {center:true});
            var disabledDays = [];
            var AllskuData =  sandbox.getComponents('component_product_option', {context:$(document)}, function(i){
                skuData = this.getDefaultSkuData();
            })
            var radioComponent = sandbox.getComponents('component_radio', {context:$this}, function(i) {
                var _self = this;
                var INDEX = i;

                this.addEvent('change', function(size){
                    var skuID = 0;
                    var _this = this;
                    skuData.some(function (size) {
                        for(var a = 0; a < size.selectedOptions.length; a++){
                          if(size.selectedOptions[a] == $(_this).data('id')){
                            skuID = size.skuId;
                            return skuID;
                          }
                        }
                    });
                    sizeOptionToggle(size, skuID);
                });

                // PDP 사이즈값 받아오기
                var pdp_option_size = $('.option-wrap .hidden-option[name="itemAttributes[size]"]').val();
                if (pdp_option_size) {
                    this.trigger(pdp_option_size, pdp_option_size);
                }
                // PDP COLOR 값 받아오기
                var pdp_option_color = $('.option-wrap .hidden-option[name="itemAttributes[Color]"]').val();
                if (pdp_option_color) {
                  $('.reservation_product input[name="itemAttributes[Color]"]').val(pdp_option_color);
                }else{
                  pdp_option_color = $('.option-wrap [data-attribute-name=Color] input').attr('data-value');
                  $('.reservation_product input[name="itemAttributes[Color]"]').val(pdp_option_color);
                }
            });
        }
    }

    return {
        init:function(){
            sandbox.uiInit({
                selector:'[data-module-pickup-location]',
                attrName:'data-module-pickup-location',
                moduleName:'module_pickup_location',
                handler:{context:this, method:Method.moduleInit}
            });
        }
    }
});

})(Core);

(function(Core){
	Core.register('module_launchproduct', function(sandbox){
		var currentFirstOptValue = '';
		var currentQuantity = 1;
		var itemAttributes = '';
		var miniOptionIS = false;
		var objProductOption = {};
		var minOffsetTop = 30;
		var maxOffsetTop = 0;
		var args = null;
		var $this;
		var imgCurrentIndex;
		var categoryId = '';
		var productId = '';
		var productDrawId = '';
		var skuId = '';
		var isQuickView = false;
		var isQuantity = true;
		var productOption;
		var quantity;
		var endPoint;
		var privateId;
		var currentSkuData;
		var pickupModal;
		var itemRequest;

		var quantityCheck = function(inventoryType, maxQty){
			var obj = {isQuantity:false, maxQty:0}
			if(inventoryType !== 'UNAVAILABLE'){
				if(inventoryType === 'CHECK_QUANTITY'){
					obj.isQuantity = (maxQty > 0) ? true : false;
					obj.maxQty = maxQty;
				}else if(inventoryType === 'ALWAYS_AVAILABLE'){
					obj.isQuantity = true;
					obj.maxQty = null;
				}
			}else{
				obj.isQuantity = false;
				obj.maxQty = 0;
			}

			return obj;
		}

		var defaultSkuSetup = function(productOptComponents){
			var skuData, quantityState;
			if(!productOptComponents) return;
			if(quantity){
				if(Array.isArray(productOptComponents)){
					$.each(productOptComponents, function(i){
						skuData = this.getDefaultSkuData()[0];
						quantityState = quantityCheck(skuData.inventoryType, skuData.quantity);
						quantity[i].setMaxQuantity(quantityState.maxQty);
						isQuantity = quantityState.isQuantity;
					});
				}else{
					skuData = productOptComponents.getDefaultSkuData()[0];
					quantityState = quantityCheck(skuData.inventoryType, skuData.quantity);
					quantity.setMaxQuantity(quantityState.maxQty);
					isQuantity = quantityState.isQuantity;
				}
			}
		}

		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];
				categoryId = sandbox.utils.getQueryParams(location.href).categoryid;
				productId = args.productId;
				productDrawId = args.productDrawId;
				privateId = args.privateId;
				referCategoryId = args.categoryId;
				endPoint = Core.getComponents('component_endpoint');

				var $dim = $('[data-miniOptionDim]');
				var guideModal = UIkit.modal('#guide', {modal:false});
				var commonModal = UIkit.modal('#common-modal', {modal:false});
				var pickUpModal = UIkit.modal('#pickup-modal', {modal:false});
				var miniCartModule = sandbox.getModule('module_minicart');
				//var pickUpModal = UIkit.modal('#pickup-popup', {modal:false});
				var gallery = sandbox.getComponents('component_gallery', {context:$this});
				var $infoHeightWrap = $('[data-info-height]');
				var snsInputCheck = $(".product-draw-inputs").length > 0;


				var addonProductGroup = {};
				var addonComponents = sandbox.getComponents('component_addon_product_option', {context:$(document)}, function(i){
					var INDEX = i;
					var key = this.getAddonId();

					if(!addonProductGroup.hasOwnProperty(key)){
						addonProductGroup[key] = [];
						INDEX = i;
					}else{
						INDEX++;
					}
					addonProductGroup[key].push(this);

					this.addEvent('addToAddOnItem', function(privateId, $selected){
						for(var i=0; i<addonProductGroup[key].length; i++){
							if(i != INDEX){
								addonProductGroup[key][i].setTrigger($selected.val(), privateId);
							}
						}
					});

					this.addEvent('itemDelete', function(privateId){
						for(var i=0; i<addonProductGroup[key].length; i++){
							if(i != INDEX){
								addonProductGroup[key][i].removeItems();
							}
						}
					});
				});

				quantity = sandbox.getComponents('component_quantity', {context:$(document)}, function(i){
					var INDEX = i;
					this.addEvent('change', function(qty){
						for(var i=0;i<quantity.length;i++){
							if(i !== INDEX){
								quantity[i].setQuantity(qty);
							}
						}
					});
				});


				var currentOptValueId = '';
				productOption = sandbox.getComponents('component_product_option', {context:$(document)}, function(i){ //product Option select components
					var CURRENT_INDEX = i;
					var INDEX = 0;
					var _self = this;
					var key = this.getProductId();


					if(!objProductOption.hasOwnProperty(key)){
						objProductOption[key] = [];
						INDEX = 0;
					}else{
						INDEX++;
					}

					objProductOption[key].push(this);

					this.addEvent('changeFirstOpt', function(firstOptName, optionName, productId, value, valueId, id){
						if(currentOptValueId != valueId){
							currentOptValueId = valueId;

							for(var i=0; i<objProductOption[productId].length; i++){
								if(i != INDEX){
									skuId = '';
									objProductOption[productId][i].setTrigger(optionName, value, valueId);
								}

								if(optionName !== 'COLOR'){
									objProductOption[productId][i].getValidateChk();
								}
							}

							// if(optionName === 'COLOR'){
							// 	gallery.setThumb(value);
							// }
						}

						//console.log( "changeFirstOpt");
						if( _.isFunction(marketingUpdateProductInfo)){
							marketingUpdateProductInfo();
						}
					});

					this.addEvent('skuComplete', function(skuOpt){
						currentSkuData = skuOpt
						if(quantity){
							var quantityState = quantityCheck(skuOpt.inventoryType, skuOpt.maxQty);
							isQuantity = quantityState.isQuantity;
							skuId = skuOpt.id;

							if(args.isDefaultSku !== 'true'){
								if(Array.isArray(quantity)){
									quantity[CURRENT_INDEX].setQuantity(1);
									quantity[CURRENT_INDEX].setMaxQuantity(quantityState.maxQty);
								}else{
									quantity.setQuantity(1);
									quantity.setMaxQuantity(quantityState.maxQty);
								}
							}
						}

						//console.log( "skuComplete");
						if( _.isFunction(marketingUpdateProductInfo)){
							marketingUpdateProductInfo();
						}
					});
				});


				/* isDefaultSku - true  ( option이 없는 경우 )  */
				if(args.isDefaultSku === 'true') defaultSkuSetup(productOption);



				//DRAW 진행사항을 체크하여 상태에 맞는 스크립트 호출
				//응모예정, 응모진행중, 응모종료, 당첨확인, 행사종료
				var drawProgress = $this.find('[data-draw-endprogress]').data('draw-endprogress');
				var redirectUrl = $(location).attr('href');
				var drawurl = sandbox.utils.contextPath + '/draw/entry/isWin';

				// if(drawProgress == '응모진행중'){
				// 	// PDP진입시 참여여부 체크
				// 	BLC.ajax({
				// 		type : "POST",
				// 		dataType : "json",
				// 		url : drawurl,
				// 		data : {
				// 			prodId : productId,
				// 			drawId : productDrawId,
				// 			redirectUrl : redirectUrl
				// 		}
				// 	},function(data){
				// 		if(data.result) {
				// 			if(data.winFlag == "win" || data.winFlag == "lose") {
				// 				$('.product-draw-inputs').remove();
				// 				$('.selector-size').remove();
				// 				$('[data-add-item]').empty().append('<a class="button button-primary flex flex-justify-center flex-align-center"><span class="btn-buy">응모완료</span></a>');
				// 			}
				// 		}
				// 	});
				// }

				$("#drawiswinBtn").click(function(e){
					e.preventDefault();

					if(!Core.getModule('module_header').getIsSignIn()){
						e.preventDefault();
						Core.getModule('module_header').setLogin(function(){
							Core.Loading.show();
							_.delay(function(){
								window.location.reload();
							}, 500);
						});
					}else{
						var drawWinPopUp = UIkit.modal('#draw-win-modal', {modal:false});
						var drawLosePopUp = UIkit.modal('#draw-lose-modal', {modal:false});

						BLC.ajax({
							type : "POST",
							dataType : "json",
							url : drawurl,
							data : {
								prodId : productId,
								drawId : productDrawId,
								redirectUrl : redirectUrl
							}
						},function(data){
							if(data.result) {
								if(data.winFlag == "win") {
									//console.log(data.result);
								    $('#drawBuyForm').attr('productId', data.productId);
								    $('#drawBuyForm').attr('fType', data.fType);
								    $('#drawBuyForm').attr('quantity', data.quantity);
								    $('#drawBuyForm').attr('SIZE', data.SIZE);
									$('#drawBuyForm').attr('COLOR', data.COLOR);
								    $('#drawBuyForm').attr('itemAttributesSize', data.itemAttributesSize);
									$('#drawBuyForm').attr('itemAttributesColor', data.itemAttributesColor);
								    $('#drawBuyForm').attr('attributenameSize', data.attributeNameSize);
									$('#drawBuyForm').attr('attributenameColor', data.attributeNameColor);

									//드로우 용 attributename 추가
									$('#drawBuyForm').attr('draw_itemAttributes', data.drawEntryId);

									//드로우 win modal - 옵션 추가
									$(".drawProductOption").text(data.displayItemAttributesColor + ' / ' + data.displayItemAttributesSize);

									UIkit.modal('#draw-win-modal', {modal:false}).show();
									//$('#draw-win-modal').find('#directOrder').attr('href',data.drawProductUrl);
								}
								else if(data.winFlag == "lose") {
									UIkit.modal('#draw-lose-modal', {modal:false}).show();
								}
								else if(data.winFlag == "notEntry") {
									alert('응모하신 내역이 없습니다.');
									//UIkit.modal('#draw-notentry-modal', {modal:false}).show();
								}
							}
						});
					}


				});



				/* cart Update */
				$('[data-add-item]').each(function(i){
					var INDEX = i;

					//매장픽업 제외 - 장바구니, 바로구매 등
					$(this).find('.btn-link').click(function(e){
						e.preventDefault();
						var _self = $(this);

						// THE DRAW Start
						var actionType = _self.attr('action-type');
						if(actionType === 'drawlogin') {
							Core.getModule('module_header').setLogin(function(){
								Core.Loading.show();
								_.delay(function(){
									window.location.reload();
								}, 500);
							});
						}else if(actionType === 'certified'){
							var certificationYnModal = UIkit.modal('#certification-yn-modal', {center:true});
							var redirectUrl = $(location).attr('href');
							$.cookie("drawCertified", 'draw', {expires: 1, path : '/'});
							$.cookie("drawRedirectUrl", redirectUrl, {expires: 1, path : '/'});
							certificationYnModal.show();
							return;
						}else if(actionType === 'drawentry'){
							// option valid
							var validateChk;
							if(args.isDefaultSku === 'false'){
								validateChk = sandbox.utils.getValidateChk(productOption, '사이즈를 선택해 주세요.');
							}

							// form valid
							var $form = $(this).parents('form');
							sandbox.validation.validate($form);

							if(validateChk && sandbox.validation.isValid($form)){
								// 개인정보 동의 체크
								var agreePolicyVal = $form.find('input[name=privacy_AgreePolicy]:checked').val();
								var agreeUseVal = $form.find('input[name=privacy_AgreeUse]:checked').val();
								var agreeValid = agreePolicyVal == 'agree' && agreeUseVal == 'agree';

								if(snsInputCheck && !agreeValid){
									var errorMsg = (agreePolicyVal !== 'agree' ? '개인정보 수집 및 이용에 동의해주세요. ' : '개인정보 취급 위탁에 동의해주세요.');
									UIkit.modal.alert(errorMsg);
								}else{
									var option =  $this.find('.hidden-option').val();
									if(option != 'undefined' && option != '' ){
										// var drawId = $("[data-drawid]").data("drawid");
										var drawurl = sandbox.utils.contextPath + '/draw/entry';
										var skuId = $this.find(".input-radio.checked").find('input').data("skuid");
										var redirectUrl = $(location).attr('href');
										var drawproductxref = $this.find(".input-radio.checked").find('input').data("drawproductxref");
										var drawskuxref = $this.find(".input-radio.checked").find('input').data("drawskuxref");
										var externalId = $("input[name=drawSnsId]").val();

										UIkit.modal.confirm('드로우에 응모하시겠습니까?', function(){
											BLC.ajax({
												type : "POST",
												dataType : "json",
												url : drawurl,
												data : {
													prodId : productId,
													drawId : productDrawId,
													skuId : skuId,
													externalId : externalId,
													redirectUrl : redirectUrl,
													drawproductxref : drawproductxref,
													drawskuxref : drawskuxref
												}
											},function(data){
												if(data.result == true){
													UIkit.modal.alert("드로우에 응모되었습니다.<br />마이페이지에서 응모 정보를 꼭 확인해주시기 바랍니다.").on('hide.uk.modal', function() {
														window.location.reload();
													});
												}else{
													UIkit.modal.alert(data.errorMessage);
												}
											});
										}, function(){},
										{
											labels: {'Ok': '확인', 'Cancel': '취소'}
										});
									}
								}
							}
						}
						// THE DRAW End

						if(productDrawId == 'null' || productDrawId == '') {
							var addToCartPromise = Method.moduleValidate(INDEX);
							addToCartPromise.then(function(qty){
								var $form = _self.closest('form');
								itemRequest = BLC.serializeObject($form);
								itemRequest['productId'] = productId;
								if(referCategoryId!=null){
									itemRequest['categoryId'] = referCategoryId;
								}
								itemRequest['quantity'] = qty;

								/* 애드온 상품 추가 */
								var $deferred = $.Deferred();
								var addonProductIndex = 0;
								if(addonComponents){
									for(var key in addonProductGroup){
										if(addonProductGroup[key][0].getValidateChk()){
											var childItems = addonProductGroup[key][0].getChildAddToCartItems();
												for(var i=0; i<childItems.length; i++){
														for(var key in childItems[i]){
													itemRequest['childAddToCartItems['+addonProductIndex+'].'+key] = childItems[i][key];
														}
												}
											addonProductIndex++;
										}else{
											$deferred.reject();
										}
									}
									$deferred.resolve(itemRequest);
								}else{
									$deferred.resolve(itemRequest);
								}

								return $deferred.promise();
							}).then(function(itemRequest){
								var $form = _self.closest('form');
								var actionType = _self.attr('action-type');
								var url = _self.attr('href');

								/*****************************************************************
									유입 channel sessionStorage
									- channel : 유입된 매체 식별 이름
									- pid : 상품 식별 code ( productId, style Code, UPC.... )

									사이트 진입시 URL에 channel, pid 가 있을때 매출을 체크 한다.
									channel 만 있을경우에는 모든 상품을 channel 매출로 인지하고
									channel과 pid 둘다 있을경우 해당 상품만 channel 매출로 인지한다.
								*****************************************************************/

								if(sandbox.sessionHistory.getHistory('channel')){
									if(sandbox.sessionHistory.getHistory('pid')){
										if(sandbox.sessionHistory.getHistory('pid') === privateId){
											itemRequest['itemAttributes[channel]'] = sandbox.sessionHistory.getHistory('channel');
										}
									}else{
										itemRequest['itemAttributes[channel]'] = sandbox.sessionHistory.getHistory('channel');
									}
								}

								switch(actionType){
									case 'externalLink' :
										//외부링크
										window.location.href = url;
										break;
									default :
										BLC.ajax({
											url:url,
											type:"POST",
											dataType:"json",
											data:itemRequest
										}, function(data, extraData){
											if(commonModal.active) commonModal.hide();
											if(data.error){
												UIkit.modal.alert(data.error);
											}else{
												var cartData = $.extend( data, {productId : productId, quantity : itemRequest.quantity, skuId : skuId });
												if(actionType === 'add'){
													sandbox.getModule('module_minicart').update( function( callbackData ){
														if( callbackData != null ){
															cartData.cartId = callbackData.cartId
														}
														endPoint.call('addToCart', cartData );
													});
												}else if(actionType === 'modify'){
													var url = Core.Utils.url.removeParamFromURL( Core.Utils.url.getCurrentUrl(), $(this).attr('name') );
													Core.Loading.show();
													endPoint.call( 'cartAddQuantity', cartData );
													_.delay(function(){
														window.location.assign( url );
													}, 500);
												}else if(actionType === 'redirect'){
													Core.Loading.show();
													endPoint.call( 'buyNow', cartData );
													_.delay(function(){
														window.location.assign( sandbox.utils.contextPath + '/checkout' );
													}, 500);
												}
											}
										});
										break;
								}
							}).fail(function(msg){
								if(!$("#common-modal").hasClass('quickview')){
									if(commonModal.active) commonModal.hide();
								}
								if(msg !== '' && msg !== undefined){
									UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'warning'});
								}
							});
						}
					});
				});

			},
			moduleValidate:function(index){
				var INDEX = index;
				var deferred = $.Deferred();
				var validateChk = (args.isDefaultSku === 'true') ? true : false;
				var qty = 0;

				if(args.isDefaultSku === 'false'){
					validateChk = sandbox.utils.getValidateChk(productOption, '사이즈를 선택해 주세요.');
				}

				if(productDrawId == 'null' || productDrawId == '') {
					if(Array.isArray(quantity)){
						qty = quantity[INDEX].getQuantity();
					}else{
						qty = quantity.getQuantity();
					}

					if(validateChk && isQuantity && qty != 0){
						deferred.resolve(qty);
						// $('.mini-option-wrap').find('.info-wrap_product').removeClass('active');
						// $('[data-miniOptionDim]').removeClass('active');
					}else if(!isQuantity || qty == 0){
						deferred.reject(args.errMsg);
					}else{
						deferred.reject();
					}
				}



				return deferred.promise();
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-launchproduct]',
					attrName:'data-module-launchproduct',
					moduleName:'module_launchproduct',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_promotion', function(sandbox){
		var endPoint;
		var Method = {
			$that:null,
			$form:null,
			$errorMessage:null,

			moduleInit:function(){
				/*
					@replaceTarget : 결과값이 들어갈 dom
					@errorMessageTarget : error message 가 들어갈 dom
				*/
				$.extend(Method, arguments[0]);

				var $this = $(this);
				Method.$that = $this;
				Method.$form = $this.find("form.promo-form");
				Method.$errorMessage = $this.find(Method.errorMessageTarget);
				endPoint = Core.getComponents('component_endpoint');

				if( Method.$form.length < 1 ){
					return;
				}

				$(this).find("button[type='submit']").on("click", function(e){
					e.preventDefault();
					Method.submitCode();
				});

				$(this).find(".promo-list .btn-delete").on("click", function(e){
					e.preventDefault();
					Method.removeCode( $(this).attr("href") );
				});

			},
			removeCode:function(url){
				sandbox.setLoadingBarState(true);
				BLC.ajax({
					url: url,
					type: "GET"
				}, function(data) {
					if (data.error && data.error == "illegalCartOperation") {
						UIkit.modal.alert(data.exception);
						sandbox.setLoadingBarState(false);
					} else {
						window.location.reload();
					}
				});
			},
			submitCode:function(){
				var $form = Method.$form;
				if($form.find('#promoCode').val() !== ''){
					sandbox.setLoadingBarState(true);
					BLC.ajax({url: $form.attr('action'),
							type: "POST",
							data: $form.serialize()
						}, function(data, extraData) {

							var endPointData = $.extend(extraData, {
								promoCode : sandbox.utils.url.getQueryStringParams( $form.serialize() ).promoCode
							});

							if (data.error && data.error == 'illegalCartOperation') {
								sandbox.setLoadingBarState(false);
								UIkit.modal.alert(data.exception);
								endPointData.exception = 'illegalCartOperation';

							} else {
								if(!extraData.promoAdded) {
									sandbox.setLoadingBarState(false);
									Method.$errorMessage.html(extraData.exception);
									Method.$errorMessage.addClass("active").removeClass('hidden');
								} else {
									if( _.isElement( Method.replaceTarget) ){
										sandbox.setLoadingBarState(false);
										$(Method.replaceTarget).html( data );
									}else{
										window.location.reload();
									}
								}
							}

							endPoint.call('applyPromoCode', endPointData);
						}
					);
					return false;
				};

			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-promotion]',
					attrName:'data-module-promotion',
					moduleName:'module_promotion',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';
	Core.register('module_lazymedia', function(sandbox){

		var Method = {
            video : [],
            count : 0,
			moduleInit: function(){
                var $this = $(this),
                    $url = $this.data('moduleLazymedia'),
                    $type = this.tagName.toLowerCase(),
                    $count = $('img[data-module-lazymedia]').length;

                !$url.length && ($url = $this.attr('src'));

                if ($type == 'img') {
                    var src = $this.attr('src').replace('?browse','?gallery');
                    var dump = $('<img class="dump-lazy-media hidden" />').attr('src', src).appendTo('body');
                    dump.load(function(){
                        $this.replaceWith( $(this).removeClass('hidden').removeClass('dump-lazy-media') );
                        if (!$('.dump-lazy-media').length) {}
                    }).ready(function(){
                        Method.count++;
                        if ( Method.count == $count ) {
                            Method.video.forEach(function(video){
                                video.target.attr('src', video.src);
                                video.target.load();
                                video.target.on('play',function(){
                                    video.target.parent().addClass('pointer-none');
                                    video.target.parent().next().removeClass('hidden');
                                })
                                video.target[0].play();
                                if (video.target[0].paused) {
                                    video.target.parent().next().addClass('hidden');
                                    video.target.parent().removeClass('pointer-none');
                                }
                            });
                        }
                    });
                }
                if ($type == 'video') {
                    Method[$type].push({
                        target : $this,
                        src : $url
                    });
                }
            }
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-lazymedia]',
					attrName:'data-module-lazymedia',
					moduleName:'module_lazymedia',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_order_delivery', function(sandbox){
		var Method = {
			$popAddressModal :null,
			$beforeAddress:null,
			$newAddress:null,
			isNewAddress:false,
			isSelectAddress:false,
			moduleInit:function(){
				var $this = $(this);

				Method.$popAddressModal = UIkit.modal("#popup-customer-address", {modal: false});
				Method.$beforeAddress = $this.find('[data-before-address]');
				Method.$newAddress = $this.find('[data-new-address]');

				// 배송지 타입이 없는건 비회원이라는 뜻
				Method.isNewAddress = ( $this.find('[data-address-type]').length == 0 ) ? true : false;

				var $personalMsg = $(this).find('[name="personalMessageText"]');
				var $personalSelect = $(this).find('select[name="selectPersonalMessage"]');
				// select가 안되어있고 msg가 있으면 직접입력 처리
				if( $personalMsg.val() != "" && $personalSelect.val() =="" ){
					$personalSelect.val('dt_1');
					$personalMsg.closest(".input-textfield").addClass('active');
				}

				var $personalMsgSelect = sandbox.getComponents('component_select', {context:$this}, function(){
					this.addEvent("change", function(){
						var value = $(this).val();
						if(value == ''){
							$personalMsg.val('');
							$personalMsg.closest(".input-textfield").removeClass('active');
						}else if(value == 'dt_1'){
							// 직접입력일 경우
							$personalMsg.val('');
							$personalMsg.closest(".input-textfield").addClass('active');
						}else{
							//$personalMsg.val( $(this).find("option:selected").val() + "||" + $(this).find("option:selected").text() );
							$personalMsg.val( $(this).find("option:selected").text());
							$personalMsg.closest(".input-textfield").removeClass('active');
						}
					});
				});

				Method.isSelectAddress = ( $(this).find('[name="isSearchAddress"]').val() == 'true' );
				var $zipCodeInput = $(this).find('[name="address.postalCode"]');
				var $zipCodeDisplay = $(this).find('[data-postalCode]');
				var deliverySearch = sandbox.getComponents('component_searchfield', {context:$this, selector:'.search-field', resultTemplate:'#address-find-list'}, function(){
					// 검색된 내용 선택시 zipcode 처리
					this.addEvent('resultSelect', function(data){
						var zipcode = $(data).data('zip-code5');
						var city = $(data).data('city');
						var doro = $(data).data('doro');

						this.getInputComponent().setValue(city + ' ' + doro);

						$zipCodeInput.val( zipcode );
						$zipCodeDisplay.text( zipcode );
						$zipCodeDisplay.parent().removeClass("active");
						Method.isSelectAddress = true;
					});
				});

				var $form = $this.find('#shipping_info');
				sandbox.validation.init( $form );

				// 배송지 정보 submit 시
				$this.find('[data-order-shipping-submit-btn]').on('click', function(e){
					e.preventDefault();
					sandbox.validation.validate( $form );
					if(sandbox.validation.isValid( $form )){
						if( Method.isNewAddress ){
							if( !deliverySearch.getValidateChk() ){
								UIkit.modal.alert("검색을 통하여 배송지를 입력해주세요.",{labels: {'Ok': '확인'}});
								return;
							}
						}
						//주문서 입력시 010 11자리, 이외는 10자리로..
						if( ($form.find('[aria-expanded]').attr('aria-expanded')=="true")  || ($form.find('[aria-expanded]').length == 0)){  //이전주소 일 경우
							var phoneNumber = $form.find('input[name="address.phonePrimary.phoneNumber"]').eq(0).val();

							//기본 배송지 일경우  이름이 최소 2자 이어야 주문가능 하게 수정.
							if($form.find('input[name="address.fullName"]').val().length < 2){
								UIkit.modal.alert('이름은 2자 이상 가능 합니다.');
								return false;
							}
						}else{  //새로입력
							var phoneNumber = $form.find('input[name="address.phonePrimary.phoneNumber"]').eq(1).val();
						}
						
						//핸드폰, 일반 전화 패턴 정의
						var hp_defalult = /^01([0|1|6|7|8|9]?)-?([0-9]{3,4})-?([0-9]{4})$/;    //새로 입력이 아닐경우, 기본 정규식 패턴 체크하기 위해서..
						var hp_pattern  = /^((01[16789])[1-9][0-9]{6,7})|(010[1-9][0-9]{7})$/;
						var cd_pattern  = /^(1[568][0456789][01456789][0-9]{4})|((01[16789])[1-9][0-9]{6,7})|(010[1-9][0-9]{7})|(050[0-9]{8,9})|((02|0[3-9][0-9])[0-9]{3,4}[0-9]{4})|(0001[568][0456789][01456789][0-9]{4})$/;
						var pattern_chk1 = false;      // false 로 기본 셋팅
						var pattern_chk2 = false;

						if(hp_defalult.test(phoneNumber)){
							pattern_chk1 = true;
						};

						if(hp_pattern.test(phoneNumber)){  //휴대폰 먼저 chk.
							pattern_chk2 = true;
						}else{
							if(cd_pattern.test(phoneNumber)){   //휴대폰 패턴이 false 경우, 일반 전화 패턴 chk.
								pattern_chk2 = true;
							};
						};

						if(!pattern_chk1 || !pattern_chk2) {    //검증 pattern_chk1, pattern_chk2 모두 true 이어야만..정상 연락처로....)
							UIkit.modal.alert('배송지 연락처를 정확하게 입력해 주세요!',{labels: {'Ok': '확인'}});
							return false;
						}

						$form.submit();
					}
				})


				// 배송지 선택 모듈 select 이벤트 호출( 배송지 선택했을때 호출됨 )
				Core.getComponents('component_customer_address', {context:$this}, function(){
					this.addEvent('select', function(data){
						Method.updateCustomerAddress( data );
						if( Method.$popAddressModal.isActive()){
							Method.$popAddressModal.hide();
						}
					})
				});

				// 배송지 선택 버튼
				$this.find('[data-customer-address-btn]').on('click', function(e){
					e.preventDefault();
					Method.$popAddressModal.show();
				});


				// 배송지 입력 타입 버튼 선택시
				$this.find('[data-address-type]').on('show.uk.switcher', function(){
					Method.isSelectAddress = deliverySearch.getValidateChk();
					Method.updateAddressInput();
				});

			},

			updateCustomerAddress:function( data ){
				var $target = Method.$beforeAddress;
				if( $target.find('[data-user-name]').length > 0 ){
					$target.find('[data-user-name]').html($.trim(data.fullName));
				}

				if( $target.find('[data-phone]').length > 0 ){
					$target.find('[data-phone]').html($.trim(data.phoneNumber));
				}

				if( $target.find('[data-postalCode]').length > 0 ){
					$target.find('[data-postalCode]').html($.trim(data.postalCode));
				}

				if( $target.find('[data-address]').length > 0 ){
					$target.find('[data-address]').html($.trim(data.addressLine1 + ' ' + data.addressLine2));
				}

				/*
				if( $target.find('[data-address2]').length > 0 ){
					$target.find('[data-address2]').text(data.addressLine2);
				}
				*/

				// 변경된 값 input 에 적용
				$target.find('input[name="address.fullName"]').val($.trim(data.fullName));
				$target.find('input[name="address.phonePrimary.phoneNumber"]').val($.trim(data.phoneNumber));
				$target.find('input[name="address.addressLine1"]').val($.trim(data.addressLine1));
				$target.find('input[name="address.addressLine2"]').val($.trim(data.addressLine2));
				$target.find('input[name="address.postalCode"]').val($.trim(data.postalCode));
			},

			updateAddressInput:function(){
				if( Method.$beforeAddress.hasClass('uk-active')){
					Method.isNewAddress = false;
					Method.$beforeAddress.find('input').attr('disabled', false );
					Method.$newAddress.find('input').attr('disabled', true );
				}else{
					Method.isNewAddress = true;
					Method.$beforeAddress.find('input').attr('disabled', true );
					Method.$newAddress.find('input').attr('disabled', false );
				}
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-order-delivery]',
					attrName:'data-module-order-delivery',
					moduleName:'module_order_delivery',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_map', function(sandbox){
		var storeList = null,
			$this,
			$infoViewContainer = null,
			map = null,
			markers = [],
			infoWindows = [],
			filterQuery = [],
			currentLocation = '',
			currentStoreIndex = 0,
			primaryStore,
			isAjax = false,
			reqPage = 1;
		/*
			store-info-view 에 추가되는 dom object

			<h2 class="tit">명동</h2>
			<span class="address">서울 영등포구 여의도동</span>
			<span class="phonenum">070-0000-0000</span>
			<dl class="info">
				<dt class="key">운영시간</dt>
				<dd class="value">평일 10:00, 주말 11:00</dd>
				<dt class="key">매장정보</dt>
				<dd class="value">네이버 지도 API v3는 JavaScript 형태로 제공되는 NAVER 지도 플랫폼으로써</dd>
			</dl>
			<button class="close-btn"><i class="icon-delete_thin"></i></button>
		*/

		/**************************

			매장검색
			매장이름, 지역검색 : _find=지하철&_search=name&_condition=like
			필터 : _find={{매장타입}}&_search=storeType&_condition=or||and

			admin에서 재고위치/대리점의 추가속성에 storeType, icon은 각각, 검색필터와 마커의 아이콘의 클래스를 입력하는 속성이다.

		***************************/

		var makeMarkerIcon = function(storeData, storeVal){

			var icon = {
				size:new naver.maps.Size(32, 57),
				anchor:new naver.maps.Point(12, 37),
				origin:new naver.maps.Point(0, 0)
			}

			if(storeData.additionalAttributes && storeData.additionalAttributes.icon && storeData.additionalAttributes.icon !== ''){
				icon.content = '<i class="icon_map_marker '+storeData.additionalAttributes.icon+'"></i>';
			}else{
				//icon.url = '/assets/images/marker-'+storeVal+'.png';
				icon.url = '/assets/images/marker-'+storeVal+'.png';
			}
			return icon;
		}

		var submitSearchMap = function($form){
			var searchQuery = $form.serializeArray(),
				searchQueryString = '',
				filterParams = location.pathname + '?';
			filterQuery = [];
			searchQuery.forEach(function(row){
				row.value = encodeURIComponent(row.value);
				if (row.name == '_find' || row.name == '_search' || row.name == '_condition' || row.name == 'pageSize') {
					searchQueryString += (row.name + '=' + row.value + '&');
				} else {
					row.value != 'all' && filterQuery.push(row.value);
				}
			});
			if(searchQueryString !== ''){
				filterParams += searchQueryString;
			}
			if (filterQuery.length) {
				filterParams += ('_find=' + filterQuery.join(',') + '&_search=storeType&_condition=like');
			}
			location.href = filterParams.replace(/[?|&]$/, '');
		}

		var Method = {
			moduleInit:function(){
				var args = arguments[0];
				$this = $(this);
				$infoViewContainer = $(this).find(args['data-module-map'].infoview);
				storeList = args['data-store-list'];
				var storeType = $this.attr('data-store-type');

				//map 초기화
				var firstLatitude = (storeList[0]) ? storeList[0].latitude:37.3595953;
				var firstLongitude = (storeList[0]) ? storeList[0].longitude:127.1053971;
				var currentParams = sandbox.utils.getQueryParams(location.href);
				var arrCurrentFilters = [];
				if(currentParams.hasOwnProperty('_find') && currentParams['_find'] instanceof Array){
					arrCurrentFilters = currentParams['_find'][1].split(',');
				}else{
					currentParams = null;
					arrCurrentFilters = null;
				}

				map = new naver.maps.Map(args['data-module-map'].target, {
					center:new naver.maps.LatLng(firstLatitude, firstLongitude),
					zoom:9
				});

				var searchField = sandbox.getComponents('component_searchfield', {context:$this}, function(){
					/*this.addEvent('beforeSubmit', function(){
						var val = arguments[0];
						$('input[name=_find]').val(val);
					});*/
					this.addEvent('searchEmpty', function($form){
						submitSearchMap($form);
					});

					this.addEvent('searchKeyword', function($form){
						submitSearchMap($form);
					});
				});

				var searchCheckBox = sandbox.getComponents('component_checkbox', {context:$this}, function(i, dom){
					if (this.getThis().prop('checked')){
						if(this.getThis()[0].value !== 'all' || this.getThis()[0].value !== '') filterQuery.push(this.getThis()[0].value);
					}
					this.addEvent('change', function(val){
						var index = filterQuery.indexOf(this.value);
						if(index === -1){
							if(this.value !== 'all') filterQuery.push(this.value);
						}else{
							filterQuery.splice(index, 1);
						}
					});

					if(arrCurrentFilters !== null && arrCurrentFilters.indexOf(encodeURIComponent(this.getThis().val())) > -1){
						this.getThis().prop('checked', true);
						this.getThis().trigger('change');
					}
				});

				var locationSelectbox = sandbox.getComponents('component_select', {context:$this}, function(i, dom){
					this.addEvent('change', function(val){
						currentLocation = val;
					});
				});

				$this.on('click', '[data-store-id]', function(){
					Method.mapEvent($(this).parent().index());
					return false;
				});
				$this.on('click', '.close-btn', function(){
					Method.mapEvent(currentStoreIndex);
					return false;
				});
				$(".search-result").on('scroll',function(){
				    var curHeight = (this.scrollTop+this.clientHeight);
				    var totHeight = this.scrollHeight;
				    if(totHeight - curHeight >= 0 && totHeight - curHeight < 100 && reqPage) {
				    	Method.addMap();
				    	isAjax = true;
				    }
				});
				$(window).on('scroll',function(e){
					var _this = $(this),
						result = $(".search-result");
					if (result.css('overflow') == 'visible') {
						var screenBotton = _this.scrollTop() + _this.height(),
							resultBotton = result.offset().top + result.height();
						if (resultBotton <= screenBotton && reqPage) {
							Method.addMap();
							isAjax = true;
						}
					}
				});
				Method.updateCheckAll();

				// 매장찾기 전체 체크시
				$(this).find('input.check-all-store[type="checkbox"]').on('change', Method.changeAllCheck);

				// 아이템 체크박스 선택시
				$(this).find('input.check-item-store[type="checkbox"]').on("change", Method.changeItemCheck);

				Method.mapInit(storeType);
			},
			// 매장찾기 전체 체크 처리
			changeAllCheck:function(e){
				e.preventDefault();
				var isCheck = $(this).prop('checked');
				$('input.check-item-store[type="checkbox"]').each( function(){
					if(isCheck == true && !$(this).prop('checked')){
						$(this).prop('checked', isCheck ).trigger('change');
					}
					if(isCheck == false && $(this).prop('checked')){
						$(this).prop('checked', isCheck ).trigger('change');
					}
				});
			},
			// 아이템 체크박스 선택시
			changeItemCheck:function(e){
				var isCheck = $(this).prop('checked');
				if( isCheck ){
					$(this).parent().addClass('checked');
				}else{
					$(this).parent().removeClass('checked');
				}
				setTimeout( function(){
					$this.find('.btn_search').trigger('click'); 
				}, 500);
				Method.updateCheckAll();
			},
			// 아이템 체크박스 변경시 전체 선택 체크박스 상태처리
			updateCheckAll:function(){
				if($('input.check-item-store[type="checkbox"]').length == $('input.check-item-store[type="checkbox"]:checked').length ){
					$('input.check-all-store[type="checkbox"]').prop( 'checked', true);
				}else{
					$('input.check-all-store[type="checkbox"]').prop( 'checked', false);
				}
			},
			getStoreList:function(id){
				for(var key in storeList){
					if(storeList[key].id == id){
						return {'info':storeList[key], 'index':key}
					}
				}
			},
			showInfoDetail:function(data){
				var template = Handlebars.compile($('#map-store-info').html())(data);
				$infoViewContainer.empty().append(template);

				$this.find('.search-result-wrap').addClass('set-active');
			},
			mapInit:function(storeType){
				//store 위도, 경도 값으로 지도 마커 찍어내기
				for (var i=0; i<storeList.length; i++) {
					var curStoreType = storeList[i].additionalAttributes.brandName;
					var position = new naver.maps.LatLng(storeList[i].latitude, storeList[i].longitude);
					var marker = new naver.maps.Marker({
						map:map,
						position:position,
						title:storeList[i].name,
						icon:makeMarkerIcon(storeList[i]),
						zIndex:100
					});

					var infoWindow = new naver.maps.InfoWindow({
						content: '<div style="width:150px;text-align:center;padding:10px;">'+ storeList[i].name +'</div>'
					});

					markers.push(marker);
					infoWindows.push(infoWindow);
				}

				for (var i=0, ii=markers.length; i<ii; i++) {
					naver.maps.Event.addListener(markers[i], 'click', getClickHandler(i));
				}

				function getClickHandler(seq){
					return function(){
						Method.mapEvent(seq);
					}
				}
			},
			mapEvent:function(seq){
				var marker = markers[seq], infoWindow = infoWindows[seq];
				if (infoWindow.getMap()) {
					infoWindow.close();
					$this.find('.search-result-wrap').removeClass('set-active');
				} else {
					infoWindow.open(map, marker);

					var objStoreInfo = Method.getStoreList($(this).attr('data-store-id'));
					Method.showInfoDetail(storeList[seq]);
					currentStoreIndex = seq;

					//선택한 store 좌표로 이동
					map.setCenter(new naver.maps.LatLng(storeList[seq].latitude, storeList[seq].longitude));
					map.setZoom(10);
				}
			},
			addMap:function() {
				if(isAjax == false && reqPage) {
					console.log(reqPage);
					reqPage = ++reqPage;

					var queryParams = sandbox.utils.getQueryParams(location.href, 'array');
					var url = (queryParams.length > 0) ? '/store?' + queryParams.join('&') : '/store';
					Core.Utils.ajax(url, 'GET',{'page':reqPage}, function(data) {
						var mapData = sandbox.rtnJson($(data.responseText).find('[data-module-map]').attr('data-store-list')) || [];
						if( data ){
							setTimeout(function(e){
								isAjax = false;
							}, 100);

							if($(data.responseText).find(".search-list").length === 0){
								reqPage = undefined;
							} else {
								mapData.forEach(function(a, b, c){
									storeList.push(a);
								});

								$(data.responseText).find(".search-list").each(function(){
									$(".search-result").append($(this));
								});

								Method.reInitMap();
							}
						}else{
							UIkit.notify(data.errorMsg, {timeout:3000,pos:'top-center',status:'danger'});
						}
					},true);
				}
			},
			reInitMap:function(){
				markers = [];
				infoWindows = [];

				Method.mapInit();
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-map]',
					attrName:['data-module-map', 'data-store-list'],
					moduleName:'module_map',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_forgot_password', function(sandbox){
		var Method = {
			$that:null,
			$form:null,
			$stepContainer:null,
			$errorAlert:null,
			moduleInit:function(){

				// listSize = 검색 결과 한번에 보여질 리스트 수
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);
				var $submitBtn = $this.find('button[type="submit"]');

				Method.$that = $this;
				Method.$form = $this.find("form");

				Method.$stepContainer = $this.find(".account-forgot-content");
				Method.$errorAlert = Method.$that.find('[data-error-alert]');

				$submitBtn.on('click', function(e){
					e.preventDefault();
					Method.searchSubmit();
				} );

				// 검색된 리스트중 선택시
				// Method.$that.on('click', '[data-customer-select-btn]', Method.selectCutomer );

				$this.on('click', '[data-certify-btn]', Method.guestCertify );

				Method.$that.on('click', '[data-back-btn]', function(){
					Method.historyBack();
				});
				if(Method.$that.data('is-customer') === false){
					Method.showAlert('검색하신 내용을 찾을 수 없습니다. 다른 정보를 이용해 다시 검색해 주십시오.');
				}
				if(Method.$that.data('is-customer') === true){
					Method.viewCustomerList();
				}
			},

			updateSelectOrder:function(e){
				e.preventDefault();
				// 자신 버튼 숨기기
				$(this).parent().hide();
				// 자신 컨텐츠 켜기
				$(this).closest('li').find('[data-certify-content]').slideDown('300');
				// 다른 버튼 보이기
				$(this).closest('li').siblings().find('[data-customer-select-btn]').parent().show();
				// 다른 컨텐츠 숨기기
				$(this).closest('li').siblings().find('[data-certify-content]').hide();
			},

			searchSubmit:function(){
				sandbox.validation.validate( Method.$form );
				if( sandbox.validation.isValid( Method.$form )){
					sandbox.utils.ajax(Method.$form.attr("action"), 'POST', Method.$form.serialize(), function(data){
						Method.createCustomerList(JSON.parse( data.responseText ));
					});
				}
			},
			viewStep:function(num){
				Method.$stepContainer.addClass('uk-hidden');
				Method.$that.find('.step-' + num ).find('input[name="identifier"]').val('');
				Method.$that.find('.step-' + num ).removeClass('uk-hidden');
			},
			showAlert:function(msg){
				UIkit.modal.alert(msg);
			},
			hideAlert:function(){
				Method.$errorAlert.addClass('uk-hidden');
			},
			historyBack:function(){
				window.history.back();
			},
			viewCustomerList:function(){
				Method.$that.on('click', '[data-customer-select-btn]',  Method.updateSelectOrder );
				//Method.viewStep(2);
			},
			createCustomerList:function(data){

				var result = data['result'];
				var $listContainer = Method.$that.find('.list-container');
				var list = data['customerData'];
				var html = '';

				if( result == true ){
					if( list.length == 0 ){
						Method.showAlert('검색하신 내용을 찾을 수 없습니다. 다른 정보를 이용해 다시 검색해 주십시오.');
					}else{
						$.each( list, function( index, li ){
							li.useName = (li.fullName!=null && $.trim(li.fullName)!='');
							li.dateCreated = li.dateCreated.slice(0, 10).split("-").join(".");
						});

						html = Handlebars.compile($("#forgot-password-list").html())(list);

						$listContainer.html( html );
						sandbox.moduleEventInjection( html );

						Method.$that.on('click', '[data-customer-select-btn]',  Method.updateSelectOrder );

						//Method.viewStep(2);
					}
				}else{
					Method.showAlert('검색하신 내용을 찾을 수 없습니다. 다른 정보를 이용해 다시 검색해 주십시오.');
				}
				///customer/requestPasswordChangeUrl?successUrl=/recover&customer=
			},

			// 비회원 인증 처리
			guestCertify:function(){
				var type = $(this).attr('data-type');
				var customerId = $(this).closest('.account-certify-actions').find('input[name="customerId"]').val();
				var email = $(this).closest('.account-certify-actions').find('input[name="email"]').val();
				var phoneNum = $(this).closest('.account-certify-actions').find('input[name="phonenum"]').val();
				var url = sandbox.utils.contextPath + "/login/requestPasswordChangeUrl";
				var messageType;

				console.log(customerId)

				if( type === 'email'){
					messageType = 'EMAIL';
				} else if ( type === 'sms' ){
					messageType = 'KAKAO';
				}
				sandbox.utils.ajax(url, 'POST', {
					customer : customerId,
					messageType : messageType,
					csrfToken : $('[name="csrfToken"]').val()
				}, function(data){
					var responseData = sandbox.rtnJson(data.responseText);
					if(responseData.result == true){
						if(type === 'email'){
							Method.viewStep(3);
						}else if(type === 'sms'){
							Method.viewStep(4);
						}
					}else{
						Method.showAlert(responseData['errorMsg']);
					}

				}, true );

				return;
			}

		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[ data-module-forgot-password ]',
					attrName:'data-module-forgot-password',
					moduleName:'module_forgot_password',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
    Core.register('module_draw_order', function(sandbox){
        var args = null;
        var Method = {
            moduleInit:function(){
                var $this = $(this);
                var url = '/cart/add?directOrder=true';
                var returnUrl = location.pathname;

                $this.find('[data-cart]').on('click', function(){

                    var csrfToken = $this.find('input[name="csrfToken"]').val();
                    var productId = $this.attr('productId');
                    var itemAttributesSize = $this.attr('itemAttributesSize');
                    var itemAttributesColor = $this.attr('itemAttributesColor');
                    var attributenameSize = $this.attr('attributeNameSize');
                    var attributenameColor = $this.attr('attributeNameColor');
                    var SIZE = $this.attr('SIZE');
                    var COLOR = $this.attr('COLOR');
                    var quantity = $this.attr('quantity');
                    var attributename = $this.attr('attributename');

                    //드로우용  Attribute  추가
                    var draw_itemAttributes = $this.attr('draw_itemAttributes');
                    var draw_attributename = $this.attr('draw_attributename');

                    var dataJson = {"productId" : productId,
                        "COLOR" : COLOR,
                        "SIZE" : SIZE,
                        "quantity" : quantity,
                        "csrfToken" : csrfToken};
                    var color         = 'itemAttributes['+attributenameColor+']';
                    var size         = 'itemAttributes['+attributenameSize+']';
                    var draw_name    = 'userDefinedFields['+draw_attributename+']';

                    dataJson[color]     = itemAttributesColor;
                    dataJson[size]      = itemAttributesSize;
                    dataJson[draw_name] = draw_itemAttributes;

                    //드로우 구매하기 버튼 태깅 추가
                    var product_name    = $this.attr('product_name');
                    var product_id      = $this.attr('product_id');
                    var product_unit_price      = $this.attr('product_unit_price');
                    var product_discount_price  = $this.attr('product_discount_price');
                    var click_area  = $this.attr('click_area');

                    data = {};
                    data.click_area = click_area;  // 마이페이지(my page) , 스니커즈pdp(pdp) 두군데 에서 진입

                    data.products = [
            					{
            						product_id : product_id,
            						product_name : product_name,
            						product_unit_price : Number(product_unit_price),
            						product_quantity : 1,   //수량
            						product_discount_price : Number(product_discount_price)
            					}
            				];

                    //endPoint.call( 'the_draw', data);  //태깅 콜 발생..


                    BLC.ajax({
                        type : "POST",
                        dataType : "json",
                        url : url,
                        data : dataJson
                    },function(data){
                        if(data.error){
                            sandbox.setLoadingBarState(false);
                            UIkit.modal.alert(data.error).on('hide.uk.modal', function () {
                                window.location.href = returnUrl;
                            });
                        }else{
                            Core.Loading.show();
                            _.delay(function () {
                                window.location.assign('/checkout');
                            }, 500);
                        }
                    });
                    return;
                });
            }
        }
        return {
            init:function(){
                sandbox.uiInit({
                    selector:'[data-module-draw-order]',
                    attrName:'data-module-draw-order',
                    moduleName:'module_draw_order',
                    handler:{context:this, method:Method.moduleInit}
                });
            }
        }
    });
})(Core);

(function(Core){
	Core.register('module_guide', function(sandbox){
		var endPoint;
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);
				
				endPoint = Core.getComponents('component_endpoint');
				$(this).on('click', function(){
					var type = $(this).data('guide-type');
					if( type == 'size'){
						endPoint.call('pdpSizeGuideClick');
					}
				})
			},
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-guide]',
					attrName:'data-module-guide',
					moduleName:'module_guide',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_product_detail', function(sandbox){
		var $this;
		var Method = {
			$pdpdetails : $('.pdp-details-section'),
			$reviewTeaser : $('.review-teaser-slider'),
			$header : $('.header-general'),
			$reviewWrap: $('[data-module-review]'),
			$slickReview : null,
			$deviceMedia : null,
      moduleInit : function(){
        $this = $(this);
        
				//PDP 옵션 상세 더보기 Btn
				$('.product-description-lead').on('click',function(){
          $('html,body').animate({ 'scrollTop' : Method.$pdpdetails.offset().top - Method.$header.height() },426);
          return false;
        });

				//PDP 옵션 리뷰 Btn
				$('.reviews-stars-link').on('click',function(){
          $('html,body').animate({ 'scrollTop' : Method.$reviewWrap.offset().top - Method.$header.height() },426);
          return false;
        });

				// PDP 상세 더보기 버튼
				Method.$pdpdetails.on('click','.pdp-details-toggle',function(){
					Method.$pdpdetails.add(this).toggleClass('active');
				})

        Method.sizeGuideAction();
        Method.tagsAccordion();
        if (!Method.$reviewTeaser.length) return false;
        Method.reviewTeaser();
        
      },
      reviewTeaser : function(){
        Method.$slickReview = Method.$reviewTeaser.slick({
          infinite: false,
          autoplay : false,
          dots:false,
          slidesToShow: 2,
          slidesToScroll: 2,
          centerPadding: 0,
          prevArrow : '<button type="button" class="icon-rotate-h slick-prev slick-arrow" title="Go to Previous"><svg class="icon"><use xlink:href="#icon-arrow"></use></svg></button>',
          nextArrow : '<button type="button" class="slick-next slick-arrow" title="Go to Next"><svg class="icon"><use xlink:href="#icon-arrow"></use></svg></button>',
          appendArrows : Method.$reviewTeaser.closest('.pdp-details-section').find('.slick-arrows'),

        });
      },
      tagsAccordion : function(){
        var tags = $('.product-tags'),
            tagsHead = tags.find('.product-tags-head'),
            tagsContent = tags.find('.product-tags-contents');
        tagsHead.on('click',function(){
          if (!tagsContent.is(':animated')) {
            tags.toggleClass('active');
            tagsContent.slideToggle();
          }
          return false;
        });
      },
      sizeGuideAction : function(){
        var chartClass = '.size-guide-chart',
          hoverText = 'hover',
          siblinghoverText = 'sibling-hover';
        $(document).on('click','[data-size-chart-toggle]',function(){
          var anchor = $(this),
            target = anchor.data('sizeChartToggle'),
            parent = anchor.parent(),
            wrap = anchor.closest('.size-guide-content');
          parent.siblings().children('a').removeClass('active');
          anchor.addClass('active');
          wrap.find('[data-size-chart-table="'+ target +'"]').removeClass('hidden').siblings().addClass('hidden');
          return false;
        });
        $(document).on('mouseenter', chartClass + ' td',function(){
          var td = $(this),
            col = td.index(),
            table = td.closest(chartClass);
          td.siblings('.exception').length && (col -= 1);
          table.find('td').removeClass(hoverText).removeClass(siblinghoverText);
          table.find('th').removeClass(siblinghoverText);
          table.find('thead').find('th').not('.exception').eq(col).addClass(siblinghoverText);
          td.addClass(hoverText);
          td.prevAll().addClass(siblinghoverText);
          td.parent().prevAll().each(function(eq, tr){
            $(tr).children().not('.exception').eq(col).addClass(siblinghoverText);
          });
        });
        $(document).on('mouseleave',chartClass,function(){
          var table = $(this);
          table.find('td').removeClass(hoverText).removeClass(siblinghoverText);
          table.find('th').removeClass(siblinghoverText);
        });
      }
    }
		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-product-detail]',
					attrName:'data-module-product-detail',
					moduleName:'module_product_detail',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';
	Core.register('module_minicart', function(sandbox){
		var args;
		var endPoint;
		var Method = {
			$that:null,
			$closeBtn:null,

			moduleInit:function(){
				var $this = $(this);
				Method.$that = $this;
				args = arguments[0];
				endPoint = Core.getComponents('component_endpoint');

				$this.on('click', '[data-remove-item]',  function(e){
					e.preventDefault();
					var model = $(this).parents("[data-product-item]").find("input[name='model']").val();
					var name = $(this).parents("[data-product-item]").find("[data-name]").data("name");
					var category = $(this).parents("[data-product-item]").find("[data-category]").data("category");
					Method.removeItem( $(this).attr('href'), model, name, category);
				});

				$this.on('click', '[data-checkout-btn]', function(e){
					e.preventDefault();
					endPoint.call('checkoutSubmit',{});
					if (_GLOBAL.DEVICE.IS_KAKAO_INAPP && !_GLOBAL.CUSTOMER.ISSIGNIN) {
						sandbox.getModule('module_kakao_in_app').submit('/checkout');
					} else {
						location.href = $(this).attr('href');
					}
				});

				$this.on('click', '[data-toggle-close]', function(e){
					e.preventDefault();
					Method.hide();
				});

				$this.on('click', 'body', function(e){
					e.preventDefault();
					Method.hide();
				});



				// Method.$toggleClose.on('click', function(){
				// 	Method.hide();
				// });
			},
			show:function(){
				//UIkit.offcanvas arguments type : selector:string, option:object
				//UIkit.offcanvas.show('#minicart', {target:'#minicart', mode:'slide', overlay:'true'});
				setTimeout(function(){
					$('.minicart-dropdown').addClass('active');
				},213)
			},
			hide:function(){
				//uikit 사용으로 hide는 필요없는 상황
				//UIkit.offcanvas.hide('#minicart');
				$('.minicart-dropdown').removeClass('active');
			},

			update:function( callback ){
				var obj = {
					'mode':'template',
					'templatePath':'/cart/partials/miniCart',
					'resultVar':'cart',
					'cache':new Date().getTime()
				}

				sandbox.utils.ajax(sandbox.utils.contextPath + '/processor/execute/cart_state', 'GET', obj, function(data){
					//console.log( data );
					var isActive = Method.$that.find('.minicart-dropdown').hasClass('active');
					var miniCart = $(data.responseText);
					isActive && miniCart.addClass('active');
					Method.$that.empty().append(miniCart);

					var miniCartItem = $(args.miniCartCnt);
					var itemSize = $($(data.responseText)[1]).val();
					var cartId = $($(data.responseText)[2]).val();

					miniCartItem.attr('icon-text-attr', itemSize);

					if( itemSize == 0 ){
						miniCartItem.addClass('empty');
					}else{
						miniCartItem.removeClass('empty');
					}

					if( callback ){
						callback( { cartId : cartId} )
					}

					UIkit.modal('#quickview-modal').hide();
					
					Method.show();
				});
			},
			removeItem:function( url, model, name, category ){
				// error 체크와 ajax 로딩 처리 추가 되야 함
				UIkit.modal.confirm("상품을 삭제 할까요?", function(){
					sandbox.utils.ajax(url, 'GET', {}, function(data){
						var param = sandbox.utils.url.getQueryStringParams( url );
						param.model = model;
						param.name = name;
						param.category = category;
						endPoint.call( 'removeFromCart', param );
						Method.update();
					});
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-minicart]',
					attrName:'data-module-minicart',
					moduleName:'module_minicart',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			show:Method.show,
			hide:Method.hide,
			update:Method.update
		}
	});
})(Core);

(function(Core){
    'use strict';

	Core.register('module_product_gallery', function(sandbox){

		var Method = {
                $reszieEvent : 'orientationchange' in window ? 'orientationchange.pdpgallery' : 'resize.pdpgallery',
                $gallery : $('.pdp-gallery-carousel'),
                $galleryControls : $('.pdp-media-gallery-controls'),
                $primary : $('.pdp-primary-image'),
                $slickGallery : null,
                $videoGallery : null,
                $deviceMedia : null,
                $isOpen : false,
                moduleInit : function(){
                    if (!Method.$gallery.length) return false;

                    Method.$videoGallery = Method.$gallery.find('video');
                    var carouselIndex = 0;
                    Method.$primary.each(function(eq, el){
                        el = $(el);
                        el.data('carouselIndex', carouselIndex);
                        carouselIndex++;
                    });
                    Method.$primary.on('click','img',function(){
                        Method.zoomGallery($(this).data('carouselIndex'));
                        return false;
                    });
                    Method.$gallery.find('.item-container:eq(0)').on('click','img',function(){
                        Method.zoomGallery(0);
                        return false;
                    });

                    Method.resizeAction();
                },
                resizeAction : function(){
                    $(window).on(Method.$reszieEvent,function(){
                        if (Method.$deviceMedia != Core.getModule('module_gnb').deviceMedia()){
                            Method.$deviceMedia = Core.getModule('module_gnb').deviceMedia();
                            Method.productGallery();
                        }
                    }).trigger(Method.$reszieEvent);
                },
                productGallery : function(){
                    if ('m' == Method.$deviceMedia){
                        Method.$gallery.on('init beforeChange',function(e,o){
                            Method.$videoGallery.length && Method.$videoGallery.get(0).pause();
                        }).on('afterChange',function(e,o){
                            var video = o.$slides.filter('.slick-active').find('video');
                            video.length && video.get(0).play();
                        });
                        Method.$slickGallery = Method.$gallery.slick({
                            infinite: false,
                            autoplay : false,
                            dots:true,
                            prevArrow : '<button type="button" class="icon-rotate-h slick-prev slick-arrow" title="Go to Previous"><svg class="icon"><use xlink:href="#icon-arrow"></use></svg></button>',
                            nextArrow : '<button type="button" class="slick-next slick-arrow" title="Go to Next"><svg class="icon"><use xlink:href="#icon-arrow"></use></svg></button>',
                            appendDots : Method.$galleryControls.find('.carousel-count'),
                            appendArrows : Method.$galleryControls,
                            customPaging : function(slick, index){
                                return (index+1)    + '/' + slick.slideCount;
                            }
                        });
                    }
                    if ('m' != Method.$deviceMedia){
                        Method.$slickGallery && Method.$slickGallery.slick('unslick');
                        Method.$videoGallery.length && Method.$videoGallery.get(0).play();
                    }
                },
                zoomGallery : function(index){
                    $('body').css('overflow','hidden');
                    var itemList = [];
                    Method.$primary.find('img').each(function(){
                        var img = $(this),
                            item = {};
                        var w = $(window).width(), h = $(window).height(), m = w>h?w:h, r1 = w/h, r2 = h/w, r = r1 < r2 ? r1 : r2;
                        var iw = img.get(0).width,
                            ih = img.get(0).height,
                            s = m/iw > m/ih ? m/iw : m/ih;
                        item.src = img.attr('src').split('?')[0];
                        item.w = iw * s;
                        item.h = ih * s;
                        itemList.push(item);
                    });

                    var pswpElement = document.querySelectorAll('.pswp')[0];
                    var pswp = new PhotoSwipe( pswpElement, Method.photoSwipeUI, itemList, {
                        index : index,
                        barsSize : {top:0,bottom:0},
                        history: false,
                        loop: false,
                        focus: false,
                        closeOnScroll : false,
                        showAnimationDuration: 0,
                        hideAnimationDuration: 0,
                        pinchToClose : false,
                        closeOnVerticalDrag : false,
                        scaleMode : 'orig',
                        getDoubleTapZoom: function(isMouseClick, item) {
                            if(isMouseClick) {
                                    return 2;
                            } else {
                                    return item.initialZoomLevel < 1 ? 2 : 1.33;
                            }
                        },
                        getThumbBoundsFn: function(index) {
                           var w = $(window).width(), h = $(window).height();
                           return {x: w/2, y:h/2, w:w};
                        },                        
                        maxSpreadZoom: 2
                    });
                    pswp.init();
                    pswp.listen('close', function() {
                        $('body').css('overflow','visible');
                        Method.$isOpen = false;
                        return false;
                    });
                    pswp.listen('afterChange', function() {
                        if ('m' == Method.$deviceMedia){
                            var index = pswp.getCurrentIndex();
                            if (Method.$videoGallery.length){
                                var videoIndex = Method.$videoGallery.closest('.item-container').index();
                                if (index >= videoIndex) {
                                    index += 1;
                                }
                            }
                            Method.$slickGallery.slick('slickGoTo',index);
                        }
                    });
                    Method.$isOpen = true;
                },
                photoSwipeUI: function photoSwipeUI(pswp, framework) {
                    var ui = this;
                    var _overlayUIUpdated = false,
                        _controlsVisible = true,
                        _fullscrenAPI,
                        _controls,
                        _captionContainer,
                        _fakeCaptionContainer,
                        _indexIndicator,
                        _shareButton,
                        _shareModal,
                        _shareModalHidden = true,
                        _initalCloseOnScrollValue,
                        _isIdle,
                        _listen,

                        _loadingIndicator,
                        _loadingIndicatorHidden,
                        _loadingIndicatorTimeout,

                        _galleryHasOneSlide,

                        _options,
                        _defaultUIOptions = {
                            barsSize: {top:0, bottom:0},
                            timeToIdle: 4000,
                            timeToIdleOutside: 1000,
                            loadingIndicatorDelay: 1000, // 2s
                            closeEl:true,
                            captionEl: true,
                            fullscreenEl: true,
                            zoomEl: true,
                            shareEl: true,
                            counterEl: true,
                            arrowEl: true,
                            preloaderEl: true,

                            tapToClose: false,
                            tapToToggleControls: true,

                            clickToCloseNonZoomable: true,
                            indexIndicatorSep: ' / ',
                            fitControlsWidth: 1200

                        },
                        _blockControlsTap,
                        _blockControlsTapTimeout;



                    var _onControlsTap = function(e) {
                        if(_blockControlsTap) {
                            return true;
                        }


                        e = e || window.event;

                        var target = e.target || e.srcElement,
                            uiElement,
                            clickedClass = target.getAttribute('class') || '',
                            found;

                        for(var i = 0; i < _uiElements.length; i++) {
                            uiElement = _uiElements[i];
                            if(uiElement.onTap && clickedClass.indexOf('pswp__' + uiElement.name ) > -1 ) {
                                uiElement.onTap();
                                found = true;

                            }
                        }

                        if(found) {
                            if(e.stopPropagation) {
                                e.stopPropagation();
                            }
                            _blockControlsTap = true;

                            // Some versions of Android don't prevent ghost click event
                            // when preventDefault() was called on touchstart and/or touchend.
                            //
                            // This happens on v4.3, 4.2, 4.1,
                            // older versions strangely work correctly,
                            // but just in case we add delay on all of them)
                            var tapDelay = framework.features.isOldAndroid ? 600 : 30;
                            _blockControlsTapTimeout = setTimeout(function() {
                                _blockControlsTap = false;
                            }, tapDelay);
                        }

                    },
                    _fitControlsInViewport = function() {
                        return !pswp.likelyTouchDevice || _options.mouseUsed || screen.width > _options.fitControlsWidth;
                    },
                    _togglePswpClass = function(el, cName, add) {
                        framework[ (add ? 'add' : 'remove') + 'Class' ](el, 'pswp__' + cName);
                    },
                    // add class when there is just one item in the gallery
                    // (by default it hides left/right arrows and 1ofX counter)
                    _countNumItems = function() {
                        var hasOneSlide = (_options.getNumItemsFn() === 1);

                        if(hasOneSlide !== _galleryHasOneSlide) {
                            _togglePswpClass(_controls, 'ui--one-slide', hasOneSlide);
                            _galleryHasOneSlide = hasOneSlide;
                        }
                    },
                    _toggleShareModalClass = function() {
                        _togglePswpClass(_shareModal, 'share-modal--hidden', _shareModalHidden);
                    },
                    _toggleShareModal = function() {

                        _shareModalHidden = !_shareModalHidden;


                        if(!_shareModalHidden) {
                            _toggleShareModalClass();
                            setTimeout(function() {
                                if(!_shareModalHidden) {
                                    framework.addClass(_shareModal, 'pswp__share-modal--fade-in');
                                }
                            }, 30);
                        } else {
                            framework.removeClass(_shareModal, 'pswp__share-modal--fade-in');
                            setTimeout(function() {
                                if(_shareModalHidden) {
                                    _toggleShareModalClass();
                                }
                            }, 300);
                        }
                        return false;
                    },
                    _hasCloseClass = function(target) {
                        /*
                        for(var    i = 0; i < _options.closeElClasses.length; i++) {
                            if( framework.hasClass(target, 'pswp__' + _options.closeElClasses[i]) ) {
                                return true;
                            }
                        }
                        */
                    },
                    _idleInterval,
                    _idleTimer,
                    _idleIncrement = 0,
                    _setupFullscreenAPI = function() {
                        if(_options.fullscreenEl && !framework.features.isOldAndroid) {
                            if(!_fullscrenAPI) {
                                _fullscrenAPI = ui.getFullscreenAPI();
                            }
                            if(_fullscrenAPI) {
                                framework.bind(document, _fullscrenAPI.eventK, ui.updateFullscreen);
                                ui.updateFullscreen();
                                framework.addClass(pswp.template, 'pswp--supports-fs');
                            } else {
                                framework.removeClass(pswp.template, 'pswp--supports-fs');
                            }
                        }
                    },
                    _setupLoadingIndicator = function() {
                        // Setup loading indicator
                        if(_options.preloaderEl) {

                            _toggleLoadingIndicator(true);

                            _listen('beforeChange', function() {

                                clearTimeout(_loadingIndicatorTimeout);

                                // display loading indicator with delay
                                _loadingIndicatorTimeout = setTimeout(function() {

                                    if(pswp.currItem && pswp.currItem.loading) {

                                        if( !pswp.allowProgressiveImg() || (pswp.currItem.img && !pswp.currItem.img.naturalWidth)    ) {
                                            // show preloader if progressive loading is not enabled,
                                            // or image width is not defined yet (because of slow connection)
                                            _toggleLoadingIndicator(false);
                                            // items-controller.js function allowProgressiveImg
                                        }

                                    } else {
                                        _toggleLoadingIndicator(true); // hide preloader
                                    }

                                }, _options.loadingIndicatorDelay);

                            });
                            _listen('imageLoadComplete', function(index, item) {
                                if(pswp.currItem === item) {
                                    _toggleLoadingIndicator(true);
                                }
                            });

                        }
                    },
                    _toggleLoadingIndicator = function(hide) {
                        if( _loadingIndicatorHidden !== hide ) {
                            _togglePswpClass(_loadingIndicator, 'preloader--active', !hide);
                            _loadingIndicatorHidden = hide;
                        }
                    },
                    _applyNavBarGaps = function(item) {
                        var gap = item.vGap;

                        if( _fitControlsInViewport() ) {

                            var bars = _options.barsSize;
                            if(_options.captionEl && bars.bottom === 'auto') {
                                if(!_fakeCaptionContainer) {
                                    _fakeCaptionContainer = framework.createEl('pswp__caption pswp__caption--fake');
                                    _fakeCaptionContainer.appendChild( framework.createEl('pswp__caption__center') );
                                    _controls.insertBefore(_fakeCaptionContainer, _captionContainer);
                                    framework.addClass(_controls, 'pswp__ui--fit');
                                }
                                if( _options.addCaptionHTMLFn(item, _fakeCaptionContainer, true) ) {

                                    var captionSize = _fakeCaptionContainer.clientHeight;
                                    gap.bottom = parseInt(captionSize,10) || 44;
                                } else {
                                    gap.bottom = bars.top; // if no caption, set size of bottom gap to size of top
                                }
                            } else {
                                gap.bottom = bars.bottom === 'auto' ? 0 : bars.bottom;
                            }

                            // height of top bar is static, no need to calculate it
                            gap.top = bars.top;
                        } else {
                            gap.top = gap.bottom = 0;
                        }
                    };

                    var _uiElements = [
                        {
                            name: 'button--zoom',
                            option: 'zoomEl',
                            onTap: pswp.toggleDesktopZoom
                        },
                        {
                            name: 'counter',
                            option: 'counterEl',
                            onInit: function(el) {
                                _indexIndicator = el;
                            }
                        },
                        {
                            name: 'button--close',
                            option: 'closeEl',
                            onTap: function() {
                                setTimeout(function(){
                                    pswp.close();
                                });
                            }
                        },
                        {
                            name: 'button--arrow--left',
                            option: 'arrowEl',
                            onTap: pswp.prev
                        },
                        {
                            name: 'button--arrow--right',
                            option: 'arrowEl',
                            onTap: pswp.next
                        },
                        {
                            name: 'preloader',
                            option: 'preloaderEl',
                            onInit: function(el) {
                                _loadingIndicator = el;
                            }
                        }
                    ];
                    var _setupUIElements = function() {
                        var item,
                            classAttr,
                            uiElement;
                        var loopThroughChildElements = function(sChildren) {
                            if(!sChildren) {
                                return;
                            }
                            var l = sChildren.length;
                            for(var i = 0; i < l; i++) {
                                item = sChildren[i];
                                classAttr = item.className;
                                for(var a = 0; a < _uiElements.length; a++) {
                                    uiElement = _uiElements[a];
                                    if(classAttr.indexOf('pswp__' + uiElement.name) > -1    ) {
                                        if( _options[uiElement.option] ) {
                                            framework.removeClass(item, 'pswp__element--disabled');
                                            if(uiElement.onInit) {
                                                uiElement.onInit(item);
                                            }
                                        } else {
                                            framework.addClass(item, 'pswp__element--disabled');
                                        }
                                    }
                                }
                            }
                        };
                        loopThroughChildElements(_controls.children);

                        var topBar =    framework.getChildByClass(_controls, 'pswp__top-bar');
                        if(topBar) {
                            loopThroughChildElements( topBar.children );
                        }
                    };

                    ui.init = function() {

                        // extend options
                        framework.extend(pswp.options, _defaultUIOptions, true);

                        // create local link for fast access
                        _options = pswp.options;

                        // find pswp__ui element
                        _controls = framework.getChildByClass(pswp.scrollWrap, 'pswp__ui');

                        // create local link
                        _listen = pswp.listen;
                        // update controls when slides change
                        _listen('beforeChange', function(){
                            ui.coverSize();
                            ui.update();
                        });

                        // toggle zoom on double-tap
                        _listen('doubleTap', function(point) {
                            var initialZoomLevel = pswp.currItem.initialZoomLevel;
                            if(pswp.getZoomLevel() !== initialZoomLevel) {
                                pswp.zoomTo(initialZoomLevel, point, 333);
                            } else {
                                pswp.zoomTo(_options.getDoubleTapZoom(false, pswp.currItem), point, 333);
                            }
                        });

                        // Allow text selection in caption
                        _listen('preventDragEvent', function(e, isDown, preventObj) {
                            var t = e.target || e.srcElement;
                            ui.update();
                            if(
                                t &&
                                t.getAttribute('class') && e.type.indexOf('mouse') > -1 &&
                                ( t.getAttribute('class').indexOf('__caption') > 0 || (/(SMALL|STRONG|EM)/i).test(t.tagName) )
                            ) {
                                preventObj.prevent = false;
                            }
                        });
                        _listen('resize', function() {
                            if (Method.$isOpen) pswp.close();
                        });
                        // bind events for UI
                        _listen('bindEvents', function() {
                            framework.bind(_controls, 'pswpTap click', _onControlsTap);
                            framework.bind(pswp.scrollWrap, 'pswpTap', ui.onGlobalTap);
                        });

                        // unbind events for UI
                        _listen('unbindEvents', function() {
                            if(!_shareModalHidden) {
                                _toggleShareModal();
                            }

                            if(_idleInterval) {
                                clearInterval(_idleInterval);
                            }
                            framework.unbind(_controls, 'pswpTap click', _onControlsTap);
                            framework.unbind(pswp.scrollWrap, 'pswpTap', ui.onGlobalTap);

                            if(_fullscrenAPI) {
                                framework.unbind(document, _fullscrenAPI.eventK, ui.updateFullscreen);
                                if(_fullscrenAPI.isFullscreen()) {
                                    _options.hideAnimationDuration = 0;
                                    _fullscrenAPI.exit();
                                }
                                _fullscrenAPI = null;
                            }
                        });

                        // clean up things when gallery is destroyed
                        _listen('destroy', function() {
                            if(_options.captionEl) {
                                if(_fakeCaptionContainer) {
                                    _controls.removeChild(_fakeCaptionContainer);
                                }
                            }

                            if(_shareModal) {
                                _shareModal.children[0].onclick = null;
                            }
                            framework.removeClass(_controls, 'pswp__ui--over-close');
                        });

                        _listen('parseVerticalMargin', _applyNavBarGaps);

                        _setupUIElements();

                        if(_options.shareEl && _shareButton && _shareModal) {
                            _shareModalHidden = true;
                        }

                        _countNumItems();

                        _setupFullscreenAPI();

                        _setupLoadingIndicator();

                        ui.coverSize();
                    };
                    ui.coverSize = function(force){
                        var w = $(window).width(), h = $(window).height(), m = w>h?w:h, r1 = w/h, r2 = h/w, r = r1 > r2 ? r1 : r2;
                        if (pswp.currItem){
                            pswp.viewportSize = {
                                x : m,
                                y : m
                            }
                            force && pswp.zoomTo(pswp.currItem.initialZoomLevel,w/2,h/2);
                        }
                    }
                    ui.update = function() {
                        // Don't update UI if it's hidden
                        ui.coverSize();
                        if(_controlsVisible && pswp.currItem) {

                            ui.updateIndexIndicator();
                            _overlayUIUpdated = true;

                        } else {
                            _overlayUIUpdated = false;
                        }

                        if(!_shareModalHidden) {
                            _toggleShareModal();
                        }

                        if(!pswp.options.loop) {
                            var index = pswp.getCurrentIndex();
                            var topBar =    framework.getChildByClass(_controls, 'pswp__top-bar');
                            var _arrowLeft = framework.getChildByClass(topBar, 'pswp__button--arrow--left');
                            var _arrowright = framework.getChildByClass(topBar, 'pswp__button--arrow--right');
                            if (!index){
                                framework.addClass(_arrowLeft,'set-invisible');
                                framework.removeClass(_arrowright,'set-invisible');
                            } else if (index == pswp.items.length - 1 ) {
                                framework.removeClass(_arrowLeft,'set-invisible');
                                framework.addClass(_arrowright,'set-invisible');
                            } else {
                                framework.removeClass(_arrowLeft,'set-invisible');
                                framework.removeClass(_arrowright,'set-invisible');
                            }
                        }
                        _countNumItems();
                    };

                    ui.updateFullscreen = function(e) {

                        if(e) {
                            // some browsers change window scroll position during the fullscreen
                            // so PhotoSwipe updates it just in case
                            setTimeout(function() {
                                pswp.setScrollOffset( 0, framework.getScrollY() );
                            }, 50);
                        }

                        // toogle pswp--fs class on root element
                        framework[ (_fullscrenAPI.isFullscreen() ? 'add' : 'remove') + 'Class' ](pswp.template, 'pswp--fs');
                    };

                    ui.updateIndexIndicator = function() {
                        if(_options.counterEl) {
                            _indexIndicator.innerHTML = (pswp.getCurrentIndex()+1) +
                                                        _options.indexIndicatorSep +
                                                        _options.getNumItemsFn();
                        }
                    };

                    ui.onGlobalTap = function(e) {
                        e = e || window.event;
                        var target = e.target || e.srcElement;
                        if(_blockControlsTap) {
                            return;
                        }
                        if(e.detail && e.detail.pointerType === 'mouse') {
                            // close gallery if clicked outside of the image
                            if(_hasCloseClass(target)) {
                                pswp.close();
                                return;
                            }
                            if(framework.hasClass(target, 'pswp__img')) {
                                if(pswp.getZoomLevel() === 1 && pswp.getZoomLevel() <= pswp.currItem.fitRatio) {
                                    if(_options.clickToCloseNonZoomable) {
                                        pswp.close();
                                    }
                                } else {
                                    pswp.toggleDesktopZoom(e.detail.releasePoint);
                                }
                            }
                        } else {
                            // tap anywhere (except buttons) to toggle visibility of controls
                            if(_options.tapToToggleControls) {
                                if(!_controlsVisible) {
                                    ui.showControls();
                                }
                            }
                            // tap to close gallery
                            if(_options.tapToClose && (framework.hasClass(target, 'pswp__img') || _hasCloseClass(target)) ) {
                                pswp.close();
                                return;
                            }

                        }
                    };
                    ui.showControls = function() {
                        _controlsVisible = true;
                        if(!_overlayUIUpdated) {
                            ui.update();
                        }
                        framework.removeClass(_controls,'pswp__ui--hidden');
                    };
                    ui.supportsFullscreen = function() {
                        var d = document;
                        return !!(d.exitFullscreen || d.mozCancelFullScreen || d.webkitExitFullscreen || d.msExitFullscreen);
                    };
                    ui.getFullscreenAPI = function() {
                        var dE = document.documentElement,
                            api,
                            tF = 'fullscreenchange';

                        if (dE.requestFullscreen) {
                            api = {
                                enterK: 'requestFullscreen',
                                exitK: 'exitFullscreen',
                                elementK: 'fullscreenElement',
                                eventK: tF
                            };
                        } else if(dE.mozRequestFullScreen ) {
                            api = {
                                enterK: 'mozRequestFullScreen',
                                exitK: 'mozCancelFullScreen',
                                elementK: 'mozFullScreenElement',
                                eventK: 'moz' + tF
                            };
                        } else if(dE.webkitRequestFullscreen) {
                            api = {
                                enterK: 'webkitRequestFullscreen',
                                exitK: 'webkitExitFullscreen',
                                elementK: 'webkitFullscreenElement',
                                eventK: 'webkit' + tF
                            };
                        } else if(dE.msRequestFullscreen) {
                            api = {
                                enterK: 'msRequestFullscreen',
                                exitK: 'msExitFullscreen',
                                elementK: 'msFullscreenElement',
                                eventK: 'MSFullscreenChange'
                            };
                        }

                        if(api) {
                            api.enter = function() {
                                // disable close-on-scroll in fullscreen
                                _initalCloseOnScrollValue = _options.closeOnScroll;
                                _options.closeOnScroll = false;

                                if(this.enterK === 'webkitRequestFullscreen') {
                                    pswp.template[this.enterK]( Element.ALLOW_KEYBOARD_INPUT );
                                } else {
                                    return pswp.template[this.enterK]();
                                }
                            };
                            api.exit = function() {
                                _options.closeOnScroll = _initalCloseOnScrollValue;

                                return document[this.exitK]();

                            };
                            api.isFullscreen = function() { return document[this.elementK]; };
                        }
                        return api;
                    };
                }
        }
		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-product-gallery]',
					attrName:'data-module-product-gallery',
					moduleName:'module_product_gallery',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_product', function(sandbox){
		var currentFirstOptValue = '';
		var currentQuantity = 1;
		var itemAttributes = '';
		var miniOptionIS = false;
		var objProductOption = {};
		var minOffsetTop = 30;
		var maxOffsetTop = 0;
		var args = null;
		var $this;
		var imgCurrentIndex;
		var categoryId = '';
		var categoryName = '';
		var productId = '';
		var skuId = '';
		var isQuickView = false;
		var isQuantity = true;
		var productOption;
		var quantity;
		var endPoint;
		var privateId;
		var currentSkuData;
		var pickupModal;
		var itemRequest;

		var quantityCheck = function(inventoryType, maxQty){
			var obj = {isQuantity:false, maxQty:0}
			if(inventoryType !== 'UNAVAILABLE'){
				if(inventoryType === 'CHECK_QUANTITY'){
					obj.isQuantity = (maxQty > 0) ? true : false;
					obj.maxQty = maxQty;
				}else if(inventoryType === 'ALWAYS_AVAILABLE'){
					obj.isQuantity = true;
					obj.maxQty = null;
				}
			}else{
				obj.isQuantity = false;
				obj.maxQty = 0;
			}

			return obj;
		}

		var defaultSkuSetup = function(productOptComponents){
			var skuData, quantityState;
			if(!productOptComponents) return;
			if(quantity){
				if(Array.isArray(productOptComponents)){
					$.each(productOptComponents, function(i){
						skuData = this.getDefaultSkuData()[0];
						quantityState = quantityCheck(skuData.inventoryType, skuData.quantity);
						quantity[i].setMaxQuantity(quantityState.maxQty);
						isQuantity = quantityState.isQuantity;
					});
				}else{
					skuData = productOptComponents.getDefaultSkuData()[0];
					quantityState = quantityCheck(skuData.inventoryType, skuData.quantity);
					quantity.setMaxQuantity(quantityState.maxQty);
					isQuantity = quantityState.isQuantity;
				}
			}
		}

		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];
				categoryId = sandbox.utils.getQueryParams(location.href).categoryid;
				categoryName = args.categoryName;
				productId = args.productId;
				privateId = args.privateId;
				referCategoryId = args.categoryId;
				endPoint = Core.getComponents('component_endpoint');

				var $dim = $('[data-miniOptionDim]');
				var guideModal = UIkit.modal('#guide', {modal:false});
				var commonModal = UIkit.modal('#common-modal', {modal:false});
				var pickUpModal = UIkit.modal('#pickup-modal', {modal:false});
				var miniCartModule = sandbox.getModule('module_minicart');
				//var pickUpModal = UIkit.modal('#pickup-popup', {modal:false});
				var gallery = sandbox.getComponents('component_gallery', {context:$this});
				var $infoHeightWrap = $('[data-info-height]');


				var addonProductGroup = {};
				var addonComponents = sandbox.getComponents('component_addon_product_option', {context:$(document)}, function(i){
					var INDEX = i;
					var key = this.getAddonId();

					if(!addonProductGroup.hasOwnProperty(key)){
						addonProductGroup[key] = [];
						INDEX = i;
					}else{
						INDEX++;
					}
					addonProductGroup[key].push(this);

					this.addEvent('addToAddOnItem', function(privateId, $selected){
						for(var i=0; i<addonProductGroup[key].length; i++){
							if(i != INDEX){
								addonProductGroup[key][i].setTrigger($selected.val(), privateId);
							}
						}
					});

					this.addEvent('itemDelete', function(privateId){
						for(var i=0; i<addonProductGroup[key].length; i++){
							if(i != INDEX){
								addonProductGroup[key][i].removeItems();
							}
						}
					});
				});

				quantity = sandbox.getComponents('component_quantity', {context:$this}, function(i){
					var INDEX = i;

					this.addEvent('change', function(qty){
						for(var i=0;i<quantity.length;i++){
							if(i !== INDEX){
								quantity[i].setQuantity(qty);
							}
						}
					});
				});


				var currentOptValueId = '';
				productOption = sandbox.getComponents('component_product_option', {context:$(document)}, function(i){ //product Option select components
					var CURRENT_INDEX = i;
					var INDEX = 0;
					var _self = this;
					var key = this.getProductId();


					if(!objProductOption.hasOwnProperty(key)){
						objProductOption[key] = [];
						INDEX = 0;
					}else{
						INDEX++;
					}

					objProductOption[key].push(this);

					this.addEvent('changeFirstOpt', function(firstOptName, optionName, productId, value, valueId, id){
						if(currentOptValueId != valueId){
							currentOptValueId = valueId;

							for(var i=0; i<objProductOption[productId].length; i++){
								if(i != INDEX){
									skuId = '';
									objProductOption[productId][i].setTrigger(optionName, value, valueId);
								}

								if(optionName !== 'COLOR'){
									objProductOption[productId][i].getValidateChk();
								}
							}

							// if(optionName === 'COLOR'){
							// 	gallery.setThumb(value);
							// }
						}

						//console.log( "changeFirstOpt");
						if( _.isFunction(marketingUpdateProductInfo)){
							marketingUpdateProductInfo();
						}
					});

					this.addEvent('skuComplete', function(skuOpt){
						currentSkuData = skuOpt
						if(quantity){
							var quantityState = quantityCheck(skuOpt.inventoryType, skuOpt.maxQty);
							isQuantity = quantityState.isQuantity;
							skuId = skuOpt.id;

							if(args.isDefaultSku !== 'true'){
								if(Array.isArray(quantity)){
									quantity[CURRENT_INDEX].setQuantity(1);
									quantity[CURRENT_INDEX].setMaxQuantity(quantityState.maxQty);
								}else{
									quantity.setQuantity(1);
									quantity.setMaxQuantity(quantityState.maxQty);
								}
							}
						}

						//console.log( "skuComplete");
						if( _.isFunction(marketingUpdateProductInfo)){
							marketingUpdateProductInfo();
						}
					});
				});

				/* 상품평 탭이동 */
				$(".review_go").click(function(){
					var review_tabMenu = $(".detail-review_view");
					$('.detail-cont-inner').removeClass('show');
					review_tabMenu.trigger('click');

					$('html, body').animate({
							scrollTop: $($(this).attr('href')).offset().top
					}, 300);
				});

				/* 픽업 신청 버튼 클릭시 비로그인이면 로그인모달  */
				$(".pickup_btn").click(function(e){
					if(!Core.getModule('module_header').getIsSignIn()){
						e.preventDefault();
						var this_url = $(this).attr('href');
						Core.getModule('module_header').setLogin(function(){
							Core.Loading.show();
							_.delay(function(){
								window.location.assign(this_url);
							}, 500);
						});
					}
				});

				//매장픽업 바로구매시
				$('.reservation-btn').click(function(e){
				e.preventDefault();
					var productUrl = $(this).parents('.info-wrap_product').find('.title-wrap a').attr('href');
					Core.Utils.ajax(productUrl, 'GET', {reservationview:true}, function(data){
						var domObject = $(data.responseText).find('#reservation-wrap');
						$('#pickup-modal').find('.contents').empty().append(domObject[0].outerHTML);
						Core.moduleEventInjection(domObject[0].outerHTML);
						pickUpModal.show();
					});
				});

				/* isDefaultSku - true  ( option이 없는 경우 )  */
				if(args.isDefaultSku === 'true') defaultSkuSetup(productOption);

				/* cart Update */
				$('[data-add-item]').each(function(i){
					var INDEX = i;

					//매장픽업 바로구매시
					// $(this).parents('#post-choice-container').find('.reservation-btn').click(function(e){
					// 	e.preventDefault();
					// 	var optionChk = Method.moduleValidate(INDEX); //옵션 체크
					// 	var productUrl = $(this).parents('.info-wrap_product').find('.title-wrap a').attr('href');
					//
					// 	optionChk.then(function(){
					// 		Core.Utils.ajax(productUrl, 'GET', {reservationview:true}, function(data){
					// 			var domObject = $(data.responseText).find('#reservation-wrap');
					// 			$('#pickup-modal').find('.contents').empty().append(domObject[0].outerHTML);
					// 			Core.moduleEventInjection(domObject[0].outerHTML);
					// 			pickUpModal.show();
					// 		});
					// 	});
					//
					// });

					//매장픽업 제외 - 장바구니, 바로구매 등
					$(this).find('.btn-link').click(function(e){
						e.preventDefault();
						var _self = $(this);
						var addToCartPromise = Method.moduleValidate(INDEX);

						addToCartPromise.then(function(qty){
							var $form = _self.closest('form');
							itemRequest = BLC.serializeObject($form);
							itemRequest['productId'] = productId;
							if(referCategoryId!=null){
								itemRequest['categoryId'] = referCategoryId;
							}
							itemRequest['quantity'] = qty;

							/* 애드온 상품 추가 */
							var $deferred = $.Deferred();
							var addonProductIndex = 0;
							if(addonComponents){
								for(var key in addonProductGroup){
									if(addonProductGroup[key][0].getValidateChk()){
										var childItems = addonProductGroup[key][0].getChildAddToCartItems();
									    for(var i=0; i<childItems.length; i++){
									        for(var key in childItems[i]){
												itemRequest['childAddToCartItems['+addonProductIndex+'].'+key] = childItems[i][key];
									        }
									    }
										addonProductIndex++;
									}else{
										$deferred.reject();
									}
								}
								$deferred.resolve(itemRequest);
							}else{
								$deferred.resolve(itemRequest);
							}

							return $deferred.promise();
						}).then(function(itemRequest){
							var $form = _self.closest('form');
							var actionType = _self.attr('action-type');
							var url = _self.attr('href');

							/*****************************************************************
								유입 channel sessionStorage
								 - channel : 유입된 매체 식별 이름
								 - pid : 상품 식별 code ( productId, style Code, UPC.... )

								사이트 진입시 URL에 channel, pid 가 있을때 매출을 체크 한다.
								channel 만 있을경우에는 모든 상품을 channel 매출로 인지하고
								channel과 pid 둘다 있을경우 해당 상품만 channel 매출로 인지한다.
							*****************************************************************/

							if(sandbox.sessionHistory.getHistory('channel')){
								if(sandbox.sessionHistory.getHistory('pid')){
									if(sandbox.sessionHistory.getHistory('pid') === privateId){
										itemRequest['itemAttributes[channel]'] = sandbox.sessionHistory.getHistory('channel');
									}
								}else{
									itemRequest['itemAttributes[channel]'] = sandbox.sessionHistory.getHistory('channel');
								}
							}

							switch(actionType){
								case 'externalLink' :
									//외부링크
									window.location.href = url;
									break;
								default :
									BLC.ajax({
										url:url,
										type:"POST",
										dataType:"json",
										data:itemRequest
									}, function(data, extraData){
										if(commonModal.active) commonModal.hide();
										if(data.error){
											UIkit.modal.alert(data.error);
										}else{
											var cartData = $.extend( data, {productId : productId, quantity : itemRequest.quantity, skuId : skuId, categoryName : categoryName });
											if(actionType === 'add'){
												miniCartModule.update( function( callbackData ){
													if( callbackData != null ){
														cartData.cartId = callbackData.cartId
													}
													endPoint.call('addToCart', cartData );
												});
											}else if(actionType === 'modify'){
												var url = Core.Utils.url.removeParamFromURL( Core.Utils.url.getCurrentUrl(), $(this).attr('name') );
												Core.Loading.show();
												endPoint.call( 'cartAddQuantity', cartData );
												_.delay(function(){
													window.location.assign( url );
												}, 500);
											}else if(actionType === 'redirect'){
												Core.Loading.show();
												endPoint.call( 'buyNow', cartData );
												if (_GLOBAL.DEVICE.IS_KAKAO_INAPP && !_GLOBAL.CUSTOMER.ISSIGNIN){
													sandbox.getModule('module_kakao_in_app').submit('/checkout');
												}else{
													_.delay(function(){
														window.location.assign( sandbox.utils.contextPath + '/checkout' );
													}, 500);
												}
											}
										}
									});
									break;
							}
						}).fail(function(msg){
							if(!$("#common-modal").hasClass('quickview')){
								if(commonModal.active) commonModal.hide();
							}
							if(msg !== '' && msg !== undefined){
								UIkit.notify(msg, {timeout:3000,pos:'top-center',status:'warning'});
							}
						});
					});
				});

				//모바일일때 무조건 미니옵션보이게
				if(Core.Utils.mobileChk) {
					miniOptionIS = true;
					$('.mini-option-wrap').stop().animate({bottom:0}, 200);
				}

				//scrollController
				var scrollArea = sandbox.scrollController(window, document, function(percent){
					var maxOffsetTop = this.getScrollTop($('footer').offset().top);
					var maxHeight = this.setScrollPer(maxOffsetTop);

					//모바일 스크롤이 맨아래일때만 숨기기
					if(!Core.Utils.mobileChk) {
						if(percent < minOffsetTop && miniOptionIS){
							miniOptionIS = false;
							$('.mini-option-wrap').stop().animate({bottom:-81}, 200);
							$('.mini-option-wrap').find('.info-wrap_product').removeClass('active');
							$dim.removeClass('active');
						}else if(percent >= minOffsetTop && percent <= maxOffsetTop && !miniOptionIS){
							miniOptionIS = true;
							$('.mini-option-wrap').stop().animate({bottom:0}, 200);
						}else if(percent > maxOffsetTop && miniOptionIS){
							miniOptionIS = false;
							$('.mini-option-wrap').stop().animate({bottom:-81}, 200);
							$('.mini-option-wrap').find('.info-wrap_product').removeClass('active');
							$dim.removeClass('active');
						}
					}
				}, 'miniOption');

				$('.minioptbtn').click(function(e){
					e.preventDefault();
					$('.mini-option-wrap').find('.info-wrap_product').addClass('active');
					$dim.addClass('active');
				});

				$('.mini-option-wrap').on('click', '.close-btn', function(e){
					e.preventDefault();
					$('.mini-option-wrap').find('.info-wrap_product').removeClass('active');
					$dim.removeClass('active');
				});

				//입고알림
				$('.sms-service-btn').click(function(e){
					e.preventDefault();
					$('.restock-add-wrap').find('.info-wrap_product').addClass('active');
					$('[data-restockAddDim]').addClass('active');
					$(".sms-apply").show();
					$(".sms-complete").hide();
				});

				// 매장픽업 선택 시 에는 입고알림 숨김
				// page 로드시 매장픽업 기본선택에 따른 hide
				if($('.post-pickup').hasClass('uk-active')){
					$(".stock-wrap").hide();
				}else{
					//click event
					$(".post-choice li").click(function(){
						if($(this).hasClass('post-pickup')){
							$(".stock-wrap").hide()
						}else{
							$(".stock-wrap").show()
						}
					});
				}

				$('.restock-add-wrap').on('click', '.close-btn', function(e){
					e.preventDefault();
					$('.restock-add-wrap').find('.info-wrap_product').removeClass('active');
					$('[data-restockAddDim]').removeClass('active');
				});

				//guide option modal
				$this.find('.option-guide').on('click', function(e){
					e.preventDefault();
					guideModal.show();
				});


				$('.uk-quickview-close').click(function(e){
					guideModal.hide();
					isQuickView = true;
				});

				guideModal.off('.uk.modal.product').on({
					'hide.uk.modal.product':function(){
						if(isQuickView){
							setTimeout(function(){
								$('html').addClass('uk-modal-page');
								$('body').css('paddingRight',15);
							});
						}
					}
				});

				//연관상품 노출[상세,퀵뷰에서만]
				if($('div[data-module-product-detail],div[data-module-product]').closest('article').hasClass('contents')) {
					$('div[data-module-product-detail]').closest('article').find(".related").show();

					$('section').each(function(e){
						if($(this).hasClass("pt_category")) {
							$('div[data-module-product]').closest('article').find(".related").show();
						}
					});
				}
			},
			moduleValidate:function(index){
				var INDEX = index;
				var deferred = $.Deferred();
				var validateChk = (args.isDefaultSku === 'true') ? true : false;
				var qty = 0;

				if(args.isDefaultSku === 'false'){
					validateChk = sandbox.utils.getValidateChk(productOption, '사이즈를 선택해 주세요.');
					if('m' == Core.getModule('module_gnb').deviceMedia() && !validateChk){
						$('html, body').animate({
							scrollTop: $($(".product-information")).offset().top
						}, 300);
					}
				}

				if(Array.isArray(quantity)){
					qty = quantity[INDEX].getQuantity();
				}else{
					qty = quantity.getQuantity();
				}

				if(validateChk && isQuantity && qty != 0){
					deferred.resolve(qty);
					// $('.mini-option-wrap').find('.info-wrap_product').removeClass('active');
					// $('[data-miniOptionDim]').removeClass('active');
				}else if(!isQuantity || qty == 0){
					deferred.reject(args.errMsg);
				}else{
					deferred.reject();
				}

				return deferred.promise();
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-product]',
					attrName:'data-module-product',
					moduleName:'module_product',
					handler:{context:this, method:Method.moduleInit}
				});
				//console.log( "product init");
				if( _.isFunction(marketingUpdateProductInfo)){
					marketingUpdateProductInfo();
				}
			},
			destroy:function(){
				$this = null;
				args = [];
				productOption = null;
				quantity = null;
			},
			getItemRequest:function(){
				return itemRequest;
			},
			getSkuData:function(){
				return currentSkuData;
			}
		}
	});
})(Core);

(function(Core){
	'use strict';

	Core.register('module_dynamicentity', function(sandbox){
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var $submitInput = $(this).find('input[name=_find]');
				var search = sandbox.getComponents('component_searchfield', {context:$this}, function(){
					this.addEvent('submit', function(target, val){
						$submitInput.val(val);
						target.submit();
					});
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-dynamicentity]',
					attrName:'data-module-dynamicentity',
					moduleName:'module_dynamicentity',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';
	Core.register('module_spatial', function(sandbox){

		var Method = {
			moduleInit: function(){
                var $this = $(this);
                $this.find('.spatial-tag').on('click',function(){
                    $this.toggleClass('toggle-active');
                })
            }
		}
		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-spatial]',
					attrName:'data-module-spatial',
					moduleName:'module_spatial',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_filter_nf', function(sandbox){
		'use strict';

		var $this, $that, latestKeywordList, $it;
		var setting = {
			selector:'[data-module-filter-nf]',
			selector2:'[data-module-gnb]',
			selector3:'[data-module-search]'
		}
		var getV = function(dataList,key) {
			dataList = dataList.replace("{","").replace("}","").replace(/\s/g,"");
			var ary = dataList.split(",");
			var map = "";
			var val = "";
			for(var i=0; i < ary.length; i++){
			    if(ary[i].indexOf(key) > -1){
			        map = ary[i].split(":");
			        val = map[1];
			        break;
			    }
			}
	        return val;
    	}

		var Method = {
			moduleInit:function(){
				$this = $(setting.selector);
				$that = $(setting.selector2);
				$it = $(setting.selector3);

				var searVal = $it.attr("data-module-search");
				var isLatestKeyword = getV(searVal,'isLatestKeyword');
				if(isLatestKeyword === 'true') {
					$it.find('.empty-btn').click(function(e){
						e.preventDefault();
						$.cookie('latestSearchKeyword',null);
						$it.find('#latest-keyword').html(Handlebars.compile($("#latest-search-keyword").html())({label:'최근 검색어',keyword:[]}));
					});
				}

				//기본 검색바노출
				//$that.find(".search-panel").css('display', 'block');

//				var scHeight = $that.find(".search-panel").css('height');
//				var thisHeight = $this.find(".contents").css('margin-top');
//				var addHeight = parseInt(scHeight,10) + parseInt(thisHeight,10);
//				var minusHeight = parseInt(addHeight,10) - parseInt(scHeight,10);

				//모바일이 아닐때만
//				if(!Core.Utils.mobileChk) {
//					$this.find(".contents").css('margin-top', addHeight+'px');
//
//					$that.find('.btn-search-close').click(function(e){
//						e.preventDefault();
//						$that.find('.search-panel').removeAttr('style');
//						$this.find(".contents").css('margin-top', minusHeight+'px');
//					});
//
//					$that.find('.gnb-search-field a').click(function(e){
//						e.preventDefault();
//						$that.find('.search-panel').css('display', 'block');
//						$that.find('.search-field').find('input[type=search]').focus();
//						$this.find(".contents").css('margin-top', addHeight+'px');
//					});
//				}

			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-filter-nf]',
					attrName:['data-module-filter-nf'],
					moduleName:'module_filter_nf',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	'use strict';
	Core.register('module_restock', function(sandbox){
		var args;
		var endPoint;
		var isAllValidate = false;
		var isInputRadioVal = false;
		var isInputTextVal = false;
		var isInputCheckVal = false;
		var Method = {
			$that:null,
			$closeBtn:null,
			$modalPolicy : null,
			$restockClass : '.modal-restock',
			$agreePolicyClass : '.agree-checkbox',
			$policyClass : '.modal-restock-policy',

			moduleInit:function(){
				var $this = $(this);
				Method.$that = $this;
				Method.$modalRestock = $(Method.$restockClass);
				Method.$modalPolicy = $(Method.$policyClass);
				Method.$modalSuccess = UIkit.modal("#modal-request-restock-success",{modal: false, center: true});
				Method.$agreePolicy = $(Method.$agreePolicyClass).find('input');
				Method.restockPolicyPopup = UIkit.modal("#modal-restock-policy",{modal: false, center: true});

				args = arguments[0];
				endPoint = Core.getComponents('component_endpoint');

				if($this.find('.variation-size.nonActive').length == $this.find('.variation-size').length){
					//UIkit.modal.alert('입고 알림 신청이 가능한 사이즈가 없습니다.');
					$("#restockAdd").attr('disabled', true);
				}

				Method.$modalRestock.find(Method.$agreePolicyClass).off('click'+Method.$agreePolicyClass).on('click'+Method.$agreePolicyClass,function(){
					if (!Method.$agreePolicy.is(':checked')){
						Method.modalPolicyShow();
					} else {
						Method.$agreePolicy.prop('checked',false);
					}
					return false;
        		});
				$this.on('click', '#restockAdd',  function(e){
					e.preventDefault();
					if(Method.getValidateAllChk()){
						Method.add();
					}
				});
				$this.on('click', '#btn-restock-delete',  function(e){
					e.preventDefault();
					var alarm_id = $(this).siblings("input[id='hidden-restock-id']").val();
					if(typeof(alarm_id) != "undefined" && alarm_id != "" && isNaN(alarm_id) == false){
						UIkit.modal.confirm('삭제 하시겠습니까?', function(){
							Core.Utils.ajax(sandbox.utils.contextPath + '/restock/remove', 'GET',{'id':alarm_id}, function(data) {
								var data = $.parseJSON( data.responseText );
								if( data.result ){
									UIkit.modal.alert( "정상적으로 삭제 되었습니다." ).on('hide.uk.modal', function() {
										location.reload();
									});
								}else{
									UIkit.notify(data.errorMsg, {timeout:3000,pos:'top-center',status:'danger'});
								}
							},true);
						});
					}else{
						UIkit.modal.alert( "삭제 실패하였습니다. 짐시 후 다시 시도 해주세요." ).on('hide.uk.modal',null);
					}
				});
				$this.on('change', 'input',  function(e){
					Method.getValidateAllChk();
				});
				$this.on('keyup','#phone', function(e){
					Method.getValidateAllChk();
				});
			},
			modalPolicyShow : function(){
				Method.restockPolicyPopup.show();
				Method.$modalPolicy.on('click'+ Method.$policyClass, '.agree-policy-action', function(){
					Method.$agreePolicy.prop('checked',true);
					Method.restockPolicyPopup.find('.uk-close').trigger('click');
					Method.getValidateAllChk();
					return false;
				});
			},
			add:function(){
				var obj = {
					'id' : '',
					'skuId' : '',
					'messageType' : '',
					'target' : ''
				}

				obj.messageType = 'KAKAO';
				obj.skuId = $("#restockSkuId").val();
				obj.target = $("#phone").val();

				Core.Utils.ajax(sandbox.utils.contextPath + '/restock/add', 'GET',obj, function(data) {
					var data = $.parseJSON( data.responseText );
					if( data.result ){
						// $(".sms-apply").hide();
						// $(".sms-complete").show();
						//
						Method.$that.find('.uk-modal-close').trigger('click');
						Method.$modalSuccess.show();
					}else{
						UIkit.notify(data.errorMsg, {timeout:3000,pos:'top-center',status:'danger'});
					}
				},true);
			},
			getValidateChk:function(val){
				var isValidate = false;
				isValidate = $(val).parsley().validate();
				return isValidate;
			},
			getValidateAllChk:function(){
				var isColorCheck = false;
				var isSizeCheck = false;
				var isPhoneCheck = false;
				var isLicenseCheck = false;
				var regExp = /^01([0|1|6|7|8|9]{1})([0-9]{3,4})([0-9]{4})$/;
				var phone = $("input[name='phone']").val();

				//상품 색상 check
				// $(".request-restock-section").find("input[type='radio'][name='COLOR']").each(function(){
				// 	if($(this).attr("checked")){
				// 		isColorCheck = true;
				// 	}
				// });
				// if(!isColorCheck){
				// 	$(".restock-option-error-msg:first").addClass('active');
				// }else{
				// 	$(".restock-option-error-msg:first").removeClass('active');
				// }
				//상품 사이즈 check
				$(".request-restock-section").find("input[type='radio'][name='SIZE']").each(function(){
					if($(this).parents('label').hasClass("checked")){
						isSizeCheck = true;
					}
				});
				if(!isSizeCheck){
					$(".restock-option-error-msg").addClass('active');
				}else{
					$(".restock-option-error-msg").removeClass('active');
				}
				//휴대폰 번호 check
				if(phone != ""){
					var regText = /^[0-9]+$/.test(phone) ? '필수 입력 항목입니다.' : '숫자만 입력 가능합니다.';
					if(regExp.test(phone)){
						isPhoneCheck = true;
						$(".restock-sms-error-msg").removeClass('active');
					}else{
						$(".restock-sms-error-msg").text(regText).addClass('active');
					}
				}else{
					$(".restock-sms-error-msg").text(regText).addClass('active');
				}
				//개인정보처리방침 check
				if($("#chb-restock-agreement").prop("checked")){
					isLicenseCheck = true;
					$(".restock-agreement-error-msg").removeClass('active');
				}else{
					$(".restock-agreement-error-msg").addClass('active');
				}

				return (isSizeCheck && isPhoneCheck && isLicenseCheck);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-restock]',
					attrName:'data-module-restock',
					moduleName:'module_restock',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			show:Method.show,
			hide:Method.hide,
			update:Method.update
		}
	});
})(Core);

(function(Core){
	Core.register('module_quickview', function(sandbox){
		var $deferred, $this, modal, args, arrQueryString = [], currentProductId, isSignIn;
		var Method = {
			$modal : null,
      $gallery : null,
      $slickGallery : null,
      $slickCount : null,
      $modalClass : '.modal-quickview',
      $galleryClass : '.pdp-gallery-main',
      $slickCountClass : '.carousel-count',
      $triggerChangeClass : '.trigger-change-option',
      $active : 'active',

			moduleInit:function(){
				args = arguments[0];
				$this = $(this);
				Method.$modal = $(Method.$modalClass);
        Method.$gallery =  $this.find(Method.$galleryClass);
				Method.$slickCount = $this.find('.carousel-count');
				
				$(".delivery-links a").click(function(){
					var target = $(this).attr('href');
					$('body').append($(target));
					var infoModal = UIkit.modal(target, {modal:false});
					infoModal.show();
				})

				Method.$gallery.on('init',function(e,o){
          Method.$slickCount.text((o.currentSlide+ 1) + '/' +  o.slideCount);
          Method.$gallery.find('.slick-dots').removeAttr('style');
        }).on('afterChange',function(e,o){
          Method.$slickCount.text((o.currentSlide+ 1) + '/' +  o.slideCount);
        });

				setTimeout(function(){
					Method.$slickGallery = Method.$gallery.slick({
	          infinite: true,
	          autoplay : false,
	          dots:true,
	          arrows: false,
	          responsive: [
	            {
	              breakpoint: 768,
	              settings: {
	                infinite: false,
	              }
	            }
	          ]
	        })
				}, 100);
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-quickview]',
					attrName:'data-module-quickview',
					moduleName:'module_quickview',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			reInitGallery:function(){

			},
		}
	});
})(Core);

(function(Core){
	Core.register('module_global_alert', function(sandbox){
		var Method = {
			moduleInit:function(){
				var $this = $(this);
				var msg = $(this).find('span').text();

				if( msg != null && $.trim(msg) ){
					UIkit.notify(msg, {timeout:0,pos:'top-center',status:'danger'});
				}
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[ data-module-global-alert]',
					attrName:'data-module-global-alert',
					moduleName:'module_global_alert',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_register', function(sandbox){
		var Method = {
			moduleInit:function(){
				var args = Array.prototype.slice.call(arguments).pop();
				$.extend(Method, args);

				var $this = $(this);
				var $submitBtn = $this.find('button[type="submit"]');

				sandbox.getComponents('component_textfield', {context:$this}, function(){
					this.addEvent('enter', function(e){
						$submitBtn.trigger("click");
					});
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-register]',
					attrName:'data-module-register',
					moduleName:'module_register',
					handler:{context:this, method:Method.moduleInit}
				});
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_ordercancel', function(sandbox){
		var $this = null,
			$modalDeferred = null, //상위 모듈에서 보낸 $.Deferred
			args = null,
			refundAmountComponent = null,
			isAbleCancel = false,
			isPartialOrderCancel = false,
			quantitySelectComponent = null,
			checkboxComponent = null,
			isToApp = false,
			isPaymentType = false,
			arrItemParentOrderItemId = [];


		var arrIndexOfs = function(key, arr){
			var arrIndex = [];
			for(var i=0; i<arr.length; i++){
				if(arr[i] === key){
					arrIndex.push(i);
				}
			}
			return arrIndex;
		}

		var Method = {
			moduleInit:function(){
				args = arguments[0];
				$this = $(this);

				//취소할 아이템
				var items = $this.find('.order-product-item');
				var orderStatusFormData = sandbox.utils.getQueryParams($this.find('#order-status-form').serialize().replace(/\+/g, ' '));
				var arrOrderItemId = [];

				isToApp = (args['data-appcard-cancel']['isAppCard'] === 'true') ? true : false;

				//주문에드온이 있다면 항상 전체취소만 가능하고
				//product 에드온이 있다면 애드온인 상품은 상위 상품에 귀속되어 전체취소만 가능하다.
				var isOrderAddon = (function(){
					var isAddon = false;
					$this.find('.order-product-item').each(function(i){
						arrOrderItemId.push($(this).attr('data-orderItemId'));
						arrItemParentOrderItemId.push($(this).attr('data-parentOrderItemId'));
						if($(this).attr('data-isAddon') === 'true'){
							isAddon = true;
						}
					});
					return isAddon;
				})();

				//결제수단이 적립금이면 전체취소만 가능
				isPaymentType = (orderStatusFormData.paymentType === 'CUSTOMER_CREDIT') ? true : false;

				isAbleCancel = (orderStatusFormData.isAble === 'true') ? true : false;
				isAblePartial = (orderStatusFormData.isAblePartial === 'true') ? true : false;
				isRefundAccount = (orderStatusFormData.isRefundAccount === 'true') ? true : false;

				refundAmountComponent = new Vue({
					el:'#refund-amount',
					data:{
						"isAbleCancel":isAbleCancel,
						"isRefundAccount":isRefundAccount,
						"isPaymentType":isPaymentType,
						"isAblePartial":(isOrderAddon || isToApp || isPaymentType) ? false : isAblePartial,
						"refundPayments":[{
							"paymentType":{"type":null,"friendlyType":null,"isFinalPayment":false},
							"orgPaymentAmount":{"amount":0,"currency":"KRW"},
							"paymentAmount":{"amount":0,"currency":"KRW"},
							"shippingAmount":{"amount":0,"currency":"KRW"},
							"taxAmount":{"amount":0,"currency":"KRW"},
							"totalAmount":{"amount":0,"currency":"KRW"}
						}],
						"refundAccountNeed":(isAbleCancel && isRefundAccount) ? true:false,
						"ableEntireVoid":(isAbleCancel && isAblePartial) ? true:false,
						"fulfillmentCharge":{"amount":0,"currency":"KRW"}
					},
					created:function(){
						this.$nextTick(function(){
							if(this.refundAccountNeed){
								$this.find('.refund-account-container').addClass('need-refund-account');
							}

							checkboxComponent = sandbox.getComponents('component_checkbox', {context:$this}, function(i){
								var INDEX = i;
								this.addEvent('change', function(checked){
									var $that = $(this),
										$val = $that.val(),
										$item = $that.closest('.order-product-item'),
										checkboxList = $this.find('.order-product-item .item-checkbox'),
										checkedCounter = 0;
									if ($val == 'all') {
										$this.find('.normal-product').each(function(){
											var input = $(this);
											input.find('input[type="checkbox"]').prop('checked', checked);
											Method.checkEvent(input.closest('.order-product-item'), checked);
										});
										checkedCounter = checkboxList.find('input[type=checkbox]:checked').length;
									} else {
										checkedCounter = checkboxList.find('input[type=checkbox]:checked').length;

										var allCheckbox = $this.find('.all-checkbox').find('input[type=checkbox]');
										var allCheck = checkboxList.length == checkedCounter;

										if (allCheckbox.prop('checked') != allCheck) {
											allCheckbox.prop('checked', allCheck);
										}
										Method.checkEvent($item, checked);
									}
									Method.submitCalculator();
								});
							});

							quantitySelectComponent = sandbox.getComponents('component_select', {context:$this}, function(){
								this.addEvent('change', function(val, $selected){

									if($(this).attr('name') === 'refundBank'){
										$(this).closest('.select-box').find('input[name="refundBankCode"]').val($selected.attr('data-bankcode-key'));
									}else if($(this).attr('name') === 'reasonType'){
										console.log(val);
									}else{
										$(this).closest('.select-box').parents('.product-mini-details').find('input[name=quantity]').val(val);
										//수량 변경시 상품사은품 Check
										var allCancel = $(this).parents('.order-product-item').attr('data-item-quantity') == val;
										var orderItemId = $(this).parents('.order-product-item').attr('data-orderitemid');
										Method.addOnCancel(allCancel, orderItemId);
										Method.submitCalculator();
									}
								});
							});

							//isAbleCancel이 true이고, checkboxComponent가 undefined일떄 계산기를 실행한다.
							//ropis일때는 계산기 로직을 제외한다. 분명 나중에 다시 수정하게 됨.

							if(isAbleCancel && !checkboxComponent){
								Method.submitCalculator();
							}

							$this.on('click', '[data-cancel-order]', function(e){
								e.preventDefault();
								if(!$(this).hasClass('disabled')){
									// Method.submitCancelOrder();
									// 앱카드 취소일경우 먼저 앱처리(단말기 카드취소) 후에 submitCancelOrder 한다.
									if(isToApp){
										Method.appCardCancel();
									}else{
										Method.submitCancelOrder();
									}
								}
							});
						});
					},
					watch:{
						refundAccountNeed:function(){
							/*if(this.refundAccountNeed === true){
								$this.find('.refund-account-container').addClass('need-refund-account');
							}else{
								$this.find('.refund-account-container').removeClass('need-refund-account');
							}*/
						}
					},
					methods:{
						isPartialVoid:function(groupCancellable, itemCancellabel, index, reverse){
							//isAbleCancel이 false이면 취소가 불가능한 주문이다.
							if(this.isAbleCancel){
								//isAblePartial이 false이면 무조건 전체취소만 가능하다.
								if(this.isAblePartial){
									//itemCancellabel이 false이면 전체취소만 가능하다.
									if(itemCancellabel){
										if(items.length <= 1 && items.attr('data-item-quantity') <= 1){
											return false;
										}else{
											return true;
										}
									}else{
										return false;
									}
								}else{
									return false;
								}

								if(arrItemParentOrderItemId[index-1]){
									if(reverse){
										return true;
									}else{
										return false;
									}
								}
							}else{
								if(reverse){
									return true;
								}else{
									return false;
								}
							}
						},
						isOrderPartialVoid:function(reverse){
							//isAbleCancel이 false일때는 취소불가능
							//isAbleCancel이 true 이고, isAblePartial이 true일때 부분취소가능
							//isAbleCancel이 true 이고, isAblePartial이 false일 전체취소만가능
							if(this.isAbleCancel){
								if(this.isAblePartial){
									if(items.length <= 1 && items.attr('data-item-quantity') <= 1){
										return false;
									}else{
										return true;
									}
								}else{
									return false;
								}
							}else{
								if(reverse){
									return true;
								}else{
									return false;
								}
							}
						},
						rtnCause:function(){
							if(this.isAbleCancel){
								if(this.isAblePartial){
									if(items.length <= 1 && items.attr('data-item-quantity') <= 1){
										return '하단의 취소 버튼을 클릭하시면 취소가 완료됩니다.';
									}else{
										return '주문을 취소하실 상품과 수량을 선택해 주세요.';
									}
								}else{
									if(this.isPaymentType) {
										return '마일리지를 사용한 주문으로 전체취소만 가능합니다. ';
									}
									return '해당 주문은 전체취소만 가능합니다.';
									//return decodeURIComponent(orderStatusFormData['restrict-partial']);
								}
							}else{
								return decodeURIComponent(orderStatusFormData['never-cause']);
							}
						},
						rtnPaymentType:function(paymentType){
							var label = '';
							switch(paymentType){
								case 'CUSTOMER_CREDIT' :
									label = '적립금';
									break;
								case 'WIRE' :
									label = '가상계좌';
									break;
								case 'GIFT_CARD' :
									label = '기프트카드';
									break;
								case 'CREDIT_CARD' :
									label = '신용카드';
									break;
								case 'KAKAO_POINT' :
									label = '카카오페이';
									break;
								case 'NAVER_PAY' :
									label = '네이버페이';
									break;
								case 'SMILE_PAY' :
									label = '스마일페이';
									break;
								case 'MOBILE' :
									label = '휴대폰소액결제';
									break;
								case 'BANK_ACCOUNT' :
									label = '실시간계좌이체';
									break;
							}
							return label;
						},
						price:function(amount){
							return sandbox.utils.price(amount);
						}
					}
				});
			},
			checkEvent:function(item, checked){
				item.find('input[type=hidden]').prop('disabled', !checked);
				item.find('select[name=quantity]').prop('disabled', !checked);

				//상품 사은품 check
				var orderItemId = item.attr('data-orderitemid');
				var maxQuantity = item.attr('data-item-quantity');
				var selectQuantity = item.find('select[name=quantity]').val();

				if(maxQuantity == 1 || maxQuantity == selectQuantity){
					Method.addOnCancel(checked, orderItemId);
				}
			},
			addOnCancel:function(val, orderItemId){

				//에드온상품이 있으면, arrItemParentOrderItemId를 비교하여 같이 취소될수있도록 처리한다.
				var orderItemIDs = orderItemId;
				var parentorderitemid;
				var addonIndex = arrItemParentOrderItemId.indexOf(orderItemIDs);
				if(addonIndex > -1) {
					$(".order-product-list").find('.order-product-item').each(function(){
						parentorderitemid = $(this).attr('data-parentorderitemid');
						if(parentorderitemid == orderItemId){
							$(this).find('input[type=hidden]').prop('disabled', !val);
							$(this).find('select').prop('disabled', !val);
						}
					});
				}
			},
			submitCalculator:function(){

				if(!args['data-module-ordercancel'].orderId){
					UIkit.notify('orderId가 없습니다.', {timeout:3000,pos:'top-center',status:'danger'});
					return;
				}

				var formData = $this.find('#cancel-items-form').serialize();
				var url = sandbox.utils.contextPath + '/account/order/partial-cancel-calculator/' + args['data-module-ordercancel'].orderId;
				var transFormData = sandbox.utils.getQueryParams(formData);
				var isFormDataValidateChk = (transFormData.hasOwnProperty('orderItemId') && transFormData.hasOwnProperty('quantity')) ? true:false;

				if(isAbleCancel && isFormDataValidateChk){
					sandbox.utils.ajax(url, 'POST', formData, function(data){
						var data = sandbox.rtnJson(data.responseText, true);
						var result = data['result'];
						if(data['result'] && data['ro']){

							//환불계좌 체크
							var isRefundAccountNeed = data['ro']['refundAccountNeed'];
							// 환불 계좌 필요여부
							if( isRefundAccountNeed ){
								console.log('환불계좌필요');
								$this.find('[data-refund-account-info]').removeClass('hidden');
								sandbox.validation.reset( $this.find('[data-refund-account-info]').find('form') );
							}else{
								$this.find('[data-refund-account-info]').addClass('hidden');
							}

							refundAmountComponent.refundPayments = [];
							for(var i=0; i<data['ro']['refundPayments'].length; i++){
								if(data['ro']['refundPayments'][i].paymentType.type !== 'COD'){
									refundAmountComponent.refundPayments.push(data['ro']['refundPayments'][i]);
								}
							}

							refundAmountComponent.refundAccountNeed = data['ro']['refundAccountNeed'];
							refundAmountComponent.ablePartialVoid = data['ro']['ablePartialVoid'];
							refundAmountComponent.fulfillmentCharge = data['ro']['fulfillmentCharge'];
							refundAmountComponent.ableEntireVoid = data['ro']['ableEntireVoid'];

							//cancelBtn enabled
							setTimeout(function(){
								$this.find('[data-cancel-order]').removeClass('disabled');
							}, 300);
						}else{
							$modalDeferred.reject(data['errorMsg']);
						}
					}, false, false, 100);
				}else{
					Method.emptyRefundPayment();
				}
			},
			emptyRefundPayment:function(){
				//계산할 금액 없음
				refundAmountComponent.refundPayments = [];

				//cancelBtn disabled
				$this.find('[data-cancel-order]').addClass('disabled');
			},
			refundAccountValidateChk:function(){
				//refundAccount validate check
				var $deferred = $.Deferred(),
					data = '';

				if(refundAmountComponent.refundAccountNeed){
					//validateChk
					var $form = $this.find('#refund-account-form');
					sandbox.validation.init( $form );
					sandbox.validation.validate( $form );

					if(sandbox.validation.isValid( $form )){
						$deferred.resolve($this.find('#refund-account-form').serialize());
					}else{
						$deferred.reject();
					}
				}else{
					$deferred.resolve();
				}

				return $deferred.promise();
			},
			submitCancelOrder:function(){
				if(!args['data-module-ordercancel'].orderId){
					UIkit.notify('orderId가 없습니다.', {timeout:3000,pos:'top-center',status:'danger'});
					return;
				}

				Method.refundAccountValidateChk().then(function(data){
					//orderCancel Item validate check
					var defer = $.Deferred();
					var cancelItemsData = $this.find('#cancel-items-form').serialize();
					var transFormData = sandbox.utils.getQueryParams(cancelItemsData);
					var currentData = sandbox.utils.getQueryParams(data, 'array');
					var isFormDataValidateChk = (transFormData.hasOwnProperty('orderItemId') && transFormData.hasOwnProperty('quantity')) ? true:false;
					if(isAbleCancel && isFormDataValidateChk){
						defer.resolve(sandbox.utils.getQueryParams(cancelItemsData, 'array').concat(currentData).join('&'));
					}else{
						defer.reject('취소할 상품을 선택해주세요.');
					}
					return defer.promise();
				}).then(function(data){
					//submitCancelOrder confirm check
					var defer = $.Deferred();
					var message = (refundAmountComponent.ableEntireVoid) ? '취소 하시겠습니까?' : '선택한 상품을 취소하시겠습니까?';
					UIkit.modal.confirm(message, function(){
						defer.resolve(data);
					}, function(){
						defer.reject();
					},{
						labels: {'Ok': '확인', 'Cancel': '취소'}
					});
					return defer.promise();
				}).then(function(data){
					//submitCancelOrder async
					var orderCancelApi = (refundAmountComponent.ableEntireVoid) ? '/account/order/cancel/' : '/account/order/partial-cancel/';
					var url = sandbox.utils.contextPath + orderCancelApi + args['data-module-ordercancel'].orderId;
					return sandbox.utils.promise({
						url:url,
						method:'POST',
						data:data
					});
				}).then(function(data){
					//part of submitCancelOrder complate
					//var data = sandbox.rtnJson(data.responseText, true);
					var marketingType = '';
					//if(data !== false){
						if( data['result'] == true ){
							var marketingData = _GLOBAL.MARKETING_DATA();
							if( marketingData.useGa == true ){

								var cancelItemsData = $this.find('#cancel-items-form').serialize();
								var transFormData = sandbox.utils.getQueryParams(cancelItemsData);

								var itemList = [];
								var $orderList = $this.find('.item-checkbox.checked').parents('.return-reason-item');
								var isArrayChk = Array.isArray(transFormData.orderItemId);

								$.each( $orderList, function( index, data ){
									if(isArrayChk){
										if($(this).data("orderitemid") == transFormData.orderItemId[index]){
											itemList.push({
												model : $(this).find("[data-model]").data("model"),
												name : $(this).find("[data-name]").data("name"),
												quantity : transFormData.quantity[index],
												price : $(this).find("[data-price]").data("price")
											});
										}
									}else{
										if($(this).data("orderitemid") == transFormData.orderItemId){
											itemList.push({
												model : $(this).find("[data-model]").data("model"),
												name : $(this).find("[data-name]").data("name"),
												quantity : transFormData.quantity,
												price : $(this).find("[data-price]").data("price")
											});
										}
									}
								});

								//결제수단이 여러개일 경우를 대비한 취소금액 Sum작업
								var _refundPayments = refundAmountComponent.refundPayments.length;
								var resultTotalAmount = 0;
								for(var i=0; i < _refundPayments; i++){
									var amountSum = refundAmountComponent.refundPayments[i].totalAmount.amount - refundAmountComponent.refundPayments[i].shippingAmount.amount;
									resultTotalAmount = resultTotalAmount + amountSum;
								}

								gtag('event', 'refund', {
									"transaction_id": args['data-module-ordercancel'].orderId,
									"value": resultTotalAmount,
									"items": itemList
								});
							}
							if(!isToApp) $modalDeferred.resolve(data);
						}else{
							if(!isToApp) $modalDeferred.reject(data['errorMsg']);
						}
					// }else{
					// 	if(!isToApp) $modalDeferred.reject();
					// }
				}).fail(function(error){
					if(error) UIkit.modal.alert(error);
				});
			},
			appCardCancel:function(){
				/* assist admin에서 앱카드 당일 취소시 사용 */
				/*
					finpay app에 보내야하는값
				{
					aditInfo:"orderId=7352" //주문ID  orderId, cartId
					cardCashSe:'CARD',
					delngSe:"0", //0:취소, 1:승인
					instlmtMonth:"0", //할부개월수
					splpc:"119000", //결제금액, 공급가
					taxxpt:"0", //면세액
					uscMuf:"CTM0 + 7352", // orderId, cartId
					vat:"11900", //부과세 10%
					callbackScript:"Core.getModule('module_order_payment').callBackFdk", app callBackFunc
				}
				*/

				UIkit.modal.confirm('app cart 취소 하시겠습니까?', function(){
					var arrQueryParams = [
						'aditInfo=orderId%3D' + args['data-module-ordercancel'].orderId,
						'cardCashSe=CARD',
						'delngSe=0',
						'instlmtMonth=0',
						'splpc=' + args['data-appcard-cancel'].totalAmount,
						'taxxpt=0',
						'uscMuf=CTM0' + args['data-module-ordercancel'].orderId,
						'vat='+ parseInt(args['data-appcard-cancel'].totalAmount) * 0.1,
						'callbackScript=Core.getModule("module_ordercancel").callBackCancelFdk'
					];
					window.location.href = "seamless://pay=ok&mode=req&"+arrQueryParams.join('&');
				},{},{
					labels: {'Ok': '확인', 'Cancel': '취소'}
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-ordercancel]',
					attrName:['data-module-ordercancel', 'data-appcard-cancel'],
					moduleName:'module_ordercancel',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				$modalDeferred = null;
				console.log('destroy orderCancel module');
			},
			setDeferred:function(defer){
				$modalDeferred = defer;
			},
			callBackCancelFdk:function(resp){
				/* finpay 결제취소 콜백 */

				UIkit.modal.alert(resp);
				//Method.submitCancelOrder();
				//var respObj = Method.parsingResponseFdk(decodeURIComponent(resp));
				/*if(respObj.setleSuccesAt == "X"){
				 	alert(respObj.setleMssage);
				 	sandbox.setLoadingBarState(false);
					var cartId = Method.$that.find("input[name='cartId']").val();
					location.href = sandbox.utils.contextPath + '/checkout/request/'+ cartId;
				}else{
					var url = sandbox.utils.contextPath + Method.$that.find("input[name=payData]").data("m-redirect-url");
					var orderId = Method.$that.find('input[name="cartId"]').val();
					var params = "?" + resp + "&orderId=" + orderId;
					location.href = url + params;
				}*/
			}
		}
	});
})(Core);

(function(Core){
	Core.register('module_instagram_embed', function(sandbox){
		var $this, args, model;
		var getFeedLoad = function(id){
			//var url = 'https://api.instagram.com/oembed/?url=http://instagr.am/p/BXW-qBZlRW1 ( feed ID ) /'  // embad
			//URL A short link, like http://instagr.am/p/fA9uwTtkSN/.
			//queryParam - MAXWIDTH, HIDECAPTION, OMITSCRIPT, CALLBACK

			sandbox.utils.jsonp('https://api.instagram.com/oembed/', {url:'http://instagr.am/p/' + id}, 'callback', function(data){
				$('#common-modal').find('.contents').empty().append(data.html);
				modal.show();

				if(window.instgrm){
					window.instgrm.Embeds.process();
				}
			});
		}

		var Method = {
			moduleInit:function(){
				$this = $(this);
				args = arguments[0];

				var arrInstagramEmbed = args.feedIds.split("|");
				var template = Handlebars.compile($(args.template).html());

				//modal init
				modal = UIkit.modal('#common-modal', {center:true});
				modal.off('.uk.modal.instagram').on({
					'hide.uk.modal.instagram':function(){
						console.log('instagram modal hide');
						$('#common-modal').find('.contents').empty();
						//delete window.instgrm;
					}
				});

				for(var i=0; i<arrInstagramEmbed.length; i++){
					var bindingHtml = template({feedId:sandbox.utils.trim(arrInstagramEmbed[i])});
					$this.append(bindingHtml);
				}

				//instagram feed Event
				$this.find('a').each(function(){
					$(this).click(function(e){
						e.preventDefault();

						getFeedLoad($(this).attr('href'));
					});
				});
			}
		}

		return {
			init:function(){
				sandbox.uiInit({
					selector:'[data-module-instagram-embed]',
					attrName:'data-module-instagram-embed',
					moduleName:'module_instagram_embed',
					handler:{context:this, method:Method.moduleInit}
				});
			},
			destroy:function(){
				console.log('product destory');
			}
		}
	});
})(Core);

